if(!thinkehr)var thinkehr={};thinkehr.f4||(thinkehr.f4={version:"1.0.59"},thinkehr.f4.PREFIX="ehr-"),thinkehr.f4.util||(thinkehr.f4.util={}),thinkehr.f4.ng||(thinkehr.f4.ng={}),thinkehr.f4.ng.CTRL_NAME||(thinkehr.f4.ng.CTRL_NAME=thinkehr.f4.PREFIX+"FormCtrl"),function namespace(){function _parseSizeViewConfig(viewConfig,sizeJson){var size=new thinkehr.f4.Size({viewConfig:viewConfig});for(var prop in sizeJson)if(sizeJson.hasOwnProperty(prop))if("field"===prop)size.setField(thinkehr.f4.FieldSize.fromString(sizeJson[prop]));else if("label"===prop){var lbl=parseInt(sizeJson[prop]);size.setLabel(isNaN(lbl)?thinkehr.f4.LabelSize.fromString(sizeJson[prop]):lbl)}else size[prop]=sizeJson[prop];return size}function _parseLayoutViewConfig(viewConfig,layoutJson){var layout=new thinkehr.f4.Layout({viewConfig:viewConfig});for(var prop in layoutJson)layoutJson.hasOwnProperty(prop)&&("field"===prop?(layoutJson[prop].align&&layout.setFieldHorizontalAlignment(thinkehr.f4.FieldHorizontalAlignment.fromString(layoutJson[prop].align)),layoutJson[prop].valign&&layout.setFieldVerticalAlignment(thinkehr.f4.FieldVerticalAlignment.fromString(layoutJson[prop].valign)),_addPropsToObject(layoutJson[prop],layout,"field",["align","valign"])):"label"===prop?(layoutJson[prop].align&&layout.setLabelHorizontalAlignment(thinkehr.f4.LabelHorizontalAlignment.fromString(layoutJson[prop].align)),layoutJson[prop].valign&&layout.setLabelVerticalAlignment(thinkehr.f4.LabelVerticalAlignment.fromString(layoutJson[prop].valign)),_addPropsToObject(layoutJson[prop],layout,"label",["align","valign"])):layout[prop]=layoutJson[prop]);return layout}function _parseLabelViewConfig(viewConfig,labelJson){var label=new thinkehr.f4.Label({viewConfig:viewConfig});return thinkehr.f4._extend(labelJson,label),label}function _parseFieldViewConfig(viewConfig,fieldJson){var fieldObject={};for(var fieldInputKey in fieldJson)if(fieldJson.hasOwnProperty(fieldInputKey))if(isObject(fieldJson[fieldInputKey])){var field=new thinkehr.f4.Field({viewConfig:viewConfig}),fieldInput=fieldJson[fieldInputKey];if(thinkehr.f4._extend(fieldInput,field),fieldInput.presentation&&field.setPresentation(thinkehr.f4.FieldPresentation.fromString(fieldInput.presentation)),fieldInput.columns){var columns=parseInt(fieldInput.columns);isNaN(columns)||field.setColumns(columns)}if(fieldInput.lines){var lines=parseInt(fieldInput.lines);isNaN(lines)||field.setLines(lines)}fieldObject[fieldInputKey]=field}else fieldObject[fieldInputKey]=fieldJson[fieldInputKey];return fieldObject}function _parseAdvancedViewConfig(viewConfig,advancedJson){return _addPropsToObject(advancedJson,viewConfig,"advanced",["hidden","readonly","viewmode"]),advancedJson.hidden&&viewConfig.setHidden(advancedJson.hidden),advancedJson.readonly&&viewConfig.setReadOnly(advancedJson.readonly),advancedJson.viewmode&&viewConfig.setViewMode(advancedJson.viewmode),null}function _parseMultiplicityViewConfig(viewConfig,multiplicityJson){if(_addPropsToObject(multiplicityJson,viewConfig,"multiplicity",["min","max"]),multiplicityJson.min){var min=parseInt(multiplicityJson.min);viewConfig.setMin(isNaN(min)?multiplicityJson.min:min)}if(multiplicityJson.max){var max=parseInt(multiplicityJson.max);viewConfig.setMax(isNaN(max)?multiplicityJson.max:max)}return null}function _addPropsToObject(from,to,toPropertyName,skip){var added=0,tmpAdd={};for(var prop in from)from.hasOwnProperty(prop)&&skip.indexOf(prop)<0&&(tmpAdd[prop]=from[prop],added++);added>0&&(to[toPropertyName]=tmpAdd)}function parseViewConfig(viewConfigPlain){var vc=new thinkehr.f4.ViewConfig;for(var prop in viewConfigPlain)if(viewConfigPlain.hasOwnProperty(prop)){var makerFunction=_knownViewConfigProps[prop];if(makerFunction){var propToAdd=makerFunction(vc,viewConfigPlain[prop]);propToAdd&&(vc[prop]=propToAdd)}else vc[prop]=viewConfigPlain[prop]}return vc}function parseFormDescription(context,formDescription,values,dependencies){var rootRmType=thinkehr.f4.RmType.fromString(formDescription.rmType);if(rootRmType!==thinkehr.f4.RmType.FORM_DEFINITION)throw new Error("Root element is not form definition");var rootObj=new thinkehr.f4.FormRootModel(formDescription);if(rootObj.setDescEl(formDescription),void 0!==rootObj.children&&delete rootObj.children,context&&rootObj.setContext(context),_parseViewConfig(rootObj,formDescription),formDescription.children)for(var i=0;i<formDescription.children.length;i++)_recursivelyParseDescription(rootObj,formDescription.children[i]);if(values||(values={}),rootObj.setValueNodeRef(values),_parseValues(rootObj,values,values),dependencies){var ast=parseDependencies(rootObj,dependencies);rootObj.setDependencyNode(ast)}return rootObj}function parseFormDescriptionSnippet(snippet,values,context){var model=_recursivelyParseDescription(null,snippet,context);return model&&(values||(values={}),_parseValues(model,values,values)),model}function _recursivelyParseDescription(parentModel,descEl,context){var model=_parseRmClassCreateObj(descEl);context&&thinkehr.f4.util.isObject(context)&&model&&model.setContext&&model.setContext(context);var parseChildren=function(model,descEl){if(descEl.children)for(var i=0;i<descEl.children.length;i++)_recursivelyParseDescription(model,descEl.children[i])};if(null!=model){_parseViewConfig(model,descEl);var isCustomFnCustomComponent=model.isCustomFunctionCustomComponent(parentModel?parentModel.getContext():null);parentModel&&!isCustomFnCustomComponent&&parentModel.insertChildModelAfterLastOfSamePath(model,!0),_parseInputs(model,descEl),_checkMinAndMax(model),isCustomFnCustomComponent||parseChildren(model,descEl),isCustomFnCustomComponent&&(model=_createCustomModel(model,descEl),parentModel&&parentModel.insertChildModelAfterLastOfSamePath(model,!0),parseChildren(model,descEl))}else{var custFnStr=_getAnnotation(descEl,"function"),hasCustomTag=_hasTag(descEl,"custom");thinkehr.f4.isCustomFunctionCustomComponent(custFnStr,hasCustomTag,parentModel.getContext())?(model=_createCustomModel(null,descEl),console.warn("Creating custom model without backing model, just descriptin for ",model.getPath())):console.warn("Skipping model creation for element: ",descEl)}return model}function _hasTag(descEl,tag){return descEl.viewConfig&&descEl.viewConfig.tags&&descEl.viewConfig.tags.indexOf(tag)>=0}function _getAnnotation(descEl,annotation){return descEl.viewConfig&&descEl.viewConfig.annotations&&void 0!=descEl.viewConfig.annotations[annotation]?descEl.viewConfig.annotations[annotation]:null}function _checkMinAndMax(model){void 0===model.min||null===model.min||thinkehr.f4.util.isInteger(model.min)||(model.min=parseInt(model.min)),void 0===model.max||null===model.max||thinkehr.f4.util.isInteger(model.max)||(model.max=parseInt(model.max))}function _parseRmClassCreateObj(descEl){var rmType,cl=getModelClassFromRmType(descEl),isGenericField=!1;if(cl)rmType=null;else if(_isContainerDesc(descEl))cl=thinkehr.f4.RmContainerModel,rmType=thinkehr.f4.RmType.fromString(descEl.rmType);else{if(!_getGenericDescFieldClass(descEl))return console.warn("Unknown rmType: ",descEl.rmType," skipping model creation"),null;cl=_getGenericDescFieldClass(descEl),isGenericField=!0}var obj=new cl(descEl);return obj.setDescEl(descEl),rmType&&obj.setRmType(rmType),obj.setIsGenericField(isGenericField),void 0!==obj.children&&delete obj.children,obj}function _createCustomModel(delegateModel,descEl){var haveDelegate=null!=delegateModel,model=new thinkehr.f4.CustomModel;model.setDelegateModel(haveDelegate?delegateModel:descEl),model.setViewConfig(new thinkehr.f4.ViewConfig({model:model}));var func;return func=haveDelegate?delegateModel.getCustomFunction():descEl.getCustomFunction?descEl.getCustomFunction():_getAnnotation(descEl,"function"),func||console.error("No initialization function specified for custom component "+model.getPath()),model.setCustomFunction(func),model}function _getGenericDescFieldClass(descEl){return thinkehr.f4.RmType.fromString(descEl.rmType)===thinkehr.f4.RmType.GENERIC_FIELD&&descEl.viewConfig&&descEl.viewConfig.field&&descEl.viewConfig.field.type?thinkehr.f4._rmTypeToClassMap[descEl.viewConfig.field.type]:null}function _isContainerDesc(descEl){return void 0!==descEl.children&&thinkehr.f4.util.isArray(descEl.children)&&descEl.rmType}function _parseViewConfig(model,descEl){var vc;return vc=descEl.viewConfig?parseViewConfig(descEl.viewConfig):new thinkehr.f4.ViewConfig,model.setViewConfig(vc),vc.setModel(model),vc}function parseInputItems(rawInputArr){var parsedInputItems=[];if(rawInputArr)for(var j=0;j<rawInputArr.length;j++){var inputItem=rawInputArr[j],inputItemObj=new thinkehr.f4.InputItem(inputItem);inputItem.validation&&inputItemObj.setValidation(new thinkehr.f4.Validation(inputItem.validation)),parsedInputItems.push(inputItemObj)}return parsedInputItems}function _parseInputs(model,descEl){if(descEl.inputs&&model instanceof thinkehr.f4.NodeModel){model.setInputs([]);for(var i=0;i<descEl.inputs.length;i++){var input=descEl.inputs[i],inputObj=new thinkehr.f4.Input(input);inputObj.setList([]),inputObj.setContext(model.getContext()),inputObj.setType(thinkehr.f4.InputType.fromString(input.type)),model.addInput(inputObj),parseInputItems(input.list).forEach(function(inputItem){inputObj.addItem(inputItem,!0)})}}}function _parseValues(model,values,rootValues){var models=[];_getModelsRecursively(model,models);for(var i=0;i<models.length;i++){var m=models[i],path=m.getPath();if(null!=path&&m.isAttachableToValueNode()&&m.getRmType()!==thinkehr.f4.RmType.FORM_DEFINITION){var segments=path.split("/");(m.getDelegateModel&&m.getDelegateModel()&&!m.getDelegateModel().getIsGenericField()||!m.getIsGenericField()&&(null==m.getDelegateModel||!m.getDelegateModel()))&&_attachValueToModels(m,segments,0,values,rootValues)}}}function recursivelyForChildModels(model,func){for(var i=0;i<model.getChildCount();i++){var childModel=model.getChildModel(i);func(childModel),recursivelyForChildModels(childModel,func)}}function _getPathChildIndex(model){if(model.getParentModel()&&model.getPath()){var allChildrenWithPath=model.getParentModel().findChildrenWithPath(model.getPath());return allChildrenWithPath.indexOf(model)}return-1}function _markModelForDeletion(model){model.__markedForDeletion=!0,recursivelyForChildModels(model,function(childModel){childModel.__markedForDeletion=!0}),model.removeFromParent()}function _attachValueToModels(model,segments,segmentIndex,values,rootValues){if(values&&!(segmentIndex>=segments.length)&&model.__markedForDeletion!==!0){var segment=segments[segmentIndex],lastSegment=segments.length===segmentIndex+1,segmentPath=_segmentsToPath(segments,segmentIndex),addedSegment=!1,pathChildIndex=-1;if(void 0===values[segment]&&(pathChildIndex=_getPathChildIndex(model),pathChildIndex>0?_markModelForDeletion(model):(values[segment]=values===rootValues?{}:[],addedSegment=!0)),void 0!==values[segment]){var val,valRef,parentValRef,node=values[segment];if(lastSegment){if(0>pathChildIndex&&(pathChildIndex=_getPathChildIndex(model)),pathChildIndex>0)!thinkehr.f4.util.isArray(node)||pathChildIndex>=node.length?_markModelForDeletion(model):(parentValRef=node,valRef=node[pathChildIndex],val=node[pathChildIndex]);else if(thinkehr.f4.util.isArray(node))if(0!==node.length||model.isMulti()&&model.isValueModel())if(1!==node.length||model.isMulti()&&model.isValueModel()){var doSplit;if(model.isMulti()?(val=node,valRef=node,parentValRef=values,doSplit=!0):(console.warn("Multiple values received for non-multi model",segmentPath,", will only use the last one."),val=node[node.length-1],valRef=val,parentValRef=node,doSplit=!1),doSplit&&!model.isValueModel()&&!addedSegment){if(segmentPath!=model.getPath())throw new Error("Segment path not the same as model path when we want to possibly split the model. Coding error?");for(var parentModel=model.getParentModel(),i=1;i<valRef.length;i++){var childModel=parentModel.findChildWithPath(segmentPath,i);if(!childModel&&(_recursivelyParseDescription(parentModel,model.getDescEl()),childModel=parentModel.findChildWithPath(segmentPath,i),!childModel))throw Error("Could not create child model for",model.getPath(),".");childModel.setValueNodeRef(valRef[i]),childModel.setValueNodeParentRef(valRef);var subModels=[];_getModelsRecursively(childModel,subModels),subModels.shift();for(var j=0;j<subModels.length;j++){var subModel=subModels[j];if(null!=subModel.getPath()){var subModelSegments=subModel.getPath().split("/");_attachValueToModels(subModel,subModelSegments,0,rootValues,rootValues)}}}parentValRef=valRef,valRef=valRef[0]}}else val=node[0],valRef=node[0],parentValRef=node;else val=null,addedSegment&&!model.isValueModel()?(valRef={},node.push(valRef)):valRef=null,parentValRef=node;else val=node,valRef=node,parentValRef=values;if(model.setValueNodeRef(valRef),model.setValueNodeParentRef(parentValRef),model.isValueModel()&&(model.setValue(val),model._setSkipDefaultValue(!1)),parentValRef||model.__markedForDeletion===!0||console.warn("Parent value reference is null for",model,". Is this legal?"),model.getRmType()===thinkehr.f4.RmType.CUSTOM&&model.getDelegateModel()&&void 0!==model.getDelegateModel().getRmType){var dm=model.getDelegateModel();dm.setValueNodeParentRef(parentValRef),dm.setValueNodeRef(valRef),dm.isValueModel()&&(dm.setValue(val),dm._setSkipDefaultValue(!1))}}else{var ancestorForSegment=model.findAncestorWithPath(segmentPath);if(ancestorForSegment)return void _attachValueToModels(model,segments,segmentIndex+1,ancestorForSegment.getValueNodeRef(),rootValues);val=null,parentValRef=null,thinkehr.f4.util.isArray(node)?(node.length>1&&console.warn("A split occurred in the model at",segmentPath," will only use last value from the array for further processing"),addedSegment?(valRef={},node.push(valRef)):valRef=0===node.length?null:node[node.length-1]):valRef=node}_attachValueToModels(model,segments,segmentIndex+1,valRef,rootValues)}}}function _segmentsToPath(segments,lastIndex){var index=void 0===lastIndex?segments.length:lastIndex+1,sliced=segments.slice(0,index);return sliced.join("/")}function refreshValues(model,values){model.getRmType()===thinkehr.f4.RmType.FORM_DEFINITION&&model.setValueNodeRef(values),_parseValues(model,values,values),model._triggerModelRefreshed(),recursivelyForChildModels(model,function(m){m._triggerModelRefreshed()})}function _getModelsRecursively(model,flatArray){flatArray.push(model);for(var i=0;i<model.getChildCount();i++){var childModel=model.getChildModel(i);_getModelsRecursively(childModel,flatArray)}}function _findDependencyDef(formId,deps){for(var i=0;i<deps.length;i++){var f=deps[i];if(f.field==formId)return f}}function isCustomFunctionCustomComponent(customFunctionString,hasCustomTagValue,context){if(!customFunctionString)return!1;var customFnRef=null;try{customFnRef=resolveCustomFunctionFromString(customFunctionString,context)}catch(e){console.error("Custom function on path '"+customFunctionString+"' is not defined.")}return customFnRef&&customFnRef instanceof Function?hasCustomTagValue:customFnRef&&"object"==typeof customFnRef&&customFnRef&&null!=customFnRef["function"]?null==customFnRef.customComponent?hasCustomTagValue:1==customFnRef.customComponent:!1}function resolveCustomFunctionFromString(customFnString,ehrContext){if(!customFnString)return null;var customFnRef=null;if(!customFnRef&&ehrContext&&ehrContext.namespaceResolver){var cfPackagePath=ehrContext.namespaceResolver(customFnString);try{customFnRef=eval(cfPackagePath+"."+[customFnString])}catch(e){}}if(!customFnRef&&ehrContext&&ehrContext.namespace)try{customFnRef=eval(ehrContext.namespace+"."+[customFnString])}catch(e){}if(!customFnRef)try{customFnRef=eval(customFnString)}catch(e){}return customFnRef}function getCustomFunctionReference(customFunctionString,ehrContext){var customFnRef=resolveCustomFunctionFromString(customFunctionString,ehrContext);return customFnRef&&customFnRef instanceof Function?customFnRef:customFnRef&&"object"==typeof customFnRef&&customFnRef&&null!=customFnRef["function"]?customFnRef["function"]:null}function duplicateModel(model,insertAfterModel){var values={},rm=model.getRootModel(),context=rm?rm.getContext():null,newModel=parseFormDescriptionSnippet(model.getDescEl(),values,context);if(rm=model.getRootModel(),rm&&rm.getRmType()===thinkehr.f4.RmType.FORM_DEFINITION){var ast=rm.getDependencyNode();if(ast&&ast.fields().length>0){var depsJson=ast.getRawDesc(),cm=[];_getModelsRecursively(newModel,cm),cm.forEach(function(m){var fieldJson=_findDependencyDef(m.getPath(),depsJson);fieldJson&&parseDependencyField(ast,fieldJson,m)})}ast&&ast.fields().length>0&&getThenStatementsWithModelPath(ast,model.getPath()).forEach(function(thenStatement){thenStatement.addTarget(newModel)})}if(insertAfterModel){var index,parent=model.getParentModel();parent&&(index=parent.getChildModels().indexOf(insertAfterModel),parent&&index>=0&&parent.insertChildModelAt(index+1,newModel));var parentValRef=model.getValueNodeParentRef();parentValRef&&thinkehr.f4.util.isArray(parentValRef)&&(newModel.setValueNodeParentRef(parentValRef),void 0===index||0>index?parentValRef.push(newModel.getValueNodeRef()):parentValRef.splice(index+1,0,newModel.getValueNodeRef()))}return newModel}function destroyModel(model){model.removeFromParent();var parentValRef=model.getValueNodeParentRef(),valRef=model.getValueNodeRef();if(parentValRef&&valRef&&thinkehr.f4.util.isArray(parentValRef)){var index=parentValRef.indexOf(valRef);index>=0&&parentValRef.splice(index,1)}}function setExternalContext(model,context){if(model.getRmType()!==thinkehr.f4.RmType.FORM_DEFINITION)throw new Error("External context can only be attached to the root form model");model._externalContext=context}function _getArrayOperatorFunction(operator,rmType){var key=operator.op+"/"+rmType,fnHostObj=_operatorFunctions[key]||_operatorFunctions[operator.op];return fnHostObj.arrayOperFn}function _getLhsComparisonFunction(operator,rmType,model){var key=operator.op+"/"+rmType,lhsFunc=_lhsFunctions[key]||_lhsFunctions[rmType]||_lhsFunctions._default;return lhsFunc?lhsFunc.call(null,model):void 0}function _getRhsComparisonLiteralFactory(operator,rmType){var key=operator.op+"/"+rmType;return _literalFactories[key]||_literalFactories[rmType]||_literalFactories._default}function _getConditionExpressionClass(operator,rmType){var key=operator.op+"/"+rmType,ce=_conditionExpressionClasses[key]||_conditionExpressionClasses["["+operator.opType+"]"+rmType]||_conditionExpressionClasses[rmType];return ce?eval(ce):"bin"===operator.opType?thinkehr.f4.AstBinaryExpression:thinkehr.f4.AstUnaryExpression}function _getActionStatementClass(action,targetRmType){var key=action.action+"/"+targetRmType,aSt=_actionStatementClasses[key]||_actionStatementClasses[action.action];return aSt?eval(aSt):thinkehr.f4.AstNoopStatement}function _collectFieldDependencies(deps){for(var collectedDeps=[],i=0;i<deps.length;i++){var currDepConfig=deps[i],cleanDepConfig=_findDependencyDef(currDepConfig.field,collectedDeps);cleanDepConfig?cleanDepConfig.conditions=cleanDepConfig.conditions.concat(currDepConfig.conditions.slice()):collectedDeps.push(currDepConfig)}return collectedDeps}function parseDependencies(rootModel,deps){deps=_collectFieldDependencies(deps);var ast=new thinkehr.f4.Ast({rawDesc:deps});return thinkehr.f4.util.isArray(deps)&&deps.forEach(function(fieldJson){var fieldId=fieldJson.field,models=rootModel.findSuccessorsWithPath(fieldId);models.length>0?models.forEach(function(model){parseDependencyField(ast,fieldJson,model)}):console.warn("Could not find model for",fieldId,"skipping dependency creation for it.")}),ast}function getThenStatementsWithModelPath(ast,modelPath){var fields=ast.fields(),thenStatementsWithModelPath=[];return fields&&fields.forEach(function(currField){currField.conditions().forEach(function(currCond){currCond.thenStatement&&currCond.thenStatement.elements&&currCond.thenStatement.elements().forEach(function(currThenStatement){currThenStatement.getTargets().forEach(function(actionTarget){actionTarget.getPath()===modelPath&&thenStatementsWithModelPath.push(currThenStatement)})})})}),thenStatementsWithModelPath}function parseDependencyField(ast,fieldJson,model){var fieldId=fieldJson.field,astField=new thinkehr.f4.AstField({rawDesc:fieldJson,field:fieldId});if(null===astField.getFieldId()||""===astField.getFieldId())throw new Error("Could not determine dependency field id",fieldJson);if(thinkehr.f4.util.isArray(fieldJson.conditions)){var rmType=model.getRmType().toString();fieldJson.conditions.forEach(function(condition){var astCondition=_depCondition(fieldId,condition,rmType,model);astCondition&&astField.conditions(astCondition)}),astField.conditions().length>0&&(ast.fields(astField),model.setDependencyNode(astField))}return astField}function _depCondition(fieldId,condition,rmType,model){var op=_depOperator(fieldId,condition,rmType);if(op){var lhsFunc=_getLhsComparisonFunction(op.operator,rmType,model);if(!lhsFunc)return console.warn("Could not find lhs comparison function for operator",op.operator,"and RM type",rmType,", skipping condition creation."),null;var lhsFunctionExpr=new thinkehr.f4.AstFunctionExpression({func:lhsFunc}),astCondExprClass=_getConditionExpressionClass(op.operator,rmType),astCondExpr=new astCondExprClass({lhsOperand:lhsFunctionExpr,operatorFunc:op.operatorFunction,operatorDef:op.operator,lhsIsMulti:model.isMulti()});if(astCondExpr.isBinary()){var rhsLitFact=_getRhsComparisonLiteralFactory(op.operator,rmType),rhsLit=rhsLitFact.call(null,op.operator,condition.value);if(!rhsLit)return console.warn("Could not create rhs literal for operator",op.operator,"and RM type",rmType,"and value",condition.value,", skipping condition creation."),null;rhsLit.setRawDesc(condition.value),astCondExpr.setRhsOperand(rhsLit)}var thenStatement=_depActions(condition.actions,model);return new thinkehr.f4.AstCondition({rawDesc:condition,expression:astCondExpr,thenStatement:thenStatement})}return null}function _depOperator(fieldId,condition,rmType){var op=_depOperators[condition.operator];if(!op)return console.warn("Unknown or missing operator",condition.operator,"skipping dependency condition creation for",fieldId),null;if(op.types.indexOf(rmType)<0)return console.warn("Operator",op.op,"not supported for RM type",rmType,"skipping condition creation for",fieldId),null;var opFunc=_getArrayOperatorFunction(op,rmType);return opFunc?{operator:op,operatorFunction:opFunc}:(console.warn("No operator function defined for operator",op.op,"skipping condition creation for",fieldId),null)}function _depActions(actions,model){if(thinkehr.f4.util.isArray(actions)&&actions.length>0){var actionsSt=new thinkehr.f4.AstActionsStatement({rawDesc:actions});return actions.forEach(function(action){var targetModel=model.findClosestWithPath(action.target);if(targetModel){var targetRmType=targetModel.getRmType().toString(),actClass=_getActionStatementClass(action,targetRmType),actSt=new actClass({rawDesc:action,name:action.action});actSt.addTarget(targetModel),actionsSt.actions(actSt)}else console.warn("Could not find target model for",action,", skipping this action.")}),actionsSt.actions().length>0?actionsSt:new thinkehr.f4.AstNoopStatement}return new thinkehr.f4.AstNoopStatement}function isArray(o){return"[object Array]"===Object.prototype.toString.call(o)}function isObject(o){return"[object Object]"===Object.prototype.toString.call(o)}function isString(o){return"[object String]"===Object.prototype.toString.call(o)}function isDate(o){return"[object Date]"===Object.prototype.toString.call(o)&&!isNaN(o.getTime())}function isInteger(o){return o===parseInt(o)}function isNumber(o){return!isNaN(parseFloat(o))&&isFinite(o)}function isFunction(f){var getType={};return f&&"[object Function]"===getType.toString.call(f)}function isValueNonEmpty(value){if(null!==value&&void 0!==value){if(thinkehr.f4.util.isString(value)||thinkehr.f4.util.isArray(value))return value.length>0;if(thinkehr.f4.util.isObject(value)){var propCount=thinkehr.f4.util.countProperties(value);if(0===propCount)return!1;for(var keys=Object.keys(value),i=0;i<keys.length;i++){var cvChild=isValueNonEmpty(value[keys[i]]);if(cvChild===!0)return!0}return!1}return!0}return!1}function deepClone(o){return JSON.parse(JSON.stringify(o))}function copyArrayShallow(arr){for(var na=new Array(arr.length),i=arr.length;i--;)na[i]=arr[i];return na}function countProperties(o){if(Object.keys)return Object.keys(o).length;var count=0;for(var k in o)o.hasOwnProperty(k)&&count++;return count}function getNthProperty(o,n){if(Object.keys)return o[Object.keys(o)[n]];var count=0;for(var k in o)if(o.hasOwnProperty(k)&&count++===n)return k;return null}function guid(separatorParam){var separator=separatorParam?separatorParam:"-",maskStr="xxxxxxxx"+separator+"xxxx"+separator+"4xxx"+separator+"yxxx"+separator+"xxxxxxxxxxxx";return maskStr.replace(/[xy]/g,function(c){var r=16*Math.random()|0,v="x"==c?r:3&r|8;return v.toString(16)})}function toDate(o){if(isString(o)){var retDate=o.length>0?new Date(o):null;return retDate&&isDate(retDate)?retDate:null}return o}function toTime(o){if(isString(o)){if(o.length>0){var tv="1970-01-02T"+o,retDate=new Date(tv);return retDate&&isDate(retDate)?retDate:null}return null}return o}function toLocalTimezoneOffsetISOString(isoDateString){if(isString(isoDateString)){var isoDateRegex=/^\d{4}-\d{2}-\d{2}T\d{2}:\d{2}:\d{2}$/,timeDelimiter=isoDateString.indexOf("T");if(timeDelimiter>0){var timezoneDelimiterIndex=isoDateString.indexOf("+");if(0>timezoneDelimiterIndex){var anyCharsAfterTimeDelimiter=isoDateString.match(/(\D*)/g).map(function(itm,i){return itm.length&&itm.match(/[^0-9\d\s\.:-]/)?i:null}).filter(function(itm){return itm>timeDelimiter}).length>0;if(!anyCharsAfterTimeDelimiter){for(;isoDateString.substring(timeDelimiter+1).split(":").length<=2;)isoDateString+=":00";var millisDelimiter=isoDateString.indexOf(".");millisDelimiter>0&&(isoDateString=isoDateString.substring(0,millisDelimiter))}if(0!=isoDateString.search(isoDateRegex)){var dateStrPartSplit=isoDateString.substring(0,timeDelimiter).split("-"),timeStrPartSplit=isoDateString.substring(timeDelimiter+1).split(":"),toDoubleDigit=function(val){return val.length<2?("00"+val).slice(-2):val};dateStrPartSplit=dateStrPartSplit.map(toDoubleDigit).join("-"),timeStrPartSplit=timeStrPartSplit.map(toDoubleDigit).join(":"),isoDateString=dateStrPartSplit+"T"+timeStrPartSplit}}}if(0==isoDateString.search(isoDateRegex)){var pad=function(num){var norm=Math.abs(Math.floor(num));return(10>norm?"0":"")+norm},tzo=-new Date(isoDateString).getTimezoneOffset(),sign=tzo>=0?"+":"-";return isoDateString+".000"+sign+pad(tzo/60)+":"+pad(tzo%60)}return isoDateString}return isoDateString}function toDateApplyTzDiff(o){var d;if(isString(o)?d=o.length>0?new Date(o):null:isDate(o)&&(d=o),d){var curDate=new Date,offsetMs=60*curDate.getTimezoneOffset()*1e3,dMs=d.getTime(),modifiedTs=dMs+offsetMs;return d=new Date,d.setTime(modifiedTs),d}return o}function toUtcDate(o){if(isDate(o)){var offsetMs=60*o.getTimezoneOffset()*1e3;if(0===offsetMs)return o;var d=new Date;return d.setTime(o.getTime()+offsetMs),d}return o}function dateFromISO(s){var testIso="2011-11-24T09:00:27",diso=Date.parse(testIso);if(1322118027e3===diso)return function(s){return new Date(Date.parse(s))};var noOffset=function(s){var day=s.slice(0,-5).split(/\D/).map(function(itm){return parseInt(itm,10)||0});day[1]-=1,day=new Date(Date.UTC.apply(Date,day));var offsetString=s.slice(-5),offset=parseInt(offsetString,10)/100;return"+"==offsetString.slice(0,1)&&(offset*=-1),day.setHours(day.getHours()+offset),day.getTime()};if(1322118027e3===noOffset(testIso))return noOffset;var ret=function(s){var day,tz,rx=/^(\d{4}\-\d\d\-\d\d([tT][\d:\.]*)?)([zZ]|([+\-])(\d\d):?(\d\d))?$/,p=rx.exec(s)||[];return p[1]?(day=p[1].split(/\D/).map(function(itm){return parseInt(itm,10)||0}),day[1]-=1,day=new Date(Date.UTC.apply(Date,day)),day.getDate()?(p[5]&&(tz=parseInt(p[5],10)/100*60,p[6]&&(tz+=parseInt(p[6],10)),"+"==p[4]&&(tz*=-1),tz&&day.setUTCMinutes(day.getUTCMinutes()+tz)),day):NaN):NaN};return ret(s)}function isSameTimezone(d1,d2){return isDate(d1)&&isDate(d2)?d1.getTimezoneOffset()===d2.getTimezoneOffset():!1}function sanitizeName(name){return name.replace(/[\/:-]/g,"_")}var initializing=!1,superPattern=/xyz/.test(function(){xyz})?/\b_super\b/:/.*/;Object._extendM=function(properties){function Class(){!initializing&&this.init&&this.init.apply(this,arguments)}var _super=this.prototype;initializing=!0;var proto=new this;initializing=!1;for(var name in properties)proto[name]="function"==typeof properties[name]&&"function"==typeof _super[name]&&superPattern.test(properties[name])?function(name,fn){return function(){var tmp=this._super;this._super=_super[name];var ret=fn.apply(this,arguments);return this._super=tmp,ret}}(name,properties[name]):properties[name];return Class.prototype=proto,Class.constructor=Class,Class._extendM=arguments.callee,Class},thinkehr.f4.enumeration=function(namesToValues){var enumeration=function(){throw"Can't instantiate enumerations"},proto=enumeration.prototype={constructor:enumeration,toString:function(){return this.name},toJSON:function(){return this.name},valueOf:function(){return this.value}};enumeration.values=[];for(var name in namesToValues){var e={};for(var prop in proto)e[prop]=proto[prop];e.name=name,e.value=namesToValues[name],enumeration[name]=e,enumeration.values.push(e)}return enumeration.foreach=function(f,c){for(var i=0;i<this.values.length;i++)f.call(c,this.values[i])},enumeration.fromString=function(str){if(!str)return null;for(var strLc=str.toLowerCase(),i=0;i<this.values.length;i++){var e=this.values[i];if(strLc===e.name.toLowerCase())return e}return str},enumeration},thinkehr.f4._extend=function(from,to){for(var prop in from)from.hasOwnProperty(prop)&&(to[prop]=from[prop])};var _knownViewConfigProps={size:_parseSizeViewConfig,layout:_parseLayoutViewConfig,label:_parseLabelViewConfig,field:_parseFieldViewConfig,advanced:_parseAdvancedViewConfig,multiplicity:_parseMultiplicityViewConfig},getModelClassFromRmType=function(descEl){return descEl.rmType===thinkehr.f4.RmType.DV_TEXT.name&&descEl.viewConfig&&descEl.viewConfig.datasource&&descEl.viewConfig.datasource.loadRemote&&(descEl.rmType=thinkehr.f4.RmType.DV_CODED_TEXT.name,descEl.inputs=[{suffix:"code",type:"TEXT",terminology:descEl.viewConfig.datasource.loadRemoteUrl},{suffix:"value",type:"TEXT",terminology:descEl.viewConfig.datasource.loadRemoteUrl}],descEl.viewConfig.field={code:{presentation:"textfield"},value:{presentation:"textfield"}}),thinkehr.f4._rmTypeToClassMap[descEl.rmType]},_depOperators={lt:{op:"lt",label:"<",opType:"bin",partial:!1,types:["DV_DATE","DV_TIME","DV_DATE_TIME","DV_QUANTITY","DV_DURATION","DV_INTEGER","DV_COUNT","DV_PROPORTION"]},gt:{op:"gt",label:">",opType:"bin",partial:!1,types:["DV_DATE","DV_TIME","DV_DATE_TIME","DV_QUANTITY","DV_DURATION","DV_INTEGER","DV_COUNT","DV_PROPORTION","DV_EHR_URI"]},le:{op:"le",label:"<=",opType:"bin",partial:!1,types:["DV_DATE","DV_TIME","DV_DATE_TIME","DV_QUANTITY","DV_DURATION","DV_INTEGER","DV_COUNT","DV_PROPORTION"]},ge:{op:"ge",label:">=",opType:"bin",partial:!1,types:["DV_DATE","DV_TIME","DV_DATE_TIME","DV_QUANTITY","DV_DURATION","DV_INTEGER","DV_COUNT","DV_PROPORTION"]},eq:{op:"eq",label:"=",opType:"bin",partial:!1,types:["DV_DATE","DV_TIME","DV_DATE_TIME","DV_QUANTITY","DV_DURATION","DV_INTEGER","DV_COUNT","DV_PROPORTION"]},ne:{op:"ne",label:"!=",opType:"bin",partial:!1,types:["DV_DATE","DV_TIME","DV_DATE_TIME","DV_QUANTITY","DV_DURATION","DV_INTEGER","DV_COUNT","DV_PROPORTION"]},empty:{op:"empty",label:"empty",opType:"un",partial:!1,types:["DV_TEXT","DV_URI","DV_MULTIMEDIA","DV_EHR_URI","DV_CODED_TEXT","DV_DATE","DV_TIME","DV_DATE_TIME","DV_QUANTITY","DV_DURATION","DV_INTEGER","DV_COUNT","DV_ORDINAL","DV_PROPORTION","DV_BOOLEAN"]},notempty:{op:"notempty",label:"not empty",opType:"un",partial:!1,types:["DV_TEXT","DV_URI","DV_MULTIMEDIA","DV_EHR_URI","DV_CODED_TEXT","DV_ORDINAL","DV_DURATION","DV_DATE","DV_TIME","DV_DATE_TIME","DV_QUANTITY","DV_COUNT"]},equals:{op:"equals",
label:"equals",opType:"bin",partial:!1,types:["DV_TEXT","DV_URI","DV_MULTIMEDIA","DV_EHR_URI","DV_CODED_TEXT","DV_ORDINAL"]},notequals:{op:"notequals",label:"not equals",opType:"bin",partial:!1,types:["DV_TEXT","DV_URI","DV_MULTIMEDIA","DV_EHR_URI","DV_CODED_TEXT","DV_ORDINAL"]},contains:{op:"contains",label:"contains",opType:"bin",partial:!0,types:["DV_TEXT","DV_URI","DV_MULTIMEDIA","DV_EHR_URI","DV_CODED_TEXT","DV_ORDINAL"]},startswith:{op:"startswith",label:"starts with",opType:"bin",partial:!0,types:["DV_TEXT","DV_URI","DV_MULTIMEDIA","DV_EHR_URI","DV_CODED_TEXT","DV_ORDINAL"]},endswith:{op:"endswith",label:"ends with",opType:"bin",partial:!0,types:["DV_TEXT","DV_URI","DV_MULTIMEDIA","DV_EHR_URI","DV_CODED_TEXT","DV_ORDINAL"]},is:{op:"is",label:"is",opType:"bin",partial:!1,types:["DV_BOOLEAN"]},isnot:{op:"isnot",label:"is not",opType:"bin",partial:!1,types:["DV_BOOLEAN"]}},ALL_TRUE_EVAL_ARRAY="allTrue",ANY_TRUE_EVAL_ARRAY="anyTrue",getOperatorFunctionOnArray=function(evalArrayValuesAsTrue,operatorFunction){return function(lHValuesArray,rHValuesArr){for(var evaluationResult,allEvaluationsTrue=evalArrayValuesAsTrue==ALL_TRUE_EVAL_ARRAY,evaluateWithRHValuesArr=function(lrValue,rVArray){var ret=!1;if(rVArray&&rVArray.length)for(var j=0;j<rVArray.length&&(ret=operatorFunction.call(null,lrValue,rVArray[j]),1!=ret);j++);else ret=operatorFunction.call(null,lrValue);return ret},i=0;i<lHValuesArray.length;i++){if(evaluationResult=evaluateWithRHValuesArr(lHValuesArray[i],rHValuesArr),!allEvaluationsTrue&&1==evaluationResult)return evaluationResult;if(allEvaluationsTrue===!0&&1!=evaluationResult)return evaluationResult}return evaluationResult}},addDependencyOperatorFn=function(operatorFunctionsObject,operatorFnKey,operatorFn,evalArrayConst){_operatorFunctions[operatorFnKey]={},_operatorFunctions[operatorFnKey].operFn=operatorFn,_operatorFunctions[operatorFnKey].arrayOperFn=getOperatorFunctionOnArray(evalArrayConst,_operatorFunctions[operatorFnKey].operFn)},_operatorFunctions={};addDependencyOperatorFn(_operatorFunctions,"lt",function(o1,o2){return null===o1||void 0===o1?!1:o2>o1},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"lt/DV_QUANTITY",function(o1,o2){return null!==o1&&void 0!==o1&&o1.unit?o1.unit==o2.unit&&_operatorFunctions.lt.operFn.call(null,o1.magnitude,o2.magnitude):!1},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"lt/DV_DATE",function(d1,d2){return null===d1||void 0===d1?!1:+d2>+d1},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"lt/DV_TIME",function(t1,t2){return _operatorFunctions["lt/DV_DATE"].operFn.call(null,t1,t2)},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"lt/DV_DATE_TIME",function(dt1,dt2){return _operatorFunctions["lt/DV_DATE"].operFn.call(null,dt1,dt2)},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"gt",function(o1,o2){return null===o1||void 0===o1?!1:o1>o2},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"gt/DV_QUANTITY",function(o1,o2){return null!==o1&&void 0!==o1&&o1.unit?o1.unit==o2.unit&&_operatorFunctions.gt.operFn.call(null,o1.magnitude,o2.magnitude):!1},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"gt/DV_DATE",function(d1,d2){return null===d1||void 0===d1?!1:+d1>+d2},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"gt/DV_TIME",function(t1,t2){return _operatorFunctions["gt/DV_DATE"].operFn.call(null,t1,t2)},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"gt/DV_DATE_TIME",function(dt1,dt2){return _operatorFunctions["gt/DV_DATE"].operFn.call(null,dt1,dt2)},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"gt/DV_EHR_URI",function(dt1,dt2){return _operatorFunctions.startswith.operFn.call(null,dt1,dt2)&&dt1.length>dt2.length},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"le",function(o1,o2){return null===o1||void 0===o1?!1:o2>=o1},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"le/DV_QUANTITY",function(o1,o2){return null!==o1&&void 0!==o1&&o1.unit?o1.unit==o2.unit&&_operatorFunctions.le.operFn.call(null,o1.magnitude,o2.magnitude):!1},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"le/DV_DATE",function(d1,d2){return null===d1||void 0===d1?!1:+d2>=+d1},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"le/DV_TIME",function(t1,t2){return _operatorFunctions["le/DV_DATE"].operFn.call(null,t1,t2)},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"le/DV_DATE_TIME",function(dt1,dt2){return _operatorFunctions["le/DV_DATE"].operFn.call(null,dt1,dt2)},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"ge",function(o1,o2){return null===o1||void 0===o1?!1:o1>=o2},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"ge/DV_QUANTITY",function(o1,o2){return null!==o1&&void 0!==o1&&o1.unit?o1.unit==o2.unit&&_operatorFunctions.ge.operFn.call(null,o1.magnitude,o2.magnitude):!1},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"ge/DV_DATE",function(d1,d2){return null===d1||void 0===d1?!1:+d1>=+d2},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"ge/DV_TIME",function(t1,t2){return _operatorFunctions["ge/DV_DATE"].operFn.call(null,t1,t2)},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"ge/DV_DATE_TIME",function(dt1,dt2){return _operatorFunctions["ge/DV_DATE"].operFn.call(null,dt1,dt2)},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"eq",function(o1,o2){return o1==o2},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"eq/DV_QUANTITY",function(o1,o2){return o1==o2?!0:o1.unit==o2.unit&&_operatorFunctions.eq.operFn.call(null,o1.magnitude,o2.magnitude)},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"eq/DV_DATE",function(d1,d2){return null===d1||void 0===d1?!1:+d1==+d2},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"eq/DV_TIME",function(t1,t2){return _operatorFunctions["eq/DV_DATE"].operFn.call(null,t1,t2)},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"eq/DV_DATE_TIME",function(dt1,dt2){return _operatorFunctions["eq/DV_DATE"].operFn.call(null,dt1,dt2)},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"ne",function(o1,o2){return o1!=o2},ALL_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"ne/DV_QUANTITY",function(o1,o2){return o1.unit!=o2.unit||_operatorFunctions.ne.operFn.call(null,o1.magnitude,o2.magnitude)},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"ne/DV_DATE",function(d1,d2){return null===d1||void 0===d1?null!==d2||void 0!==d2:+d1!=+d2},ALL_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"ne/DV_TIME",function(t1,t2){return _operatorFunctions["ne/DV_DATE"].operFn.call(null,t1,t2)},ALL_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"ne/DV_DATE_TIME",function(dt1,dt2){return _operatorFunctions["ne/DV_DATE"].operFn.call(null,dt1,dt2)},ALL_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"empty",function(o){var und=null===o||void 0===o;return und||!thinkehr.f4.util.isString(o)&&!thinkehr.f4.util.isArray(o)?und:0===o.length},ALL_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"empty/DV_QUANTITY",function(o){var isLhsEmpty=function(val){return!val},isMagnitudeEmpty=function(val){return!thinkehr.f4.util.isNumber(val.magnitude)},isUnitEmpty=function(val){return!thinkehr.f4.util.isString(val.unit)||0===val.unit.length};return isLhsEmpty(o)||isMagnitudeEmpty(o)||isUnitEmpty(o)||_operatorFunctions.empty.operFn.call(null,o.magnitude.toString())},ALL_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"notempty",function(o){var def=null!==o&&void 0!==o;return def&&(thinkehr.f4.util.isString(o)||thinkehr.f4.util.isArray(o))?o.length>0:def},ALL_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"notempty/DV_QUANTITY",function(o){return!_operatorFunctions["empty/DV_QUANTITY"].operFn.call(null,o)},ALL_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"equals",function(o1,o2){return thinkehr.f4.util.isString(o1)&&thinkehr.f4.util.isString(o2)&&(o1=o1.toLowerCase(),o2=o2.toLowerCase()),o1===o2},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"notequals",function(o1,o2){return thinkehr.f4.util.isString(o1)&&thinkehr.f4.util.isString(o2)&&(o1=o1.toLowerCase(),o2=o2.toLowerCase()),o1!==o2},ALL_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"startswith",function(o1,o2){return thinkehr.f4.util.isString(o1)&&thinkehr.f4.util.isString(o2)&&(o1=o1.toLowerCase(),o2=o2.toLowerCase()),o1&&0===o1.indexOf(o2)},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"endswith",function(o1,o2){if(o1){thinkehr.f4.util.isString(o1)&&thinkehr.f4.util.isString(o2)&&(o1=o1.toLowerCase(),o2=o2.toLowerCase());var index=o1.indexOf(o2);if(index>=0)return index+o2.length===o1.length}return!1},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"contains",function(o1,o2){return thinkehr.f4.util.isString(o1)&&thinkehr.f4.util.isString(o2)&&(o1=o1.toLowerCase(),o2=o2.toLowerCase()),o1&&o1.indexOf(o2)>=0},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"is",function(o1,o2){return o1===o2},ANY_TRUE_EVAL_ARRAY),addDependencyOperatorFn(_operatorFunctions,"isnot",function(o1,o2){return o1!==o2},ALL_TRUE_EVAL_ARRAY);var _lhsFunctions={DV_QUANTITY:function(model){return function(){return{magnitude:model.magnitudeValue(void 0,void 0),unit:model.unitValue(void 0,void 0)}}},DV_CODED_TEXT:function(model){return function(){return{code:model.codeValue(),value:model.labelValue()}}},DV_TEXT:function(model){return function(){return model.textValue(void 0,void 0)}},DV_MULTIMEDIA:function(model){return function(){return model.uriValue(void 0,void 0)}},DV_ORDINAL:function(model){return function(){return{code:model.codeValue(),value:model.labelValue()}}},DV_PROPORTION:function(model){return function(){return{numerator:model.numeratorValue(void 0,void 0),denominator:model.denominatorValue(void 0,void 0)}}},DV_COUNT:function(model){return function(){return model.countValue(void 0,void 0)}},DV_BOOLEAN:function(model){return function(){return model.booleanValue()}},DV_DATE:function(model){return function(){return model.dateObjectValue(void 0,void 0)}},DV_TIME:function(model){return function(){return model.timeObjectValue(void 0,void 0)}},DV_DATE_TIME:function(model){return function(){return model.dateTimeObjectValue(void 0,void 0)}},DV_DURATION:function(model){return function(){return model.durationValue(void 0,void 0)}},DV_URI:function(model){return function(){return model.uriValue(void 0,void 0)}},DV_EHR_URI:function(model){return function(){return model.ehrUriValue(void 0,void 0)}},_default:function(model){return function(){return model.getValue()}}},_literalFactories={DV_QUANTITY:function(operator,value){return new thinkehr.f4.AstQuantityLiteral({magnitudeLiteral:new thinkehr.f4.AstNumericLiteral({value:value.magnitude}),unitLiteral:new thinkehr.f4.AstStringLiteral({value:value.unit})})},DV_CODED_TEXT:function(operator,value){return new thinkehr.f4.AstCodedTextLiteral({codeLiteral:new thinkehr.f4.AstStringLiteral({value:value.code}),valueLiteral:new thinkehr.f4.AstStringLiteral({value:value.value})})},DV_ORDINAL:function(operator,value){return _literalFactories.DV_CODED_TEXT.call(null,operator,value)},DV_PROPORTION:function(operator,value){return new thinkehr.f4.AstProportionLiteral({numeratorLiteral:new thinkehr.f4.AstNumericLiteral({value:value.numerator}),denominatorLiteral:new thinkehr.f4.AstNumericLiteral({value:value.denominator})})},DV_DATE:function(operator,value){return new thinkehr.f4.AstDateLiteral({value:value.value})},DV_TIME:function(operator,value){return new thinkehr.f4.AstTimeLiteral({value:value.value})},DV_DATE_TIME:function(operator,value){return new thinkehr.f4.AstDateTimeLiteral({value:value.value})},DV_DURATION:function(operator,value){return new thinkehr.f4.AstDurationLiteral({value:value})},_string:function(operator,value){return new thinkehr.f4.AstStringLiteral({value:value})},_numeric:function(operator,value){return new thinkehr.f4.AstNumericLiteral({value:value})},_default:function(operator,value){if(thinkehr.f4.util.isString(value))return new thinkehr.f4.AstStringLiteral({value:value});if(thinkehr.f4.util.isNumber(value))return new thinkehr.f4.AstNumericLiteral({value:value});if(thinkehr.f4.util.isObject(value)&&void 0!==value.value){var val=value.value;return thinkehr.f4.util.isString(val)?new thinkehr.f4.AstStringLiteral({value:val}):thinkehr.f4.util.isNumber(val)?new thinkehr.f4.AstNumericLiteral({value:val}):new thinkehr.f4.AstLiteral({value:val})}return new thinkehr.f4.AstLiteral({value:value})}},_conditionExpressionClasses={"[un]DV_QUANTITY":"thinkehr.f4.AstUnaryQuantityExpression","[bin]DV_QUANTITY":"thinkehr.f4.AstBinaryQuantityExpression",DV_QUANTITY:"thinkehr.f4.AstBinaryQuantityExpression","[un]DV_CODED_TEXT":"thinkehr.f4.AstUnaryCodedTextExpression","[bin]DV_CODED_TEXT":"thinkehr.f4.AstBinaryCodedTextExpression",DV_CODED_TEXT:"thinkehr.f4.AstBinaryCodedTextExpression","[un]DV_ORDINAL":"thinkehr.f4.AstUnaryCodedTextExpression","[bin]DV_ORDINAL":"thinkehr.f4.AstBinaryCodedTextExpression",DV_ORDINAL:"thinkehr.f4.AstBinaryCodedTextExpression","[un]DV_PROPORTION":"thinkehr.f4.AstUnaryProportionExpression","[bin]DV_PROPORTION":"thinkehr.f4.AstBinaryProportionExpression",DV_PROPORTION:"thinkehr.f4.AstBinaryProportionExpression","[bin]DV_DATE_TIME":"thinkehr.f4.AstBinaryDateExpression","[bin]DV_DATE":"thinkehr.f4.AstBinaryDateExpression","[bin]DV_TIME":"thinkehr.f4.AstBinaryDateExpression","[un]DV_DURATION":"thinkehr.f4.AstUnaryDurationExpression","[bin]DV_DURATION":"thinkehr.f4.AstBinaryDurationExpression",DV_DURATION:"thinkehr.f4.AstBinaryDurationExpression"},_actionStatementClasses={show:"thinkehr.f4.AstShowAction",hide:"thinkehr.f4.AstHideAction",enable:"thinkehr.f4.AstEnableAction",disable:"thinkehr.f4.AstDisableAction",set:"thinkehr.f4.AstSetAction",clear:"thinkehr.f4.AstClearAction",reset:"thinkehr.f4.AstResetAction"};!function(nezasa,undefined){function parsePeriodString(period,_distributeOverflow){var struct,distributeOverflow=_distributeOverflow?_distributeOverflow:!1,valueIndexes=[2,3,4,5,7,8,9],duration=[0,0,0,0,0,0,0],overflowLimits=[0,12,4,7,24,60,60];if(null===period||period===undefined)return[null,null,null,null,null,null,null];if(period=period.toUpperCase(),!period)return duration;if("string"!=typeof period)throw new Error("Invalid iso8601 period string '"+period+"'");if(!(struct=/^P((\d+Y)?(\d+M)?(\d+W)?(\d+D)?)?(T(\d+H)?(\d+M)?(\d+S)?)?$/.exec(period)))throw new Error("String '"+period+"' is not a valid ISO8601 period.");for(var i=0;i<valueIndexes.length;i++){var structIndex=valueIndexes[i];duration[i]=struct[structIndex]?+struct[structIndex].replace(/[A-Za-z]+/g,""):0}if(distributeOverflow)for(i=duration.length-1;i>0;i--)duration[i]>=overflowLimits[i]&&(duration[i-1]=duration[i-1]+Math.floor(duration[i]/overflowLimits[i]),duration[i]=duration[i]%overflowLimits[i]);return duration}nezasa.iso8601||(nezasa.iso8601={}),nezasa.iso8601.Period||(nezasa.iso8601.Period={}),nezasa.iso8601.version="0.2",nezasa.iso8601.Period.parse=function(period,distributeOverflow){return parsePeriodString(period,distributeOverflow)},nezasa.iso8601.Period.parseToTotalSeconds=function(period){for(var multiplicators=[31104e3,2592e3,604800,86400,3600,60,1],durationPerUnit=parsePeriodString(period),durationInSeconds=0,i=0;i<durationPerUnit.length;i++){var dpu=durationPerUnit[i];isNumber(dpu)||(dpu=0),durationInSeconds+=durationPerUnit[i]*multiplicators[i]}return durationInSeconds},nezasa.iso8601.Period.isValid=function(period){try{return parsePeriodString(period),!0}catch(e){return!1}},nezasa.iso8601.Period.periodToString=function(periodArray){if(thinkehr.f4.util.isArray(periodArray)&&7===periodArray.length){var periodMarkers=["Y","M","W","D","H","M","S"],ps="P",hasDatePd=!1,hasTimePd=!1;return periodArray.forEach(function(p,i){4===i&&(ps+="T"),0!==p&&null!==p&&(ps+=p+periodMarkers[i],hasDatePd||(hasDatePd=3>=i),hasTimePd||(hasTimePd=i>=4))}),hasDatePd||hasTimePd?hasTimePd||(ps=ps.substring(0,ps.length-1)):ps=null,ps}return null}}(window.nezasaEhr=window.nezasaEhr||{}),thinkehr.f4.util.isArray=isArray,thinkehr.f4.util.isObject=isObject,thinkehr.f4.util.isString=isString,thinkehr.f4.util.isDate=isDate,thinkehr.f4.util.isNumber=isNumber,thinkehr.f4.util.isInteger=isInteger,thinkehr.f4.util.isFunction=isFunction,thinkehr.f4.util.isValueNonEmpty=isValueNonEmpty,thinkehr.f4.util.deepClone=deepClone,thinkehr.f4.util.countProperties=countProperties,thinkehr.f4.util.getNthProperty=getNthProperty,thinkehr.f4.util.guid=guid,thinkehr.f4.util.toDate=toDate,thinkehr.f4.util.toTime=toTime,thinkehr.f4.util.toLocalTimezoneOffsetISOString=toLocalTimezoneOffsetISOString,thinkehr.f4.util.toDateApplyTzDiff=toDateApplyTzDiff,thinkehr.f4.util.toUtcDate=toUtcDate,thinkehr.f4.util.dateFromISO=dateFromISO,thinkehr.f4.util.isSameTimezone=isSameTimezone,thinkehr.f4.util.sanitizeName=sanitizeName,thinkehr.f4.util.copyArrayShallow=copyArrayShallow,thinkehr.f4.parseViewConfig=parseViewConfig,thinkehr.f4.parseFormDescription=parseFormDescription,thinkehr.f4.parseFormDescriptionSnippet=parseFormDescriptionSnippet,thinkehr.f4.parseDependencies=parseDependencies,thinkehr.f4.parseDependencyField=parseDependencyField,thinkehr.f4.parseInputItems=parseInputItems,thinkehr.f4.getThenStatementsWithModelPath=getThenStatementsWithModelPath,thinkehr.f4.duplicateModel=duplicateModel,thinkehr.f4.destroyModel=destroyModel,thinkehr.f4.refreshValues=refreshValues,thinkehr.f4.recursivelyForChildModels=recursivelyForChildModels,thinkehr.f4.isCustomFunctionCustomComponent=isCustomFunctionCustomComponent,thinkehr.f4.getCustomFunctionReference=getCustomFunctionReference,thinkehr.f4.setExternalContext=setExternalContext,thinkehr.f4.getDependancyOperatorFunction=_getArrayOperatorFunction}(),thinkehr.f4.RmType=thinkehr.f4.enumeration({FORM_DEFINITION:0,GENERIC_FIELDSET:1,DV_QUANTITY:2,DV_CODED_TEXT:3,DV_TEXT:4,DV_PROPORTION:5,DV_BOOLEAN:6,DV_DATE:7,DV_TIME:8,DV_DATE_TIME:9,DV_ORDINAL:10,DV_COUNT:11,DV_DURATION:12,DV_URI:13,DV_EHR_URI:14,GENERIC_FIELD:15,DV_MULTIMEDIA:16,DV_PARSABLE:17,OBSERVATION:1001,EVENT:1002,COMPOSITION:1003,SECTION:1004,EVALUATION:1005,INSTRUCTION:1006,ACTION:1007,ISM_TRANSITION:1008,CUSTOM:1e4}),thinkehr.f4.FieldSize=thinkehr.f4.enumeration({INHERIT:0,SMALL:1,MEDIUM:2,LARGE:3}),thinkehr.f4.LabelSize=thinkehr.f4.enumeration({INHERIT:0}),thinkehr.f4.FieldHorizontalAlignment=thinkehr.f4.enumeration({INHERIT:0,LEFT:1,CENTER:2,RIGHT:3}),thinkehr.f4.FieldVerticalAlignment=thinkehr.f4.enumeration({INHERIT:0,TOP:1,MIDDLE:2,BOTTOM:3}),thinkehr.f4.LabelHorizontalAlignment=thinkehr.f4.enumeration({INHERIT:0,TOP:1,LEFT:2,RIGHT:3}),thinkehr.f4.LabelVerticalAlignment=thinkehr.f4.enumeration({INHERIT:0,TOP:1,MIDDLE:2,BOTTOM:3}),thinkehr.f4.InputType=thinkehr.f4.enumeration({DECIMAL:0,CODED_TEXT:1,TEXT:2,INTEGER:3,BOOLEAN:4,DATE:5,TIME:6,DATETIME:7}),thinkehr.f4.FieldPresentation=thinkehr.f4.enumeration({COMBOBOX:0,RADIOS:1,TEXTFIELD:2,TEXTAREA:3}),thinkehr.f4.Object=Object._extendM({init:function(properties){if(properties)for(var prop in properties)properties.hasOwnProperty(prop)&&(this[prop]=properties[prop])},toString:function(){return"thinkehr.f4.Object"}}),thinkehr.f4.ViewConfig=thinkehr.f4.Object._extendM({init:function(properties){this._super(properties),void 0===this.model&&(this.model=null),void 0===this.label&&(this.label=null),void 0===this.size&&(this.size=null),void 0===this.layout&&(this.layout=null),void 0===this.field&&(this.field={}),void 0===this.hidden&&(this.hidden=!1),void 0===this.readonly&&(this.readonly=!1),void 0===this.viewmode&&(this.viewmode=!1),void 0===this.min&&(this.min=null),void 0===this.max&&(this.max=null),void 0===this.tags&&(this.tags=[]),void 0===this.annotations&&(this.annotations={}),void 0===this.datasource&&(this.datasource={}),void 0===this._multiplicityStr&&(this._multiplicityStr=null)},getModel:function(){return this.model},setModel:function(model){this.model=model},getLabel:function(){return this.label},setLabel:function(label){this.label=label},getSize:function(hierarchy){return this._getHierarchicalViewConfigProperty(hierarchy,"size",this.getSize)},setSize:function(size){this.size=size},getLayout:function(hierarchy){return this._getHierarchicalViewConfigProperty(hierarchy,"layout",this.getLayout)},setLayout:function(layout){this.layout=layout},getField:function(forInput){var f;if(void 0!==forInput)f=this.field[forInput],f||(f=null);else{var keyCount=thinkehr.f4.util.countProperties(this.field);f=1===keyCount?thinkehr.f4.util.getNthProperty(this.field,0):null,!f&&this.field.input&&(f=this.field.input)}return f},setField:function(field){this.field=field},getFields:function(){return this.field},isHidden:function(){return this.hidden},setHidden:function(hidden){this.hidden=hidden},isReadOnly:function(){return this.readonly},setReadOnly:function(readonly){this.readonly=readonly},isViewMode:function(){return!!this.viewmode||this.hasTag("viewmode")},getViewMode:function(){return this.viewmode},setViewMode:function(viewmode){this.viewmode=viewmode},isLabelHidden:function(){if(this.size&&null!=this.size.label){var valInt=parseInt(this.size.label);return!isNaN(valInt)&&-1==valInt}return!1},getMin:function(hierarchy){return this._getModelPropertyIfNotOwn(hierarchy,"min","getMin")},setMin:function(min){this.min=min},getMax:function(hierarchy){return this._getModelPropertyIfNotOwn(hierarchy,"max","getMax")},setMax:function(max){this.max=max},getMultiplicityString:function(){if(!this._multiplicityStr){var min=this.min,max=this.max;(void 0==min||0>min)&&(min="*"),(void 0==max||0>max)&&(max="*"),this._multiplicityStr="["+min+".."+max+"]"}return this._multiplicityStr},getTerminology:function(){return this.datasource&&1==this.datasource.loadRemote?this.datasource.loadRemoteUrl:null},getTerminologyResolver:function(){return this.datasource?this.datasource.terminology:null},getTags:function(){return this.tags},hasTag:function(tag){return this.tags.indexOf(tag)>=0},getAnnotations:function(){return this.annotations},hasAnnotation:function(key){return void 0!==this.annotations[key]},annotationValue:function(key){return this.annotations[key]},_getModelPropertyIfNotOwn:function(hierarchy,property,getterProperty){return hierarchy===!1||null!=this[property]?this[property]:this.model&&this.model[getterProperty]?this.model[getterProperty].call(this.model):null},_getHierarchicalViewConfigProperty:function(hierarchy,property,getter){return hierarchy===!1||null!=this[property]?this[property]:null!=this.model&&this.model.getParentModel()?getter.call(this.model.getParentModel().getViewConfig(),!0):null},toString:function(){return"thinkehr.f4.ViewConfig"}}),thinkehr.f4.ViewConfigProperty=thinkehr.f4.Object._extendM({init:function(properties){this._super(properties),void 0===this.viewConfig&&(this.viewConfig=null)},getViewConfig:function(){return this.viewConfig},setViewConfig:function(viewConfig){this.viewConfig=viewConfig},_getHierarchicalProperty:function(hierarchy,propKey,inheritValue,fieldGetter,containingObjGetterProp){if(hierarchy===!1||this[propKey]&&this[propKey]!=inheritValue)return this[propKey];var containingObjGetter=this._getParentViewConfig()?this._getParentViewConfig()[containingObjGetterProp]:null;return containingObjGetter&&containingObjGetter.call(this._getParentViewConfig(),!0)?fieldGetter.call(containingObjGetter.call(this._getParentViewConfig(),!0),!0):this[propKey]},_getParentViewConfig:function(){return this.viewConfig.getModel()&&this.viewConfig.getModel().getParentModel()&&this.viewConfig.getModel().getParentModel()instanceof thinkehr.f4.FormObjectModel?this.viewConfig.getModel().getParentModel().getViewConfig():null},toString:function(){return"thinkehr.f4.ViewConfigProperty"}}),thinkehr.f4.Size=thinkehr.f4.ViewConfigProperty._extendM({init:function(properties){this._super(properties),void 0===this.field&&(this.field=null),void 0===this.label&&(this.label=null)},getField:function(hierarchy){return this._getHierarchicalProperty(hierarchy,"field",thinkehr.f4.FieldSize.INHERIT,this.getField,"getSize")},setField:function(field){this.field=field},getLabel:function(hierarchy){return this._getHierarchicalProperty(hierarchy,"label",thinkehr.f4.LabelSize.INHERIT,this.getLabel,"getSize")},setLabel:function(label){this.label=label},toString:function(){return"thinkehr.f4.Size/ViewConfigProperty"}}),thinkehr.f4.Layout=thinkehr.f4.ViewConfigProperty._extendM({init:function(properties){this._super(properties),void 0===this.viewConfig&&(this.viewConfig=null),void 0===this.fieldHorizontalAlignment&&(this.fieldHorizontalAlignment=null),void 0===this.fieldVerticalAlignment&&(this.fieldVerticalAlignment=null),void 0===this.labelHorizontalAlignment&&(this.labelHorizontalAlignment=null),void 0===this.labelVerticalAlignment&&(this.labelVerticalAlignment=null)},getFieldHorizontalAlignment:function(hierarchy){return this._getHierarchicalProperty(hierarchy,"fieldHorizontalAlignment",thinkehr.f4.FieldHorizontalAlignment.INHERIT,this.getFieldHorizontalAlignment,"getLayout")},setFieldHorizontalAlignment:function(alignment){this.fieldHorizontalAlignment=alignment},getFieldVerticalAlignment:function(hierarchy){return this._getHierarchicalProperty(hierarchy,"fieldVerticalAlignment",thinkehr.f4.FieldVerticalAlignment.INHERIT,this.getFieldVerticalAlignment,"getLayout")},setFieldVerticalAlignment:function(alignment){this.fieldVerticalAlignment=alignment},getLabelHorizontalAlignment:function(hierarchy){return this._getHierarchicalProperty(hierarchy,"labelHorizontalAlignment",thinkehr.f4.LabelHorizontalAlignment.INHERIT,this.getLabelHorizontalAlignment,"getLayout")},setLabelHorizontalAlignment:function(alignment){this.labelHorizontalAlignment=alignment},getLabelVerticalAlignment:function(hierarchy){return this._getHierarchicalProperty(hierarchy,"labelVerticalAlignment",thinkehr.f4.LabelVerticalAlignment.INHERIT,this.getLabelVerticalAlignment,"getLayout")},setLabelVerticalAlignment:function(alignment){this.labelVerticalAlignment=alignment},toString:function(){return"thinkehr.f4.Layout/ViewConfigProperty"}}),thinkehr.f4.Label=thinkehr.f4.ViewConfigProperty._extendM({init:function(properties){this._super(properties),void 0===this.custom&&(this.custom=!1),void 0===this.value&&(this.value=null),void 0===this.useLocalizations&&(this.useLocalizations=!1),void 0===this.localizationsList&&(this.localizationsList={})},isCustom:function(){return this.custom},setCustom:function(custom){this.custom=custom},getValue:function(){return this.value},setValue:function(value){this.value=value},isUseLocalizations:function(){return this.useLocalizations},setUseLocalizations:function(useLocalizations){this.useLocalizations=useLocalizations},getLocalization:function(locale){var l=this.localizationsList[locale];return l?l:null},setLocalizations:function(localizationsList){this.localizationsList=localizationsList},toString:function(){return"thinkehr.f4.Label/ViewConfigProperty"}}),thinkehr.f4.Field=thinkehr.f4.ViewConfigProperty._extendM({init:function(properties){this._super(properties),void 0===this.presentation&&(this.presentation=null),void 0===this.columns&&(this.columns=null),void 0===this.lines&&(this.lines=null)},getPresentation:function(){return this.presentation},setPresentation:function(presentation){this.presentation=presentation},getColumns:function(){return this.columns},setColumns:function(columns){this.columns=columns},getLines:function(){return this.lines},setLines:function(lines){this.lines=lines},toString:function(){return"thinkehr.f4.Field/ViewConfigProperty"}}),thinkehr.f4.Input=thinkehr.f4.Object._extendM({init:function(properties){this._super(properties),void 0===this.suffix&&(this.suffix=null),void 0===this.type&&(this.type=null),void 0===this.list&&(this.list=[]),void 0===this.validation&&(this.validation=null),void 0===this.listOpen&&(this.listOpen=!1),void 0===this.defaultValue&&(this.defaultValue=null),void 0===this.defaultInputItem&&(this.defaultInputItem=null),void 0===this.terminology&&(this.terminology=null),void 0===this.context&&(this.context=null),void 0===this.inputForModel&&(this.inputForModel=null),void 0===this.terminologyListCache&&(this.terminologyListCache={}),this._lastTerminologySearchStrId=null},getSuffix:function(){return this.suffix},setSuffix:function(suffix){this.suffix=suffix},setInputForModel:function(model){this.inputForModel=model},getType:function(){return this.type},setType:function(type){this.type=type},getTerminologyItemsWithLabel:function(qryParam,callbackFn){var qryString;thinkehr.f4.util.isObject(qryParam)?(1==qryParam.all&&(qryString=""),null!=qryParam.query&&(qryString=qryParam.query),1==qryParam.force&&(this._lastTerminologySearchStrId=null)):qryString=qryParam;var newLabelStrId=this._createLastTermStringId(qryString),terminologyStr=this.getTerminology();if(terminologyStr&&this._lastTerminologySearchStrId!==newLabelStrId){var resolverFn=this._getTerminologyResolverFn();if(!resolverFn&&this.getContext().getTerminologyList&&this.getContext().getTerminologyList instanceof Function&&(resolverFn=this.getContext().getTerminologyList),this._lastTerminologySearchStrId=newLabelStrId,this.setList([]),!resolverFn)return console.warn("'getTerminologyList' method not defined on form context object neither terminology resolver on field."),void callbackFn(this.getList(),qryParam);var reqLang=this.getContext().language;return void resolverFn(terminologyStr,qryParam,reqLang,function(terminologyResultArr,resLanguage){var lang=resLanguage||reqLang;terminologyResultArr&&terminologyResultArr.length&&(terminologyResultArr=thinkehr.f4.Input._toLabelValuePropsArr(terminologyResultArr,lang,terminologyStr),this.setList(thinkehr.f4.parseInputItems(terminologyResultArr),!0)),callbackFn&&callbackFn(this.getList(),qryParam)}.bind(this),!1)}callbackFn&&callbackFn(this.getList(),qryParam)},_getTerminologyResolverFn:function(){var resolverFn=null;if(this.inputForModel.getViewConfig().getTerminologyResolver())try{resolverFn=eval(this.inputForModel.getViewConfig().getTerminologyResolver()),resolverFn instanceof Function||(resolverFn=null)}catch(e){}return resolverFn},getList:function(){return this.list},getTerminologyListCache:function(){return this.terminologyListCache[this.getTerminology()]||(this.terminologyListCache[this.getTerminology()]={}),this.terminologyListCache[this.getTerminology()]},setList:function(list,skipLoadFromTerminology){list.forEach(function(inputItem){this._connectItemToTerminology(inputItem,skipLoadFromTerminology)},this),this.list=list},getItem:function(index){return index>=0&&index<this.list.length?this.list[index]:null},addItem:function(item,skipLoadFromTerminology){this._connectItemToTerminology(item,skipLoadFromTerminology),this.list.push(item)},hasItems:function(){return this.list.length>0},getValidation:function(){return this.validation},setValidation:function(validation){this.validation=validation},isListOpen:function(){return this.listOpen},setListOpen:function(listOpen){this.listOpen=listOpen},getDefaultValue:function(){return this.defaultValue},_createTerminologyItem:function(value,skipTerminologyLoad,createWithDefaultValues){if(value&&this.getTerminology()){var termItem=thinkehr.f4.parseInputItems([{value:value,label:createWithDefaultValues&&createWithDefaultValues.label?createWithDefaultValues.label:"value ("+value+")",localizedLabels:createWithDefaultValues&&createWithDefaultValues.localizedLabels?createWithDefaultValues.localizedLabels:{}}])[0];return this._connectItemToTerminology(termItem,skipTerminologyLoad),termItem}},getDefaultInputItem:function(createWithDefaultValues){var defValue=this.getDefaultValue();return!this.defaultInputItem&&defValue&&(this.defaultInputItem=this.findInputItemByValue(defValue,!0),!this.defaultInputItem&&this.getTerminology()&&(this.defaultInputItem=this._createTerminologyItem(defValue,!1,createWithDefaultValues))),
this.defaultInputItem},findInputItemByValue:function(value,skipDefault,createWithDefaultValues){for(var listArr=this.getList(),i=0;i<listArr.length;i++)if(listArr[i].value===value)return listArr[i];if(value&&this.getTerminology()){var retItem=this.getTerminologyListCache()[value];return retItem||(retItem=this._createTerminologyItem(value,!1,createWithDefaultValues),this.addItem(retItem)),retItem}if(!skipDefault){var defaultItem=this.getDefaultInputItem();if(defaultItem&&defaultItem.value===value)return defaultItem}return null},setDefaultValue:function(defaultValue){var newDefaultInputItem=this.findInputItemByValue(defaultValue,!0);newDefaultInputItem&&(this.defaultValue=defaultValue,this.defaultInputItem=newDefaultInputItem)},getContext:function(){return this.context},getTerminology:function(){return this.terminology},setTerminology:function(terminology,reloadLastSearch){var update=this.terminology!=terminology;update&&(this.terminology=terminology,reloadLastSearch?this.reloadListFromTerminology():this.setList([]))},setContext:function(context,skipLoadFromTerminology){var update=!1;!skipLoadFromTerminology&&this.context&&context.language&&this.context.language!=context.language&&(update=!0),this.context=context,update&&this.reloadListFromTerminology(),this.getList().forEach(function(item){item.setContext(this.getContext(),!1)},this)},reloadListFromTerminology:function(){var lastQueryStr=this._getLastTermQryString(this._lastTerminologySearchStrId);lastQueryStr&&this.getTerminologyItemsWithLabel(lastQueryStr,null)},_createLastTermStringId:function(labelString){var language=this.getContext()?this.getContext().language:"noLang";return labelString+"~"+language+"~"+this.getTerminology()},_tokenizeLastTermStringId:function(lastTermLabelStr){return lastTermLabelStr?lastTermLabelStr.split("~"):null},_getLastTermQryString:function(lastTermLabelStr){var splArr=this._tokenizeLastTermStringId(lastTermLabelStr);return splArr?(splArr.splice(splArr.length-2,2),splArr.join("")):null},_connectItemToTerminology:function(inputItem,skipLoadFromTerminology){if(this.getTerminology()){inputItem.setTerminologyResolverFn(this._getTerminologyResolverFn()),inputItem.setContext(this.getContext(),!0),inputItem.setTerminology(this.getTerminology(),skipLoadFromTerminology);var cachedInputItem=this.getTerminologyListCache()[inputItem.value];cachedInputItem?cachedInputItem.onUpdateCallback&&(cachedInputItem.applyValuesFrom(inputItem),cachedInputItem.onUpdateCallback.call(void 0,cachedInputItem)):this.getTerminologyListCache()[inputItem.value]=inputItem}},toString:function(){return"thinkehr.f4.Input"}}),thinkehr.f4.Input._toLabelValuePropsArr=function(codeDescPropsArr,lang,fromTerminologyStr){for(var ret=[],i=0;i<codeDescPropsArr.length;i++)ret.push(thinkehr.f4.InputItem._toLabelValuePropsItem(codeDescPropsArr[i],lang,fromTerminologyStr));return ret},thinkehr.f4.Input.loadItemFromTerminology=function(codeValue,callbackFn,language,terminologyCodeSystem,context,resolverFn){if(terminologyCodeSystem&&context){var reqLang=language||context.language;if(!resolverFn&&context&&context.getTerminologyItem&&context.getTerminologyItem instanceof Function&&(resolverFn=context.getTerminologyItem),resolverFn)return resolverFn(terminologyCodeSystem,codeValue,reqLang,function(resItem){thinkehr.f4.InputItem._toLabelValuePropsItem(resItem,reqLang,terminologyCodeSystem),callbackFn&&callbackFn(resItem)},!0),!0;console.warn("'getTerminologyItem' method not defined on form context object")}return callbackFn&&callbackFn(null),!1},thinkehr.f4.InputItem=thinkehr.f4.Object._extendM({init:function(properties){this._super(properties),void 0===this.value&&(this.value=null),void 0===this.label&&(this.label=null),void 0===this.validation&&(this.validation=null),void 0===this.localizedLabels&&(this.localizedLabels={}),void 0===this.onUpdateCallback&&(this.onUpdateCallback=null),void 0===this.terminology&&(this.terminology=null),void 0===this.context&&(this.context=null),void 0===this.status&&(this.status=null),void 0===this.parentInput&&(this.parentInput=null),this._loadTerminologyRequestIdsInProgress=null,this._stashedLabelValue=""},getValue:function(){return this.value},setValue:function(value){this.value=value},getLabel:function(locale){if(locale){var l=this.localizedLabels?this.localizedLabels[locale]:null;return locale&&null==l&&this.updateFromTerminology(locale),l?l:this.label}return this.label},setLabel:function(label){this.label=label},getValidation:function(){return this.validation},setValidation:function(validation){this.validation=validation},setLocalizedLabels:function(localizedLabels){this.localizedLabels=localizedLabels},setLocalizedLabel:function(language,value){language&&(this.localizedLabels||this.setLocalizedLabels({}),this.localizedLabels[language]=value)},setOnUpdateCallback:function(onUpdateCallback){this.onUpdateCallback=onUpdateCallback},getTerminologyResolverFn:function(){return this.terminologyResolverFn},setTerminologyResolverFn:function(resolverFn){this.terminologyResolverFn=resolverFn},getTerminology:function(){return this.terminology},setTerminology:function(terminologyStr,skipTerminologyUpdate){var update=this.terminology!=terminologyStr;this.terminology=terminologyStr,update&&!skipTerminologyUpdate&&(this.setLocalizedLabels({}),this.updateFromTerminology())},getContext:function(){return this.context},setContext:function(context,skipLoadFromTerminology){this.context=context,skipLoadFromTerminology||this.updateFromTerminology()},applyValuesFrom:function(inputItemObj){if(inputItemObj){if(this.label=inputItemObj.label,this.validation=inputItemObj.validation,inputItemObj.localizedLabels)for(var langProp in inputItemObj.localizedLabels)inputItemObj.localizedLabels.hasOwnProperty(langProp)&&(this.localizedLabels[langProp]=inputItemObj.localizedLabels[langProp]);this.onUpdateCallback&&this.onUpdateCallback.call(void 0,this)}},updateFromTerminology:function(language){language||(language=this.getContext().language);var terminologyCodeSystem=this.getTerminology();if(terminologyCodeSystem){var createRequestIdString=function(terminologyCodeSystem,currVal,reqLang){return terminologyCodeSystem+":"+currVal+":"+reqLang},context=this.getContext(),currVal=this.getValue(),loadTermId=createRequestIdString(terminologyCodeSystem,currVal,language);if(null==this.localizedLabels[language]&&this._loadTerminologyRequestIdsInProgress!=loadTermId){var resolveFn=this.getTerminologyResolverFn(),requestMade=thinkehr.f4.Input.loadItemFromTerminology(currVal,function(terminologyItem){var notFound=null==terminologyItem;if(!terminologyItem){terminologyItem={},terminologyItem.localizedLabels={};var currentLocalizedLabel;for(var lang in this.localizedLabels)this.localizedLabels.hasOwnProperty(lang)&&lang!=language&&(currentLocalizedLabel=this.localizedLabels[lang],currentLocalizedLabel.indexOf(thinkehr.f4.InputItem._getNotFoundLabel(lang,currVal))<0&&(currentLocalizedLabel=thinkehr.f4.InputItem._getNotFoundLabel(lang,currVal),currentLocalizedLabel=this._stashedLabelValue?currentLocalizedLabel+" | "+this._stashedLabelValue:currentLocalizedLabel),terminologyItem.localizedLabels[lang]=currentLocalizedLabel);currentLocalizedLabel=this.localizedLabels[language],currentLocalizedLabel&&currentLocalizedLabel.indexOf(thinkehr.f4.InputItem._getNotFoundLabel(language,currVal))<0&&(currentLocalizedLabel=thinkehr.f4.InputItem._getNotFoundLabel(language,currVal),currentLocalizedLabel=this._stashedLabelValue?currentLocalizedLabel+" | "+this._stashedLabelValue:currentLocalizedLabel),terminologyItem.localizedLabels[language]=currentLocalizedLabel,terminologyItem.label=terminologyItem.localizedLabels[language]}terminologyItem&&(this.applyValuesFrom(terminologyItem),this.status=notFound?thinkehr.f4.InputItem.STATUS_NOT_FOUND:null)}.bind(this),language,terminologyCodeSystem,context,resolveFn);requestMade&&(this._stashedLabelValue=this.label,this._loadTerminologyRequestIdsInProgress=loadTermId,this.setLocalizedLabel(language,this.label),this.status=thinkehr.f4.InputItem.STATUS_LOADING)}}},toString:function(){return"thinkehr.f4.InputItem"}}),thinkehr.f4.InputItem.STATUS_LOADING="loading",thinkehr.f4.InputItem.STATUS_NOT_FOUND="notfound",thinkehr.f4.InputItem._toLabelValuePropsItem=function(codeDescPropsItem,lang,fromTerminologyStr){return codeDescPropsItem&&(codeDescPropsItem.localizedLabels||(codeDescPropsItem.localizedLabels={}),lang&&!codeDescPropsItem.localizedLabels[lang]&&(codeDescPropsItem.localizedLabels[lang]=codeDescPropsItem.description),codeDescPropsItem.label=codeDescPropsItem.description,codeDescPropsItem.value=codeDescPropsItem.code,fromTerminologyStr&&(codeDescPropsItem.terminology=fromTerminologyStr),delete codeDescPropsItem.description,delete codeDescPropsItem.code),codeDescPropsItem},thinkehr.f4.InputItem.OTHER_VALUE="__other__",thinkehr.f4.InputItem._getOtherLabel=function(language){var loadingStr=thinkehr.f4.dict.tr("other",language);return loadingStr||(loadingStr="Other"),loadingStr},thinkehr.f4.InputItem._getNotFoundLabel=function(language,codeValue){var notFound=thinkehr.f4.dict.tr("notFound",language);return notFound||(notFound="Not found"),notFound+" ("+codeValue+")"},thinkehr.f4.Validation=thinkehr.f4.Object._extendM({init:function(properties){this._super(properties),void 0===this.precision&&(this.precision=null)},getPrecision:function(){return this.precision},setPrecision:function(precision){this.precision=precision},toString:function(){return"thinkehr.f4.Validation"}}),thinkehr.f4.Model=thinkehr.f4.Object._extendM({init:function(properties){this._super(properties),this.parentModel=null,this.childModels=[],void 0===this.descEl&&(this.descEl=null),void 0===this.wrappingModel&&(this.wrappingModel=null)},getChildModels:function(){return this.childModels},getChildModel:function(i){return this.childModels[i]},getChildCount:function(){return this.childModels.length},getChildModelsMatching:function(func){for(var models=[],i=0;i<this.childModels.length;i++){var model=this.childModels[i];func(model)&&models.push(model)}return models},addChildModel:function(model){model.setParentModel(this),this.childModels.push(model)},insertChildModelAt:function(index,model){model.setParentModel(this),this.childModels.splice(index,0,model)},removeChildModel:function(model){var index=this.childModels.indexOf(model);index>=0&&this.childModels.splice(index,1)},removeFromParent:function(){this.getParentModel()&&this.getParentModel().removeChildModel(this)},getParentModel:function(){return this.parentModel},getParentOrWrapperModel:function(){var pm=this.getParentModel();return!pm&&this.isWrapped()&&(pm=this.getWrappingModel()),pm},setParentModel:function(model){this.parentModel=model},getRootModel:function(){for(var m=this;m.getParentOrWrapperModel();)m=m.getParentOrWrapperModel();return m},accept:function(visitor){var stop=visitor.visit(this);if(stop!==!0)for(var continueProcessing=!0,i=0;continueProcessing&&i<this.getChildCount();i++){var child=this.getChildModel(i),childStop=child.accept(visitor);childStop===!0&&(continueProcessing=!1,stop=!0)}return visitor.afterVisit(this),stop},getDescEl:function(){return this.descEl},setDescEl:function(descEl){this.descEl=descEl},getWrappingModel:function(){return this.wrappingModel},setWrappingModel:function(wrappingModel){this.wrappingModel=wrappingModel},isWrapped:function(){return null!==this.wrappingModel&&void 0!==this.wrappingModel},toString:function(){return"thinkehr.f4.Model"}}),thinkehr.f4.FormObjectModel=thinkehr.f4.Model._extendM({init:function(properties){this._super(properties),void 0===this.formId&&(this.formId=null),void 0===this.name&&(this.name=null),void 0===this.viewConfig?this.viewConfig=null:this.viewConfig instanceof thinkehr.f4.ViewConfig&&this.viewConfig.setModel(this),void 0===this.valueNodeRef&&(this.valueNodeRef=null),void 0===this.valueNodeParentRef&&(this.valueNodeParentRef=null),void 0===this.dependencyNode&&(this.dependencyNode=null),void 0===this._childPathIdMap&&(this._childPathIdMap={}),void 0===this._context&&(this.context=null),void 0===this._elementName&&(this._elementName=null),void 0===this.__onModelRefreshed&&(this.__onModelRefreshed=[]),void 0===this._customFunctionName&&(this._customFunctionName=null),void 0===this.isGenericField&&(this.isGenericField=!1)},getFormId:function(){return this.formId},setFormId:function(id){this.formId=id},getName:function(){return this.name},setName:function(name){this.name=name},getViewConfig:function(){return this.viewConfig},setViewConfig:function(viewConfig){this.viewConfig=viewConfig,viewConfig&&viewConfig.setModel(this)},getRmType:function(){return null},getIsGenericField:function(){return this.isGenericField},setIsGenericField:function(value){this.isGenericField=value},getPath:function(){return this.formId},isValueModel:function(){return!1},isAttachableToValueNode:function(){return!0},getValueNodeRef:function(){return this.valueNodeRef},setValueNodeRef:function(valueNodeRef){this.valueNodeRef=valueNodeRef},getValueNodeParentRef:function(){return this.valueNodeParentRef},setValueNodeParentRef:function(valueNodeParentRef){this.valueNodeParentRef=valueNodeParentRef},getValueNodeParentRefPropertyName:function(){var pathArr=this.getFormId().split("/");return pathArr[pathArr.length-1]},getContext:function(){if(this._context)return this._context;var pm=this.getParentModel();return pm&&pm.getContext?this.getParentModel().getContext():null},setContext:function(context){this._context=context},isContainer:function(){return!1},labelFor:function(language){var lbl;if(this.getViewConfig()&&this.getViewConfig().getLabel()){var labelConfig=this.getViewConfig().getLabel();labelConfig.isCustom()?(labelConfig.isUseLocalizations()&&(lbl=labelConfig.getLocalization(language)),lbl||(lbl=labelConfig.getValue())):labelConfig.isUseLocalizations()&&(lbl=labelConfig.getLocalization(language))}return lbl||(lbl||labelConfig&&labelConfig.isCustom()||(lbl=this.getLocalizedName(language)),lbl||(lbl=this.getLocalizedName(),lbl||(lbl=this.getName()))),lbl},getContainerChildModels:function(withModelPath){return this.getChildModelsMatching(function(model){var isContainer=model.isContainer();return withModelPath?isContainer&&model.getPath()===withModelPath:isContainer})},addChildModel:function(model){this._super(model),this._increaseChildPathIdIndexFor(model),this.processDependenciesFromRoot()},insertChildModelAt:function(index,model){this._super(index,model),this._increaseChildPathIdIndexFor(model),this.processDependenciesFromRoot()},insertChildModelAfterLastOfSamePath:function(model,insertAsLastIfNotFound){for(var lastChildIndex=-1,i=0;i<this.getChildCount();i++){var child=this.getChildModel(i);child.getPath()===model.getPath()&&(lastChildIndex=i)}lastChildIndex>=0?this.insertChildModelAt(lastChildIndex+1,model):insertAsLastIfNotFound&&this.addChildModel(model)},removeChildModel:function(model){this._super(model),this.processDependenciesFromRoot()},removeFromParent:function(){var pm=this.getParentModel();pm&&(this._super(),this.processDependenciesFromRoot())},_increaseChildPathIdIndexFor:function(model){var path=model.getPath()?model.getPath():"none";void 0!==this._childPathIdMap[path]?this._childPathIdMap[path]+=1:this._childPathIdMap[path]=0;var idIndex=this._childPathIdMap[path];return model._childPathIdIndex=idIndex,idIndex},getUniqueId:function(){if(!this.childPathId)if(this.getPath()){for(var index=void 0===this._childPathIdIndex?0:this._childPathIdIndex,modelPath=this.getPath(),p=modelPath+":"+index,parent=this.getParentModel();null!=parent;)if(parent.getPath()&&parent.getRmType()!==thinkehr.f4.RmType.FORM_DEFINITION){index=void 0===parent._childPathIdIndex?0:parent._childPathIdIndex;var parentPath=parent.getPath();if(0==p.indexOf(parentPath)){var parentPart=p.substring(0,parentPath.length);p=parentPart+":"+index+p.substr(parentPath.length)}else p=parentPath+":"+index+"/"+p;parent=parent.getParentModel()}else parent=null;this.childPathId=p}else this.childPathId=null;return this.childPathId},getSanitizedUniqueId:function(){var uniqueId=this.getUniqueId();return uniqueId?thinkehr.f4.util.sanitizeName(uniqueId):null},getTags:function(){return this.getViewConfig().getTags()},hasTag:function(tag){var viewConfig=this.getViewConfig();return viewConfig?viewConfig.hasTag(tag):!1},getAnnotations:function(){return this.getViewConfig().getAnnotations()},hasAnnotation:function(key){return this.getViewConfig().hasAnnotation(key)},annotationValue:function(key){return this.getViewConfig().annotationValue(key)},getElementName:function(){if(!this._elementName){var sUid=this.getSanitizedUniqueId();this._elementName=sUid?sUid:thinkehr.f4.util.guid()}return this._elementName},setElementName:function(elementName){this._elementName=elementName},getElementNameChain:function(){for(var chain=[this.getElementName()],pm=this.getParentModel();pm;)pm.isContainer()&&pm.getRmType()!==thinkehr.f4.RmType.FORM_DEFINITION&&pm.getElementName()&&chain.splice(0,0,pm.getElementName()),pm=pm.getParentModel();return chain},getDependencyNode:function(){return this.dependencyNode},setDependencyNode:function(dependencyNode){this.dependencyNode=dependencyNode},processDependenciesFromRoot:function(){var rm=this.getRootModel();if(rm){var dn=rm.getDependencyNode();dn&&dn.process({})}},findAncestorWithPath:function(path){for(var pm=this.getParentModel();pm;){if(pm.getPath()===path)return pm;pm=pm.getParentModel()}return null},findMultiAncestor:function(includeCurrent){for(var pm=includeCurrent?this:this.getParentModel();pm;){if(pm.isMulti&&pm.isMulti())return pm;pm=pm.getParentModel()}return null},findAncestorContainer:function(includeCurrent){for(var pm=includeCurrent?this:this.getParentModel();pm;){if(pm.isContainer&&pm.isContainer())return pm;pm=pm.getParentModel()}return null},findChildWithPath:function(path,index){if(this.getChildCount()>0)for(var ic=0,i=0;i<this.getChildCount();i++){var childModel=this.getChildModel(i);if(childModel.getPath()===path){if(void 0===index)return childModel;if(ic++===index)return childModel}}return null},findChildrenWithPath:function(path){for(var children=[],i=0;i<this.getChildCount();i++){var childModel=this.getChildModel(i);childModel.getPath()===path&&children.push(childModel)}return children},findSuccessorWithPredicate:function(predicateFn){for(var i=0;i<this.getChildCount();i++){var childModel=this.getChildModel(i),predicateFnRes=predicateFn(childModel);if(predicateFnRes)return childModel;if(predicateFnRes!==!1){var cm=childModel.findSuccessorWithPredicate(predicateFn);if(null!=cm)return cm}}return null},findSuccessorWithPath:function(path){for(var i=0;i<this.getChildCount();i++){var childModel=this.getChildModel(i);if(childModel.getPath()===path)return childModel;var cm=childModel.findSuccessorWithPath(path);if(null!=cm)return cm}return null},findSuccessorWithTag:function(tag){for(var i=0;i<this.getChildCount();i++){var childModel=this.getChildModel(i);if(childModel.hasTag(tag))return childModel;var cm=childModel.findSuccessorWithTag(tag);if(null!=cm)return cm}return null},findSuccessorsWithPath:function(path){var result=[];return this._findSuccessorsWithPathRecursive(path,result),result},_findSuccessorsWithPathRecursive:function(path,result){for(var i=0;i<this.getChildCount();i++){var childModel=this.getChildModel(i);childModel.getPath()===path&&result.push(childModel),childModel._findSuccessorsWithPathRecursive(path,result)}},findSuccessorsWithTag:function(tag){var result=[];return this._findSuccessorsWithTagRecursive(tag,result),result},_findSuccessorsWithTagRecursive:function(tag,result){for(var i=0;i<this.getChildCount();i++){var childModel=this.getChildModel(i);childModel.hasTag(tag)&&result.push(childModel),childModel._findSuccessorsWithTagRecursive(tag,result)}},findAncestorWithTag:function(tag,includeCurrent){for(var currModel=includeCurrent?this:this.getParentModel();currModel;){if(currModel.hasTag(tag))return currModel;currModel=currModel.getParentModel()}return null},findClosestWithPath:function(path){for(var m=this;m;){var s=m.findSuccessorWithPath(path);if(s)return s;m=m.getParentModel()}return null},findAncestorWithRmType:function(rmTypeEnum,includeCurrent){for(var currModel=includeCurrent?this:this.getParentModel();currModel;){if(currModel.getRmType()===rmTypeEnum)return currModel;currModel=currModel.getParentModel()}return null},findAncestorWithAnnotation:function(key,value,includeCurrent){for(var currModel=includeCurrent?this:this.getParentModel();currModel;){if(null==value){if(currModel.hasAnnotation(key))return currModel}else if(currModel.annotationValue(key)===value)return currModel;currModel=currModel.getParentModel()}return null},hasAnyKendoComponent:function(){return!!this.findSuccessorWithPredicate(function(currModel){var rmType=currModel.getRmType();if(currModel.isContainer()||currModel.getIsGenericField()||currModel.getViewConfig().isHidden())return currModel.hasAnnotation("tab")?!1:null;var typeHasKendoComponent=rmType!==thinkehr.f4.RmType.DV_TEXT&&rmType!==thinkehr.f4.RmType.DV_BOOLEAN&&rmType!==thinkehr.f4.RmType.DV_URI&&rmType!==thinkehr.f4.RmType.DV_EHR_URI&&rmType!==thinkehr.f4.RmType.CUSTOM,field=currModel.getViewConfig().getField(),presentat=field&&field.getPresentation?field.getPresentation():null;if(typeHasKendoComponent!==!0||rmType!==thinkehr.f4.RmType.DV_CODED_TEXT&&rmType!==thinkehr.f4.RmType.DV_ORDINAL){if(typeHasKendoComponent===!1&&(rmType===thinkehr.f4.RmType.DV_TEXT||presentat&&(presentat==thinkehr.f4.FieldPresentation.TEXTFIELD||presentat==thinkehr.f4.FieldPresentation.TEXTAREA))){var input=currModel.getInputFor("textValues");typeHasKendoComponent=input&&presentat===thinkehr.f4.FieldPresentation.COMBOBOX?input.getList().length>0:!1}}else!presentat||rmType!==thinkehr.f4.RmType.DV_CODED_TEXT&&rmType!==thinkehr.f4.RmType.DV_ORDINAL||(typeHasKendoComponent=presentat!==thinkehr.f4.FieldPresentation.RADIOS);return typeHasKendoComponent})},onModelRefreshed:function(f){this.__onModelRefreshed.push(f)},removeOnModelRefreshed:function(f){this.__onModelRefreshed.splice(this.__onModelRefreshed.indexOf(f),1)},_triggerModelRefreshed:function(){for(var i=0;i<this.__onModelRefreshed.length;i++){var f=this.__onModelRefreshed[i];f(this)}},getCustomFunction:function(){return!this._customFunctionName&&this.hasAnnotation("function")&&(this._customFunctionName=this.annotationValue("function")),this._customFunctionName},isCustomFunctionCustomComponent:function(context){return thinkehr.f4.isCustomFunctionCustomComponent(this.getCustomFunction(),this.hasTag("custom"),context||this.getContext())},setCustomFunction:function(globalCustomFuncName){this._customFunctionName=globalCustomFuncName},containsValue:function(){function isSuitable(model){return!model.isContainer()&&model.getRmType()!==thinkehr.f4.RmType.FORM_DEFINITION&&void 0!==model.getValue}if("true"===this.annotationValue("ignoreForContainsValue"))return!1;if(isSuitable(this)&&thinkehr.f4.util.isValueNonEmpty(this.getValue()))return!0;for(var i=0;i<this.getChildCount();i++){var model=this.getChildModel(i);if(model.containsValue()===!0)return!0}return!1},toString:function(){return"thinkehr.f4.FormObjectModel"}}),thinkehr.f4.FormRootModel=thinkehr.f4.FormObjectModel._extendM({init:function(properties){this._super(properties)},getContext:function(){return this._context},getRmType:function(){return thinkehr.f4.RmType.FORM_DEFINITION},getUniqueId:function(){return null},toString:function(){return"thinkehr.f4.FormRootModel/"+this.getName()+"/"+this.getRmType().toString()}}),thinkehr.f4.FormRepeatableElementModel=thinkehr.f4.FormObjectModel._extendM({init:function(properties){this._super(properties),void 0===this.localizedName&&(this.localizedName=null),void 0===this.localizedNames&&(this.localizedNames={}),void 0===this.min&&(this.min=0),void 0===this.max&&(this.max=null),void 0===this.parent&&(this.parent=null)},getLocalizedName:function(locale){if(locale){var n=this.localizedNames[locale];return n?n:null}return this.localizedName},setLocalizedName:function(localizedName){this.localizedName=localizedName},setLocalizedNames:function(localizedNames){this.localizedNames=localizedNames},getMin:function(){return this.min},setMin:function(min){this.min=min},getMax:function(){return this.max},setMax:function(max){this.max=max},isMulti:function(){return this.hasTag("multi")&&this.max&&(this.max>1||this.max<0)},getMultiIndex:function(searchFirstMultiAncestor){var containersInParent=this.getParentModel().getContainerChildModels(this.getPath());if(containersInParent&&containersInParent.length)return containersInParent.indexOf(this);if(searchFirstMultiAncestor){var firstMultiAncestor=this.findMultiAncestor();if(firstMultiAncestor)return firstMultiAncestor.getMultiIndex(!1)}return null},isRequired:function(){return void 0!==this.min&&this.min>0},clearValue:function(){this.isContainer()&&this.getChildModels().forEach(function(chModel){chModel.clearValue()})},resetValue:function(){this.isContainer()&&(this.getParentModel().getContainerChildModels(this.getPath()).forEach(function(multiItem){multiItem!==this&&thinkehr.f4.destroyModel(multiItem)}.bind(this)),this.getChildModels().forEach(function(chModel){chModel.resetValue()}))},isContainer:function(){return!1},toString:function(){return"thinkehr.f4.FormRepeatableElementModel"}}),thinkehr.f4.AbstractContainerModel=thinkehr.f4.FormRepeatableElementModel._extendM({init:function(properties){this._super(properties)},isContainer:function(){return!0},getElementName:function(){return this._elementName||(this._elementName=this.getNamePrefix()+thinkehr.f4.util.guid("_"),this._elementName=this.getNamePrefix()+thinkehr.f4.util.guid("_")),this._elementName},getNamePrefix:function(){return"container_"},toString:function(){return"thinkehr.f4.AbstractContainerModel/"+this.getName()+"/"+this.getRmType().toString()}}),thinkehr.f4.GenericFieldsetModel=thinkehr.f4.AbstractContainerModel._extendM({init:function(properties){this._super(properties)},getRmType:function(){return thinkehr.f4.RmType.GENERIC_FIELDSET},isAttachableToValueNode:function(){return!1},getNamePrefix:function(){return"cnt_gen_"},isMulti:function(){return!1},toString:function(){return"thinkehr.f4.GenericFieldsetModel/"+this.getName()+"/"+this.getRmType().toString()}}),thinkehr.f4.RmContainerModel=thinkehr.f4.AbstractContainerModel._extendM({init:function(properties){this._super(properties),void 0===this.rmType&&(this.rmType=null)},getRmType:function(){return this.rmType},setRmType:function(rmType){this.rmType=rmType},getNamePrefix:function(){return"cnt_rm_"},toString:function(){return"thinkehr.f4.RmContainerModel/"+this.getName()+"/"+this.getRmType()}}),thinkehr.f4.NodeModel=thinkehr.f4.FormRepeatableElementModel._extendM({init:function(properties){this._super(properties),void 0===this.nodeId&&(this.nodeId=null),void 0===this.aqlPath&&(this.aqlPath=null),void 0===this.inputs&&(this.inputs=[]),void 0===this.value&&(this.value=null),void 0===this.valueTypes&&(this.valueTypes=[]),this._MULTI_ARR_PARAM=void 0,this._isDefaultValue=!1},getNodeId:function(){return this.nodeId},setNodeId:function(nodeId){this.nodeId=nodeId},getAqlPath:function(){return this.aqlPath},setAqlPath:function(aqlPath){this.aqlPath=aqlPath},getInputs:function(){return this.inputs},getInput:function(index){return index>=0&&index<this.inputs.length?this.inputs[index]:null},getInputFor:function(suffix){for(var i=0;i<this.inputs.length;i++){var input=this.inputs[i];if(input.getSuffix()===suffix)return input}return null},getInputByType:function(type){for(var i=0;i<this.inputs.length;i++){var input=this.inputs[i];if(input.getType()===type)return input}return null},setInputs:function(inputs){this.inputs=inputs},addInput:function(input){input.setInputForModel(this),this.getViewConfig().getTerminology()&&input.setTerminology(this.getViewConfig().getTerminology()),this.inputs.push(input)},isValueModel:function(){return!0},getValue:function(property,multiIndex){var valsArr=this._getValuesArray();if(valsArr){if(arguments.length>1&&multiIndex===this._MULTI_ARR_PARAM||arguments.length<2&&this.isMulti())return valsArr.map(function(multiVal){return property?multiVal[property]:multiVal});if(multiIndex||(multiIndex=0),valsArr.length>0&&null!=valsArr[multiIndex]){var retVal;return property?(retVal=valsArr[multiIndex][property],void 0===retVal&&(property="|"+property,retVal=valsArr[multiIndex][property])):retVal=valsArr[multiIndex],void 0!==retVal?retVal:null}}return null},setValue:function(value,multiIndex,propertyName){var retValue=null;if(void 0===multiIndex)null==value||thinkehr.f4.util.isArray(value)||(value=[value]),this._setValuesArray(value),retValue=this._getValuesArray();else{var valuesArr=this._getValuesArray();void 0===propertyName?(null===value?valuesArr.splice(multiIndex,1):valuesArr[multiIndex]=value,retValue=valuesArr):(null==propertyName&&null===value?valuesArr.splice(valuesArr.indexOf(valuesArr[multiIndex]),1):null!=propertyName?(null==valuesArr[multiIndex]&&(valuesArr[multiIndex]={}),valuesArr[multiIndex][propertyName]=value):valuesArr[multiIndex]=value,retValue=valuesArr),this._setOnAllValuesArray(valuesArr)}return this._setSkipDefaultValue(!0,multiIndex),null!=multiIndex?retValue[multiIndex]:retValue},clearValue:function(){this._setValuesArray([]),this._setIsDefaultValue(!1)},_setSkipDefaultValue:function(val,multiIndex){this._skipDefaultValue=val},_applyValueFromObject:function(value){if(thinkehr.f4.util.isObject(value)){for(var prop in value)value.hasOwnProperty(prop)&&this.applyValue(value[prop],prop);return!0}return!1},applyValue:function(value,valTypeStr,multiIndex){throw new Error("'applyValue' method not implemented on "+this.toString())},resetValue:function(){throw new Error("'resetValue' method not implemented on "+this.toString())},setValueProp:function(value,valuePropertyName,multiIndex){if(this.isMulti()||null!=multiIndex){if(this.isMulti()&&null==multiIndex&&!thinkehr.f4.util.isArray(value)&&null!=valuePropertyName)throw new Error("multiIndex parameter is required on isMulti()==true models")}else multiIndex=0;var currValAtIndex=this.getValue(this._MULTI_ARR_PARAM,multiIndex);if(!currValAtIndex&&null!=value){var val={};this.setValue(val,multiIndex),currValAtIndex=[val]}currValAtIndex&&(thinkehr.f4.util.isArray(currValAtIndex)||(currValAtIndex=[currValAtIndex]),currValAtIndex.forEach(function(){this.setValue(value,multiIndex,valuePropertyName)},this))},clearValueProp:function(valuePropertyName,multiIndex){if(this.isMulti()||null!=multiIndex){if(this.isMulti()&&void 0===multiIndex)throw new Error("multiIndex parameter must be null or integer on isMulti() model")}else multiIndex=0;if(null===multiIndex)this._getValuesArray().length=0;else{if(null==multiIndex)throw new Error("multiIndex param must be defined");this.setValueProp(null,valuePropertyName,multiIndex)}this._setIsDefaultValue(!1)},getMultiContainerDefaultValue:function(){var parentModel=this.getParentModel();if(parentModel&&parentModel.isMulti&&parentModel.isMulti()){var multiDefAnnVal=this.getViewConfig().annotationValue("multiDefault");if(multiDefAnnVal){var vals=multiDefAnnVal.split(";"),retVal=vals[parentModel.getMultiIndex()];return null!=retVal?retVal.trim():void 0}}},isDefaultValue:function(){return this._isDefaultValue},hasValue:function(){throw new Error("Must be implementated on field model.")},_hasValue:function(val,_isValueEmptyFn){return thinkehr.f4.util.isArray(val)?val.length?!val.every(function(arrVal){return _isValueEmptyFn(arrVal)}.bind(this)):!1:!_isValueEmptyFn(val)},_isValueEmpty:function(val){return null==val||""===val},_setIsDefaultValue:function(val){this._isDefaultValue=val},_getPropertyValueFromMultiDefaultString:function(multiDefaultValue,propName,skipGenericValue){if(multiDefaultValue.indexOf("|")<0&&multiDefaultValue.indexOf("=")<0&&!skipGenericValue)return multiDefaultValue;for(var keyValsStrArr=multiDefaultValue.split("|"),i=0;i<keyValsStrArr.length;i++){var keyVal=keyValsStrArr[i].split("=");if(keyVal[0].trim()==propName)return keyVal[1]}},_getMultiIndexArgs:function(arg,propertyName){
var retArgs=[];return arg.length>1&&(retArgs=[void 0,arg[1]]),propertyName&&(retArgs||(retArgs=[]),retArgs[0]=propertyName),retArgs},_getValuesArray:function(){var valuesArr=this.getValueNodeParentRef();return null==valuesArr&&(this.isGenericField||this.isCustomFunctionCustomComponent())&&(valuesArr=this.value,valuesArr||(valuesArr=[])),this.isMulti()?thinkehr.f4.util.isArray(valuesArr)||(valuesArr=valuesArr[this.getValueNodeParentRefPropertyName()]):null!=valuesArr&&(thinkehr.f4.util.isArray(valuesArr)||(this.isGenericField||this.isCustomFunctionCustomComponent()?valuesArr=[valuesArr]:console.warn("ParentRef is not array!",valuesArr))),valuesArr},_setValuesArray:function(newValuesArr){var currValsArr=this._getValuesArray();if(currValsArr){if(newValuesArr){if(newValuesArr=thinkehr.f4.util.copyArrayShallow(newValuesArr),currValsArr.length=0,newValuesArr.length)for(var i=newValuesArr.length;i--;)currValsArr[i]=newValuesArr[i];this._setOnAllValuesArray(currValsArr)}}else console.warn("No values arr=",currValsArr)},_setOnAllValuesArray:function(arr){this.value=arr,this.setValueNodeRef(arr)},_setFloatValueIfString:function(val,multiIndex,propName){if(null!=val&&thinkehr.f4.util.isString(val)){null==multiIndex&&(multiIndex=0);var floatVal=parseFloat(val);return isNaN(floatVal)&&(floatVal=null),this.setValueProp(floatVal,propName,multiIndex),this.getValue.apply(this,this._getMultiIndexArgs(arguments,propName))}return val},_getDefaultMultiIndex:function(multiIndex){return null!=multiIndex?multiIndex:this.isMulti()?0:void 0},toString:function(){return"thinkehr.f4.NodeModel"}}),thinkehr.f4.DirectValueModel=thinkehr.f4.NodeModel._extendM({init:function(properties,valueFuncName){this._super(properties),this._skipDefaultValue=!1,this._valueFuncName=valueFuncName},_MULTI_ARR_PARAM:void 0,valueGetterSetter:function(value,multiIndex,settingDefaultValue){return arguments.length>0&&value!==this._MULTI_ARR_PARAM?(this._setValuesArray(this.transformValue(value,this._getValuesArray(),multiIndex)),this._skipDefaultValue=!0,this._setIsDefaultValue(!1),this.getValue.apply(this,this._getMultiIndexArgs(arguments))):(null==this.getValue()||this.getValue().length<1)&&this.defaultValue()&&!this._skipDefaultValue?(this.valueGetterSetter(JSON.parse(JSON.stringify(this.defaultValue())),this._MULTI_ARR_PARAM,!0),this._setIsDefaultValue(!0),this.getValue.apply(this,this._getMultiIndexArgs(arguments))):this.getValue.apply(this,this._getMultiIndexArgs(arguments))},_sanitizeArrayValue:function(retArr){return 1==retArr.length&&(null==retArr[0]||retArr[0].toString().length<1)&&(retArr.length=0),retArr},transformValue:function(newValue,currValueArr,multiIndex){var retArr=currValueArr?currValueArr:[];if(thinkehr.f4.util.isArray(retArr)||(retArr=[retArr]),void 0!==newValue){if(3==arguments.length&&multiIndex===this._MULTI_ARR_PARAM){if(retArr.length=0,thinkehr.f4.util.isArray(newValue)){for(var i=0;i<newValue.length;i++)retArr[i]=newValue[i];return this._sanitizeArrayValue(retArr)}multiIndex=0}else null==multiIndex&&(multiIndex=0);null!=newValue?(null==newValue||newValue.toString().length<1)&&0==multiIndex&&retArr.length<2?retArr.length=0:(isNaN(parseFloat(multiIndex))&&console.warn("multi index not number=",multiIndex),retArr[multiIndex]=newValue):retArr.splice(multiIndex,1)}return this._sanitizeArrayValue(retArr)},getDefaultInput:function(){return null},setValue:function(val,multiIndex){this._super(this.transformValue(val,this.getValue(),this._MULTI_ARR_PARAM),multiIndex)},defaultValue:function(){var dv=this.getMultiContainerDefaultValue();return null!=dv?this.getDefaultInput().setDefaultValue(dv):dv=this.getDefaultInput().getDefaultValue(),thinkehr.f4.util.isString(dv)&&dv.length>0||thinkehr.f4.util.isArray(dv)?dv:null},clearValue:function(){this.setValue(null),this._skipDefaultValue=!0},hasValue:function(){return this._hasValue(this.valueGetterSetter(),this._isValueEmpty)},toString:function(){return"thinkehr.f4.DirectValueModel/"+this._valueFuncName}}),thinkehr.f4.QuantityFieldModel=thinkehr.f4.NodeModel._extendM({init:function(properties){this._super(properties),this._skipDefaultValueMagnitude=!1,this._skipDefaultValueUnit=[]},_getSkipDefaultValueUnit:function(multiInd){return null==multiInd&&(multiInd=0),this._skipDefaultValueUnit[multiInd]},_setSkipDefaultValueUnit:function(val,multiInd){null==multiInd&&(multiInd=0),this._skipDefaultValueUnit[multiInd]=val},getRmType:function(){return thinkehr.f4.RmType.DV_QUANTITY},magnitudeValue:function(value,multiIndex,setEmptyValue){var val=this.getValue.apply(this,this._getMultiIndexArgs(arguments,"|magnitude"));if(value!==this._MULTI_ARR_PARAM){this._setIsDefaultValue(!1);var actualValue=value&&thinkehr.f4.util.isString(value)?parseFloat(value):value;if(setEmptyValue||null!==actualValue&&""!==value&&void 0!==actualValue){var currUnitVal=this.getValue.apply(this,this._getMultiIndexArgs(arguments,"|unit"));return this._setDefaultUnitValue(currUnitVal,multiIndex,!0),this._skipDefaultValueMagnitude=!0,this.setValueProp(actualValue,"|magnitude",multiIndex),this.getValue.apply(this,this._getMultiIndexArgs(arguments,"|magnitude"))}return this.clearMagnitudeValue(multiIndex),this._skipDefaultValueMagnitude=!0,null}var defMagValue=this._setDefaultMagnitudeValue(val,multiIndex,!1);return null!=defMagValue?defMagValue:this._setFloatValueIfString(val,multiIndex,"|magnitude")},defaultValueMagnitude:function(){var dv=this.getMultiContainerDefaultValue();return null!=dv&&(dv=this._getPropertyValueFromMultiDefaultString(dv,"magnitude",!1),dv&&this.getInputFor("magnitude").setDefaultValue(dv)),null==dv&&(dv=this.getInputFor("magnitude").getDefaultValue()),thinkehr.f4.util.isString(dv)?dv.length>0?parseFloat(dv):null:null!==dv&&void 0!==dv?dv:null},_setDefaultMagnitudeValue:function(currValue,multiIndex,skipDefaultUnitValue){if((null==currValue||currValue.length<1)&&!this._skipDefaultValueMagnitude){var mv=this.defaultValueMagnitude();if(null!==mv&&void 0!==mv){this._skipDefaultValueMagnitude=!0;var defMultiInd=null!=multiIndex?multiIndex:0;if(this.isMulti()||(arguments[1]=defMultiInd),!skipDefaultUnitValue){var uv=this.defaultValueUnit();uv&&this.unitValue(uv,defMultiInd)}return this.magnitudeValue(mv,defMultiInd),this._setIsDefaultValue(!0),this.getValue.apply(this,this._getMultiIndexArgs(arguments,"|magnitude"))}}return null},unitValue:function(value,multiIndex,setEmptyValue){var val=this.getValue.apply(this,this._getMultiIndexArgs(arguments,"|unit"));if(value!==this._MULTI_ARR_PARAM){if(this._setIsDefaultValue(!1),setEmptyValue||null!==value&&""!==value&&void 0!==value){var currMagVal=this.getValue.apply(this,this._getMultiIndexArgs(arguments,"|magnitude"));return this.setValueProp(value,"|unit",multiIndex),this._setDefaultMagnitudeValue(currMagVal,multiIndex,!0),this._setSkipDefaultValueUnit(!0,multiIndex),this.getValue.apply(this,this._getMultiIndexArgs(arguments,"|unit"))}return this.clearUnitValue(multiIndex),this._setSkipDefaultValueUnit(!0,multiIndex),null}var defUnitValue=this._setDefaultUnitValue(val,multiIndex,!0);return null!=defUnitValue?defUnitValue:val},_setDefaultUnitValue:function(val,multiIndex,skipDefaultMagnitudeValue){if((null==val||val.length<1)&&!this._getSkipDefaultValueUnit(multiIndex)){var uv=this.defaultValueUnit();if(null!==uv&&void 0!==uv){this._setSkipDefaultValueUnit(!0,multiIndex);var defMultiInd=null!=multiIndex?multiIndex:0;if(this.unitValue(uv,defMultiInd),this._setIsDefaultValue(!0),!skipDefaultMagnitudeValue){var mv=this.defaultValueMagnitude();mv&&(this.magnitudeValue(mv,defMultiInd),this._setIsDefaultValue(!0))}return this.getValue.apply(this,this._getMultiIndexArgs(arguments,"|unit"))}}return null},defaultValueUnit:function(){var dv=this.getMultiContainerDefaultValue();return null!=dv&&(dv=this._getPropertyValueFromMultiDefaultString(dv,"unit",!0),dv&&this.getInputFor("unit").setDefaultValue(dv)),null==dv&&(dv=this.getInputFor("unit").getDefaultValue()),thinkehr.f4.util.isString(dv)&&dv.length>0?dv:null},_getValidationPropertyForUnit:function(unit,functionProperty){var u=void 0!==unit?unit:this.unitValue();if(null==u)return console.warn("Unit parameter must be passed in!"),null;for(var isInt=thinkehr.f4.util.isInteger(unit),l=this.getInputFor("unit").getList(),i=0;i<l.length;i++){var item=l[i];if(isInt&&u==i||item.getValue()===u)return item.getValidation()&&void 0!==item.getValidation()[functionProperty]?thinkehr.f4.util.isFunction(item.getValidation()[functionProperty])?item.getValidation()[functionProperty].call(item.getValidation()):item.getValidation()[functionProperty]:null}return null},getPrecisionForUnit:function(unit){if(null==unit)throw new Error("getPrecisionForUnit() - unit parameter is required!");return this._getValidationPropertyForUnit(unit,"getPrecision")},getRangeForUnit:function(unit){return this._getValidationPropertyForUnit(unit,"range")},getMinValueForUnit:function(unit){var range=this.getRangeForUnit(unit);if(range&&void 0!==range.min){var rangeMin=parseFloat(range.min),minOp=range.minOp?range.minOp:">=";return{min:rangeMin,minOp:minOp}}return null},getMaxValueForUnit:function(unit){var range=this.getRangeForUnit(unit);if(range&&void 0!==range.max){var rangeMax=parseFloat(range.max),maxOp=range.maxOp?range.maxOp:"<=";return{max:rangeMax,maxOp:maxOp}}return null},applyValue:function(value,valueType,multiIndex){this._applyValueFromObject(value)||(null==valueType||"magnitude"==valueType||"value"==valueType?(multiIndex=this._getDefaultMultiIndex(multiIndex),this.magnitudeValue(value,multiIndex)):"unit"==valueType?(multiIndex=this._getDefaultMultiIndex(multiIndex),this.unitValue(value,multiIndex)):console.warn("Setting non-existent value type ("+valueType+") with value="+value+" on RM type ("+this.toString()+")"))},resetValue:function(multiIndex){this.clearValue();var mInd=this._getDefaultMultiIndex(multiIndex);this.unitValue(this.defaultValueUnit(),mInd,!0),this.magnitudeValue(this.defaultValueMagnitude(),mInd,!0),this._setIsDefaultValue(!0)},clearValue:function(){this.removeValue(null)},clearUnitValue:function(multiIndex){this.clearValueProp("|unit",multiIndex)},clearMagnitudeValue:function(multiIndex){this.clearValueProp("|magnitude",multiIndex)},removeValue:function(multiIndex){this.clearValueProp(this._MULTI_ARR_PARAM,multiIndex)},containsValue:function(){return thinkehr.f4.util.isValueNonEmpty(this.magnitudeValue())&&thinkehr.f4.util.isValueNonEmpty(this.unitValue())},hasValue:function(){return this._hasValue(this.magnitudeValue(),this._isValueEmpty)},toString:function(){return"thinkehr.f4.QuantityFieldModel/"+this.getName()+"/"+this.getRmType().toString()}}),thinkehr.f4.CodeValueBasedFieldModel=thinkehr.f4.NodeModel._extendM({init:function(properties){this._super(properties),this._skipDefaultValue=!1,null==this.eventListeners&&(this.eventListeners={})},codeValue:function(value,language){var val=this.getValue();if(null!=value&&thinkehr.f4.util.isString(value)&&(value=value.trim()),arguments.length>0){if(this.isMulti()||this._deleteOtherProperty(),null===value||""===value||void 0===value)return this.clearValue(),null;val=this.addValue(value,language)}else{if(this.isMulti()){var codeValues=[];if(this._getValuesArray().forEach(function(v){var currMultiItemCode=v["|code"];null!=currMultiItemCode&&codeValues.push(currMultiItemCode)},this),!this._skipDefaultValue&&!codeValues.length){var defaultValueCode=this.defaultValueCode();if(defaultValueCode){defaultValueCode.forEach(function(codeVal){this.codeValue(codeVal,language)},this);var retCodeVal=this.codeValue();return this._setIsDefaultValue(!0),retCodeVal}}return codeValues}if(null==val){if(null==val&&this.defaultValueCode){var dvCode,defaultValueCode2=this.defaultValueCode();if(defaultValueCode2&&!this._skipDefaultValue&&(dvCode=defaultValueCode2[0]),dvCode){var retCodeVal1=this.codeValue(dvCode,language);return this._setIsDefaultValue(!0),retCodeVal1}}return null}}return val["|code"]?val["|code"]:null},labelValue:function(language,labelValueFormat){if(this.isMulti()){var cvm=this.codeValue(),lv=cvm.map(function(c){var item=this.findInputItemByCode(c,language);if(item){var labelValue=void 0!==language?item.getLabel(language):item.getLabel();return labelValue||(labelValue=item.getLabel()),labelValueFormat?{label:labelValue,value:item.value,status:item.status}:labelValue}var foreignItem=this.findValueObjectByCode(c),lbl="("+c+") "+(foreignItem.value?foreignItem.value:"");return foreignItem||(lbl="("+c+") not found"),labelValueFormat?{label:lbl,value:c,status:thinkehr.f4.InputItem.STATUS_NOT_FOUND}:lbl}.bind(this));lv=lv.filter(function(itm){return null!=itm});var ovm=labelValueFormat&&null!=this.otherValue()?{label:this.otherValue(),value:thinkehr.f4.InputItem.OTHER_VALUE}:this.otherValue();return(thinkehr.f4.util.isString(ovm)||ovm&&ovm.value==thinkehr.f4.InputItem.OTHER_VALUE)&&lv.push(ovm),lv}var ov=labelValueFormat?{label:this.otherValue(),value:thinkehr.f4.InputItem.OTHER_VALUE}:this.otherValue();if(thinkehr.f4.util.isString(ov))return ov;var cv=this.codeValue();if(cv){var itemStatus,item=this.findInputItemByCode(cv,language);if(item){var labelValue=void 0!==language?item.getLabel(language):item.getLabel();null==labelValue&&(labelValue=item.getLabel()),null!=labelValue&&(this.getValue()["|value"]=labelValue),itemStatus=item.status}}var labelVal=cv?this.getValue()["|value"]:null,ret=labelValueFormat?{label:labelVal,value:cv,status:itemStatus}:labelVal;return cv?ret:null},setLabelValue:function(code,value,valueObject){return valueObject&&valueObject["|code"]==code||(valueObject=this.findValueObjectByCode(code)),valueObject?(valueObject["|value"]=value,!0):!1},defaultValueCode:function(){var dv=this.getMultiContainerDefaultValue();return null!=dv?this._getCodeInput().setDefaultValue(dv):dv=this._getCodeInput().getDefaultValue(),thinkehr.f4.util.isString(dv)&&dv.length>0&&(dv=dv.split(";").map(function(codeVal){return codeVal.trim()})),dv&&thinkehr.f4.util.isArray(dv)?dv:null},otherValue:function(value){if(!this.isListOpen())return null;var val=this.getValue();if(0===arguments.length){if(val){if(this.isMulti()){var ov=this.findOtherValueObject();return ov?ov["|other"]:null}return val["|other"]?val["|other"]:null}return null}if(this.isMulti()||this.clearValue(),null===value||""===value||void 0===value)return this.isMulti()?this.removeOtherValue():this.clearValue(),null;if(this.isMulti()){var otherVal=this.findOtherValueObject();return otherVal?otherVal["|other"]=value:otherVal=this.addOtherValue(value),this._setIsDefaultValue(!1),otherVal["|other"]}var otherValObj=this.findOtherValueObject();return otherValObj?otherValObj["|other"]=value:otherValObj=this.setValue(value,this._getValuesArray().length,"|other"),this._setIsDefaultValue(!1),otherValObj},findInputItemByCode:function(code,updateInLanguage){var withDefaultValues,valObj=this.findValueObjectByCode(code);valObj&&(withDefaultValues={label:valObj["|value"],localizedLabels:{}},withDefaultValues.localizedLabels[updateInLanguage]=withDefaultValues.label);var item=this._getCodeInput().findInputItemByValue(code,!1,withDefaultValues);return item&&item.setOnUpdateCallback(function(inputItem){this._setValueFromInputItem(inputItem,updateInLanguage)}.bind(this)),item},findValueObjectByCode:function(code){var searchInArr=this._getValuesArray();if(searchInArr)for(var i=0;i<searchInArr.length;i++){var val=searchInArr[i];if(val["|code"]==code)return val}return null},findOtherValueObject:function(){for(var valArray=this._getValuesArray(),i=0;i<valArray.length;i++){var val=valArray[i];if(val["|other"])return val}return null},addValue:function(code,language){this._skipDefaultValue=!0,this._setIsDefaultValue(!1);var val=this.findValueObjectByCode(code);if(val)return val;var atMultiIndex=this.isMulti()?this._getValuesArray().length:0;val=this.setValue(code,atMultiIndex,"|code");var item=this.findInputItemByCode(code,language);return item&&(this._setValueFromInputItem(item,language),this._updateOtherFields(val,item)),this._resetOtherFields(val),val},removeValue:function(code){var valObj=this.findValueObjectByCode(code);if(valObj){var valArray=this._getValuesArray(),index=valArray.indexOf(valObj);valArray.splice(index,1)}return this._skipDefaultValue=!0,this._setIsDefaultValue(!1),valObj},addOtherValue:function(value){var val={"|other":value},valArray=this._getValuesArray();return valArray.push(val),this.getValue()||this.setValue(valArray),val},removeOtherValue:function(){var valObj=this.findOtherValueObject();if(valObj){var valArray=this._getValuesArray(),index=valArray.indexOf(valObj);valArray.splice(index,1)}return this._skipDefaultValue=!0,this._setIsDefaultValue(!1),valObj},isListOpen:function(){return this._getCodeInput().isListOpen()},addTerminologyItemUpdateListener:function(eventHandler){this.eventListeners.terminologyItemUpdate||(this.eventListeners.terminologyItemUpdate=[]),-1===this.eventListeners.terminologyItemUpdate.indexOf(eventHandler)&&this.eventListeners.terminologyItemUpdate.push(eventHandler)},_dispatchEvent:function(eventName,eventValue){this.eventListeners[eventName]&&this.eventListeners[eventName].forEach(function(evHandler){evHandler.call(null,{event:eventName,value:eventValue})})},_setValueFromInputItem:function(inputItem,language){var labelValue=void 0!==language?inputItem.getLabel(language):inputItem.getLabel();labelValue||(labelValue=inputItem.getLabel()),this.setLabelValue(inputItem.value,labelValue)&&this._dispatchEvent("terminologyItemUpdate",inputItem)},_getCodeInput:function(){return this.getInputFor("code")},_updateOtherFields:function(val,item){},_resetOtherFields:function(val){},_deleteOtherProperty:function(){var val=this.getValue();val&&void 0!==val["|other"]&&delete val["|other"]},resetValue:function(){this.clearValue();var defaultValueCodesArr=this.defaultValueCode();defaultValueCodesArr&&defaultValueCodesArr.length||(defaultValueCodesArr=[null]),defaultValueCodesArr.forEach(function(codeVal){this.codeValue(codeVal)},this),this._setIsDefaultValue(!0)},applyValue:function(value,valueType){this._applyValueFromObject(value)||(null==valueType||"value"==valueType||"code"==valueType?this.codeValue(value):console.warn("Setting non-existent value type ("+valueType+") with value="+value+" on RM type ("+this.toString()+")"))},clearValue:function(){this._setValuesArray([]),this._skipDefaultValue=!0,this._setIsDefaultValue(!1)},hasValue:function(){return this._hasValue(this.codeValue(),this._isValueEmpty)},toString:function(){return"thinkehr.f4.CodeValueBasedFieldModel"}}),thinkehr.f4.CodedTextFieldModel=thinkehr.f4.CodeValueBasedFieldModel._extendM({init:function(properties){this._super(properties)},getRmType:function(){return thinkehr.f4.RmType.DV_CODED_TEXT},toString:function(){return"thinkehr.f4.CodedTextFieldModel/"+this.getName()+"/"+this.getRmType().toString()}}),thinkehr.f4.OrdinalFieldModel=thinkehr.f4.CodeValueBasedFieldModel._extendM({init:function(properties){this._super(properties)},isListOpen:function(){return!1},_getCodeInput:function(){return this.getInput(0)},_updateOtherFields:function(val,item){val["|ordinal"]=item.ordinal},addValue:function(code,language){var val=this._super(code,language);if(val){var item=this.findInputItemByCode(code,language);item&&(val["|ordinal"]=item.ordinal)}return val},getInputFor:function(suffix){return"code"==suffix?this.getInput(0):this._super(suffix)},getRmType:function(){return thinkehr.f4.RmType.DV_ORDINAL},toString:function(){return"thinkehr.f4.OrdinalFieldModel/"+this.getName()+"/"+this.getRmType().toString()}}),thinkehr.f4.TextFieldModel=thinkehr.f4.DirectValueModel._extendM({init:function(properties){this._super(properties),void 0===this._otherValue&&(this._otherValue=null)},textValue:function(value,multiIndex){return this.valueGetterSetter.apply(this,arguments)},getDefaultInput:function(){return this.getInputByType(thinkehr.f4.InputType.TEXT)},isListOpen:function(){return this.getInputFor("textValues").isListOpen()},getInputFor:function(suffix){return"textValues"==suffix?this.getInput(0):this._super(suffix)},resetValue:function(){this.textValue(this.defaultValue()),this._setIsDefaultValue(!0)},applyValue:function(value,valueType,multiIndex){this._applyValueFromObject(value)||(null==valueType||"value"==valueType?(multiIndex=this._getDefaultMultiIndex(multiIndex),this.textValue(value,multiIndex)):console.warn("Setting non-existent value type ("+valueType+") with value="+value+" on RM type ("+this.toString()+")"))},getRmType:function(){return thinkehr.f4.RmType.DV_TEXT},toString:function(){return"thinkehr.f4.TextFieldModel/"+this.getName()+"/"+this.getRmType().toString()}}),thinkehr.f4.ProportionFieldModel=thinkehr.f4.NodeModel._extendM({init:function(properties){this._super(properties)},numeratorValue:function(value,multiIndex,setEmptyValue){var val=this.getValue.apply(this,this._getMultiIndexArgs(arguments,"|numerator"));if(value!==this._MULTI_ARR_PARAM){this._skipDefaultValue=!0,this._setIsDefaultValue(!1);var actualValue=value&&thinkehr.f4.util.isString(value)?parseFloat(value):value;if(setEmptyValue||null!==actualValue&&""!==value&&void 0!==value){this.setValueProp(actualValue,"|numerator",multiIndex);var fd=this._getFixedDenominator(multiIndex);return null!=fd&&this.setValueProp(fd,"|denominator",multiIndex),this.getValue.apply(this,this._getMultiIndexArgs(arguments,"|numerator"))}return this.clearNumeratorValue(multiIndex),null}if((null==val||val.length<1)&&this.defaultValueNumerator()&&!this._skipDefaultValue){var nv=this.defaultValueNumerator();if(null!==nv&&void 0!==nv){var defMultiInd=null!=multiIndex?multiIndex:0,dv=this.defaultValueDenominator(defMultiInd);return dv&&this.denominatorValue(dv,defMultiInd),this.numeratorValue(nv,defMultiInd),this._setIsDefaultValue(!0),this.getValue.apply(this,this._getMultiIndexArgs(arguments,"|numerator"))}return null}return this._setFloatValueIfString(val,multiIndex,"|numerator")},defaultValueNumerator:function(){var dv=this.getMultiContainerDefaultValue();return null!=dv?(dv=dv.indexOf("/")>0?dv.split("/")[0]:this._getPropertyValueFromMultiDefaultString(dv,"numerator",!1),this.getInputFor("numerator").setDefaultValue(dv)):dv=this.getInputFor("numerator").getDefaultValue(),thinkehr.f4.util.isString(dv)?dv.length>0?parseFloat(dv):null:null!==dv&&void 0!==dv?dv:null},denominatorValue:function(value,multiIndex){var val=this.getValue.apply(this,this._getMultiIndexArgs(arguments,"|denominator"));if(value!==this._MULTI_ARR_PARAM){var fd=this._getFixedDenominator(multiIndex);null!=fd&&(value=fd),this._skipDefaultValue=!0,this._setIsDefaultValue(!1);var actualValue=value&&thinkehr.f4.util.isString(value)?parseFloat(value):value;return null===actualValue||""===value||void 0===value?(this.clearDenominatorValue(multiIndex),null):(this.setValueProp(parseFloat(value),"|denominator",multiIndex),this.getValue.apply(this,this._getMultiIndexArgs(arguments,"|denominator")))}var defMultiInd=null!=multiIndex?multiIndex:0;if((null==val||val.length<1)&&this.defaultValueDenominator(defMultiInd)&&!this._skipDefaultValue){var dv=this.defaultValueDenominator(defMultiInd);if(null!==dv&&void 0!==dv){var nv=this.defaultValueNumerator();return nv&&this.numeratorValue(nv,defMultiInd),this.denominatorValue(dv,defMultiInd),this._setIsDefaultValue(!0),this.getValue.apply(this,this._getMultiIndexArgs(arguments,"|denominator"))}return null}return this._setFloatValueIfString(val,multiIndex,"|denominator")},defaultValueDenominator:function(){var dv=this.getMultiContainerDefaultValue();return null!=dv?(dv=dv.indexOf("/")>0?dv.split("/")[1]:this._getPropertyValueFromMultiDefaultString(dv,"denominator",!0),null==dv&&(dv=100),this.getInputFor("denominator").setDefaultValue(dv)):dv=this.getInputFor("denominator").getDefaultValue(),thinkehr.f4.util.isString(dv)?dv.length>0?parseFloat(dv):null:null!==dv&&void 0!==dv?dv:this._getFixedDenominator()},_getFixedDenominator:function(){var minDn=this.getMinValueForDenominator(),maxDn=this.getMaxValueForDenominator();if(null!==maxDn&&void 0!==minDn&&void 0!==maxDn&&minDn===maxDn){var fd=parseFloat(minDn);return fd}return null},_getRangeNumericProperty:function(validation,property){return validation&&validation.range&&void 0!==validation.range[property]?parseFloat(validation.range[property]):null},_getRangeStringProperty:function(validation,property){return validation&&validation.range&&thinkehr.f4.util.isString(validation.range[property])?validation.range[property]:null},getMinValueForNumerator:function(){return this._getRangeNumericProperty(this.getInputFor("numerator").getValidation(),"min")},getMaxValueForNumerator:function(){return this._getRangeNumericProperty(this.getInputFor("numerator").getValidation(),"max")},getMinValueForDenominator:function(){return this._getRangeNumericProperty(this.getInputFor("denominator").getValidation(),"min")},getMaxValueForDenominator:function(){return this._getRangeNumericProperty(this.getInputFor("denominator").getValidation(),"max")},getMinOperatorForNumerator:function(){return this._getRangeStringProperty(this.getInputFor("numerator").getValidation(),"minOp")},getMaxOperatorForNumerator:function(){return this._getRangeStringProperty(this.getInputFor("numerator").getValidation(),"maxOp")},getMinOperatorForDenominator:function(){return this._getRangeStringProperty(this.getInputFor("denominator").getValidation(),"minOp")},getMaxOperatorForDenominator:function(){return this._getRangeStringProperty(this.getInputFor("denominator").getValidation(),"maxOp")},getRmType:function(){return thinkehr.f4.RmType.DV_PROPORTION},resetValue:function(multiIndex){void 0===multiIndex&&this.isMulti()&&(multiIndex=null),this.removeValue(multiIndex);var mInd=this._getDefaultMultiIndex(multiIndex);this.denominatorValue(this.defaultValueDenominator(mInd),mInd),this.numeratorValue(this.defaultValueNumerator(),mInd),this._setIsDefaultValue(!0)},applyValue:function(value,valueType,multiIndex){this._applyValueFromObject(value)||("numerator"==valueType?(multiIndex=this._getDefaultMultiIndex(multiIndex),this.numeratorValue(value,multiIndex)):"denominator"==valueType?(multiIndex=this._getDefaultMultiIndex(multiIndex),this.denominatorValue(value,multiIndex)):console.warn("Setting non-existent value type ("+valueType+") with value="+value+" on RM type ("+this.toString()+")"))},clearDenominatorValue:function(multiIndex){this.clearValueProp("|denominator",multiIndex)},clearNumeratorValue:function(multiIndex){this.clearValueProp("|numerator",multiIndex)},removeValue:function(multiIndex){this.clearValueProp(this._MULTI_ARR_PARAM,multiIndex)},clearValue:function(multiIndex){this.clearNumeratorValue(multiIndex),this.clearDenominatorValue(multiIndex)},containsValue:function(){return thinkehr.f4.util.isValueNonEmpty(this.numeratorValue())&&thinkehr.f4.util.isValueNonEmpty(this.denominatorValue())},hasValue:function(){return this._hasValue(this.denominatorValue(),this._isValueEmpty)&&this._hasValue(this.numeratorValue(),this._isValueEmpty)},toString:function(){return"thinkehr.f4.ProportionFieldModel/"+this.getName()+"/"+this.getRmType().toString()}}),thinkehr.f4.MultimediaFieldModel=thinkehr.f4.NodeModel._extendM({init:function(properties){this._super(properties),this._skipDefaultMimeTypeValue=!1,this._skipDefaultValue=!1},uriValue:function(value,multiIndex){var val=this.getValue.apply(this,this._getMultiIndexArgs(arguments,"|uri"));if(value!==this._MULTI_ARR_PARAM)return this._skipDefaultValue=!0,this._setIsDefaultValue(!1),null===value?(this.clearUriValue(multiIndex),null):(this.setValueProp(value,"|uri",multiIndex),this.getValue.apply(this,this._getMultiIndexArgs(arguments,"|uri")));if((null==val||val.length<1)&&this.defaultValueUri()&&!this._skipDefaultValue){var dUri=this.defaultValueUri();if(null!==dUri&&void 0!==dUri){var defMultiInd=null!=multiIndex?multiIndex:0;return this.uriValue(dUri,defMultiInd),this._setIsDefaultValue(!0),this.getValue.apply(this,this._getMultiIndexArgs(arguments,"|uri"))}return null}return val},defaultValueUri:function(){var dv=this.getMultiContainerDefaultValue();return null!=dv?(dv=this._getPropertyValueFromMultiDefaultString(dv,"uri",!1),this.getInputByType(thinkehr.f4.InputType.TEXT).setDefaultValue(dv)):dv=this.getInputByType(thinkehr.f4.InputType.TEXT).getDefaultValue(),null!==dv&&void 0!==dv?dv:null},mimeTypeValue:function(value,multiIndex){var val=this.getValue.apply(this,this._getMultiIndexArgs(arguments,"|mimetype"));if(value!==this._MULTI_ARR_PARAM)return this._skipDefaultMimeTypeValue=!0,this._setIsDefaultValue(!1),null===value?(this.clearMimeTypeValue(multiIndex),null):(this.setValueProp(value,"|mimetype",multiIndex),this.getValue.apply(this,this._getMultiIndexArgs(arguments,"|mimetype")));if((null==val||val.length<1)&&this.defaultValueMimeType()&&!this._skipDefaultMimeTypeValue){var dMimeTy=this.defaultValueMimeType();if(null!==dMimeTy&&void 0!==dMimeTy){var defMultiInd=null!=multiIndex?multiIndex:0;return this.mimeTypeValue(dMimeTy,defMultiInd),this._setIsDefaultValue(!0),this.getValue.apply(this,this._getMultiIndexArgs(arguments,"|mimetype"))}return null}return val},defaultValueMimeType:function(){var dv=this.getMultiContainerDefaultValue();return null!=dv&&(dv=this._getPropertyValueFromMultiDefaultString(dv,"mimetype",!0)),null!==dv&&void 0!==dv?dv:null},clearValue:function(multiIndex){this.clearUriValue(multiIndex),this.clearMimeTypeValue(multiIndex)},getRmType:function(){return thinkehr.f4.RmType.DV_MULTIMEDIA},resetValue:function(multiIndex){void 0===multiIndex&&this.isMulti()&&(multiIndex=null),this.removeValue(multiIndex);var mInd=null!=multiIndex?multiIndex:0;this.uriValue(this.defaultValueUri(mInd),mInd),this.mimeTypeValue(null,mInd),this._setIsDefaultValue(!0)},applyValue:function(value,valueType,multiIndex){this._applyValueFromObject(value)||(null==valueType||"value"==valueType||"uri"==valueType?(multiIndex=this._getDefaultMultiIndex(multiIndex),this.uriValue(value,multiIndex)):"mimetype"==valueType?(multiIndex=this._getDefaultMultiIndex(multiIndex),this.mimeTypeValue(value,multiIndex)):console.warn("Setting non-existent value type ("+valueType+") with value="+value+" on RM type ("+this.toString()+")"))},clearUriValue:function(multiIndex){this.clearValueProp("|uri",multiIndex)},clearMimeTypeValue:function(multiIndex){this.clearValueProp("|mimetype",multiIndex)},removeValue:function(multiIndex){this.clearValueProp(this._MULTI_ARR_PARAM,multiIndex)},hasValue:function(){return this._hasValue(this.uriValue(),this._isValueEmpty)},toString:function(){return"thinkehr.f4.MultimediaFieldModel/"+this.getName()+"/"+this.getRmType().toString()}}),thinkehr.f4.BooleanFieldModel=thinkehr.f4.NodeModel._extendM({init:function(properties){this._super(properties),this._skipDefaultValue=!1},setValue:function(value){this.booleanValue(value)},booleanValue:function(value){if(arguments.length>0){this.value=value;var parentRef=this.getValueNodeParentRef();parentRef&&(parentRef.length>0?null!==value&&void 0!==value?(parentRef[0]=this.value,this._skipDefaultValue=!1):(parentRef.shift(),this._skipDefaultValue=!0):null!==value&&void 0!==value&&(parentRef.push(this.value),this._skipDefaultValue=!1)),this._setIsDefaultValue(!1)}else if((null==this.value||""===this.value)&&!this._skipDefaultValue){var val=this.defaultValueBoolean();if(null!==val)return this._setIsDefaultValue(!0),this.booleanValue(val);if(!this.isThreeState())return this._setIsDefaultValue(!0),this.booleanValue(!1)}return this.value},defaultValueBoolean:function(){var val,dv=this.getMultiContainerDefaultValue();if(null!=dv?("null"===dv&&(dv=null),this.getInputByType(thinkehr.f4.InputType.BOOLEAN).setDefaultValue(dv)):dv=this.getInputByType(thinkehr.f4.InputType.BOOLEAN).getDefaultValue(),null!==dv&&void 0!==dv){var isStr=thinkehr.f4.util.isString(dv);val=void 0!==dv&&!isStr||isStr&&dv.length>0?isStr?"true"===dv:dv:this.isThreeState()?null:!1}else val=this.isThreeState()?null:!1;return this.allowedValues().indexOf(val)<0&&(val=!val),val},getRmType:function(){return thinkehr.f4.RmType.DV_BOOLEAN},resetValue:function(){this.booleanValue(this.defaultValueBoolean());
},applyValue:function(value,valueType){this._applyValueFromObject(value)||(null==valueType||"value"==valueType?this.booleanValue(value):console.warn("Setting non-existent value type ("+valueType+") with value="+value+" on RM type ("+this.toString()+")"))},clearBooleanValue:function(){var parentRef=this.getValueNodeParentRef();parentRef&&parentRef.length>0&&(this.isThreeState()?(parentRef.shift(),this.value=null):(this.value=!1,parentRef[0]=this.value)),this._skipDefaultValue=!0},isThreeState:function(){return this.getViewConfig().getField()&&this.getViewConfig().getField().threeState},allowedValues:function(){if(!this._allowedValues){this._allowedValues=[];var input=this.getInput(0);if(input.hasItems())for(var i=0;i<input.getList().length;i++){var item=input.getItem(i),val=item.value;void 0!==val&&(thinkehr.f4.util.isString(val)?"true"===val?this._allowedValues.push(!0):"false"===val&&this._allowedValues.push(!1):this._allowedValues.push())}else this._allowedValues.push(!0,!1);this.isThreeState()&&this._allowedValues.push(null)}return this._allowedValues},_isValueEmpty:function(booleanValue){return this.isThreeState()?void 0==booleanValue||""==booleanValue:booleanValue!==!1&&booleanValue!==!0},hasValue:function(){return this._hasValue(this.booleanValue(),this._isValueEmpty.bind(this))},toString:function(){return"thinkehr.f4.BooleanFieldModel/"+this.getName()+"/"+this.getRmType().toString()}}),thinkehr.f4.DateFieldModel=thinkehr.f4.DirectValueModel._extendM({init:function(properties){this._super(properties,"dateValue")},dateValue:function(value,multiIndex){return this.valueGetterSetter.apply(this,arguments)},dateObjectValue:function(){return thinkehr.f4.util.toDate(this.dateValue())},getDefaultInput:function(){return this.getInputByType(thinkehr.f4.InputType.DATE)},getRmType:function(){return thinkehr.f4.RmType.DV_DATE},resetValue:function(){this.dateValue(this.defaultValue()),this._setIsDefaultValue(!0)},applyValue:function(value,valueType,multiIndex){this._applyValueFromObject(value)||(null==valueType||"value"==valueType?(multiIndex=this._getDefaultMultiIndex(multiIndex),this.dateValue(value,multiIndex)):console.warn("Setting non-existent value type ("+valueType+") with value="+value+" on RM type ("+this.toString()+")"))},clearDateValue:function(){this.clearValue()},toString:function(){return"thinkehr.f4.DateFieldModel/"+this.getName()+"/"+this.getRmType().toString()}}),thinkehr.f4.TimeFieldModel=thinkehr.f4.DirectValueModel._extendM({init:function(properties){this._super(properties,"timeValue")},timeValue:function(value,multiIndex){return this.valueGetterSetter.apply(this,arguments)},timeObjectValue:function(multiIndex){return thinkehr.f4.util.toTime(this.timeValue(void 0,multiIndex))},getDefaultInput:function(){return this.getInputByType(thinkehr.f4.InputType.TIME)},getRmType:function(){return thinkehr.f4.RmType.DV_TIME},resetValue:function(){this.timeValue(this.defaultValue()),this._setIsDefaultValue(!0)},applyValue:function(value,valueType,multiIndex){this._applyValueFromObject(value)||(null==valueType||"value"==valueType?(multiIndex=this._getDefaultMultiIndex(multiIndex),this.timeValue(value,multiIndex)):console.warn("Setting non-existent value type ("+valueType+") with value="+value+" on RM type ("+this.toString()+")"))},clearTimeValue:function(){this.clearValue()},toString:function(){return"thinkehr.f4.TimeFieldModel/"+this.getName()+"/"+this.getRmType().toString()}}),thinkehr.f4.DateTimeFieldModel=thinkehr.f4.DirectValueModel._extendM({init:function(properties){this._super(properties,"dateTimeValue")},dateTimeValue:function(value,multiIndex){return arguments[0]&&(arguments[0]=thinkehr.f4.util.toLocalTimezoneOffsetISOString(value)),this.valueGetterSetter.apply(this,arguments)},dateTimeObjectValue:function(multiIndex){return thinkehr.f4.util.toDate(this.dateTimeValue(void 0,multiIndex))},getDefaultInput:function(){return this.getInputByType(thinkehr.f4.InputType.DATETIME)},getRmType:function(){return thinkehr.f4.RmType.DV_DATE_TIME},resetValue:function(){this.dateTimeValue(this.defaultValue()),this._setIsDefaultValue(!0)},applyValue:function(value,valueType,multiIndex){this._applyValueFromObject(value)||(null==valueType||"value"==valueType?(multiIndex=this._getDefaultMultiIndex(multiIndex),this.dateTimeValue(value,multiIndex)):console.warn("Setting non-existent value type ("+valueType+") with value="+value+" on RM type ("+this.toString()+")"))},clearDateTimeValue:function(){this.clearValue()},toString:function(){return"thinkehr.f4.DateTimeFieldModel/"+this.getName()+"/"+this.getRmType().toString()}}),thinkehr.f4.CountFieldModel=thinkehr.f4.DirectValueModel._extendM({init:function(properties){this._super(properties,"countValue")},countValue:function(value,multiIndex){if(null!=value){var val=parseFloat(arguments[0]);if(isNaN(arguments[0]))throw new Error("countValue ("+arguments[0]+") is not number ");arguments[0]=val}return this.valueGetterSetter.apply(this,arguments)},defaultValue:function(){var dv=this.getMultiContainerDefaultValue();return null!=dv?this.getDefaultInput().setDefaultValue(dv):dv=this.getDefaultInput().getDefaultValue(),thinkehr.f4.util.isString(dv)?dv.length>0?parseInt(dv):null:null!==dv&&void 0!==dv?dv:null},getDefaultInput:function(){return this.getInputByType(thinkehr.f4.InputType.INTEGER)},getRmType:function(){return thinkehr.f4.RmType.DV_COUNT},resetValue:function(){this.countValue(this.defaultValue()),this._setIsDefaultValue(!0)},applyValue:function(value,valueType,multiIndex){this._applyValueFromObject(value)||(null==valueType||"value"==valueType?(multiIndex=this._getDefaultMultiIndex(multiIndex),this.countValue(value,multiIndex)):console.warn("Setting non-existent value type ("+valueType+") with value="+value+" on RM type ("+this.toString()+")"))},clearCountValue:function(){this.clearValue()},hasValue:function(){return this._hasValue(this.countValue(),this._isValueEmpty)},toString:function(){return"thinkehr.f4.CountFieldModel/"+this.getName()+"/"+this.getRmType().toString()}}),thinkehr.f4.DurationFieldModel=thinkehr.f4.DirectValueModel._extendM({init:function(properties){this._super(properties,"durationValue"),this.periodsMultiArray=[[null,null,null,null,null,null,null]];var self=this;setTimeout(function(){var valsArr=self._getValuesArray();if(valsArr){if(!thinkehr.f4.util.isArray(valsArr))throw new Error("_getValuesArray must return array");var multiValsArr=valsArr.map(function(valStr){return nezasaEhr.iso8601.Period.parse(valStr)});self._syncPeriodArray(multiValsArr)}},0),this.fieldNames=["year","month","week","day","hour","minute","second"]},durationValue:function(value,multiIndex){null===multiIndex&&(multiIndex=0);var prevVal=this.getValue(void 0,multiIndex),strVal=this.valueGetterSetter.apply(this,arguments);if(arguments.length>0||strVal!==prevVal){var multiValsArr=this.valueGetterSetter(void 0,void 0).map(function(valStr){return nezasaEhr.iso8601.Period.parse(valStr)});this._syncPeriodArray(multiValsArr)}return strVal},_syncPeriodArray:function(paNewMultiArr){var setValuesOnMultiArray=function(srcArr,targetArr){srcArr.forEach(function(p,i){var pVal=targetArr[i];null===pVal&&0===p||(targetArr[i]=0===p?null:p)})};if(paNewMultiArr&&thinkehr.f4.util.isArray(paNewMultiArr)&&paNewMultiArr.length&&!thinkehr.f4.util.isArray(paNewMultiArr[0]))throw new Error("paMulti is not multi array");var tpaMulti=this.periodsMultiArray;paNewMultiArr.length<1&&(paNewMultiArr=[[null,null,null,null,null,null,null]]);for(var newMultiLocalArr=thinkehr.f4.util.deepClone(paNewMultiArr),mInd=tpaMulti.length-1;mInd>-1;mInd--){var newMultiLocalDur=newMultiLocalArr.splice(mInd,1)[0],multiArrDur=tpaMulti[mInd];newMultiLocalDur?setValuesOnMultiArray(newMultiLocalDur,multiArrDur):tpaMulti.splice(mInd,1)}if(newMultiLocalArr.length)for(var j=0;j<newMultiLocalArr.length;j++){var newMultiLocDur=newMultiLocalArr[j],multiDurArr=[];tpaMulti.push(multiDurArr),setValuesOnMultiArray(newMultiLocDur,multiDurArr)}},_durationArrayValue:function(multiIndex,index,value){var v;if(multiIndex=null!=multiIndex?multiIndex:0,arguments.length<=2)v=this.periodsMultiArray[multiIndex]?this.periodsMultiArray[multiIndex][index]:null;else{thinkehr.f4.util.isInteger(value)?v=value:thinkehr.f4.util.isString(value)?v=parseInt(value):void 0===value?value=null:v=value;var potentialArray=thinkehr.f4.util.deepClone(this.periodsMultiArray);potentialArray[multiIndex][index]=v;var potentialStrVal=nezasaEhr.iso8601.Period.periodToString(potentialArray[multiIndex]);if(!nezasaEhr.iso8601.Period.isValid(potentialStrVal))throw new Error("Invalid duration period: '",v,"'");this.periodsMultiArray[multiIndex][index]=v,null===potentialStrVal&&(potentialStrVal=""),this.valueGetterSetter(potentialStrVal,multiIndex)}return v},yearsValue:function(value,multiIndex){var args=[multiIndex,0];return arguments.length&&void 0!==value&&args.push(value),this._durationArrayValue.apply(this,args)},monthsValue:function(value,multiIndex){var args=[multiIndex,1];return arguments.length&&void 0!==value&&args.push(value),this._durationArrayValue.apply(this,args)},weeksValue:function(value,multiIndex){var args=[multiIndex,2];return arguments.length&&void 0!==value&&args.push(value),this._durationArrayValue.apply(this,args)},daysValue:function(value,multiIndex){var args=[multiIndex,3];return arguments.length&&void 0!==value&&args.push(value),this._durationArrayValue.apply(this,args)},hoursValue:function(value,multiIndex){var args=[multiIndex,4];return arguments.length&&void 0!==value&&args.push(value),this._durationArrayValue.apply(this,args)},minutesValue:function(value,multiIndex){var args=[multiIndex,5];return arguments.length&&void 0!==value&&args.push(value),this._durationArrayValue.apply(this,args)},secondsValue:function(value,multiIndex){var args=[multiIndex,6];return arguments.length&&void 0!==value&&args.push(value),this._durationArrayValue.apply(this,args)},defaultValue:function(){var dv=this.getMultiContainerDefaultValue();if(null!=dv)return dv;var dvf=this.defaultValueFor,t=this,dva=[dvf.call(t,"year"),dvf.call(t,"month"),dvf.call(t,"week"),dvf.call(t,"day"),dvf.call(t,"hour"),dvf.call(t,"minute"),dvf.call(t,"second")];return nezasaEhr.iso8601.Period.periodToString(dva)},defaultValueFor:function(suffix){var input=this.getInputFor(suffix);if(input){var dv=input.getDefaultValue();if(void 0!==dv&&null!==dv)return dv}return null},setValue:function(value){this._super(value);var newMultiArr;null===value?newMultiArr=[[null,null,null,null,null,null,null]]:thinkehr.f4.util.isString(value)?newMultiArr=[nezasaEhr.iso8601.Period.parse(value)]:thinkehr.f4.util.isArray(value)&&(newMultiArr=this.getValue().map(function(valStr){return nezasaEhr.iso8601.Period.parse(valStr)})),this._setIsDefaultValue(!1),newMultiArr&&this._syncPeriodArray(newMultiArr)},getRmType:function(){return thinkehr.f4.RmType.DV_DURATION},resetValue:function(){this.setValue(this.defaultValue()),this._setIsDefaultValue(!0)},applyValue:function(value,valueType,multiIndex){if(!this._applyValueFromObject(value)){var args=[].splice.call(arguments,0);switch(args.splice(1,1),args[1]=this._getDefaultMultiIndex(args[1]),valueType){case"year":this.yearsValue.apply(this,args);break;case"month":this.monthsValue.apply(this,args);break;case"week":this.weeksValue.apply(this,args);break;case"day":this.daysValue.apply(this,args);break;case"hour":this.hoursValue.apply(this,args);break;case"minute":this.minutesValue.apply(this,args);break;case"second":this.secondsValue.apply(this,args);break;default:console.warn("Setting non-existent value type ("+valueType+") with value="+value+" on RM type ("+this.toString()+")")}}},clearValue:function(){this._super(),this.periodsMultiArray=[[null,null,null,null,null,null,null]],this._setIsDefaultValue(!1)},clearDurationValue:function(){this.clearValue()},columns:function(columns){if(void 0===columns){if(void 0===this._columns){var maxCols=this.getInputs().length,f=this.getViewConfig().getFields(),c=f&&f.columns?parseInt(f.columns):maxCols;this._columns=maxCols>=c?c:maxCols}}else this._columns=columns;return this._columns},isFieldDisabled:function(suffix){var f=this.getViewConfig().getField(suffix);return f&&f.disabled===!0},isFieldHidden:function(suffix){var f=this.getViewConfig().getField(suffix);return f&&f.hidden===!0},isFieldRequired:function(multiIndex){return this.isRequired()&&!this.durationValue(void 0,multiIndex)},getFieldName:function(index){return this.fieldNames[index]},getFieldNames:function(){return this.fieldNames},_getValidation:function(suffix){var input=this.getInputFor(suffix);return input?input.getValidation():null},_getRange:function(suffix){var vd=this._getValidation(suffix);return vd&&vd.range?vd.range:null},minValueFor:function(suffix){var range=this._getRange(suffix);return range&&range.min?range.min:null},minOperatorFor:function(suffix){var range=this._getRange(suffix);return range&&range.minOp?range.minOp:null},maxValueFor:function(suffix){var range=this._getRange(suffix);return range&&range.max?range.max:null},maxOperatorFor:function(suffix){var range=this._getRange(suffix);return range&&range.maxOp?range.maxOp:null},hasValidation:function(){if(this.isRequired())return!0;for(var inputs=this.getInputs(),i=0;i<inputs.length;i++){var v=inputs[i].getValidation();if(v&&v.range&&(void 0!==v.range.min||void 0!==v.range.max))return!0}return!1},toString:function(){return"thinkehr.f4.DurationFieldModel/"+this.getName()+"/"+this.getRmType().toString()}}),thinkehr.f4.UriFieldModel=thinkehr.f4.DirectValueModel._extendM({init:function(properties){this._super(properties,"uriValue")},uriValue:function(value,multiIndex){return this.valueGetterSetter.apply(this,arguments)},getDefaultInput:function(){return this.getInputByType(thinkehr.f4.InputType.TEXT)},getRmType:function(){return thinkehr.f4.RmType.DV_URI},resetValue:function(){this.uriValue(this.defaultValue()),this._setIsDefaultValue(!0)},applyValue:function(value,valueType,multiIndex){this._applyValueFromObject(value)||(null==valueType||"value"==valueType?(multiIndex=this._getDefaultMultiIndex(multiIndex),this.uriValue(value,multiIndex)):console.warn("Setting non-existent value type ("+valueType+") with value="+value+" on RM type ("+this.toString()+")"))},clearUriValue:function(){this.clearValue()},toString:function(){return"thinkehr.f4.UriFieldModel/"+this.getName()+"/"+this.getRmType().toString()}}),thinkehr.f4.EhrUriFieldModel=thinkehr.f4.UriFieldModel._extendM({init:function(properties){this._super(properties,"ehrUriValue"),this._ehrUriRegEx=new RegExp(/^ehr:\/\/\S+$/i)},ehrUriValue:function(value,multiIndex){return this.valueGetterSetter.apply(this,arguments)},getRmType:function(){return thinkehr.f4.RmType.DV_EHR_URI},resetValue:function(){this.ehrUriValue(this.defaultValue()),this._setIsDefaultValue(!0)},applyValue:function(value,valueType,multiIndex){this._applyValueFromObject(value)||(null==valueType||"value"==valueType?(multiIndex=this._getDefaultMultiIndex(multiIndex),this.ehrUriValue(value,multiIndex)):console.warn("Setting non-existent value type ("+valueType+") with value="+value+" on RM type ("+this.toString()+")"))},clearEhrUriValue:function(){this.clearValue()},getEhrUriPattern:function(){return this._ehrUriRegEx},getPatternValidExample:function(){return"ehr://uri/value"},toString:function(){return"thinkehr.f4.EhrUriFieldModel/"+this.getName()+"/"+this.getRmType().toString()}}),thinkehr.f4.CustomModel=thinkehr.f4.NodeModel._extendM({init:function(properties){this._super(properties),void 0===this.delegateModel&&(this.delegateModel=null),this._configureWrapperModel(this.delegateModel),void 0===this.func&&(this.func=null)},getDelegateModel:function(){return this.delegateModel},setDelegateModel:function(delegateModel){this.delegateModel=delegateModel,this._configureWrapperModel(delegateModel)},getPath:function(){var path=this._super();return path||(path=this.delegateModel.formId),path},_configureWrapperModel:function(wrapperModel){wrapperModel&&wrapperModel.setWrappingModel(this)},getRmType:function(){return thinkehr.f4.RmType.CUSTOM},toString:function(){return"thinkehr.f4.CustomModel/"+this._valueFuncName}}),thinkehr.f4._rmTypeToClassMap={FORM_DEFINITION:thinkehr.f4.FormRootModel,GENERIC_FIELDSET:thinkehr.f4.GenericFieldsetModel,DV_QUANTITY:thinkehr.f4.QuantityFieldModel,DV_CODED_TEXT:thinkehr.f4.CodedTextFieldModel,DV_TEXT:thinkehr.f4.TextFieldModel,DV_PARSABLE:thinkehr.f4.TextFieldModel,DV_PROPORTION:thinkehr.f4.ProportionFieldModel,DV_MULTIMEDIA:thinkehr.f4.MultimediaFieldModel,DV_BOOLEAN:thinkehr.f4.BooleanFieldModel,DV_DATE:thinkehr.f4.DateFieldModel,DV_TIME:thinkehr.f4.TimeFieldModel,DV_DATE_TIME:thinkehr.f4.DateTimeFieldModel,DV_ORDINAL:thinkehr.f4.OrdinalFieldModel,DV_COUNT:thinkehr.f4.CountFieldModel,DV_DURATION:thinkehr.f4.DurationFieldModel,DV_URI:thinkehr.f4.UriFieldModel,DV_EHR_URI:thinkehr.f4.EhrUriFieldModel},thinkehr.f4.AstVisitor=thinkehr.f4.Object._extendM({init:function(properties){this._super(properties)},visit:function(astNode){return astNode?!0:void 0},toString:function(){return"thinkehr.f4.AstVisitor"}}),thinkehr.f4.AstNode=thinkehr.f4.Object._extendM({init:function(properties){this._super(properties),void 0===this.rawDesc&&(this.rawDesc=null)},process:function(context){var val=this.evaluate(),nextNode=this.next(val);nextNode&&nextNode.process(context)},evaluate:function(){return null},next:function(evaluatedValue){return null},accept:function(visitor){return visitor.visit(this)},getRawDesc:function(){return this.rawDesc},setRawDesc:function(rawDesc){this.rawDesc=rawDesc},toString:function(){return"thinkehr.f4.AstNode"}}),thinkehr.f4.AstCollectionNode=thinkehr.f4.AstNode._extendM({init:function(properties){this._super(properties),void 0===this.collection&&(this.collection=[])},elements:function(elementToAdd){return void 0!==elementToAdd&&this.collection.push(elementToAdd),this.collection},process:function(context){for(var val=this.evaluate(),nextNode=this.next(val);nextNode;)nextNode.process(context),nextNode=this.next(val)},evaluate:function(){return this.collection.slice()},next:function(collectionObj){return collectionObj.shift()},toString:function(){return"thinkehr.f4.AstCollectionNode"}}),thinkehr.f4.Ast=thinkehr.f4.AstCollectionNode._extendM({init:function(properties){this._super(properties)},fields:function(field){return this.elements(field)},getField:function(fieldId){if(fieldId)for(var fields=this.fields(),i=0;i<fields.length;i++)if(fields[i].getFieldId()==fieldId)return fields[i];return null},toString:function(){return"thinkehr.f4.Ast"}}),thinkehr.f4.AstField=thinkehr.f4.AstCollectionNode._extendM({init:function(properties){this._super(properties),void 0===this.field&&(this.field=null)},getFieldId:function(){return this.field},setFieldId:function(fieldId){this.field=fieldId},conditions:function(condition){return this.elements(condition)},toString:function(){return"thinkehr.f4.AstField"}}),thinkehr.f4.AstCondition=thinkehr.f4.AstNode._extendM({init:function(properties){this._super(properties),void 0===this.expression&&(this.expression=null),void 0===this.thenStatement&&(this.thenStatement=null)},getExpression:function(){return this.expression},setExpression:function(expression){this.expression=expression},getThenStatement:function(){return this.thenStatement},setThenStatement:function(statement){this.thenStatement=statement},evaluate:function(){return this.expression.evaluate()===!0},next:function(val){return val===!0?this.thenStatement:void 0},toString:function(){return"thinkehr.f4.AstCondition"}}),thinkehr.f4.AstExpression=thinkehr.f4.AstNode._extendM({init:function(properties){this._super(properties)},isBinary:function(){return!1},toString:function(){return"thinkehr.f4.AstExpression"}}),thinkehr.f4.AstFunctionExpression=thinkehr.f4.AstExpression._extendM({init:function(properties){this._super(properties),void 0===this.func&&(this.func=function(){})},getFunction:function(){return this.func},setFunction:function(func){this.func=func},evaluate:function(){return this.getFunction().call(null)},toString:function(){return"thinkehr.f4.AstFunctionExpression"}}),thinkehr.f4.AstOperatorExpression=thinkehr.f4.AstExpression._extendM({init:function(properties){this._super(properties),void 0===this.operatorFunc&&(this.operatorFunc=null),void 0===this.lhsOperand&&(this.lhsOperand=null),void 0===this.lhsIsMulti&&(this.lhsIsMulti=null)},getOperatorFunc:function(){return this.operatorFunc},setOperatorFunc:function(operatorFunc){this.operatorFunc=operatorFunc},getLhsOperand:function(){return this.lhsOperand},setLhsOperand:function(lhsOperand){this.lhsOperand=lhsOperand},setLhsIsMulti:function(value){this.lhsIsMulti=value},getLhsIsMulti:function(){return this.lhsIsMulti},getLhsValuesArr:function(){var lhsVal=this.getLhsOperand().evaluate();return thinkehr.f4.util.isArray(lhsVal)?lhsVal||(lhsVal=[]):lhsVal=[lhsVal],lhsVal},next:function(val){return null},toString:function(){return"thinkehr.f4.AstOperatorExpression"}}),thinkehr.f4.AstUnaryExpression=thinkehr.f4.AstOperatorExpression._extendM({init:function(properties){this._super(properties)},evaluate:function(){var lhs=this.getLhsValuesArr();return lhs.length||lhs.push(null),this.getOperatorFunc().call(null,lhs)},toString:function(){return"thinkehr.f4.AstUnaryExpression"}}),thinkehr.f4.AstBinaryExpression=thinkehr.f4.AstOperatorExpression._extendM({init:function(properties){this._super(properties),void 0===this.rhsOperand&&(this.rhsOperand=null)},getRhsOperand:function(){return this.rhsOperand},setRhsOperand:function(rhsOperand){this.rhsOperand=rhsOperand},getRhsValuesArr:function(){var rhsVal=this.getRhsOperand().evaluate();return thinkehr.f4.util.isArray(rhsVal)?rhsVal&&0!=rhsVal.length||(rhsVal=[null]):rhsVal=[rhsVal],rhsVal},isBinary:function(){return!0},evaluate:function(){var lhs=this.getLhsValuesArr();lhs.length||lhs.push(null);var rhs=this.getRhsValuesArr();return this.getOperatorFunc().call(null,lhs,rhs)},toString:function(){return"thinkehr.f4.AstBinaryExpression"}}),thinkehr.f4.AstBinaryQuantityExpression=thinkehr.f4.AstBinaryExpression._extendM({init:function(properties){this._super(properties)},evaluate:function(){var lhs=thinkehr.f4.AstBinaryQuantityExpression.toAstQuantObj(this.getLhsOperand().evaluate()),rhs=this.getRhsValuesArr();return this.getOperatorFunc().call(null,lhs,rhs)},toString:function(){return"thinkehr.f4.AstBinaryQuantityExpression"}}),thinkehr.f4.AstBinaryQuantityExpression.toAstQuantObj=function(magUnitObjArr){return magUnitObjArr=magUnitObjArr&&magUnitObjArr.magnitude&&magUnitObjArr.magnitude.length?magUnitObjArr.magnitude.map(function(magVal,i){return{magnitude:magVal,unit:magUnitObjArr.unit[i]}}):[{magnitude:null,unit:null}]},thinkehr.f4.AstUnaryQuantityExpression=thinkehr.f4.AstUnaryExpression._extendM({init:function(properties){this._super(properties)},evaluate:function(){var lhs=thinkehr.f4.AstBinaryQuantityExpression.toAstQuantObj(this.getLhsOperand().evaluate());return this.getOperatorFunc().call(null,lhs)},toString:function(){return"thinkehr.f4.AstUnaryQuantityExpression"}}),thinkehr.f4.AstBinaryCodedTextExpression=thinkehr.f4.AstBinaryExpression._extendM({init:function(properties){this._super(properties)},evaluate:function(){var lhs=this.getLhsValuesArr();this.getLhsIsMulti()||(lhs=thinkehr.f4.AstBinaryCodedTextExpression.toAstCodedObj(lhs));var lhsVal,rhsVal,rhs=this.getRhsValuesArr(),collectProp=function(propName){return function(val){return val[propName]}};return!this.operatorDef||"equals"!==this.operatorDef.op&&"notequals"!==this.operatorDef.op?this.getLhsIsMulti()?(lhsVal=lhs[0]&&lhs[0].value?lhs[0].value:lhs.value,rhsVal=rhs.map(collectProp("value"))):(lhsVal=lhs.map(collectProp("value")),rhsVal=rhs.map(collectProp("value"))):this.getLhsIsMulti()?(lhsVal=lhs[0]&&lhs[0].code?lhs[0].code:lhs.code,rhsVal=rhs.map(collectProp("code"))):(lhsVal=lhs.map(collectProp("code")),rhsVal=rhs.map(collectProp("code"))),lhsVal&&lhsVal.length||(lhsVal=[null]),this.getOperatorFunc().call(null,lhsVal,rhsVal)},toString:function(){return"thinkehr.f4.AstBinaryCodedTextExpression"}}),thinkehr.f4.AstBinaryCodedTextExpression.toAstCodedObj=function(codeValModelArr){return codeValModelArr||(codeValModelArr=[]),codeValModelArr.length?codeValModelArr=codeValModelArr.map(function(val){return{code:val.code||val["|code"],value:val.value||val["|value"]}}):codeValModelArr.push({code:null,value:null}),codeValModelArr},thinkehr.f4.AstUnaryCodedTextExpression=thinkehr.f4.AstUnaryExpression._extendM({init:function(properties){this._super(properties)},evaluate:function(){var lhs=this.getLhsValuesArr();if(this.getLhsIsMulti())lhsVals=lhs[0]&&lhs[0].code?lhs[0].code:lhs.code;else{lhs=thinkehr.f4.AstBinaryCodedTextExpression.toAstCodedObj(lhs);var lhsVals=lhs.map(function(lhs){var lhsVal;return lhsVal=lhs.code?lhs.code:lhs.value?lhs.value:null})}return lhsVals&&lhsVals.length||(lhsVals=[null]),this.getOperatorFunc().call(null,lhsVals)},toString:function(){return"thinkehr.f4.AstUnaryCodedTextExpression"}}),thinkehr.f4.AstBinaryProportionExpression=thinkehr.f4.AstBinaryExpression._extendM({init:function(properties){this._super(properties)},evaluate:function(){var rhs=this.getRhsValuesArr();if(!rhs||!rhs.length||!rhs.filter(function(rhsItem){return thinkehr.f4.util.isNumber(rhsItem.numerator)&&thinkehr.f4.util.isNumber(rhsItem.denominator)}).length)return!1;var lhs=this.getLhsOperand().evaluate();if(!lhs||!lhs.numerator.length||!lhs.numerator.filter(function(numVal){return thinkehr.f4.util.isNumber(numVal)}).length)return!1;var lhsVals=lhs.numerator.map(function(numVal,i){return numVal/lhs.denominator[i]}),rhsVals=rhs.map(function(rhsPropObj){return rhsPropObj.numerator/rhsPropObj.denominator});return this.getOperatorFunc().call(null,lhsVals,rhsVals)},toString:function(){return"thinkehr.f4.AstBinaryProportionExpression"}}),thinkehr.f4.AstUnaryProportionExpression=thinkehr.f4.AstUnaryExpression._extendM({init:function(properties){this._super(properties)},evaluate:function(){var lhs=this.getLhsOperand().evaluate(),lhsVals=lhs.numerator.map(function(numVal,i){var denVal=lhs.denominator[i];if(thinkehr.f4.util.isNumber(numVal)&&thinkehr.f4.util.isNumber(denVal)){var calc=numVal/denVal;return isNaN(calc)?null:calc}return null});return lhsVals.length||(lhsVals=[null]),this.getOperatorFunc().call(null,lhsVals)},toString:function(){return"thinkehr.f4.AstUnaryProportionExpression"}}),thinkehr.f4.AstBinaryDateExpression=thinkehr.f4.AstBinaryExpression._extendM({init:function(properties){this._super(properties)},_valuesToUTCTimestamp:function(stringValsArr){var currDate;return stringValsArr.map(function(currVal){return thinkehr.f4.util.isDate(currVal)?currDate=currVal:(currDate=new Date(thinkehr.f4.util.toLocalTimezoneOffsetISOString(currVal)),thinkehr.f4.util.isDate(currDate)||(currDate=thinkehr.f4.util.toTime(currVal))),currDate?currDate.getTime():null})},getRhsValuesArr:function(){var stringVals=this._super();return stringVals.map(function(d){return d.getTime()})},getLhsValuesArr:function(){var stringVals=this._super();return this._valuesToUTCTimestamp(stringVals)},toString:function(){return"thinkehr.f4.AstBinaryDateExpression"}}),thinkehr.f4.AstBinaryDurationExpression=thinkehr.f4.AstBinaryExpression._extendM({init:function(properties){this._super(properties)},evaluate:function(){var rhsVal=this.getRhsValuesArr(),lhs=this.getLhsValuesArr(),lhsVals=lhs.map(function(durVal){return nezasaEhr.iso8601.Period.parseToTotalSeconds(durVal)});return lhsVals.length||lhsVals.push(null),this.getOperatorFunc().call(null,lhsVals,rhsVal)},toString:function(){return"thinkehr.f4.AstBinaryDurationExpression"}}),thinkehr.f4.AstUnaryDurationExpression=thinkehr.f4.AstUnaryExpression._extendM({init:function(properties){this._super(properties)},evaluate:function(){var lhs=this.getLhsValuesArr(),lhsVals=lhs.map(function(durVal){var toSecs=nezasaEhr.iso8601.Period.parseToTotalSeconds(durVal);return 1>toSecs?null:toSecs});return lhsVals.length||lhsVals.push(null),this.getOperatorFunc().call(null,lhsVals)},toString:function(){return"thinkehr.f4.AstUnaryDurationExpression"}}),thinkehr.f4.AstLiteral=thinkehr.f4.AstExpression._extendM({init:function(properties){this._super(properties),void 0===this.value&&(this.value=null)},getValue:function(){return this.value},setValue:function(value){this.value=value},evaluate:function(){return this.getValue()},next:function(val){return null},toString:function(){return"thinkehr.f4.AstLiteral"}}),thinkehr.f4.AstNumericLiteral=thinkehr.f4.AstLiteral._extendM({init:function(properties){this._super(properties)},toString:function(){return"thinkehr.f4.AstNumericLiteral"}}),thinkehr.f4.AstStringLiteral=thinkehr.f4.AstLiteral._extendM({init:function(properties){this._super(properties)},toString:function(){return"thinkehr.f4.AstStringLiteral"}}),thinkehr.f4.AstDateLiteral=thinkehr.f4.AstLiteral._extendM({init:function(properties){this._super(properties),this.setValue(thinkehr.f4.util.toDate(this.getValue()))},toString:function(){return"thinkehr.f4.AstDateLiteral"}}),thinkehr.f4.AstTimeLiteral=thinkehr.f4.AstLiteral._extendM({init:function(properties){this._super(properties),this.setValue(thinkehr.f4.util.toTime(this.getValue()))},toString:function(){return"thinkehr.f4.AstTimeLiteral"}}),thinkehr.f4.AstDateTimeLiteral=thinkehr.f4.AstLiteral._extendM({init:function(properties){this._super(properties),this.setValue(new Date(thinkehr.f4.util.toLocalTimezoneOffsetISOString(this.getValue())))},toString:function(){return"thinkehr.f4.AstDateTimeLiteral"}}),thinkehr.f4.AstQuantityLiteral=thinkehr.f4.AstLiteral._extendM({init:function(properties){this._super(properties),void 0===this.magnitudeLiteral&&(this.magnitudeLiteral=null),void 0===this.unitLiteral&&(this.unitLiteral=null)},getValue:function(){return{magnitude:this.getMagnitudeLiteral().evaluate(),unit:this.getUnitLiteral().evaluate()}},getMagnitudeLiteral:function(){return this.magnitudeLiteral},setMagnitudeLiteral:function(magnitudeLiteral){this.magnitudeLiteral=magnitudeLiteral},getUnitLiteral:function(){return this.unitLiteral},setUnitLiteral:function(unitLiteral){this.unitLiteral=unitLiteral},toString:function(){return"thinkehr.f4.AstQuantityLiteral"}}),thinkehr.f4.AstCodedTextLiteral=thinkehr.f4.AstLiteral._extendM({init:function(properties){this._super(properties),void 0===this.codeLiteral&&(this.codeLiteral=null),void 0===this.valueLiteral&&(this.valueLiteral=null)},getValue:function(){return{code:this.getCodeLiteral().evaluate(),value:this.getValueLiteral().evaluate()}},getCodeLiteral:function(){return this.codeLiteral},setCodeLiteral:function(codeLiteral){this.codeLiteral=codeLiteral},getValueLiteral:function(){return this.valueLiteral},setValueLiteral:function(valueLiteral){this.valueLiteral=valueLiteral},toString:function(){return"thinkehr.f4.AstCodedTextLiteral"}}),thinkehr.f4.AstProportionLiteral=thinkehr.f4.AstLiteral._extendM({init:function(properties){this._super(properties),void 0===this.numeratorLiteral&&(this.numeratorLiteral=null),void 0===this.denominatorLiteral&&(this.denominatorLiteral=null)},getValue:function(){return{numerator:this.getNumeratorLiteral().evaluate(),denominator:this.getDenominatorLiteral().evaluate()}},getNumeratorLiteral:function(){return this.numeratorLiteral},setNumeratorLiteral:function(numeratorLiteral){this.numeratorLiteral=numeratorLiteral},getDenominatorLiteral:function(){return this.denominatorLiteral},setDenominatorLiteral:function(denominatorLiteral){this.denominatorLiteral=denominatorLiteral},toString:function(){return"thinkehr.f4.AstProportionLiteral"}}),thinkehr.f4.AstDurationLiteral=thinkehr.f4.AstLiteral._extendM({init:function(properties){if(this._super(properties),void 0===this.totalSecondsLiteral){var val=0;if(this.value){var multiplicators={year:31104e3,month:2592e3,week:604800,day:86400,hour:3600,minute:60,second:1};Object.keys(this.value).forEach(function(key){var units=parseInt(this.value[key]);thinkehr.f4.util.isInteger(units)||(units=0);var unitDuration=multiplicators[key]||0;val+=units*unitDuration}.bind(this))}this.totalSecondsLiteral=new thinkehr.f4.AstNumericLiteral({
value:val})}},getValue:function(){return this.totalSecondsLiteral.evaluate()},getTotalSecondsLiteral:function(){return this.totalSecondsLiteral},setTotalSecondsLiteral:function(totalSecondsLiteral){this.totalSecondsLiteral=totalSecondsLiteral},toString:function(){return"thinkehr.f4.AstDurationLiteral"}}),thinkehr.f4.AstStatement=thinkehr.f4.AstNode._extendM({init:function(properties){this._super(properties)},toString:function(){return"thinkehr.f4.AstStatement"}}),thinkehr.f4.AstNoopStatement=thinkehr.f4.AstStatement._extendM({init:function(properties){this._super(properties)},process:function(context){},evaluate:function(context){},toString:function(){return"thinkehr.f4.AstNoopStatement"}}),thinkehr.f4.AstActionsStatement=thinkehr.f4.AstCollectionNode._extendM({init:function(properties){this._super(properties)},actions:function(action){return this.elements(action)},toString:function(){return"thinkehr.f4.AstActionsStatement"}}),thinkehr.f4.AstActionStatement=thinkehr.f4.AstStatement._extendM({init:function(properties){this._super(properties),void 0===this.name&&(this.name=null),void 0===this.targets&&(this.targets=[]),void 0===this.actionFunc&&(this.actionFunc=function(){})},getName:function(){return this.name},setName:function(name){this.name=name},getTargets:function(){return this.targets},addTarget:function(target){this.targets.push(target)},getActionFunc:function(){return this.actionFunc},setActionFunc:function(actionFunc){this.actionFunc=actionFunc},evaluate:function(){var ta=this.getTargets(),res=[];return ta.forEach(function(target){var fr=this.getActionFunc().call(null,target);void 0!==fr&&res.push(fr)}.bind(this)),res},toString:function(){return"thinkehr.f4.AstActionStatement"}}),thinkehr.f4.AstShowAction=thinkehr.f4.AstActionStatement._extendM({init:function(properties){this._super(properties),this.setName("show"),this.setActionFunc(function(target){target.getViewConfig().isHidden()&&target.getViewConfig().setHidden(!1)})},toString:function(){return"thinkehr.f4.AstShowAction"}}),thinkehr.f4.AstHideAction=thinkehr.f4.AstActionStatement._extendM({init:function(properties){this._super(properties),this.setName("hide"),this.setActionFunc(function(target){target.getViewConfig().isHidden()||target.getViewConfig().setHidden(!0)})},toString:function(){return"thinkehr.f4.AstHideAction"}}),thinkehr.f4.AstEnableAction=thinkehr.f4.AstActionStatement._extendM({init:function(properties){this._super(properties),this.setName("enable"),this.setActionFunc(function(target){target.getViewConfig().isReadOnly()&&target.getViewConfig().setReadOnly(!1)})},toString:function(){return"thinkehr.f4.AstEnableAction"}}),thinkehr.f4.AstDisableAction=thinkehr.f4.AstActionStatement._extendM({init:function(properties){this._super(properties),this.setName("disable"),this.setActionFunc(function(target){target.getViewConfig().isReadOnly()||target.getViewConfig().setReadOnly(!0)})},toString:function(){return"thinkehr.f4.AstEnableAction"}}),thinkehr.f4.AstSetAction=thinkehr.f4.AstActionStatement._extendM({init:function(properties){this._super(properties),this.setName("set"),this.setActionFunc(function(target){target.applyValue(properties.rawDesc.value)})},toString:function(){return"thinkehr.f4.AstSetAction"}}),thinkehr.f4.AstClearAction=thinkehr.f4.AstActionStatement._extendM({init:function(properties){this._super(properties),this.setName("clear"),this.setActionFunc(function(target){target.clearValue(null)})},toString:function(){return"thinkehr.f4.AstClearAction"}}),thinkehr.f4.AstResetAction=thinkehr.f4.AstActionStatement._extendM({init:function(properties){this._super(properties),this.setName("reset"),this.setActionFunc(function(target){target.resetValue()})},toString:function(){return"thinkehr.f4.AstResetAction"}}),thinkehr.f4.Visitor=thinkehr.f4.Object._extendM({init:function(properties){this._super(properties),void 0!==this.context&&null!==this.context||(this.context={})},getContext:function(){return this.context},visit:function(model){},afterVisit:function(model){},toString:function(){return"thinkehr.f4.Visitor"}}),thinkehr.f4.StackContext=thinkehr.f4.Object._extendM({init:function(properties){this._super(properties),thinkehr.f4.util.isArray(this._ctxStack)||(this._ctxStack=[])},_peek:function(){return this._ctxStack.length>0?this._ctxStack[0]:void 0},push:function(node,value){var stackObj={node:node,value:value};return this._ctxStack.unshift(stackObj)},pop:function(){var popped=this._ctxStack.shift();return void 0!==popped?popped.value:void 0},popConditionally:function(node){var top=this._peek();return top&&node===top.node?this._ctxStack.shift().value:void 0},get:function(prop){for(var i=0;i<this._ctxStack.length;i++){var ctxVal=this._ctxStack[i].value;if(ctxVal.hasOwnProperty(prop))return ctxVal[prop]}},toString:function(){return"thinkehr.f4.StackContext"}}),thinkehr.f4.VCTX_ISM_CURRENT_STATE="vctxIsmCurrentState",thinkehr.f4.IsmTransitionVisitor=thinkehr.f4.Visitor._extendM({init:function(properties){this._super(properties),this.context=new thinkehr.f4.StackContext},visit:function(model){var csVal=model.annotationValue(thinkehr.f4.VCTX_ISM_CURRENT_STATE);if(thinkehr.f4.util.isString(csVal)&&this.getContext().push(model,{ismCurrentState:csVal}),model.getRmType()===thinkehr.f4.RmType.ISM_TRANSITION){var ismState=this.getContext().get("ismCurrentState");if(thinkehr.f4.util.isValueNonEmpty(ismState)){var containsValue,needToVisitSubModels,actionPath,stateToSet=ismState,parent=model.getParentModel();if(parent.getRmType()===thinkehr.f4.RmType.ACTION?(containsValue=parent.containsValue(),needToVisitSubModels=containsValue!==!0,actionPath=parent.getPath()):(actionPath=this.findActionPath(model),needToVisitSubModels=!0,containsValue=!1),needToVisitSubModels){var itemVisitor=new thinkehr.f4.ActionIsmItemVisitor({context:{path:actionPath,exemptions:[actionPath+"/ism_transition"]}});containsValue=model.getRootModel().accept(itemVisitor)}containsValue||(stateToSet=null);var csFormId=model.getPath()+"/current_state",csModel=model.findChildWithPath(csFormId);csModel?csModel.codeValue(stateToSet):console.warn("ISM_TRANSITION child current_state not found")}}return!1},afterVisit:function(model){this.getContext().popConditionally(model)},findActionPath:function(ismTransitionModel){var segments=ismTransitionModel.getPath().split("/"),len=segments.length;if("ism_transition"===segments[len-1]){for(var actionPath="",i=0;i<segments.length-1;i++)i>0&&(actionPath+="/"),actionPath+=segments[i];return actionPath}return null}}),thinkehr.f4.ActionIsmItemVisitor=thinkehr.f4.Visitor._extendM({init:function(properties){this._super(properties),thinkehr.f4.util.isArray(this.context.exemptions)||(this.context.exemptions=[])},visit:function(model){var c=this.getContext(),modelPath=model.getPath();if(0===modelPath.indexOf(c.path)){for(var i=0;i<c.exemptions.length;i++){var exemption=c.exemptions[i];if(0===modelPath.indexOf(exemption))return!1}var cv=model.containsValue();return cv===!0&&(this.getContext().model=model),cv}return!1}}),thinkehr.f4.dict||(thinkehr.f4.dict={translations:{},tr:function(key,language){var defDictStr="default";language||(language=defDictStr);var langObj=thinkehr.f4.dict.translations[language];return langObj&&langObj[key]||(langObj=thinkehr.f4.dict.translations[defDictStr]),langObj&&langObj[key]?langObj[key]:null},msg:function(key,language,supplantArgs){var text=this.tr(key,language);return text?text.replace(/{([^{}]*)}/g,function(a,b){var r=supplantArgs[b];return"string"==typeof r||"number"==typeof r?r:a}):text}}),thinkehr.f4.dict.translations["default"]={"duration.year":"Years","duration.year.ph":"yr","duration.month":"Months","duration.month.ph":"mo","duration.week":"Weeks","duration.week.ph":"w","duration.day":"Days","duration.day.ph":"day","duration.hour":"Hours","duration.hour.ph":"hr","duration.minute":"Minutes","duration.minute.ph":"min","duration.second":"Seconds","duration.second.ph":"sec",other:"Other",loading:"Loading",notFound:"Not found",tabRendering:" Rendering in progress ...","validation.required":"Required field","validation.min":"Min. value {minOp} {min}","validation.min.duration":"{field} min val. {minOp} {min}","validation.max":"Max. value {maxOp} {max}","validation.max.duration":"{field} max val. {maxOp} {max}","validation.numberOfSelectionsInvalid":"Number of options between {numberOfSelectionsMin} and {numberOfSelectionsMax}","validation.pattern":"Example: {patternValidExample}","validation.terminologyCodeNotFound":"Terminology code {codeValue} is not valid.","validation.dateOptional.closeSelection":"skip optional selection","validation.dateOptional.requiredSelection":"required selection","validation.dateInvalidPattern":"Date pattern not valid: {datePattern}","validation.minItemsRequired":"Minimum {requiredDeltaNr} item(s) required.","validation.minItemsRequiredAddPlaceholder":"selection required","validation.maxItemsLimitText":"Maximum number of items selected.","model.notFound.byTag":"Model not found by '{queryStr}' tag.","model.notFound.byPath":"Model not found by '{queryStr}' path.","placeholder.terminology":"Type and select."},thinkehr.f4.dict.translations.sl={"duration.year":"leta","duration.year.ph":"let","duration.month":"mes.","duration.month.ph":"mes","duration.week":"ted.","duration.week.ph":"ted","duration.day":"dn.","duration.day.ph":"dn","duration.hour":"ure","duration.hour.ph":"ure","duration.minute":"min","duration.minute.ph":"min","duration.second":"sek.","duration.second.ph":"sek",other:"Drugo",loading:"Prenašam",notFound:"Ne obstaja",tabRendering:"Prikazovanje v teku ...","validation.required":"Obvezno polje","validation.min":"Najm. vred. {minOp} {min}","validation.min.duration":"{field} {minOp} {min}","validation.max":"Najv. vred. {maxOp} {max}","validation.max.duration":"{field} {maxOp} {max}","validation.numberOfSelectionsInvalid":"Izberite med {numberOfSelectionsMin} in {numberOfSelectionsMax} možnosti.","validation.pattern":"Vzorec: {patternValidExample}","validation.terminologyCodeNotFound":"Neveljavna koda terminologije {codeValue}.","validation.dateOptional.closeSelection":"zapri poljubno izbiro","validation.dateOptional.requiredSelection":"zahtevana izbira","validation.dateInvalidPattern":"Datum neveljaven: {datePattern}","validation.minItemsRequired":"Izberi še {requiredDeltaNr}.","validation.minItemsRequiredAddPlaceholder":"zahtevana izbira","validation.maxItemsLimitText":"Doseženo število izbranih elementov.","model.notFound.byTag":"Model z oznako '{queryStr}' ne obstaja.","model.notFound.byPath":"Model s potjo '{queryStr}' ne obstaja.","placeholder.terminology":"Iskanje po terminologiji."},angular.module("ehr-forms4-templates",["thinkehr/f4/templates/ehr-boolean.html","thinkehr/f4/templates/ehr-coded-text-checkboxes.html","thinkehr/f4/templates/ehr-coded-text-combo_deprecated.html","thinkehr/f4/templates/ehr-coded-text-component.html","thinkehr/f4/templates/ehr-coded-text-radio.html","thinkehr/f4/templates/ehr-coded-text.html","thinkehr/f4/templates/ehr-component-element-switch.html","thinkehr/f4/templates/ehr-count.html","thinkehr/f4/templates/ehr-custom.html","thinkehr/f4/templates/ehr-date-time.html","thinkehr/f4/templates/ehr-date.html","thinkehr/f4/templates/ehr-duration-validation-field.html","thinkehr/f4/templates/ehr-duration-validation-required.html","thinkehr/f4/templates/ehr-duration.html","thinkehr/f4/templates/ehr-ehr-uri-text-area.html","thinkehr/f4/templates/ehr-ehr-uri-text-field.html","thinkehr/f4/templates/ehr-ehr-uri.html","thinkehr/f4/templates/ehr-form.html","thinkehr/f4/templates/ehr-free-layout-component.html","thinkehr/f4/templates/ehr-label.html","thinkehr/f4/templates/ehr-multimedia-field.html","thinkehr/f4/templates/ehr-multimedia.html","thinkehr/f4/templates/ehr-other-input.html","thinkehr/f4/templates/ehr-proportion.html","thinkehr/f4/templates/ehr-quantity.html","thinkehr/f4/templates/ehr-single-field-multi-controls.html","thinkehr/f4/templates/ehr-tab-container-title.html","thinkehr/f4/templates/ehr-text-area.html","thinkehr/f4/templates/ehr-text-field.html","thinkehr/f4/templates/ehr-text-values-combo.html","thinkehr/f4/templates/ehr-text-values-radio.html","thinkehr/f4/templates/ehr-text.html","thinkehr/f4/templates/ehr-time.html","thinkehr/f4/templates/ehr-unknown.html","thinkehr/f4/templates/ehr-uri-text-area.html","thinkehr/f4/templates/ehr-uri-text-field.html","thinkehr/f4/templates/ehr-uri.html","thinkehr/f4/templates/ehr-validation-msg.html"]),angular.module("thinkehr/f4/templates/ehr-boolean.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-boolean.html",'<div\n        class="ehr-boolean ehr-line"\n        data-ehr-path="{{::model.getPath()}}"\n        data-ehr-name="{{::model.getName()}}"\n        ng-hide="EhrLayoutHelper.isFieldHidden(this)"\n        ng-class="EhrLayoutHelper.computeEhrLineClass(model)">\n\n    <ehr-label class="ehr-label-content" ng-class="EhrLayoutHelper.computeEhrLabelContentClass(model)">\n        <span class="label-start-position-holder"></span>\n        <span ng-if="!suppressLabel" ng-class="{\'mandatory-field-label\': model.isRequired()}"><span class="ehr-label-text"> {{model.labelFor(EhrContext.language)}}</span><span class="multiplicity-label" ng-class="{\'show-multiplicity\': !model.isRequired() && !model.isOptional()}"> {{::model.getViewConfig().getMultiplicityString()}}</span>:</span>\n        <span class="label-end-position-holder"></span>\n    </ehr-label>\n    <div class="ehr-field-content">\n\n        <div class="content-start-position-holder"></div>\n\n        <div class="field-content-holder">\n            <div class="ehr-relative">\n                <input\n                        type="checkbox"\n                        name="{{::booleanName()}}"\n                        id="{{::booleanName()}}_id"\n                        class="ehr-checkbox k-checkbox"\n                        ng-model="booleanValue"\n                        ng-model-options="{ getterSetter: true }"\n                        ng-disabled="twoStateReadOnly()"\n                        ng-class="computeFieldClass()"\n                        ng-hide="model.getViewConfig().isHidden()"\n                        ng-if="!model.isThreeState()"\n                        >\n                <label class="k-checkbox-label" ng-if="!model.isThreeState()" for="{{::booleanName()}}_id"></label>\n            </div>\n        </div>\n        <div class="ehr-radio-button-group" ng-if="model.isThreeState()" ng-hide="model.getViewConfig().isHidden() || (trueReadOnly() && hideReadOnlyInputs) ||  ( isViewMode() && booleanValue()!==true )">\n            <div class="ehr-radio-button-column ehr-boolean-three-state-true-column"\n                 ng-style="columnStyle()"\n                 ng-class="computeFieldClass()"\n                    >\n                <label class="ehr-radio-label last-in-column">\n                    <input\n                            type="radio"\n                            class="ehr-radio ehr-boolean-three-state ehr-boolean-true k-radio"\n                            name="ehr-rb-group-{{::booleanName()}}"\n                            id="{{::booleanName()}}_true_id"\n                            ng-disabled="trueReadOnly()"\n                            ng-model="booleanValue"\n                            ng-model-options="{ getterSetter: true }"\n                            ng-value="true"\n                            >\n                    <label ng-class="{\'k-radio-label\':!(isViewMode && isViewMode())}" for="{{::booleanName()}}_true_id"><span class="k-icon k-i-tick"></span></label>\n\n                </label>\n            </div>\n        </div>\n\n        <div class="ehr-radio-button-group" ng-if="model.isThreeState()" ng-hide="model.getViewConfig().isHidden() || (falseReadOnly() && hideReadOnlyInputs) ||  ( isViewMode() && booleanValue()!==false )">\n            <div class="ehr-radio-button-column ehr-boolean-three-state-false-column"\n                 ng-style="columnStyle()"\n                 ng-class="computeFieldClass()"\n                    >\n                <label class="ehr-radio-label last-in-column">\n                    <input\n                            type="radio"\n                            class="ehr-radio ehr-boolean-three-state ehr-boolean-false k-radio"\n                            name="ehr-rb-group-{{::booleanName()}}"\n                            id="{{::booleanName()}}_false_id"\n                            ng-disabled="falseReadOnly()"\n                            ng-model="booleanValue"\n                            ng-model-options="{ getterSetter: true }"\n                            ng-value="false"\n                            >\n                    <label ng-class="{\'k-radio-label\':!(isViewMode && isViewMode())}" for="{{::booleanName()}}_false_id"><span class="k-icon k-i-close"></span></label>\n                </label>\n            </div>\n\n        </div>\n\n        <div class="ehr-radio-button-group" ng-if="model.isThreeState()" ng-hide="model.getViewConfig().isHidden() || (nullReadOnly() && hideReadOnlyInputs) ||  ( isViewMode() && booleanValue()!==null )">\n            <div class="ehr-radio-button-column ehr-boolean-three-state-null-column"\n                 ng-style="columnStyle()"\n                 ng-class="computeFieldClass()"\n                    >\n                <label class="ehr-radio-label last-in-column">\n                    <input\n                            type="radio"\n                            class="ehr-radio ehr-boolean-three-state ehr-boolean-null k-radio"\n                            name="ehr-rb-group-{{::booleanName()}}"\n                            id="{{::booleanName()}}_null_id"\n                            ng-disabled="nullReadOnly() || (isViewMode && isViewMode())"\n                            ng-model="booleanValue"\n                            ng-model-options="{ getterSetter: true }"\n                            ng-value="null"\n                            >\n                    <label ng-class="{\'k-radio-label\':!(isViewMode && isViewMode())}" for="{{::booleanName()}}_null_id"><span class="k-icon k-i-cancel"></span></label>\n                </label>\n            </div>\n\n        </div>\n\n        <div class="content-end-position-holder"></div>\n\n    </div>\n\n</div>\n')}]),angular.module("thinkehr/f4/templates/ehr-coded-text-checkboxes.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-coded-text-checkboxes.html",'<div ng-form="{{::codedTextFormGroupName()}}" class="ehr-checkbox-group" ng-hide="model.getViewConfig().isHidden()" ehr-coded-text-checkboxes-min-max-validator>\n\n    <div class="ehr-checkbox-column"\n         ng-repeat="col in columns"\n         ng-style="::elementStyle()"\n         ng-class="::EhrLayoutHelper.computeFieldClass(model)"\n         ng-hide="(isViewMode && isViewMode()) && !anySelectedInColumn(col)"\n            >\n\n        <label class="ehr-checkbox-label" ng-repeat="itemIndex in col" ng-class="::EhrLayoutHelper.computeLastColumnClass($last, listOpen())">\n            <input\n                    type="checkbox"\n                    name="{{::multiCodedTextNameFor(itemIndex)}}"\n                    id="{{::multiCodedTextIdFor(itemIndex)}}"\n                    class="ehr-checkbox k-checkbox hide-in-ehr-view-mode"\n                    ng-model="multiValues[list()[itemIndex].getValue()].checked"\n                    ng-disabled="model.getViewConfig().isReadOnly() || (isViewMode && isViewMode())"\n                    ng-hide="model.getViewConfig().isHidden()"\n                    ng-true-value="true"\n                    ng-false-value="false"\n                    ng-change="valueToggled(list()[itemIndex].getValue())"\n                    ng-click="cbClicked()"\n                    ng-blur="cbBlurred()"\n                    >\n\n            <label ng-class="{\'k-checkbox-label\':!(isViewMode && isViewMode())}" for="{{::multiCodedTextIdFor(itemIndex)}}" ng-bind="::labelText(list()[itemIndex])"\n                   ng-hide="(isViewMode && isViewMode() && (!multiValues[list()[itemIndex].getValue()].checked))"></label>\n        </label>\n    </div>\n\n    <span class="ehr-validation-error-msg" ng-messages="showErrorMessage()"><span ng-messages-include="thinkehr/f4/templates/ehr-validation-msg.html"></span></span>\n\n    <ehr-other-input ng-if="::listOpen()" class="ehr-other-include"></ehr-other-input>\n</div>')}]),angular.module("thinkehr/f4/templates/ehr-coded-text-combo_deprecated.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-coded-text-combo_deprecated.html",'<!--<select kendo-combo-box class="ehr-combo" ng-model="codeValue" ng-model-options="{ getterSetter: true }"-->\n<!--ng-options="item.getValue() as item.getLabel() for item in model.getInputFor(\'code\').getList()">-->\n<!--<option value="">&nbsp;</option>-->\n<!--</select>-->\n\n<select\n        kendo-combo-box="{{::kendoName()}}"\n        name="{{::codedTextName()}}"\n        class="ehr-combo"\n        ng-class="::EhrLayoutHelper.computeFieldClass(model)"\n        ng-readonly="model.getViewConfig().isReadOnly()"\n        ng-hide="model.getViewConfig().isHidden()"\n        ng-model="codeValue"\n        ng-model-options="{ getterSetter: true }"\n        k-filter="\'contains\'"\n        k-change="codeChanged"\n        ng-required="::model.isRequired()"\n        >\n    <option value=""></option>\n        <option ng-repeat="item in ::list()" value="{{::item.getValue()}}" ng-bind="::labelText(item)"></option>\n    <option value="__other__" ng-if="::listOpen()">{{::EhrDictionary.text(\'other\')}}&nbsp;&gt;&gt;</option>\n</select>\nlist={{list().length}}\ncv={{codeValue()}}\n\n<input\n        ng-if="::listOpen()"\n        name="{{::otherFieldName()}}"\n        type="text"\n        class="ehr-text-input field other k-textbox"\n        ng-model="otherValue"\n        ng-model-options="{ getterSetter: true, debounce: 100 }"\n        ng-readonly="model.getViewConfig().isReadOnly()"\n        ng-hide="model.getViewConfig().isHidden() || !otherSelected()"\n        ng-required="otherRequired()"\n        >\n<ehr-single-field-multi-controls></ehr-single-field-multi-controls>\n<span class="ehr-validation-error-msg" ng-messages="showErrorMessage()"><span ng-messages-include="thinkehr/f4/templates/ehr-validation-msg.html"></span></span>\n\n\n')}]),angular.module("thinkehr/f4/templates/ehr-coded-text-component.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-coded-text-component.html",'<!--<select kendo-combo-box class="ehr-combo" ng-model="codeValue" ng-model-options="{ getterSetter: true }"-->\n<!--ng-options="item.getValue() as item.getLabel() for item in model.getInputFor(\'code\').getList()">-->\n<!--<option value="">&nbsp;</option>-->\n<!--</select>-->\n<div ng-if="isMulti() && (multiValuesArr.length || minMultiNrDelta(true).length)" class="k-multiselect-wrap k-floatwrap selected-multi-items-holder hide-in-ehr-view-mode" unselectable="on">\n    <ul role="listbox" unselectable="on" class="k-reset">\n        <li ng-repeat="codeVal in multiValuesArr" class="k-button selected-multi-item" unselectable="on" ng-class="{\'item-status-not-found\':codeVal.status==inputItemStatus.notFound, \'item-status-loading\':codeVal.status==inputItemStatus.loading}"><span ng-show="codeVal.status==inputItemStatus.loading" class="k-icon k-loading"></span> <span unselectable="on" class="label">{{codeVal.label}}</span><span unselectable="on" class="k-select" ng-show="!model.getViewConfig().isReadOnly()"><span unselectable="on" class="k-icon k-i-close" ng-click="removeCodeValue(codeVal.value)">delete</span></span></li>\n        <li ng-repeat="selectItem in minMultiNrDelta(true) track by $index" class="k-button min-required-item-placeholder" unselectable="on" ng-click="displayFullItemsList()"><span unselectable="on" class="label">{{EhrDictionary.messageFormat("validation.minItemsRequiredAddPlaceholder", {}, EhrContext.language)}}</span></li>\n    </ul>\n</div>\n<span ng-show="addMultiItemEnabled()" class="autocomplete-input-wrap hide-in-ehr-view-mode k-dropdown-wrap k-state-default position-relative" ng-class="::EhrLayoutHelper.computeFieldClass(model)">\n    <span>\n        <span ng-class="{\'no-opacity\':!filterEnabled}" class="input-w ehr-coded-text-input-w">\n            <input kendo-auto-complete="{{::kendoName()}}"\n                   name="{{::codedTextName()}}"\n                   class="ehr-autocomplete ehr-text-input field"\n                   ng-class="::EhrLayoutHelper.computeFieldClass(model)"\n                   ng-readonly="model.getViewConfig().isReadOnly()"\n                   ng-hide="model.getViewConfig().isHidden()"\n                   k-data-source="listDSArray"\n                   ng-required="codeValueRequired()"\n                   filter="\'contains\'"\n                   k-filtering="onFilter"\n                   k-select="\'onSelect\'"\n                   k-open="\'onOpen\'"\n                   k-close="onClose"\n                   k-change="onChanged"\n                   k-options="::getKendoAutocompleteOptions()"\n                   separator="\'\'"\n                   highlight-first="false"\n                   min-length="0"\n                   data-text-field="\'label\'"\n                   value-primitive="true"\n                   ng-blur="hasFocus=false;onBlur($event)"\n                   ng-focus="hasFocus=true"\n                   ehr-terminology-code-exists-validator=""\n                   ehr-coded-text-multi-min-items-validator="minValueRequired()"\n                   ng-model="_terminologyValidationCodeValue"\n                   ng-model-options="{ updateOn: \'\' }"\n                   ehr-placeholder="{{::getInputPlaceholder()}}"\n            >\n        </span>\n        <span ng-show="!filterEnabled" ng-class="{\'ng-invalid-background\':hasErrorMessage, \'input-background\':!hasErrorMessage}"\n              class="label-on-input-disabled ehr-autocomplete ehr-text-input field truncate-text k-autocomplete">\n            <span class="k-input">{{inputLabelValue}}</span>\n        </span>\n\n        <span ng-show="!filterEnabled" ng-click="model.getViewConfig().isReadOnly()?null:displayFullItemsList()" class="click-overlay ehr-autocomplete ehr-text-input field"\n              ng-class="{\'cursor-disabled\':model.getViewConfig().isReadOnly()}"></span>\n    </span>\n\n    <span tabindex="-1" unselectable="on" class="k-select" ng-show="displayListArrow && !_lastFilterString" ng-click="model.getViewConfig().isReadOnly()?null:displayFullItemsList()"\n            ng-class="{\'cursor-disabled\':model.getViewConfig().isReadOnly()}">\n        <span unselectable="on" class="k-icon k-i-arrow-s" role="button" tabindex="-1">select</span>\n    </span>\n    <span class="k-icon k-loading k-select" ng-show="isTerminologyLoading"></span>\n</span>\n\n<span class="show-in-ehr-view-mode">\n    <span ng-repeat="label in toLabelValuesArr()" class="ehr-view-mode-value">{{label}}</span>\n</span>\n<span class="ehr-validation-error-msg" ng-messages="showErrorMessage()"><span ng-messages-include="thinkehr/f4/templates/ehr-validation-msg.html"></span></span>\n<div ng-show="!addMultiItemEnabled()" class="hide-in-ehr-view-mode max-items-message">{{EhrDictionary.messageFormat("validation.maxItemsLimitText", {}, EhrContext.language)}}</div>\n<div ng-hide="!addMultiItemEnabled() && !otherValue()" class="hide-in-ehr-view-mode list-open-wrap">\n    <span ng-show="listOpen() && isMulti()"> {{getOtherLabel()}}:</span>\n    <input\n        ng-if="listOpen()"\n        name="{{::otherFieldName()}}"\n        type="text"\n        class="ehr-text-input field other k-textbox"\n        ng-model="otherValue"\n        ng-model-options="{ getterSetter: true, debounce: 100 , allowInvalid:true}"\n        ng-readonly="model.getViewConfig().isReadOnly()"\n        ng-hide="model.getViewConfig().isHidden() || (!isMulti() && !otherSelected())"\n        ng-required="otherRequired()"\n        ehr-placeholder="{{model.annotationValue(\'placeholder\')}}"\n        >\n</div>')}]),angular.module("thinkehr/f4/templates/ehr-coded-text-radio.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-coded-text-radio.html",'<div class="ehr-radio-button-group" ng-hide="model.getViewConfig().isHidden()">\n    <div class="ehr-radio-clear-holder"\n         ng-class="::EhrLayoutHelper.computeFieldClass(model)"\n         ng-hide="(!codeValue())||(isViewMode && isViewMode()) || model.getViewConfig().isReadOnly()"\n    >\n        <a style="cursor: pointer;" ng-click="codeValue(null)" title="clear"><span class="k-icon k-i-cancel"></span></a>\n    </div>\n    <div class="ehr-radio-button-column"\n         ng-repeat="col in columns"\n         ng-style="::elementStyle()"\n         ng-class="::EhrLayoutHelper.computeFieldClass(model)"\n         ng-hide="(isViewMode && isViewMode()) && !anySelectedInColumn(col)"\n            >\n        <label class="ehr-radio-label" ng-repeat="itemIndex in col" ng-class="{\'last-in-column\':$last && !listOpen(),\'input-label-on-top\':model.hasTag(\'inputLabelOnTop\'), \'hide-label\':model.hasTag(\'inputLabelHide\')}">\n            <span ng-if="model.hasTag(\'inputLabelHide\') && model.hasTag(\'inputLabelOnTop\')" style="opacity:0; height: 0px; display: block;">{{labelText(list()[itemIndex])}}</span>\n            <input\n                    type="radio"\n                    class="ehr-radio k-radio hide-in-ehr-view-mode"\n                    name="ehr_rb_group_{{::codedTextName()}}"\n                    id="{{::codedTextName()}}_{{list()[itemIndex].getValue()}}_id"\n                    ng-disabled="model.getViewConfig().isReadOnly()"\n                    ng-model="codeValue"\n                    ng-model-options="{ getterSetter: true }"\n                    ng-value="::list()[itemIndex].getValue()"\n                    ng-required="radioRequired()"\n                    ng-click="rbClicked()"\n                    ng-blur="rbBlurred()"\n                    >\n            <label ng-class="{\'k-radio-label\':!(isViewMode && isViewMode())}" for="{{::codedTextName()}}_{{list()[itemIndex].getValue()}}_id"\n                   ng-bind="::labelText(list()[itemIndex], model.hasTag(\'inputLabelHide\'))" ng-hide="(isViewMode && isViewMode() && (list()[itemIndex].getValue()!=codeValue()))"></label>\n        </label>\n    </div>\n\n    <span class="ehr-validation-error-msg" ng-messages="showErrorMessage()"><span ng-messages-include="thinkehr/f4/templates/ehr-validation-msg.html"></span></span>\n\n    <ehr-other-input ng-if="::listOpen()" class="ehr-other-include" ng-hide="(isViewMode && isViewMode()) && !otherValue()"></ehr-other-input>\n\n</div>')}]),angular.module("thinkehr/f4/templates/ehr-coded-text.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-coded-text.html",'<div\n        class="ehr-line"\n        data-ehr-path="{{::model.getPath()}}"\n        data-ehr-name="{{::model.getName()}}"\n        ng-hide="EhrLayoutHelper.isFieldHidden(this)"\n        ng-class="computeLineClass()">\n    <ehr-label class="ehr-label-content" ng-class="::EhrLayoutHelper.computeEhrLabelContentClass(model)">\n        <span class="label-start-position-holder"></span>\n        <span ng-if="!suppressLabel" ng-class="{\'mandatory-field-label\': model.isRequired()}"><span class="ehr-label-text"> {{model.labelFor(EhrContext.language)}}</span><span class="multiplicity-label" ng-class="{\'show-multiplicity\': !model.isRequired() && !model.isOptional()}"> {{::model.getViewConfig().getMultiplicityString()}}</span>:</span>\n        <span class="label-end-position-holder"></span>\n    </ehr-label>\n    <div class="ehr-field-content">\n\n        <div class="content-start-position-holder"></div>\n        <div class="field-content-holder">\n            <ehr-coded-text-checkboxes ng-if="isCheckboxes() && !isTerminology()"></ehr-coded-text-checkboxes>\n            <span ng-show="(isCheckboxes() || isRadios()) && isTerminology()">Checkboxes and radios not yet implemented for terminology.</span>\n            <!--<ehr-coded-text-combo ng-if="isCombo()"></ehr-coded-text-combo>-->\n            <ehr-coded-text-radio ng-if="isRadios()"></ehr-coded-text-radio>\n            <ehr-coded-text-component ng-if="!isRadios() && !isCheckboxes()"></ehr-coded-text-component>\n        </div>\n        <div class="content-end-position-holder"></div>\n\n    </div>\n\n\n</div>\n\n');
}]),angular.module("thinkehr/f4/templates/ehr-component-element-switch.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-component-element-switch.html",'<div ehr-component-placeholders ng-if="::(!model.isContainer() && !model.getViewConfig().hasTag(\'noRender\'))" ng-switch on="::model.getRmType().toString()" ng-if="::!model.getViewConfig().hasTag(\'noRender\')">\n    <ehr-coded-text id="{{::model.getUniqueId()}}" data-ehr-path="{{::model.getPath()}}" data-ehr-name="{{::model.getName()}}"\n                    ng-switch-when="DV_CODED_TEXT"></ehr-coded-text>\n    <ehr-quantity id="{{::model.getUniqueId()}}" data-ehr-path="{{::model.getPath()}}" data-ehr-name="{{::model.getName()}}"\n                  ng-switch-when="DV_QUANTITY"></ehr-quantity>\n    <ehr-text id="{{::model.getUniqueId()}}" data-ehr-path="{{::model.getPath()}}" data-ehr-name="{{::model.getName()}}" ng-switch-when="DV_TEXT"></ehr-text>\n\n    <ehr-uri id="{{::model.getUniqueId()}}" data-ehr-path="{{::model.getPath()}}" data-ehr-name="{{::model.getName()}}"\n             ng-switch-when="DV_URI"></ehr-uri>\n   <ehr-ehr-uri id="{{::model.getUniqueId()}}" data-ehr-path="{{::model.getPath()}}" data-ehr-name="{{::model.getName()}}"\n             ng-switch-when="DV_EHR_URI"></ehr-ehr-uri>\n   <ehr-multimedia id="{{::model.getUniqueId()}}" data-ehr-path="{{::model.getPath()}}" data-ehr-name="{{::model.getName()}}"\n             ng-switch-when="DV_MULTIMEDIA"></ehr-multimedia>\n    <ehr-proportion id="{{::model.getUniqueId()}}" data-ehr-path="{{::model.getPath()}}" data-ehr-name="{{::model.getName()}}"\n                    ng-switch-when="DV_PROPORTION"></ehr-proportion>\n    <ehr-date id="{{::model.getUniqueId()}}" data-ehr-path="{{::model.getPath()}}" data-ehr-name="{{::model.getName()}}"\n              ng-switch-when="DV_DATE"></ehr-date>\n    <ehr-time id="{{::model.getUniqueId()}}" data-ehr-path="{{::model.getPath()}}" data-ehr-name="{{::model.getName()}}"\n              ng-switch-when="DV_TIME"></ehr-time>\n    <ehr-date-time id="{{::model.getUniqueId()}}" data-ehr-path="{{::model.getPath()}}" data-ehr-name="{{::model.getName()}}"\n                   ng-switch-when="DV_DATE_TIME"></ehr-date-time>\n    <ehr-boolean id="{{::model.getUniqueId()}}" data-ehr-path="{{::model.getPath()}}" data-ehr-name="{{::model.getName()}}"\n                 ng-switch-when="DV_BOOLEAN"></ehr-boolean>\n    <ehr-ordinal id="{{::model.getUniqueId()}}" data-ehr-path="{{::model.getPath()}}" data-ehr-name="{{::model.getName()}}"\n                 ng-switch-when="DV_ORDINAL"></ehr-ordinal>\n    <ehr-count id="{{::model.getUniqueId()}}" data-ehr-path="{{::model.getPath()}}" data-ehr-name="{{::model.getName()}}"\n               ng-switch-when="DV_COUNT"></ehr-count>\n    <ehr-duration id="{{::model.getUniqueId()}}" data-ehr-path="{{::model.getPath()}}" data-ehr-name="{{::model.getName()}}"\n                  ng-switch-when="DV_DURATION"></ehr-duration>\n    <ehr-custom id="{{::model.getUniqueId()}}" data-ehr-path="{{::model.getPath()}}" data-ehr-name="{{::customName()}}"\n                ng-switch-when="CUSTOM"></ehr-custom>\n    <ehr-unknown data-ehr-path="{{::model.getPath()}}" data-ehr-name="{{::model.getName()}}" ng-switch-default></ehr-unknown>\n</div>\n\n\n')}]),angular.module("thinkehr/f4/templates/ehr-count.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-count.html",'<div\n        class="ehr-count ehr-line"\n        data-ehr-path="{{::model.getPath()}}"\n        data-ehr-name="{{::model.getName()}}"\n        ng-hide="EhrLayoutHelper.isFieldHidden(this)"\n        ng-class="::EhrLayoutHelper.computeEhrLineClass(model)"\n        ehr-single-field-multi-holder="countValue">\n    <ehr-label class="ehr-label-content" ng-class="::EhrLayoutHelper.computeEhrLabelContentClass(model)">\n        <span class="label-start-position-holder"></span>\n        <span ng-if="!suppressLabel" ng-class="{\'mandatory-field-label\': model.isRequired()}"><span class="ehr-label-text"> {{model.labelFor(EhrContext.language)}}</span><span class="multiplicity-label" ng-class="{\'show-multiplicity\': !model.isRequired() && !model.isOptional()}"> {{::model.getViewConfig().getMultiplicityString()}}</span>:</span>\n        <span class="label-end-position-holder"></span>\n    </ehr-label>\n    <div class="ehr-field-content">\n\n        <div class="content-start-position-holder"></div>\n        <div class="field-content-holder">\n            <div ehr-count-field  ehr-single-field-multi-item="" ng-repeat="textVal in singleFieldMultiValuesList track by $index" class="input-wrap">\n                <input\n                        kendo-numeric-text-box="{{::kendoName()}}"\n                        type="number"\n                        name="{{::countName()}}"\n                        class="ehr-count-input hide-in-ehr-view-mode"\n                        ng-model="countFieldValue"\n                        ng-model-options="{ getterSetter: true, updateOn: \'default blur\', debounce: {\'default\': 100, \'blur\': 0}, allowInvalid: true}"\n                        k-options="countOptions"\n                        ng-readonly="model.getViewConfig().isReadOnly()"\n                        ng-class="::EhrLayoutHelper.computeFieldClass(model)"\n                        ng-hide="EhrLayoutHelper.isFieldHidden(this)"\n                        ng-required="::model.isRequired()"\n                        ehr-ng-min="::minValue"\n                        ehr-ng-min-op="\'>=\'"\n                        ehr-ng-min-listen="false"\n                        ehr-ng-max="::maxValue"\n                        ehr-ng-max-op="\'<=\'"\n                        ehr-ng-max-listen="false"\n                        >\n\n                <span class="show-in-ehr-view-mode">{{countFieldValue()}}</span>\n                <ehr-single-field-multi-controls></ehr-single-field-multi-controls>\n                <span class="ehr-validation-error-msg" ng-messages="showErrorMessage()"><span ng-messages-include="thinkehr/f4/templates/ehr-validation-msg.html"></span></span>\n            </div>\n        </div>\n        <div class="content-end-position-holder"></div>\n\n    </div>\n\n</div>\n')}]),angular.module("thinkehr/f4/templates/ehr-custom.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-custom.html",'<div\n        class="ehr-custom ehr-line"\n        data-ehr-path="{{::model.getPath()}}"\n        data-ehr-name="{{::customName()}}"\n        ng-hide="model.getDelegateModel().getViewConfig().isHidden()"\n        ng-class="::EhrLayoutHelper.computeEhrLineClass(model.getDelegateModel())">\n\n    <ehr-label class="ehr-label-content" ng-class="EhrLayoutHelper.computeEhrLabelContentClass(model.getDelegateModel())">\n        <span class="label-start-position-holder"></span>\n        <span ng-if="!suppressLabel" ng-class="{\'mandatory-field-label\': model.getDelegateModel().isRequired()}"><span class="ehr-label-text"> {{model.getDelegateModel().labelFor(EhrContext.language)}}</span><span class="multiplicity-label" ng-class="{\'show-multiplicity\': !model.isRequired() && !model.isOptional()}"> {{::model.getViewConfig().getMultiplicityString()}}</span>:</span>\n        <span class="label-end-position-holder"></span>\n    </ehr-label>\n\n    <div class="ehr-field-content custom"></div>\n</div>')}]),angular.module("thinkehr/f4/templates/ehr-date-time.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-date-time.html",'<div class="ehr-date-time ehr-line"\n        data-ehr-path="{{::model.getPath()}}"\n        data-ehr-name="{{::model.getName()}}"\n        ng-hide="EhrLayoutHelper.isFieldHidden(this)"\n        ng-class="::EhrLayoutHelper.computeEhrLineClass(model)"\n        ehr-single-field-multi-holder="dateTimeValue">\n    <ehr-label class="ehr-label-content" ng-class="::EhrLayoutHelper.computeEhrLabelContentClass(model)">\n        <span class="label-start-position-holder"></span>\n        <span ng-if="!suppressLabel" ng-class="{\'mandatory-field-label\': model.isRequired()}"><span class="ehr-label-text"> {{model.labelFor(EhrContext.language)}}</span><span class="multiplicity-label" ng-class="{\'show-multiplicity\': !model.isRequired() && !model.isOptional()}"> {{::model.getViewConfig().getMultiplicityString()}}</span>:</span>\n        <span class="label-end-position-holder"></span>\n    </ehr-label>\n    <div class="ehr-field-content">\n\n        <div class="content-start-position-holder"></div>\n        <div class="field-content-holder">\n            <div ehr-date-time-field  ehr-single-field-multi-item="" ng-repeat="textVal in singleFieldMultiValuesList track by $index" class="input-wrap">\n            <input\n                    ehr-date-time-formatter=""\n                    kendo-date-time-picker="{{::kendoName()}}"\n                    type="datetime-local"\n                    name="{{::dateTimeName()}}"\n                    class="ehr-date-time-input hide-in-ehr-view-mode"\n                    k-ng-model="dateTimeObject"\n                    ng-model="_dateTimeObject"\n                    ng-model-options="{ debounce: 100, allowInvalid: true }"\n                    k-options="dateTimeOptions"\n                    ng-readonly="model.getViewConfig().isReadOnly()"\n                    ng-class="::EhrLayoutHelper.computeFieldClass(model)"\n                    ng-hide="model.getViewConfig().isHidden()"\n                    ng-required="::model.isRequired()"\n                    >\n            <span class="show-in-ehr-view-mode">{{toUIFormattedDateTime(_dateTimeObject)}}</span>\n            <ehr-single-field-multi-controls></ehr-single-field-multi-controls>\n            <span class="ehr-validation-error-msg" ng-messages="showErrorMessage()"><span ng-messages-include="thinkehr/f4/templates/ehr-validation-msg.html"></span></span>\n        </div>\n        </div>\n        <div class="content-end-position-holder"></div>\n\n    </div>\n\n</div>\n')}]),angular.module("thinkehr/f4/templates/ehr-date.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-date.html",'<div\n        class="ehr-date ehr-line"\n        data-ehr-path="{{::model.getPath()}}"\n        data-ehr-name="{{::model.getName()}}"\n        ng-hide="EhrLayoutHelper.isFieldHidden(this)"\n        ng-class="::EhrLayoutHelper.computeEhrLineClass(model)"\n        ehr-single-field-multi-holder="dateValue">\n    <ehr-label class="ehr-label-content" ng-class="::EhrLayoutHelper.computeEhrLabelContentClass(model)">\n        <span class="label-start-position-holder"></span>\n        <span ng-if="!suppressLabel" ng-class="{\'mandatory-field-label\': model.isRequired()}"><span class="ehr-label-text"> {{model.labelFor(EhrContext.language)}}</span><span class="multiplicity-label" ng-class="{\'show-multiplicity\': !model.isRequired() && !model.isOptional()}"> {{::model.getViewConfig().getMultiplicityString()}}</span>:</span>\n        <span class="label-end-position-holder"></span>\n    </ehr-label>\n    <div class="ehr-field-content">\n\n        <div class="content-start-position-holder"></div>\n        <div class="field-content-holder">\n            <div ehr-date-field  ehr-single-field-multi-item="" ng-repeat="textVal in singleFieldMultiValuesList track by $index" class="input-wrap">\n            <input\n                    ehr-date-formatter=""\n                    kendo-date-picker="{{::kendoName()}}"\n                    type="date"\n                    name="{{::dateName()}}"\n                    class="ehr-date-input hide-in-ehr-view-mode"\n                    k-ng-model="dateObject"\n                    ng-model="_dateObject"\n                    ng-model-options="{ debounce: 100, allowInvalid: true }"\n                    k-options="dateOptions"\n                    ng-readonly="model.getViewConfig().isReadOnly()"\n                    ng-class="::EhrLayoutHelper.computeFieldClass(model)"\n                    ng-hide="model.getViewConfig().isHidden()"\n                    ng-required="::model.isRequired()"\n                    ehr-date-pattern-validator=""\n                    >\n            <span class="show-in-ehr-view-mode">{{toUIFormattedDate(_dateObject)}}</span>\n            <ehr-single-field-multi-controls></ehr-single-field-multi-controls>\n            <span class="ehr-validation-error-msg" ng-messages="showErrorMessage()"><span ng-messages-include="thinkehr/f4/templates/ehr-validation-msg.html"></span></span>\n        </div>\n        </div>\n        <div class="content-end-position-holder"></div>\n\n    </div>\n\n</div>\n')}]),angular.module("thinkehr/f4/templates/ehr-duration-validation-field.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-duration-validation-field.html",'<span ng-message="min" class="k-widget k-tooltip k-tooltip-validation k-invalid-msg">\n    <span class="k-icon k-warning"></span>\n    {{EhrDictionary.messageFormat("validation.min.duration", {\n        "field": fieldLabel(input.getSuffix()),\n        "min": minValueFor(input.getSuffix()),\n        "minOp": minOperatorFor(input.getSuffix())},\n        EhrContext.language)}}\n</span>\n<span ng-message="max" class="k-widget k-tooltip k-tooltip-validation k-invalid-msg">\n    <span class="k-icon k-warning"></span>\n    {{EhrDictionary.messageFormat("validation.max.duration", {\n        "field": fieldLabel(input.getSuffix()),\n        "max": maxValueFor(input.getSuffix()),\n        "maxOp": maxOperatorFor(input.getSuffix())},\n        EhrContext.language)}}\n</span>')}]),angular.module("thinkehr/f4/templates/ehr-duration-validation-required.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-duration-validation-required.html",'<span ng-message="required" class="k-widget k-tooltip k-tooltip-validation k-invalid-msg">\n    <span class="k-icon k-warning"></span>\n    {{::EhrDictionary.text("validation.required")}}\n</span>\n')}]),angular.module("thinkehr/f4/templates/ehr-duration.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-duration.html",'<div\n        class="ehr-duration ehr-line"\n        data-ehr-path="{{::model.getPath()}}"\n        data-ehr-name="{{::model.getName()}}"\n        ng-hide="EhrLayoutHelper.isFieldHidden(this)"\n        ng-class="::EhrLayoutHelper.computeEhrLineClass(model)"\n        ehr-single-field-multi-holder="durationValue"\n        >\n\n    <ehr-label class="ehr-label-content" ng-class="EhrLayoutHelper.computeEhrLabelContentClass(model)">\n        <span class="label-start-position-holder"></span>\n        <span ng-if="!suppressLabel" ng-class="{\'mandatory-field-label\': model.isRequired()}"><span class="ehr-label-text"> {{model.labelFor(EhrContext.language)}}</span><span class="multiplicity-label" ng-class="{\'show-multiplicity\': !model.isRequired() && !model.isOptional()}"> {{::model.getViewConfig().getMultiplicityString()}}</span>:</span>\n        <span class="label-end-position-holder"></span>\n    </ehr-label>\n    <div class="ehr-duration-row" ng-class="::EhrLayoutHelper.computeFieldClass(model)">\n\n        <div class="content-start-position-holder"></div>\n        <div class="field-content-holder">\n            <div ehr-duration-field  ehr-single-field-multi-item="" ng-repeat="durVal in singleFieldMultiValuesList track by $index">\n            <div class="ehr-field-content" ng-class=" ::EhrLayoutHelper.computeFieldClass(model)">\n\n                    <div class="ehr-column-wrapper" ng-repeat="col in ::columns()" ng-class=" ::EhrLayoutHelper.computeFieldClass(model)">\n                        <div class="ehr-duration-column">\n                            <!-- TODO change how hidden works if only hidden rows in column - it still displays the column gap -->\n                            <div class="ehr-row-wrapper" ng-repeat="input in col" ng-hide="model.isFieldHidden(input.getSuffix())">\n                                <div class="ehr-duration-input-label-wrapper">\n                                    <label class="ehr-duration-field-label ehr-infield-label">{{::fieldLabel(input.getSuffix())}}</label>\n                                    <ehr-label-gap></ehr-label-gap>\n\n                                    <div class="kendo-input-wrapper">\n                                        <!-- This one is necessary due to some kendo bug that stretches the input field to two lines if the parent container is flex -->\n                                        <input\n                                                kendo-numeric-text-box="{{::kendoName()}}_{{::input.getSuffix()}}"\n                                                type="number"\n                                                name="{{::durationName(input.getSuffix())}}"\n                                                class="ehr-duration-input hide-in-ehr-view-mode"\n                                                k-options="durationOptions"\n                                                k-placeholder="fieldPlaceholder(input.getSuffix())"\n                                                ng-class="::durationInputClass(input.getSuffix())"\n                                                ng-model="durationFieldInputValue[input.getSuffix()]"\n                                                ng-model-options="{ getterSetter: true, updateOn: \'default blur\', debounce: {\'default\': 100, \'blur\': 0}, allowInvalid: true}"\n                                                ng-readonly="model.getViewConfig().isReadOnly()"\n                                                ng-disabled="model.isFieldDisabled(input.getSuffix())"\n                                                ng-required="model.isFieldRequired(currMultiIndex)"\n                                                ehr-ng-min="::minValueFor(input.getSuffix())"\n                                                ehr-ng-min-op="::minOperatorFor(input.getSuffix())"\n                                                ehr-ng-max="::maxValueFor(input.getSuffix())"\n                                                ehr-ng-max-op="::maxOperatorFor(input.getSuffix())"\n                                                >\n                                    </div>\n                                    <span class="show-in-ehr-view-mode">{{durationFieldInputValue[input.getSuffix()]()}}</span>\n                                </div>\n                                <div class="ehr-error-wrapper" ng-if="showErrorMessageField(input.getSuffix())">\n                                    <ehr-row-gap></ehr-row-gap>\n                                    <span class="ehr-validation-error-msg" ng-messages="showErrorMessageField(input.getSuffix())">\n                                        <span ng-messages-include="thinkehr/f4/templates/ehr-duration-validation-field.html"></span>\n                                    </span>\n                                </div>\n                                <ehr-row-gap last="$last"></ehr-row-gap>\n                            </div>\n\n                        </div>\n                        <ehr-column-gap last="$last" ng-hide="isHiddenColumn(col)"></ehr-column-gap>\n                    </div>\n                <!--<span class="show-in-ehr-view-mode">\n                    <span  ng-repeat="col in ::columns()">\n                        <span  ng-repeat="input in col" ng-show="durationFieldInputValue[input.getSuffix()]()>0">\n                            {{durationFieldInputValue[input.getSuffix()]()}} {{::fieldLabel(input.getSuffix())}}\n                            <div class="ehr-error-wrapper" ng-if="showErrorMessageField(input.getSuffix())">\n                                <ehr-row-gap></ehr-row-gap>\n                                <span class="ehr-validation-error-msg" ng-messages="showErrorMessageField(input.getSuffix())">\n                                    <span ng-messages-include="thinkehr/f4/templates/ehr-duration-validation-field.html"></span>\n                                </span>\n                            </div>\n                        </span>\n                    </span>\n\n                </span>-->\n\n                <ehr-single-field-multi-controls></ehr-single-field-multi-controls>\n\n                <div class="ehr-error-wrapper" ng-if="showErrorMessageRequired()">\n                    <ehr-label-gap></ehr-label-gap>\n                    <span class="ehr-validation-error-msg" ng-messages="showErrorMessageRequired()">\n                        <span ng-messages-include="thinkehr/f4/templates/ehr-duration-validation-required.html"></span>\n                    </span>\n                </div>\n            </div>\n        </div>\n        </div>\n        <div class="content-end-position-holder"></div>\n\n    </div>\n</div>\n')}]),angular.module("thinkehr/f4/templates/ehr-ehr-uri-text-area.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-ehr-uri-text-area.html",'<div class="input-wrap">\n        <textarea\n        class="ehr-text-input  ehr-uri-text-area area k-textbox hide-in-ehr-view-mode"\n        name="{{getFieldName()}}"\n        rows="{{::rows()}}"\n        ng-readonly="model.getViewConfig().isReadOnly()"\n        ng-hide="EhrLayoutHelper.isFieldHidden(this)"\n        ng-model="ehrUriFieldValue"\n        ng-model-options="{ getterSetter: true, allowInvalid: true}"\n        ng-class="::EhrLayoutHelper.computeFieldClass(model)"\n        ng-required="::model.isRequired()"\n        ng-pattern="::model.getEhrUriPattern()"\n        ehr-placeholder="{{model.annotationValue(\'placeholder\')}}"></textarea>\n\n        <span class="show-in-ehr-view-mode">{{ehrUriFieldValue()}}</span>\n        <ehr-single-field-multi-controls></ehr-single-field-multi-controls>\n        <span class="ehr-validation-error-msg" ng-messages="showErrorMessage()"><span ng-messages-include="thinkehr/f4/templates/ehr-validation-msg.html"></span></span>\n</div>')}]),angular.module("thinkehr/f4/templates/ehr-ehr-uri-text-field.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-ehr-uri-text-field.html",'<div class="input-wrap">\n        <input\n        type="text"\n        name="{{getFieldName()}}"\n        class="ehr-text-input ehr-uri-text-field field k-textbox hide-in-ehr-view-mode"\n        ng-readonly="model.getViewConfig().isReadOnly()"\n        ng-hide="EhrLayoutHelper.isFieldHidden(this)"\n        ng-model="ehrUriFieldValue" ng-model-options="{ getterSetter: true, allowInvalid: true }"\n        ng-class="::EhrLayoutHelper.computeFieldClass(model)"\n        ng-required="::model.isRequired()"\n        ng-pattern="::model.getEhrUriPattern()"\n        ehr-placeholder="{{model.annotationValue(\'placeholder\')}}"\n        />\n        <span class="show-in-ehr-view-mode">{{ehrUriFieldValue()}}</span>\n        <ehr-single-field-multi-controls></ehr-single-field-multi-controls>\n        <span class="ehr-validation-error-msg" ng-messages="showErrorMessage()"><span ng-messages-include="thinkehr/f4/templates/ehr-validation-msg.html"></span></span>\n</div>')}]),angular.module("thinkehr/f4/templates/ehr-ehr-uri.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-ehr-uri.html",'<div\n        class="ehr-text ehr-uri ehr-line"\n        data-ehr-path="{{::model.getPath()}}"\n        data-ehr-name="{{::model.getName()}}"\n        ng-hide="EhrLayoutHelper.isFieldHidden(this)"\n        ng-class="::EhrLayoutHelper.computeEhrLineClass(model)"\n        ehr-single-field-multi-holder="ehrUriValue"\n        >\n    <ehr-label class="ehr-label-content" ng-class="::EhrLayoutHelper.computeEhrLabelContentClass(model)">\n        <span class="label-start-position-holder"></span>\n        <span ng-if="!suppressLabel" ng-class="{\'mandatory-field-label\': model.isRequired()}"><span class="ehr-label-text"> {{model.labelFor(EhrContext.language)}}</span><span class="multiplicity-label" ng-class="{\'show-multiplicity\': !model.isRequired() && !model.isOptional()}"> {{::model.getViewConfig().getMultiplicityString()}}</span>:</span>\n        <span class="label-end-position-holder"></span>\n    </ehr-label>\n    <div class="ehr-field-content">\n\n        <div class="content-start-position-holder"></div>\n        <div class="field-content-holder">\n            <!--<textarea ng-model="textValue" ng-model-options="{ getterSetter: true }" rows="1" cols="30"></textarea>-->\n            <ehr-ehr-uri-text-field ng-if="::isTextField()" ehr-single-field-multi-item="" ng-repeat="textVal in singleFieldMultiValuesList track by $index"></ehr-ehr-uri-text-field>\n            <ehr-ehr-uri-text-area ng-if="::isTextArea()" ehr-single-field-multi-item="" ng-repeat="textVal in singleFieldMultiValuesList track by $index"></ehr-ehr-uri-text-area>\n        </div>\n        <div class="content-end-position-holder"></div>\n\n    </div>\n\n</div>\n')}]),angular.module("thinkehr/f4/templates/ehr-form.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-form.html",'<form ng-cloak class="ehr-form" name="{{formName()}}" novalidate="novalidate" ng-submit="validateEhrForm($event)">\n    <div frang-tree ng-if="!freeLayout">\n        <div ehr-tab-container-level class="ehr-disable-possible" ng-class="formContainerClass()">\n            <div class="ehr-glass-panel ehr-form-glass-panel"></div>\n            <div frang-tree-repeat="model in model.childModels">\n\n                <ehr-container class="" ehr-component-placeholders ng-if="( (model.isContainer() && !isTabContainer(model) && !model.getViewConfig().hasTag(\'noRender\')) || ( isTabContainer(model) && getTabObj(model)==tabGroupSelection[getTabObj(model).tabGroupId] ) || ehrFormCtrl.getWasTabSelected(model.getPath()) )"  ng-hide="model.getViewConfig().isHidden() || ( isTabContainer(model) && getTabObj(model)!=tabGroupSelection[getTabObj(model).tabGroupId] )" ng-class="{\'no-border\':model.getViewConfig().advanced.hideFrame}">\n\n                    <div class="ehr-container ehr-disable-possible" data-ehr-path="{{::model.getPath()}}" id="{{::model.getUniqueId()}}"\n                         data-ehr-name="{{::model.getName()}}"\n                         ng-form="{{::model.getElementName()}}"\n                         ng-hide="model.getViewConfig().isHidden()" ng-class="containerClass()">\n                        <div class="ehr-glass-panel"></div>\n                        <div class="ehr-container-bar k-header" ng-init="showControls(true)" ng-hide="\'{{::model.getRmType()}}\'==\'GENERIC_COMPOSITE_FIELD\' || model.getViewConfig().advanced.hideFrame">\n\n                            <span class="label-start-position-holder">\n                                <i class="fa fa-angle-down k-sprite expand-arrow-icon"></i>\n                            </span>\n\n                            <span class="ehr-container-label">\n                                <span ng-if="!suppressLabel && !_isTabContainer" class="ehr-label-text">{{::model.labelFor(EhrContext.language)}}</span>\n                                <ehr-tab-container-title ehr-context="EhrContext" ng-if="_isTabContainer" ng-repeat="tabObj in getTabGroupArrForModel(model) track by $index" tab-obj="tabObj" ng-class="{selected:isTabObjSelected(tabObj)}"></ehr-tab-container-title>\n                                <span ng-if="::supportsMulti() && !_isTabContainer" ng-show="showControls()" class="multi-container-position-label">{{getMultiNumberText(getMultiIndex()+1)}}</span>\n                                <span class="multiplicity-label" ng-class="{\'show-multiplicity\': !model.isRequired() && !model.isOptional() && !_isTabContainer} "> {{::model.getViewConfig().getMultiplicityString()}}</span>\n                            </span>\n\n                            <span class="label-end-position-holder">\n                                <div class="ehr-container-controls hide-in-ehr-view-mode" ng-if="::supportsMulti() && !_isTabContainer" ng-show="showControls()">\n                                    <button kendo-button type="button" class="ehr-duplicate-container-btn" ng-click="duplicateContainer()" ng-disabled="!duplicationEnabled()">+</button>\n                                    <button kendo-button type="button" class="ehr-remove-container-btn" ng-click="removeContainer()" ng-disabled="!removalEnabled()">-</button>\n                                </div>\n                            </span>\n\n                        </div>\n                        <div ng-show="!!hiddenContainerContentStyle" class="container-render-progress">{{renderProgressText}}</div>\n                        <div ehr-tab-container-level ng-style="hiddenContainerContentStyle">\n                            <div frang-tree-insert-children="model.childModels"  ng-if="model.childModels && model.childModels.length > 0"></div>\n                        </div>\n                    </div>\n                </ehr-container>\n                <ehr-component-element-switch></ehr-component-element-switch>\n            </div>\n        </div>\n    </div>\n    <!--<ehr-recursive-element ng-if="!freeLayout"></ehr-recursive-element>-->\n</form>')}]),angular.module("thinkehr/f4/templates/ehr-free-layout-component.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-free-layout-component.html",'<div ng-if="model!=null" class="ehr-free-layout-component" data-ehr-path="{{::model.getPath()}}" id="{{::model.getUniqueId()}}"\n     data-ehr-name="{{::model.getName()}}"\n     ng-form="{{::model.getElementName()}}"\n     ng-hide="model.getViewConfig().isHidden()" ng-class="containerClass()">\n    <ehr-component-element-switch></ehr-component-element-switch>\n</div>\n<div class="free-layout-model-not-found" ng-if="!model && modelNotFoundDictCode">{{EhrDictionary.messageFormat(modelNotFoundDictCode, {queryStr:modelQueryStr}, EhrContext.language)}}</div>')}]),angular.module("thinkehr/f4/templates/ehr-label.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-label.html",'<label class="ehr-label" ng-transclude></label>')}]),angular.module("thinkehr/f4/templates/ehr-multimedia-field.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-multimedia-field.html",'<div class="input-wrap">\n        <div class="media-content" ng-switch="getMediaType()">\n                <a ng-switch-when="MEDIA_TYPE_IMAGE" ng-href="{{uriValue() | trustUrl}}" target="_blank">\n                    <img class="image-media" ng-src="{{uriValue()}}"/>\n                </a>\n                <video ng-switch-when="MEDIA_TYPE_VIDEO" class="video-media" controls>\n                        <source ng-src="{{uriValue() | trustUrl}}" type="{{getMimeType(uriValue())}}">\n                        Your browser does not support the video tag.\n                </video>\n                <audio ng-switch-when="MEDIA_TYPE_AUDIO" class="audio-media" controls>\n                        <source ng-src="{{uriValue() | trustUrl}}" type="{{getMimeType(uriValue())}}">\n                        Your browser does not support the audio element.\n                </audio>\n                <div ng-sitch-default class="no-media"></div>\n        </div>\n\n        <input\n        type="text"\n        name="{{::uriName()}}"\n        class="ehr-text-input ehr-multimedia-input field k-textbox hide-in-ehr-view-mode"\n        ng-readonly="model.getViewConfig().isReadOnly()"\n        ng-hide="EhrLayoutHelper.isFieldHidden(this)"\n        ng-model="uriValue" ng-model-options="{ getterSetter: true, allowInvalid: true }"\n        ng-class="::EhrLayoutHelper.computeFieldClass(model)"\n        ng-required="::model.isRequired()"\n        ehr-placeholder="{{model.annotationValue(\'placeholder\')}}"\n        />\n\n        <span class="ehr-validation-error-msg" ng-messages="showErrorMessage()"><span ng-messages-include="thinkehr/f4/templates/ehr-validation-msg.html"></span></span>\n\n        <div class="mime-edit-toggle hide-in-ehr-view-mode" ng-click="_view._editMime=!_view._editMime" ng-hide="getFileSuffix(uriValue())">mime: <span ng-hide="_view._editMime">{{mimeTypeValue()}}</span></div>\n\n        <input\n        type="text"\n        name="{{::mimeTypeName()}}"\n        class="ehr-text-input ehr-multimedia-mime-type-input field k-textbox hide-in-ehr-view-mode"\n        ng-readonly="model.getViewConfig().isReadOnly()"\n        ng-hide="model.getViewConfig().isHidden() || !_view._editMime || getFileSuffix(uriValue())"\n        ng-model="mimeTypeValue" ng-model-options="{ getterSetter: true, allowInvalid: true }"\n        ng-class="::EhrLayoutHelper.computeFieldClass(model)"\n        />\n\n        <ehr-single-field-multi-controls></ehr-single-field-multi-controls>\n\n</div>');
}]),angular.module("thinkehr/f4/templates/ehr-multimedia.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-multimedia.html",'<div\n        class="ehr-multimedia ehr-line"\n        data-ehr-path="{{::model.getPath()}}"\n        data-ehr-name="{{::model.getName()}}"\n        ng-hide="EhrLayoutHelper.isFieldHidden(this)"\n        ng-class="::EhrLayoutHelper.computeEhrLineClass(model)"\n        ehr-single-field-multi-holder="uriValue"\n        >\n    <ehr-label class="ehr-label-content" ng-class="::EhrLayoutHelper.computeEhrLabelContentClass(model)">\n        <span class="label-start-position-holder"></span>\n        <span ng-if="!suppressLabel" ng-class="{\'mandatory-field-label\': model.isRequired()}"><span class="ehr-label-text"> {{model.labelFor(EhrContext.language)}}</span><span class="multiplicity-label" ng-class="{\'show-multiplicity\': !model.isRequired() && !model.isOptional()}"> {{::model.getViewConfig().getMultiplicityString()}}</span>:</span>\n        <span class="label-end-position-holder"></span>\n    </ehr-label>\n    <div class="ehr-field-content">\n\n        <div class="content-start-position-holder"></div>\n        <div class="field-content-holder">\n            <ehr-multimedia-field ehr-single-field-multi-item="" ng-repeat="multimF in singleFieldMultiValuesList track by $index"></ehr-multimedia-field>\n            <div class="multimedia-upload"></div>\n        </div>\n        <div class="content-end-position-holder"></div>\n\n    </div>\n\n</div>\n')}]),angular.module("thinkehr/f4/templates/ehr-other-input.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-other-input.html",'<div class="ehr-other" ng-hide="EhrLayoutHelper.isFieldHidden(this)">\n    <label class="ehr-text-other-span">\n        <span class="ehr-other-label hide-in-ehr-view-mode">{{::EhrDictionary.text("other")}}:</span>\n        <input\n                type="text"\n                name="{{::otherFieldName()}}"\n                class="ehr-text-input field other k-textbox hide-in-ehr-view-mode"\n                ng-model="otherValue"\n                ng-model-options="{ getterSetter: true, debounce: 100, allowInvalid:true }"\n                ng-readonly="model.getViewConfig().isReadOnly()"\n                ng-hide="model.getViewConfig().isHidden()"\n                ng-required="otherRequired()"\n                ehr-placeholder="{{model.annotationValue(\'placeholder\')}}"\n                />\n\n        <span class="show-in-ehr-view-mode">{{otherValue()}}</span>\n    </label>\n</div>')}]),angular.module("thinkehr/f4/templates/ehr-proportion.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-proportion.html",'<div\n        class="ehr-proportion ehr-line"\n        data-ehr-path="{{::model.getPath()}}"\n        data-ehr-name="{{::model.getName()}}"\n        ng-hide="EhrLayoutHelper.isFieldHidden(this)"\n        ng-class="::EhrLayoutHelper.computeEhrLineClass(model)"\n        ehr-single-field-multi-holder="proportionValue">\n\n    <ehr-label class="ehr-label-content" ng-class="::EhrLayoutHelper.computeEhrLabelContentClass(model)">\n        <span class="label-start-position-holder"></span>\n        <span ng-if="!suppressLabel" ng-class="{\'mandatory-field-label\': model.isRequired()}"><span class="ehr-label-text"> {{model.labelFor(EhrContext.language)}}</span><span class="multiplicity-label" ng-class="{\'show-multiplicity\': !model.isRequired() && !model.isOptional()}"> {{::model.getViewConfig().getMultiplicityString()}}</span>:</span>\n        <span class="label-end-position-holder"></span>\n    </ehr-label>\n    <div class="ehr-field-content">\n\n        <div class="content-start-position-holder"></div>\n        <div class="field-content-holder">\n            <div ehr-proportion-field  ehr-single-field-multi-item="" ng-repeat="propVal in singleFieldMultiValuesList track by $index" class="input-wrap">\n            <!--k-rebind="magnitudeOptions" Add this option for rebinding if kendo ever fixes the bug with TypeError on rebind -->\n            <!-- Then disable the precision watcher in the controller -->\n            <input\n                    ehr-number-formatter="decimal"\n                    kendo-numeric-text-box="{{::kendoNumName()}}"\n                    name="{{::numeratorName()}}"\n                    type="number"\n                    k-options="numeratorOptions"\n                    class="ehr-number ehr-proportion ehr-numerator hide-in-ehr-view-mode"\n                    ng-class="::computeFieldClass()"\n                    ng-readonly="model.getViewConfig().isReadOnly()"\n                    ng-model="numeratorValue"\n                    ng-model-options="{ getterSetter: true, updateOn: \'default blur\', debounce: {\'default\': 100, \'blur\': 0}, allowInvalid: true}"\n                    ng-required="::model.isRequired()"\n                    ehr-ng-min="::numeratorMinValue"\n                    ehr-ng-min-op="::numeratorMinValueOp"\n                    ehr-ng-min-listen="false"\n                    ehr-ng-max="::numeratorMaxValue"\n                    ehr-ng-max-op="::numeratorMaxValueOp"\n                    ehr-ng-max-listen="false"\n                    >\n            <span class="show-in-ehr-view-mode">{{numeratorValue()}}</span>\n            <span class="ehr-proportion-separator" ng-if="::!fixedDenominator()">&nbsp;/&nbsp;</span>\n            <!-- Has to be ng-show, because ng-if causes problems with model binding, probably kendo-related -->\n            <input\n                    ehr-number-formatter="decimal"\n                    kendo-numeric-text-box="{{::kendoDenName()}}"\n                    name="{{::denominatorName()}}"\n                    type="number"\n                    k-options="denominatorOptions"\n                    class="ehr-number ehr-proportion ehr-denominator hide-in-ehr-view-mode"\n                    ng-class="::computeFieldClass()"\n                    ng-readonly="model.getViewConfig().isReadOnly()"\n                    ng-model="denominatorValue"\n                    ng-model-options="{ getterSetter: true, updateOn: \'default blur\', debounce: {\'default\': 100, \'blur\': 0}, allowInvalid: true}"\n                    ng-show="::!fixedDenominator()"\n                    ng-required="::denominatorRequired()"\n                    ehr-ng-min="::denominatorMinValue"\n                    ehr-ng-min-op="::denominatorMinValueOp"\n                    ehr-ng-min-listen="false"\n                    ehr-ng-max="::denominatorMaxValue"\n                    ehr-ng-max-op="::denominatorMaxValueOp"\n                    ehr-ng-max-listen="false"\n                    >\n            <span class="show-in-ehr-view-mode">{{denominatorValue()}}</span>\n            <span class="ehr-percentage-sign" ng-if="::percentage()">&nbsp;&#37;</span>\n\n            <ehr-single-field-multi-controls></ehr-single-field-multi-controls>\n            <span class="ehr-validation-error-msg" ng-messages="showErrorMessage()"><span ng-messages-include="thinkehr/f4/templates/ehr-validation-msg.html"></span></span>\n\n        </div>\n        </div>\n        <div class="content-end-position-holder"></div>\n\n    </div>\n\n</div>\n')}]),angular.module("thinkehr/f4/templates/ehr-quantity.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-quantity.html",'<div\n        class="ehr-quantity ehr-line field-size-small"\n        data-ehr-path="{{::model.getPath()}}"\n        data-ehr-name="{{::model.getName()}}"\n        ng-hide="EhrLayoutHelper.isFieldHidden(this)"\n        ng-class="::EhrLayoutHelper.computeEhrLineClass(model)"\n        ehr-single-field-multi-holder="quantityValue">\n\n    <ehr-label class="ehr-label-content" ng-class="EhrLayoutHelper.computeEhrLabelContentClass(model)">\n        <span class="label-start-position-holder"></span>\n        <span ng-if="!suppressLabel" ng-class="{\'mandatory-field-label\': model.isRequired()}"><span class="ehr-label-text"> {{model.labelFor(EhrContext.language)}}</span><span class="multiplicity-label" ng-class="{\'show-multiplicity\': !model.isRequired() && !model.isOptional()}"> {{::model.getViewConfig().getMultiplicityString()}}</span>:</span>\n        <span class="label-end-position-holder"></span>\n    </ehr-label>\n    <div class="ehr-field-content">\n\n        <div class="content-start-position-holder"></div>\n        <div class="field-content-holder">\n            <div ehr-quantity-field  ehr-single-field-multi-item="" ng-repeat="propVal in singleFieldMultiValuesList track by $index" class="input-wrap">\n            <!--k-rebind="magnitudeOptions" Add this option for rebinding if kendo ever fixes the bug with TypeError on rebind -->\n            <!-- Then disable the precision watcher in the controller -->\n            <input\n                    ehr-number-formatter="decimal"\n                    kendo-numeric-text-box="{{::kendoMagName()}}"\n                    type="number"\n                    name="{{::magnitudeName()}}"\n                    k-options="magnitudeOptions"\n                    class="ehr-number ehr-magnitude hide-in-ehr-view-mode"\n                    ng-class="::EhrLayoutHelper.computeFieldClass(model)"\n                    ng-readonly="model.getViewConfig().isReadOnly()"\n                    ng-model="magnitudeFieldValue"\n                    ng-model-options="{ getterSetter: true, updateOn: \'default blur\', debounce: {\'default\': 100, \'blur\': 0}, allowInvalid: true}"\n                    ng-required="::model.isRequired()"\n                    ehr-ng-min="minValue"\n                    ehr-ng-min-op="minValueOp"\n                    ehr-ng-max="maxValue"\n                    ehr-ng-max-op="maxValueOp"\n                    />\n\n            <select\n                    kendo-combo-box="{{::kendoUnitName()}}"\n                    name="{{::unitName()}}"\n                    class="ehr-combo ehr-unit hide-in-ehr-view-mode"\n                    ng-if="isComboUnit()"\n                    ng-class="::EhrLayoutHelper.computeFieldClass(model)"\n                    ng-readonly="model.getViewConfig().isReadOnly()"\n                    ng-model="unitFieldValue"\n                    ng-model-options="{ getterSetter: true }"\n                    k-filter="\'contains\'"\n                    k-change="unitChanged"\n                    ng-required="unitRequired()"\n                    >\n                <option value=""></option>\n                <option ng-repeat="item in ::list()" value="{{::item.getValue()}}" ng-bind="item.getLabel()"></option>\n            </select>\n\n            <div class="ehr-radio-button-group hide-in-ehr-view-mode" ng-if="isRadiosUnit()">\n                <div class="ehr-radio-button-column"\n                     ng-repeat="unit in ::list()"\n                     ng-class="::EhrLayoutHelper.computeFieldClass(model)">\n                    <label class="ehr-radio-label last-in-column">\n                    <input\n                                type="radio"\n                                class="ehr-radio ehr-unit k-radio"\n                                name="{{::unitRbGroupName()}}"\n                                id="{{::model.getUniqueId()}}_{{unit.getValue()}}_id"\n                                ng-disabled="model.getViewConfig().isReadOnly()"\n                                ng-model="unitFieldValue"\n                                ng-model-options="{ getterSetter: true }"\n                                ng-value="::unit.getValue()"\n                                ng-required="::model.isRequired()"\n                            >\n                        <label class="k-radio-label" for="{{::model.getUniqueId()}}_{{unit.getValue()}}_id" ng-bind="::unit.getLabel()"></label>\n                    </label>\n                </div>\n            </div>\n            <span class="ehr-unit-label ehr-unit hide-in-ehr-view-mode" ng-if="::isLabelUnit()" ng-bind="::list()[0].getLabel()" ng-hide="::hideUnit()"></span>\n\n            <span class="show-in-ehr-view-mode">{{magnitudeFieldValue()}}</span>\n            <span class="show-in-ehr-view-mode">{{unitFieldValue()}}</span>\n            <ehr-single-field-multi-controls></ehr-single-field-multi-controls>\n            <span class="ehr-validation-error-msg" ng-messages="showErrorMessage()"><span ng-messages-include="thinkehr/f4/templates/ehr-validation-msg.html"></span></span>\n\n        </div>\n        </div>\n        <div class="content-end-position-holder"></div>\n\n    </div>\n\n</div>\n')}]),angular.module("thinkehr/f4/templates/ehr-single-field-multi-controls.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-single-field-multi-controls.html",'<span ng-show="isMulti() && !model.getViewConfig().isReadOnly()" class="single-field-multi-buttons hide-in-ehr-view-mode">\n    <span>\n        <button ng-disabled="!(addMultiFieldEnabled() && ( $parent.$last && (singleFieldMultiValuesList.length && !anyTextValueEmpty())) )" ng-click="addMultiField()" class="single-field-multi-button single-field-multi-add">+</button>\n        <button ng-disabled="!(removeMultiFieldEnabled() && (!$parent.$first || (singleFieldMultiValuesList.length>1)) )" ng-click="removeMultiField()" class="single-field-multi-button single-field-multi-remove">-</button>\n    </span>\n</span>')}]),angular.module("thinkehr/f4/templates/ehr-tab-container-title.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-tab-container-title.html",'<a class="ehr-tab-title" ng-click="tabsCtrl.selectTab(tabObj)">{{label}}</a>\n\n')}]),angular.module("thinkehr/f4/templates/ehr-text-area.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-text-area.html",'<div class="input-wrap">\n        <textarea\n                class="ehr-text-input area k-textbox hide-in-ehr-view-mode"\n                name="{{getFieldName()}}"\n                rows="{{::rows()}}"\n                ng-readonly="model.getViewConfig().isReadOnly()"\n                ng-hide="EhrLayoutHelper.isFieldHidden(this)"\n                ng-model="textFieldValue"\n                ng-model-options="{ getterSetter: true, allowInvalid: true }"\n                ng-class="::EhrLayoutHelper.computeFieldClass(model)"\n                ng-required="::model.isRequired()"\n                ehr-placeholder="{{model.annotationValue(\'placeholder\')}}"></textarea>\n        <span class="show-in-ehr-view-mode">{{textFieldValue()}}</span>\n        <ehr-single-field-multi-controls></ehr-single-field-multi-controls>\n        <span class="ehr-validation-error-msg" ng-messages="showErrorMessage()"><span ng-messages-include="thinkehr/f4/templates/ehr-validation-msg.html"></span></span>\n</div>')}]),angular.module("thinkehr/f4/templates/ehr-text-field.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-text-field.html",'<div class="input-wrap">\n        <input\n        type="text"\n        name="{{getFieldName()}}"\n        class="ehr-text-input field k-textbox hide-in-ehr-view-mode"\n        ng-readonly="model.getViewConfig().isReadOnly()"\n        ng-hide="model.getViewConfig().isHidden()"\n        ng-model="textFieldValue"\n        ng-model-options="{ getterSetter: true, allowInvalid: true }"\n        ng-class="::EhrLayoutHelper.computeFieldClass(model)"\n        ng-required="::model.isRequired()"\n        ehr-placeholder="{{model.annotationValue(\'placeholder\')}}"\n        />\n        <span class="show-in-ehr-view-mode">{{textFieldValue()}}</span>\n        <ehr-single-field-multi-controls></ehr-single-field-multi-controls>\n        <span class="ehr-validation-error-msg" ng-messages="showErrorMessage()"><span ng-messages-include="thinkehr/f4/templates/ehr-validation-msg.html"></span></span>\n\n</div>')}]),angular.module("thinkehr/f4/templates/ehr-text-values-combo.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-text-values-combo.html",'<!--<select kendo-combo-box class="ehr-combo" ng-model="codeValue" ng-model-options="{ getterSetter: true }"-->\n<!--ng-options="item.getValue() as item.getLabel() for item in model.getInputFor(\'code\').getList()">-->\n<!--<option value="">&nbsp;</option>-->\n<!--</select>-->\n<div class="input-wrap">\n        <select\n                kendo-combo-box="{{::kendoName()}}"\n                name="{{::textValuesName()}}_{{multiController.getMultiIndex()}}"\n                class="ehr-combo hide-in-ehr-view-mode"\n                ng-class="::EhrLayoutHelper.computeFieldClass(model)"\n                ng-readonly="model.getViewConfig().isReadOnly()"\n                ng-hide="model.getViewConfig().isHidden()"\n                ng-model="textFieldValue"\n                ng-model-options="{ getterSetter: true }"\n                k-filter="\'contains\'"\n                k-change="textChanged"\n                ng-required="::model.isRequired()"\n                >\n            <option value=""></option>\n            <option ng-repeat="item in ::list()" value="{{::item.getValue()}}" ng-bind="::labelText(item)"></option>\n            <option value="__other__" ng-if="::listOpen()">{{::EhrDictionary.text(\'other\')}}&nbsp;&gt;&gt;</option>\n        </select>\n        <!--<input\n                ng-if="::listOpen()"\n                name="{{::otherFieldName()}}"\n                type="text"\n                class="ehr-text-input field other k-textbox"\n                ng-model="otherValue"\n                ng-model-options="{ getterSetter: true, debounce: 100 }"\n                ng-readonly="model.getViewConfig().isReadOnly()"\n                ng-hide="model.getViewConfig().isHidden() || !otherSelected()"\n                ng-required="otherRequired()"\n                >-->\n        <span class="show-in-ehr-view-mode">{{textFieldValue()}}</span>\n        <ehr-single-field-multi-controls></ehr-single-field-multi-controls>\n        <ehr-other-input ng-if="::listOpen()" ng-hide="model.getViewConfig().isHidden() || !otherSelected()" class="ehr-other-include hide-in-ehr-view-mode"></ehr-other-input>\n\n        <span class="ehr-validation-error-msg" ng-messages="showErrorMessage()"><span ng-messages-include="thinkehr/f4/templates/ehr-validation-msg.html"></span></span>\n</div>\n\n')}]),angular.module("thinkehr/f4/templates/ehr-text-values-radio.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-text-values-radio.html",'<div class="input-wrap">\n    <div class="ehr-radio-button-group" ng-hide="model.getViewConfig().isHidden()">\n        <div class="ehr-radio-button-column"\n             ng-repeat="col in columns"\n             ng-style="::elementStyle()"\n             ng-class="::EhrLayoutHelper.computeFieldClass(model)"\n             ng-hide="(isViewMode && isViewMode()) && !anySelectedInColumn(col)"\n        >\n\n            <label class="ehr-radio-label" ng-repeat="itemIndex in col" ng-class="::EhrLayoutHelper.computeLastColumnClass($last, listOpen())">\n                <input\n                    type="radio"\n                    class="ehr-radio k-radio hide-in-ehr-view-mode"\n                    name="ehr_rb_group_{{::textValuesName()}}_{{multiController.getMultiIndex()}}"\n                    id="{{::textValuesName()}}_{{multiController.getMultiIndex()}}_{{list()[itemIndex].getValue()}}_id"\n                    ng-disabled="model.getViewConfig().isReadOnly()"\n                    ng-model="textFieldValue"\n                    ng-model-options="{ getterSetter: true }"\n                    ng-value="::list()[itemIndex].getValue()"\n                    ng-required="radioRequired()"\n                    ng-click="rbClicked()"\n                    ng-blur="rbBlurred()"\n                    >\n\n                <label ng-class="{\'k-radio-label\':!(isViewMode && isViewMode())}" for="{{::textValuesName()}}_{{multiController.getMultiIndex()}}_{{list()[itemIndex].getValue()}}_id" ng-bind="::labelText(list()[itemIndex])"\n                       ng-hide="(isViewMode && isViewMode() && (list()[itemIndex].getValue()!=textFieldValue()))"></label>\n            </label>\n        </div>\n\n        <ehr-single-field-multi-controls></ehr-single-field-multi-controls>\n        <span class="ehr-validation-error-msg" ng-messages="showErrorMessage()"><span ng-messages-include="thinkehr/f4/templates/ehr-validation-msg.html"></span></span>\n        <ehr-other-input ng-if="::listOpen()" class="ehr-other-include" ng-hide="(isViewMode && isViewMode()) && !otherValue()"></ehr-other-input>\n\n    </div>\n</div>\n')}]),angular.module("thinkehr/f4/templates/ehr-text.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-text.html",'<div\n        class="ehr-text ehr-line"\n        data-ehr-path="{{::model.getPath()}}"\n        data-ehr-name="{{::model.getName()}}"\n        ng-hide="EhrLayoutHelper.isFieldHidden(this)"\n        ng-class="::EhrLayoutHelper.computeEhrLineClass(model)"\n        ehr-single-field-multi-holder="textValue"\n        >\n\n    <ehr-label class="ehr-label-content" ng-class="::EhrLayoutHelper.computeEhrLabelContentClass(model)">\n        <span class="label-start-position-holder"></span>\n        <span ng-if="!suppressLabel" ng-class="{\'mandatory-field-label\': model.isRequired()}"><span class="ehr-label-text"> {{model.labelFor(EhrContext.language)}}</span><span class="multiplicity-label" ng-class="{\'show-multiplicity\': !model.isRequired() && !model.isOptional()}"> {{::model.getViewConfig().getMultiplicityString()}}</span>:</span>\n        <span class="label-end-position-holder"></span>\n    </ehr-label>\n    <div class="ehr-field-content">\n        <div class="content-start-position-holder"></div>\n        <div class="field-content-holder">\n            <ehr-text-field ng-if="showTextField()" ehr-single-field-multi-item="" ng-repeat="textVal in singleFieldMultiValuesList track by $index"></ehr-text-field>\n            <ehr-text-area ng-if="showTextArea()" ehr-single-field-multi-item="" ng-repeat="textVal in singleFieldMultiValuesList track by $index"></ehr-text-area>\n            <ehr-text-values-combo ng-if="::isCombo()" ehr-single-field-multi-item="" ng-repeat="textVal in singleFieldMultiValuesList track by $index"></ehr-text-values-combo>\n            <ehr-text-values-radio ng-if="::isRadios()" ehr-single-field-multi-item="" ng-repeat="textVal in singleFieldMultiValuesList track by $index"></ehr-text-values-radio>\n        </div>\n        <div class="content-end-position-holder"></div>\n\n    </div>\n</div>\n')}]),angular.module("thinkehr/f4/templates/ehr-time.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-time.html",'<div\n        class="ehr-time ehr-line"\n        data-ehr-path="{{::model.getPath()}}"\n        data-ehr-name="{{::model.getName()}}"\n        ng-hide="EhrLayoutHelper.isFieldHidden(this)"\n        ng-class="::EhrLayoutHelper.computeEhrLineClass(model)"\n        ehr-single-field-multi-holder="timeValue">\n    <ehr-label class="ehr-label-content" ng-class="::EhrLayoutHelper.computeEhrLabelContentClass(model)">\n        <span class="label-start-position-holder"></span>\n        <span ng-if="!suppressLabel" ng-class="{\'mandatory-field-label\': model.isRequired()}"><span class="ehr-label-text"> {{model.labelFor(EhrContext.language)}}</span><span class="multiplicity-label" ng-class="{\'show-multiplicity\': !model.isRequired() && !model.isOptional()}"> {{::model.getViewConfig().getMultiplicityString()}}</span>:</span>\n        <span class="label-end-position-holder"></span>\n    </ehr-label>\n    <div class="ehr-field-content">\n\n        <div class="content-start-position-holder"></div>\n        <div class="field-content-holder">\n            <div ehr-time-field  ehr-single-field-multi-item="" ng-repeat="textVal in singleFieldMultiValuesList track by $index" class="input-wrap">\n            <input\n                    ehr-time-formatter=""\n                    kendo-time-picker="{{::kendoName()}}"\n                    type="time"\n                    name="{{::timeName()}}"\n                    class="ehr-time-input hide-in-ehr-view-mode"\n                    k-ng-model="timeObject"\n                    ng-model="_timeObject"\n                    ng-model-options="{ debounce: 100, allowInvalid: true }"\n                    k-options="timeOptions"\n                    ng-readonly="model.getViewConfig().isReadOnly()"\n                    ng-class="::EhrLayoutHelper.computeFieldClass(model)"\n                    ng-hide="model.getViewConfig().isHidden()"\n                    ng-required="::model.isRequired()"\n                    >\n            <span class="show-in-ehr-view-mode">{{toUIFormattedTime(_timeObject)}}</span>\n            <ehr-single-field-multi-controls></ehr-single-field-multi-controls>\n            <span class="ehr-validation-error-msg" ng-messages="showErrorMessage()"><span ng-messages-include="thinkehr/f4/templates/ehr-validation-msg.html"></span></span>\n        </div>\n        </div>\n        <div class="content-end-position-holder"></div>\n\n    </div>\n\n</div>\n')}]),angular.module("thinkehr/f4/templates/ehr-unknown.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-unknown.html",'<span class="ehr-unknown">Unknown EHR element: {{::model.getName()}}.</span>')}]),angular.module("thinkehr/f4/templates/ehr-uri-text-area.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-uri-text-area.html",'<div class="input-wrap">\n        <textarea\n        class="ehr-text-input  ehr-uri-text-area area k-textbox hide-in-ehr-view-mode"\n        name="{{getFieldName()}}"\n        rows="{{::rows()}}"\n        ng-readonly="model.getViewConfig().isReadOnly()"\n        ng-hide="model.getViewConfig().isHidden()"\n        ng-model="uriFieldValue"\n        ng-model-options="{ getterSetter: true, allowInvalid: true }"\n        ng-class="::EhrLayoutHelper.computeFieldClass(model)"\n        ng-required="::model.isRequired()"\n        ehr-placeholder="{{model.annotationValue(\'placeholder\')}}"></textarea>\n        <span class="show-in-ehr-view-mode">{{uriFieldValue()}}</span>\n        <ehr-single-field-multi-controls></ehr-single-field-multi-controls>\n        <span class="ehr-validation-error-msg" ng-messages="showErrorMessage()"><span ng-messages-include="thinkehr/f4/templates/ehr-validation-msg.html"></span></span>\n</div>')}]),angular.module("thinkehr/f4/templates/ehr-uri-text-field.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-uri-text-field.html",'<div class="input-wrap">\n    <input\n    type="text"\n    name="{{getFieldName()}}"\n    class="ehr-text-input ehr-uri-text-field field k-textbox hide-in-ehr-view-mode"\n    ng-readonly="model.getViewConfig().isReadOnly()"\n    ng-hide="model.getViewConfig().isHidden()"\n    ng-model="uriFieldValue" ng-model-options="{ getterSetter: true, allowInvalid: true }"\n    ng-class="::EhrLayoutHelper.computeFieldClass(model)"\n    ng-required="::model.isRequired()"\n    ehr-placeholder="{{model.annotationValue(\'placeholder\')}}"\n    />\n    <span class="show-in-ehr-view-mode">{{uriFieldValue()}}</span>\n    <ehr-single-field-multi-controls></ehr-single-field-multi-controls>\n    <span class="ehr-validation-error-msg" ng-messages="showErrorMessage()"><span ng-messages-include="thinkehr/f4/templates/ehr-validation-msg.html"></span></span>\n</div>')}]),angular.module("thinkehr/f4/templates/ehr-uri.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-uri.html",'<div\n        class="ehr-text ehr-uri ehr-line"\n        data-ehr-path="{{::model.getPath()}}"\n        data-ehr-name="{{::model.getName()}}"\n        ng-hide="EhrLayoutHelper.isFieldHidden(this)"\n        ng-class="::EhrLayoutHelper.computeEhrLineClass(model)"\n        ehr-single-field-multi-holder="uriValue"\n        >\n    <ehr-label class="ehr-label-content" ng-class="::EhrLayoutHelper.computeEhrLabelContentClass(model)">\n        <span class="label-start-position-holder"></span>\n        <span ng-if="!suppressLabel" ng-class="{\'mandatory-field-label\': model.isRequired()}"><span class="ehr-label-text"> {{model.labelFor(EhrContext.language)}}</span><span class="multiplicity-label" ng-class="{\'show-multiplicity\': !model.isRequired() && !model.isOptional()}"> {{::model.getViewConfig().getMultiplicityString()}}</span>:</span>\n        <span class="label-end-position-holder"></span>\n    </ehr-label>\n    <div class="ehr-field-content">\n\n        <div class="content-start-position-holder"></div>\n        <div class="field-content-holder">\n            <!--<textarea ng-model="textValue" ng-model-options="{ getterSetter: true }" rows="1" cols="30"></textarea>-->\n            <ehr-uri-text-field ng-if="::isTextField()" ehr-single-field-multi-item="" ng-repeat="textVal in singleFieldMultiValuesList track by $index"></ehr-uri-text-field>\n            <ehr-uri-text-area ng-if="::isTextArea()" ehr-single-field-multi-item="" ng-repeat="textVal in singleFieldMultiValuesList track by $index"></ehr-uri-text-area>\n        </div>\n        <div class="content-end-position-holder"></div>\n\n    </div>\n\n</div>\n')}]),angular.module("thinkehr/f4/templates/ehr-validation-msg.html",[]).run(["$templateCache",function($templateCache){$templateCache.put("thinkehr/f4/templates/ehr-validation-msg.html",'<span ng-message="required" class="k-widget k-tooltip k-tooltip-validation k-invalid-msg">\n    <span class="k-icon k-warning"></span>\n    {{::EhrDictionary.text("validation.required", EhrContext.language)}}\n</span>\n<span ng-message="min" class="k-widget k-tooltip k-tooltip-validation k-invalid-msg">\n    <span class="k-icon k-warning"></span>\n    {{EhrDictionary.messageFormat("validation.min", {"min": minValue, "minOp": minValueOp}, EhrContext.language)}}\n</span>\n<span ng-message="max" class="k-widget k-tooltip k-tooltip-validation k-invalid-msg">\n    <span class="k-icon k-warning"></span>\n    {{EhrDictionary.messageFormat("validation.max", {"max": maxValue, "maxOp": maxValueOp}, EhrContext.language)}}\n</span>\n<span ng-message="numberOfSelectionsInvalid" class="k-widget k-tooltip k-tooltip-validation k-invalid-msg">\n    <span class="k-icon k-warning"></span>\n    {{EhrDictionary.messageFormat("validation.numberOfSelectionsInvalid", {"numberOfSelectionsMin": numberOfSelectionsMin, "numberOfSelectionsMax": numberOfSelectionsMax}, EhrContext.language)}}\n</span>\n<span ng-message="pattern" class="k-widget k-tooltip k-tooltip-validation k-invalid-msg">\n    <span class="k-icon k-warning"></span>\n    {{EhrDictionary.messageFormat("validation.pattern", {"patternValidExample": patternValidExample}, EhrContext.language)}}\n</span>\n<span ng-message="terminologyCodeExistsValidator" class="k-widget k-tooltip k-tooltip-validation k-invalid-msg">\n    <span class="k-icon k-warning"></span>\n    {{EhrDictionary.messageFormat("validation.terminologyCodeNotFound", {"codeValue": validatedCodeValue}, EhrContext.language)}}\n</span>\n<span ng-message="ehrDatePatternValidator" class="k-widget k-tooltip k-tooltip-validation k-invalid-msg">\n    <span class="k-icon k-warning"></span>\n    {{EhrDictionary.messageFormat("validation.dateInvalidPattern", {"datePattern": datePattern}, EhrContext.language)}}\n</span>\n<span ng-message="ehrCodedTextMultiMinItemsValidator" class="k-widget k-tooltip k-tooltip-validation k-invalid-msg">\n    <span class="k-icon k-warning"></span>\n    {{EhrDictionary.messageFormat("validation.minItemsRequired", {"requiredDeltaNr": minMultiNrDelta()}, EhrContext.language)}}\n</span>\n');
}]),function(){thinkehr.f4.ng._ehrTemplatesDefined||(thinkehr.f4.ng._ehrTemplatesDefined=!0)}(),function namespace(){function _recursionHelperService(){return angular.module("EhrRecursionHelper",[]).factory("EhrRecursionHelper",["$compile",function($compile){return{compile:function(element,link){angular.isFunction(link)&&(link={post:link});var compiledContents,contents=element.contents().remove();return{pre:link&&link.pre?link.pre:null,post:function(scope,element){compiledContents||(compiledContents=$compile(contents)),compiledContents(scope,function(clone){element.append(clone)}),link&&link.post&&link.post.apply(null,arguments)}}}}}])}function _createContext(source,dest){var locale,ehrContext=angular.extend(dest,source);return ehrContext.language?(locale=ehrContext.language,ehrContext.territory&&(locale+="-"+ehrContext.territory.toUpperCase())):locale=null,ehrContext.locale=locale,ehrContext}function createFormModule(formName,formVersion,formModel,context,fixedName){_recursionHelperService(),thinkehr.f4.ng._ehrTemplatesDefined||(console.warn("ehr-forms4-templates, defining empty module"),angular.module("ehr-forms4-templates",[]),thinkehr.f4.ng._ehrTemplatesDefined=!0);var moduleName=fixedName?fixedName:thinkehr.f4.PREFIX+formName+":"+formVersion,module=angular.module(moduleName,["ngMessages","EhrRecursionHelper","ehr-forms4-templates","kendo.directives"]);module.factory("EhrNgUtil",[function(){return{isEmpty:function(value){return angular.isUndefined(value)||""===value||null===value||value!==value}}}]),module.factory("EhrSaveHelper",[function(){return{prepareValueModel:function(valueModel,ehrContext,rootModel){this.runVisitors(valueModel,ehrContext,rootModel);var clonedModel=angular.copy(valueModel);return this.createSaveContext(ehrContext,clonedModel),clonedModel},createSaveContext:function(context,valueModel){valueModel.ctx||(valueModel.ctx={});var ctx=context||{};return ctx.language&&(valueModel.ctx.language=ctx.language),ctx.territory&&(valueModel.ctx.territory=ctx.territory),valueModel.ctx},runVisitors:function(valueModel,ehrContext,rootModel){var ismVisitor=new thinkehr.f4.IsmTransitionVisitor;rootModel.accept(ismVisitor)}}}]),module.factory("EhrLayoutHelper",["lowercaseFilter",function(lowercaseFilter){return{fieldSizeClass:function(model){if(model.getViewConfig().getSize()&&model.getViewConfig().getSize().getField()){var fs=model.getViewConfig().getSize().getField();if(fs!=thinkehr.f4.FieldSize.INHERIT)return"field-size-"+lowercaseFilter(fs.toString())}return null},fieldHorizontalAlignClass:function(model){if(model.getViewConfig().getLayout()&&model.getViewConfig().getLayout().getFieldHorizontalAlignment()){var fha=model.getViewConfig().getLayout().getFieldHorizontalAlignment();if(fha!=thinkehr.f4.FieldHorizontalAlignment.INHERIT)return"field-horizontal-align-"+lowercaseFilter(fha.toString())}},fieldVerticalAlignClass:function(model){if(model.getViewConfig().getLayout()&&model.getViewConfig().getLayout().getFieldVerticalAlignment()){var fva=model.getViewConfig().getLayout().getFieldVerticalAlignment();if(fva!=thinkehr.f4.FieldVerticalAlignment.INHERIT)return"field-vertical-align-"+lowercaseFilter(fva.toString())}},labelHorizontalAlignClass:function(model){if(model.getViewConfig().getLayout()&&model.getViewConfig().getLayout().getLabelHorizontalAlignment()){var lha=model.getViewConfig().getLayout().getLabelHorizontalAlignment();if(lha!=thinkehr.f4.LabelHorizontalAlignment.INHERIT)return"label-horizontal-align-"+lowercaseFilter(lha.toString())}},labelVerticalAlignClass:function(model){if(model.getViewConfig().getLayout()&&model.getViewConfig().getLayout().getLabelVerticalAlignment()){var lva=model.getViewConfig().getLayout().getLabelVerticalAlignment();if(lva!=thinkehr.f4.LabelVerticalAlignment.INHERIT)return"label-vertical-align-"+lowercaseFilter(lva.toString())}},computeFieldClass:function(model){var c=[],fsc=this.fieldSizeClass(model);return fsc&&c.push(fsc),c},computeEhrLineClass:function(model){var c=[],fha=this.fieldHorizontalAlignClass(model);fha&&c.push(fha);var fva=this.fieldVerticalAlignClass(model);fva&&c.push(fva);var lha=this.labelHorizontalAlignClass(model);return"label-horizontal-align-top"===lha&&c.push("line-top-to-bottom"),model.getViewConfig().isViewMode()&&c.push("ehr-view-mode"),c},computeEhrLabelContentClass:function(model){var c=[],lha=this.labelHorizontalAlignClass(model);lha&&c.push(lha);var lva=this.labelVerticalAlignClass(model);return lva&&c.push(lva),c},distributeColumns:function(columns,elements){for(var totalCols=columns>elements?elements:columns,cols=[],i=0;totalCols>i;i++)cols.push([]);for(i=0;elements>i;i++){var colIndex=i%totalCols;cols[colIndex].push(i)}return cols},columnWidthPercentage:function(viewConfig,columns){var vc=viewConfig;return vc.getSize()&&vc.getSize().getField()===thinkehr.f4.FieldSize.LARGE?Math.floor(100/columns-1).toString()+"%":"auto"},computeLastColumnClass:function(last,listOpen){var c=[];return last&&!listOpen&&c.push("last-in-column"),c},getTextareaRows:function($scope){if($scope.model.getViewConfig().getField()){var field=$scope.model.getViewConfig().getField();return field.getLines()?field.getLines():$scope.rowsDefault}return $scope.rowsDefault},getFormId:function($scope){return $scope&&$scope.formName?$scope.formName():""},isFieldHidden:function($scope){if($scope){var isHiddenConfig=$scope.model.getViewConfig().isHidden();return $scope.isValuesViewMode&&$scope.isValuesViewMode()?!$scope.model.hasValue()||isHiddenConfig:isHiddenConfig}}}}]),module.factory("EhrDictionary",["numberFilter",function(numberFilter){return{text:function(key,language){var lang=void 0!==language?language:"";return thinkehr.f4.dict.tr(key,lang)},message:function(key,interpolationArgs,language){return null==language&&(language=""),thinkehr.f4.dict.msg(key,language,interpolationArgs)},messageFormat:function(key,interpolationArgs,language){return interpolationArgs&&Object.keys(interpolationArgs).forEach(function(arg){var value=interpolationArgs[arg];angular.isNumber(value)&&(interpolationArgs[arg]=numberFilter(value))}),this.message(key,interpolationArgs,language)}}}]),module.factory("EhrLocalizationHelper",["$window","$locale",function($window,$locale){return{browserDecimalSeparator:function(){var n=1.1;return n=n.toLocaleString().substring(1,2)},kendoCulture:function(locale){return $window.kendo&&$window.kendo.cultures&&$window.kendo.cultures[locale]?$window.kendo.cultures[locale]:null},angularLocale:function(locale){var lcLocale=locale.toLowerCase();return $locale&&$locale.id===lcLocale?$locale:null},decimalSeparator:function(locale){if(!locale)return this.browserDecimalSeparator();var sep,kendoCulture=this.kendoCulture(locale);if(kendoCulture&&(sep=kendoCulture.numberFormat["."]),!sep){var ngLocale=this.angularLocale(locale);ngLocale&&(sep=ngLocale.NUMBER_FORMATS.DECIMAL_SEP)}return sep||(sep=this.browserDecimalSeparator()),sep},isDecimalSeparatorComma:function(locale){return","===this.decimalSeparator(locale)},_calendarProperty:function(locale,kendoProperty,angularProperty){if(!locale)return null;var format,kendoCulture=this.kendoCulture(locale);if(kendoCulture&&(format=kendoCulture.calendars.standard.patterns[kendoProperty]),!format){var ngLocale=this.angularLocale(locale);ngLocale&&(format=ngLocale.DATETIME_FORMATS[angularProperty])}return format},dateFormat:function(locale){return this._calendarProperty(locale,"d","shortDate")},timeFormat:function(locale){return this._calendarProperty(locale,"t","shortTime")},dateTimeFormat:function(locale){return this._calendarProperty(locale,"F","short")},supportedTimeFormats:["HH:mm:ss.sss","HH:mm:ss","HH:mm"],outputTimeFormat:"HH:mm:ss.sss",supportedDateTimeFormats:function(locale){return[this._calendarProperty(locale,"g","short"),this._calendarProperty(locale,"G","medium"),this._calendarProperty(locale,"F","medium")]},outputDateTimeFormat:"yyyy-MM-ddTHH:mm:ss.sssZ",toDate:function(strDate){return strDate&&strDate.length>0?$window.kendo.parseDate(strDate):null},toTime:function(tv){if(tv&&tv.length>0){var d,millisDelimiter=tv.indexOf(".");return millisDelimiter>0&&(tv=tv.substring(0,millisDelimiter)),d=$window.kendo?$window.kendo.parseDate(tv,this.supportedTimeFormats):thinkehr.f4.util.toTime(tv)}return null},generateKendoName:function(prefix,$scope,genFunction,propertyName,fnName){var pn=propertyName?propertyName:"_kendoName";if($scope&&angular.isDefined($scope[pn]))return $scope[pn];var kendoName=(prefix+"_"+thinkehr.f4.util.guid()).replace(/\-/g,"_");if($scope&&($scope[pn]=kendoName,genFunction!==!1)){var fn=fnName||"kendoName";$scope[fn]=function(){return $scope[pn]}}return kendoName}}}]),module.factory("EhrApiServiceFactory",["$rootScope","$compile","$q",function($rootScope,$compile,$q){return{setupCustomFunction:function($scope,model,element){var self=this;return $scope?(model&&this.executeCustomFunction(model,$scope,element,null),void $scope.$watch("model",function(newValue,oldValue){newValue&&newValue!==oldValue&&self.executeCustomFunction(newValue,$scope,element,null)})):void console.warn("ERROR no scope for custom function on element=",element)},executeCustomFunction:function(model,$scope,element,customFunctionName){var self=this,returnDeferred=$q.defer(),fncAnnVal=!customFunctionName&&model&&model.hasAnnotation("function")?model.annotationValue("function"):customFunctionName;if(fncAnnVal){var deferredCustomFnExecution=$q.defer(),watchConfig={watchExpressions:[],initialized:!1};try{var formApi=self.create(deferredCustomFnExecution,model,$scope,watchConfig,$compile,element),customFnRef=thinkehr.f4.getCustomFunctionReference(fncAnnVal,$scope.EhrContext);if(null==customFnRef)console.error(fncAnnVal+" custom function not defined.");else{var customFnResult=customFnRef.call(customFnRef,formApi);customFnResult!==!1&&deferredCustomFnExecution.resolve(customFnResult)}watchConfig.initialized=!0}catch(ex){console.error("Init function eval error",ex),null==eval(fncAnnVal)?returnDeferred.reject({errorId:3,message:"Custom function '"+fncAnnVal+"' not defined.",data:ex}):returnDeferred.reject({errorId:0,message:"Error evaluating initialization function "+fncAnnVal+". See console.",data:ex})}deferredCustomFnExecution.promise.then(function(resultObject){self.processInitResult(resultObject,model,$scope,watchConfig),returnDeferred.resolve(resultObject?resultObject.element:null)},function(failObject){returnDeferred.reject({errorId:1,message:"Initialization has been rejected: "+failObject,data:failObject}),console.error("Init rejected: ",failObject)})}else returnDeferred.reject({errorId:2,message:"EhrApiServiceFactory.executeCustomFunction called without function name to execute.",data:null});return returnDeferred.promise},create:function(deferred,model,scope,watchConfig,$compile,element){var rootModel=model.getRootModel();if(rootModel&&rootModel.getRmType()===thinkehr.f4.RmType.FORM_DEFINITION)var externalContext=rootModel._externalContext;return thinkehr.f4.ng.getFormApiObject(deferred,model,scope,$rootScope,$compile,element,externalContext,watchConfig,$q)},processInitResult:function(resultObject,model,scope,watchConfig){if(resultObject){var el=resultObject.element;el&&el.on("$destroy",function(){scope.$destroy()}),resultObject.onDestroy&&scope.$on("$destroy",function(){resultObject.onDestroy(resultObject.element,scope)}),resultObject.onModelRefresh&&void 0!==model.getRmType&&scope.model.onModelRefreshed(function(){resultObject.onModelRefresh(model)})}watchConfig.watchExpressions.forEach(function(wf){scope.$watch(wf[0],wf[1],wf[2])})}}}]),module.factory("EhrValidationHelper",["$timeout","EhrJQueryHelper",function($timeout,EhrJQueryHelper){return{ehrFormInput:function($scope,nameChainRef,inputProperty){var ip=inputProperty?inputProperty:"_formInput";if(!$scope[ip]){var model=$scope.model;if(model&&model.isValueModel()&&$scope.ehrForm){var ehrForm=$scope.ehrForm();if(ehrForm){for(var form=ehrForm,i=0;i<nameChainRef.length;i++){var subFormName=nameChainRef[i];if(form=form[subFormName],!form){form=null;break}}$scope[ip]=form!==ehrForm?form:null}}}return $scope[ip]},showErrorMessage:function($scope,formInput){if("false"!==$scope.showErrorMessages&&formInput&&formInput.$error){var touched=formInput.$dirty||formInput.$touched;if(touched)return formInput.$error;var form=$scope.ehrForm();if(form&&form.$submitted)return formInput.$error}},registerFormInputOnScope:function($scope,nameChain,property){var self=this;$scope.ehrFormInput=function(){return self.ehrFormInput($scope,nameChain,property)},$scope.showErrorMessage=function(){return self.showErrorMessage($scope,$scope.ehrFormInput())}},registerCompoundFormInputsOnScope:function($scope,nameChains){var self=this;$scope._inputAttempts=0,$scope.ehrFormInputs=function(){return $scope._haveFormInputs||($scope._formInputs?$scope._formInputs.missingInputs.forEach(function(pair,index,array){var formInput=self.ehrFormInput($scope,pair.inputName);delete $scope._formInput,formInput&&($scope._formInputs.inputs[pair.index]=formInput,array.splice(index,1))}):($scope._formInputs={haveAllInputs:!1,inputs:[],missingInputs:[]},nameChains.forEach(function(nameChain,index){var formInput=self.ehrFormInput($scope,nameChain);delete $scope._formInput,$scope._formInputs.inputs.push(formInput),formInput||$scope._formInputs.missingInputs.push({inputName:nameChain,index:index})})),$scope._formInputs.haveAllInputs=0===$scope._formInputs.missingInputs.length,$scope._haveFormInputs=$scope._formInputs.haveAllInputs),$scope._formInputs.inputs},$scope.showErrorMessage=function(){if("false"!==$scope.showErrorMessages){var inputs=$scope.ehrFormInputs(),touched=!1,errors=[];if(inputs.filter(function(input){return null!=input}).forEach(function(input){input.$error&&thinkehr.f4.util.countProperties(input.$error)>0&&errors.push(input.$error),touched||(touched=input.$dirty||input.$touched)}),errors.length>0){if(touched)return errors[0];var form=$scope.ehrForm();if(form&&form.$submitted)return errors[0]}}return null}},registerCompoundFormInputsModifyChains:function($scope,lastChainElementMods){var elementChain=$scope.model.getElementNameChain(),nameChains=lastChainElementMods.map(function(lastElement){var chain=angular.copy(elementChain);return chain[chain.length-1]=lastElement,chain});this.registerCompoundFormInputsOnScope($scope,nameChains)},validationFlagValue:function($scope,index,flagName){if(void 0!==$scope.ehrFormInputs){var inputs=$scope.ehrFormInputs();if(inputs.length>index&&inputs[index])return inputs[index][flagName]}else if(0===index&&$scope.ehrFormInput){var input=$scope.ehrFormInput();if(input)return input[flagName]}},syncNgClasses:function($scope,element,inputIndices,selectors){var ii;if(thinkehr.f4.util.isInteger(inputIndices)){ii=[];for(var j=0;inputIndices>j;j++)ii[j]=j}else ii=inputIndices;var fs=ii.map(function(i){var self=this,f1=function(scope){return self.validationFlagValue(scope,i,"$valid")},f2=function(scope){return self.validationFlagValue(scope,i,"$dirty")},f3=function(scope){return self.validationFlagValue(scope,i,"$touched")},f4=function(scope){return scope.model.getViewConfig().isHidden()},f5=function(scope){return scope.model.getViewConfig().isReadOnly()};return[f1,f2,f3,f4,f5]},this);fs.forEach(function(f,index){$scope.$watchGroup(f,function(){setTimeout(function(){var numberInput=$(element).find(selectors[index]);2==numberInput.length&&EhrJQueryHelper.syncAngularClasses(numberInput[1],numberInput[0])})})})},replaceLastElement:function(array,replaceWith){return array[array.length-1]=replaceWith,array}}}]),module.factory("EhrJQueryHelper",[function(){return{getElementClasses:function(element){var cls=$(element).attr("class");if(cls){var ar=$(element).attr("class").split(" ");angular.isArray(ar)||(ar=[])}else ar=[];return ar},getAngularClasses:function(element){return this.getElementClasses(element).filter(function(e){return 0===e.indexOf("ng-")})},removeAllAngularClasses:function(element){var angClasses=this.getAngularClasses(element),angClStr=angClasses.join(" ");return $(element).removeClass(angClStr),angClasses},syncAngularClasses:function(srcElement,targetElement){this.removeAllAngularClasses(targetElement);var angClasses=this.getAngularClasses(srcElement),angClStr=angClasses.join(" ");return $(targetElement).addClass(angClStr),angClasses}}}]),module.factory("EhrDepsHelper",[function(){var depsHlp={processModelDeps:function($scope,watchFn,isCollection,objEquality){if($scope.model.getDependencyNode()){var fn=isCollection===!0?$scope.$watchCollection:$scope.$watch;fn.call($scope,watchFn,this.processDepsFn($scope),objEquality)}},processDepsFn:function($scope){return function(newValue,oldValue){var dn=$scope.model.getDependencyNode(),nv=depsHlp.extractDepsValue(newValue),ov=depsHlp.extractDepsValue(oldValue);dn&&(nv!==ov||depsHlp.isDepsInitialCall(newValue,oldValue))&&dn.process({})}},depsValueFactory:function(value){return{_dependenciesValue:value}},extractDepsValue:function(value){return this.isDepsValueObject(value)?value._dependenciesValue:value},isDepsValueObject:function(value){return thinkehr.f4.util.isObject(value)&&value.hasOwnProperty("_dependenciesValue")},isDepsInitialCall:function(newValue,oldValue){return depsHlp.isDepsValueObject(newValue)&&newValue===oldValue}};return depsHlp}]),module.directive("ehrForm",["$log","$rootScope","$q","EhrLayoutHelper","EhrDictionary","EhrApiServiceFactory",function($log,$rootScope,$q,EhrLayoutHelper,EhrDictionary,EhrApiServiceFactory){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-form.html",transclude:!0,replace:!1,scope:{model:"=",ehrContext:"=",formId:"@",showErrorMessages:"@",freeLayout:"@"},controller:function($scope){var _formName=null,sanitizeFormId=function(formIdParam){var sanitizedFormId=null;return formIdParam&&(sanitizedFormId=formIdParam.replace(/[^\w]/gi,"").replace("_","")),sanitizedFormId||(sanitizedFormId="uid"+thinkehr.f4.util.guid("_")),sanitizedFormId},selectedTabs={},openedTabs={};$scope.selectedTabCount={},this.setSelectTabModelPathId=function(tabsParentContainerPathId,tabGroupId,tabModelPathId){selectedTabs[tabsParentContainerPathId]||(selectedTabs[tabsParentContainerPathId]={}),$scope.selectedTabCount[tabModelPathId]||($scope.selectedTabCount[tabModelPathId]=0),$scope.selectedTabCount[tabModelPathId]++,selectedTabs[tabsParentContainerPathId][tabGroupId]=tabModelPathId},this.getSelectedTabModelPathId=function(tabsParentContainerPathId,tabGroupId){return selectedTabs[tabsParentContainerPathId]?selectedTabs[tabsParentContainerPathId][tabGroupId]:null},this.setWasTabSelected=function(tabModelPathId){openedTabs[tabModelPathId]=!0},this.getWasTabSelected=function(tabModelPathId){return openedTabs[tabModelPathId]},$scope.model||($scope.model=formModel);var formModelCtx=$scope.model&&$scope.model.getContext?angular.copy($scope.model.getContext()):null;$scope.ehrContext?$scope.EhrContext=_createContext($scope.ehrContext,formModelCtx||{}):($scope.EhrContext=$scope.EhrContext||{},formModelCtx&&($scope.EhrContext=angular.extend($scope.EhrContext,formModelCtx))),$scope.EhrLayoutHelper=EhrLayoutHelper,$scope.EhrDictionary=EhrDictionary,$scope.formName=function(){return $scope.formId&&$scope.formId!=_formName?($scope.formId=sanitizeFormId($scope.formId),_formName=$scope.formId):_formName||(_formName="uid"+thinkehr.f4.util.guid("_"),$scope.model.setElementName(_formName)),_formName},$scope.ehrForm=function(){return $scope[$scope.formName()]},$scope.validateEhrForm=function($event){$event.preventDefault(),$scope.ehrForm().$setSubmitted()},$scope.$watch("formId",function(newValue,oldValue){newValue!==oldValue&&($scope.formId=sanitizeFormId(newValue))}),$scope.formContainerClass=function(){var classArr=[];return $scope.model&&$scope.model.getViewConfig().isReadOnly()?classArr.push("ehr-disabled"):classArr.push("ehr-enabled"),$scope.isViewMode()&&(classArr.push("ehr-view-mode"),$scope.isValuesViewMode()&&classArr.push("ehr-view-mode-values-only")),classArr.length?classArr.join(" "):""},$scope.isViewMode=function(){return $scope.model&&$scope.model.getViewConfig().isViewMode()},$scope.isValuesViewMode=function(){return $scope.model&&"values"==$scope.model.getViewConfig().getViewMode()}},link:function(scope,element,attr,ctrl,transclude){scope.ehrFormCtrl=ctrl;var transcludedFreeLayoutScopes=[];transclude(scope,function(clone,trScope){scope.freeLayout=!!clone.length,scope.freeLayout&&(transcludedFreeLayoutScopes.push(trScope),element.append(clone))});var stopCurrEhrFormValidWatch=null,unsubscribeKendoRenderedEventFn=void 0;scope.emitNoKendoRenderedEvent=function(){setTimeout(function(){scope.$emit("ehr-form-rendered",scope.formId)})};var checkAndDispatchRenderEvent=function(){var foundAnyKendoComponent=!!scope.model.hasAnyKendoComponent();foundAnyKendoComponent&&!unsubscribeKendoRenderedEventFn?unsubscribeKendoRenderedEventFn=scope.$on("kendoRendered",function(e){scope.$emit("ehr-form-rendered",scope.formId),unsubscribeKendoRenderedEventFn(),unsubscribeKendoRenderedEventFn=null}):foundAnyKendoComponent||scope.emitNoKendoRenderedEvent()};scope.$watch("model",function(newValue,oldValue){if(newValue){checkAndDispatchRenderEvent(),transcludedFreeLayoutScopes.forEach(function(trFLScope){trFLScope.$broadcast("onEhrModelRootChange",newValue)});var ast=scope.model.getDependencyNode();ast&&ast.process({})}}),scope.$watch("EhrContext",function(newValue,oldValue){transcludedFreeLayoutScopes.forEach(function(trFLScope){trFLScope.$broadcast("onEhrContextChange",newValue)})}),scope.$watch("EhrDictionary",function(newValue,oldValue){transcludedFreeLayoutScopes.forEach(function(trFLScope){trFLScope.$broadcast("onEhrDictionaryChange",newValue)})}),scope.$watch(function(){return scope.ehrForm()},function(newValue,oldValue){newValue&&newValue!==oldValue?(stopCurrEhrFormValidWatch&&stopCurrEhrFormValidWatch(),stopCurrEhrFormValidWatch=scope.$watch(function(){return newValue.$valid},function(newValue,oldValue){scope.$emit("ehrFormValidityChange",{formName:scope.formName(),form:scope.ehrForm(),newValue:newValue,oldValue:oldValue})})):newValue||stopCurrEhrFormValidWatch&&stopCurrEhrFormValidWatch()}),element.on("$destroy",function(){console.info("Form element destroyed."),scope.$destroy()}),scope.$on("$destroy",function(){scope.model=null,scope.EhrContext=null,scope.EhrLayoutHelper=null,scope.EhrDictionary=null,angular.isDefined(scope.ehrContext)&&(scope.ehrContext=null)}),scope.disableCustomFunction||EhrApiServiceFactory.setupCustomFunction(scope,scope.model,element)}}}]),module.directive("ehrFreeLayoutComponent",[function(){return{restrict:"E",templateUrl:"thinkehr/f4/templates/ehr-free-layout-component.html",scope:!0,require:["^^ehrForm"],link:function(scope,element,attr){scope.modelNotFoundDictCode=null,scope.modelQueryStr=null;var findComponentModel=function(rootModel,path,tag){var retModel=null;return rootModel&&(path&&(retModel=rootModel.findSuccessorWithPath(path),retModel||(console.warn("Can not find model for ehr path=",path),scope.modelNotFoundDictCode="model.notFound.byPath",scope.modelQueryStr=path)),tag&&(retModel=rootModel.findSuccessorWithTag(tag),retModel||(console.warn("Can not find model for tag=",tag),scope.modelNotFoundDictCode="model.notFound.byTag",scope.modelQueryStr=tag))),retModel&&(scope.modelNotFoundDictCode=null,scope.modelQueryStr=null),retModel};attr.ehrTag&&(scope.ehrTag=attr.ehrTag),attr.ehrPath&&(scope.ehrPath=attr.ehrPath),scope.$watch("ehrContext",function(newVal){scope.EhrContext=newVal}),scope.$watch("ehrDictionary",function(newVal){scope.EhrDictionary=newVal}),scope.$watch("ehrPath",function(newVal){scope.ehrModelRoot&&newVal?scope.model=findComponentModel(scope.ehrModelRoot,newVal):scope.model=null}),scope.$watch("ehrTag",function(newVal){scope.ehrModelRoot&&newVal?scope.model=findComponentModel(scope.ehrModelRoot,null,newVal):scope.model=null}),scope.$watch("ehrModelRoot",function(newVal){scope.ehrPath&&(scope.model=findComponentModel(newVal,scope.ehrPath)),scope.ehrTag&&(scope.model=findComponentModel(newVal,null,scope.ehrTag))}),scope.$on("onEhrModelRootChange",function(ev,newVal){scope.ehrModelRoot=newVal}),scope.$on("onEhrContextChange",function(ev,newVal){scope.ehrContext=newVal}),scope.$on("onEhrDictionaryChange",function(ev,newVal){scope.ehrDictionary=newVal})}}}]),module.directive("ehrContainer",["$timeout","EhrRecursionHelper","EhrApiServiceFactory",function($timeout,EhrRecursionHelper,EhrApiServiceFactory){return{restrict:"EA",scope:!0,require:["ehrContainer","^frangTree"],controller:function($scope){if($scope.suppressLabel=$scope.model.getViewConfig().isLabelHidden(),$scope._showControls=!1,$scope.hiddenContainerContentStyle=null,$scope.renderProgressText=" Rendering in progress...",$scope.EhrDictionary){var language=$scope.EhrContext?$scope.EhrContext.language:null;$scope.renderProgressText=$scope.EhrDictionary.text("tabRendering",language)||$scope.renderProgressText}$scope.supportsMulti=function(){return $scope.model.isContainer()&&$scope.model.isMulti()&&$scope.model.isAttachableToValueNode()},$scope.duplicateContainer=function(nrOfCopies){nrOfCopies||(nrOfCopies=1);for(var i=0;nrOfCopies>i;i++)thinkehr.f4.duplicateModel($scope.model,$scope.model)},$scope.getMultiIndex=function(){return $scope.model.getMultiIndex(!1)},$scope.removeContainer=function(){thinkehr.f4.destroyModel($scope.model)},$scope.showControls=function(showControls){return void 0!==showControls&&($scope._showControls=showControls),$scope._showControls},$scope.duplicationEnabled=function(){if($scope.supportsMulti()){var model=$scope.model,max=model.getViewConfig().getMax();if(0>max)return!0;var count=$scope.getMultiSiblingsCount();return max>count}return!1},$scope.getMultiSiblingsCount=function(){var parent=$scope.model.getParentModel(),count=parent?parent.findChildrenWithPath($scope.model.getPath()).length:1;return count},$scope.removalEnabled=function(){if($scope.supportsMulti()){var model=$scope.model,min=model.getViewConfig().getMin();1>min&&(min=1);var count=$scope.getMultiSiblingsCount();return count>min}return!1},$scope.containerClass=function(){return $scope.model.getViewConfig().isReadOnly()?"ehr-disabled":"ehr-enabled"}},compile:function(element){return EhrRecursionHelper.compile(element,function(scope,iElement,attrs,controllers){function applyTabIndex(val){var children=$(iElement).find("input,select,textarea,button,datalist"),tabIndex=val===!0?"-1":"0";angular.forEach(children,function(c){$(c).attr("tabIndex",tabIndex)})}var showContainerContent=function(){scope.hiddenContainerContentStyle=null;try{scope.$digest()}catch(e){}},hideContainerContent=function(){scope.hiddenContainerContentStyle={opacity:0,"pointer-events":"none"};var displayNotification=scope.renderProgressText;scope.renderProgressText="",setTimeout(function(){scope.$apply(function(){scope.renderProgressText=displayNotification})},1e3)},hideTabFieldsRenderProgressUntillComplete=function(){var foundAnyKendoComponent=!!scope.model.hasAnyKendoComponent();foundAnyKendoComponent&&(scope.$on("kendoRendered",function(e){showContainerContent()}),hideContainerContent())};scope.isTabContainer(scope.model)&&!scope.model.hasTag("showRenderProgress")&&hideTabFieldsRenderProgressUntillComplete(),scope.disableCustomFunction||EhrApiServiceFactory.setupCustomFunction(scope,scope.model,iElement),scope.model.getViewConfig().isReadOnly()&&$timeout(function(){applyTabIndex(!0)}),scope.$watch(function(){return scope.model.getViewConfig().isReadOnly()},function(newValue,oldValue){newValue!==oldValue&&applyTabIndex(newValue)}),scope.isTabContainer&&(scope.$watch("model",function(newValue){null!=newValue&&(scope._isTabContainer=scope.isTabContainer(newValue))}),scope.$watch(function(){var tabObj=scope.getTabObj(scope.model);return tabObj?tabObj!=scope.tabGroupSelection[tabObj.tabGroupId]:!1},function(isCurrentTab,oldVal){var selectedTabCount=scope.selectedTabCount[scope.model.getPath()]?scope.selectedTabCount[scope.model.getPath()]:0;selectedTabCount>1&&showContainerContent()}));var deltaToMinRequired=scope.supportsMulti()?scope.model.getViewConfig().getMin()-scope.getMultiSiblingsCount():0;deltaToMinRequired>0&&scope.duplicateContainer(deltaToMinRequired,!0)})}}}]),module.directive("ehrTabContainerLevel",function(){return{restrict:"EA",scope:!0,require:["ehrTabContainerLevel","^^?ehrForm"],controller:function($scope){this.selectTab=$scope.selectTab=function(tabObj){tabObj&&($scope.tabGroupSelection[tabObj.tabGroupId]=tabObj,$scope.ehrFormCtrl&&$scope.ehrFormCtrl.setSelectTabModelPathId(tabObj.model.getPath(),tabObj.tabGroupId,tabObj.model.getPath()))}},link:function(scope,element,attr,controller){scope.ehrFormCtrl=controller[1];var tabsCtrl=controller[0],allTabs=[];scope.tabContainerSiblings,scope.selectTabByModel=function(model){var tabObj=scope.getTabObj(model);tabObj&&tabsCtrl.selectTab(tabObj)},scope.$watch("model",function(newVal){newVal?scope.tabContainerSiblings=newVal.childModels:scope.tabContainerSiblings=[]}),scope.$watch("tabContainerSiblings",function(newVal){if(scope.tabContainerSiblings=newVal,scope.tabGroups={},allTabs=[],scope.tabGroupSelection={},scope.tabContainerSiblings){var tabAnnotationName="tab",defaultTabAnnotationName="defaultTab";allTabs=scope.tabContainerSiblings.filter(function(chModel){return chModel.hasAnnotation(tabAnnotationName)}).map(function(tabModel){var isDefaultTab=tabModel.hasAnnotation(defaultTabAnnotationName);return{model:tabModel,pathId:tabModel.getPath(),tabGroupId:tabModel.annotationValue(tabAnnotationName),isDefault:isDefaultTab}}),allTabs.forEach(function(tabObj){scope.tabGroups[tabObj.tabGroupId]||(scope.tabGroups[tabObj.tabGroupId]=[]),scope.tabGroups[tabObj.tabGroupId].push(tabObj)}),initSelectedTabs(scope.tabGroups)}});var initSelectedTabs=function(tabGroups){for(var groupId in tabGroups){var selectTabObj=tabGroups[groupId].filter(function(tabObj){return tabObj.isDefault})[0];selectTabObj||(selectTabObj=tabGroups[groupId][0]);var cachedSelectedModelPathId=scope.ehrFormCtrl?scope.ehrFormCtrl.getSelectedTabModelPathId(scope.model.getPath(),groupId):null;if(cachedSelectedModelPathId){var selTO=tabGroups[groupId].filter(function(tabObj){return tabObj.model.getPath()==cachedSelectedModelPathId});selTO.length&&(selectTabObj=selTO[0])}tabsCtrl.selectTab(selectTabObj)}};scope.getTabObj=function(model){var pathId=model.getPath();return allTabs.filter(function(tabObj){return tabObj.pathId==pathId})[0]},scope.isTabContainer=function(model){return!!scope.getTabObj(model)},scope.getTabGroupArrForModel=function(model){if(model){var tabObj=scope.getTabObj(model);if(tabObj)return scope.tabGroups[tabObj.tabGroupId]}return[]},scope.isTabObjSelected=function(tabObj){var ret=scope.tabGroupSelection[tabObj.tabGroupId]===tabObj;return ret&&scope.ehrFormCtrl.setWasTabSelected(tabObj.model.getPath()),ret}}}}),module.directive("ehrTabContainerTitle",function(){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-tab-container-title.html",scope:{tabObj:"=",ehrContext:"="},require:["^^ehrTabContainerLevel"],link:function(scope,element,attr,controllerArr){scope.tabsCtrl=controllerArr[0],scope.$watch("tabObj",function(newVal){scope.label=newVal?newVal.model.labelFor(scope.ehrContext.language):""})}}}),module.directive("ehrComponentElementSwitch",function(){return{restrict:"E",templateUrl:"thinkehr/f4/templates/ehr-component-element-switch.html"}}),module.directive("ehrOtherInput",function(){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-other-input.html"}}),module.directive("ehrComponentPlaceholders",function(){return{restrict:"A",scope:!1,link:function(scope,element){scope.appendToPositionHolder=function(appendElement,placementConst){switch(placementConst){case thinkehr.f4.ng.componentPlacement.POSITION_LABEL_START:$($(".label-start-position-holder",element).get(0)).append(appendElement);break;case thinkehr.f4.ng.componentPlacement.POSITION_LABEL_END:$($(".label-end-position-holder",element).get(0)).append(appendElement);break;case thinkehr.f4.ng.componentPlacement.POSITION_CONTENT_START:$(".content-start-position-holder",element).append(appendElement);
break;case thinkehr.f4.ng.componentPlacement.POSITION_CONTENT_END:$(".content-end-position-holder",element).append(appendElement)}},scope.appendLabelStart=function(appendElement){return scope.appendToPositionHolder(appendElement,thinkehr.f4.ng.componentPlacement.POSITION_LABEL_START)},scope.appendLabelEnd=function(appendElement){return scope.appendToPositionHolder(appendElement,thinkehr.f4.ng.componentPlacement.POSITION_LABEL_END)},scope.appendContentStart=function(appendElement){return scope.appendToPositionHolder(appendElement,thinkehr.f4.ng.componentPlacement.POSITION_CONTENT_START)},scope.appendContentEnd=function(appendElement){return scope.appendToPositionHolder(appendElement,thinkehr.f4.ng.componentPlacement.POSITION_CONTENT_END)},scope.getMultiNumberText=function(currMultiPositionNr){var annVal=scope.model.annotationValue("multiPositionText");return annVal=annVal?annVal.indexOf("[NR]")>0?annVal.replace("[NR]",currMultiPositionNr):annVal+" "+currMultiPositionNr:"("+currMultiPositionNr+")"}}}}),module.directive("ehrUnknown",function(){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-unknown.html",scope:!0,controller:function($scope){}}}),module.directive("ehrLabel",function(){return{restrict:"E",templateUrl:"thinkehr/f4/templates/ehr-label.html",transclude:!0,scope:!0,controller:function($scope,$element,$attrs){}}});var _ehrListValuesController=function($scope,EhrContext,EhrLayoutHelper){$scope.suppressLabel=$scope.model.getViewConfig().isLabelHidden(),$scope.presentation=function(){throw new Error("Must override.")},$scope.otherValue=function(value){return $scope.model.otherValue.apply($scope.model,arguments)},$scope.list=function(){throw new Error("Must override.")},$scope.otherFieldName=function(){throw new Error("Must override.")},$scope.computeLineClass=function(){throw new Error("Must override.")},$scope.isMulti=function(){return null==$scope._isMulti&&($scope._isMulti=$scope.model.isMulti()),$scope._isMulti},$scope.isCombo=function(){return $scope.presentation()===thinkehr.f4.FieldPresentation.COMBOBOX&&(!$scope.model.getInputFor("code")||!$scope.model.getInputFor("code").terminology)||$scope.presentation()===thinkehr.f4.FieldPresentation.TEXTFIELD&&$scope.list().length>0},$scope.isRadios=function(){return!$scope.isMulti()&&$scope.presentation()===thinkehr.f4.FieldPresentation.RADIOS},$scope.isCheckboxes=function(){return $scope.presentation()===thinkehr.f4.FieldPresentation.RADIOS&&$scope.isMulti()},$scope.getTerminology=function(){return $scope.presentation()===thinkehr.f4.FieldPresentation.COMBOBOX&&$scope.model.getInputFor("code")&&$scope.model.getInputFor("code").getTerminology()},$scope.listOpen=function(){return $scope.model.isListOpen()},$scope.labelText=function(item){return item.getLabel(EhrContext.language)},$scope.otherField=function(){return $scope.model.getViewConfig().getField("other")},$scope.codeInput=function(){return $scope.model.getInputFor("code")}},_ehrCodedTextController=function($scope,EhrContext,EhrLayoutHelper){_ehrListValuesController($scope,EhrContext,EhrLayoutHelper),$scope.codeValue=function(value){return 0===arguments.length?$scope.model.codeValue():$scope.model.codeValue(value,EhrContext.language)},$scope.presentation=function(){var present=null;$scope.codeField()&&$scope.codeField().getPresentation()&&(present=$scope.codeField().getPresentation());var acceptedPresentations=[thinkehr.f4.FieldPresentation.COMBOBOX,thinkehr.f4.FieldPresentation.RADIOS];return acceptedPresentations.indexOf(present)<0&&(present=thinkehr.f4.FieldPresentation.COMBOBOX),present},$scope.list=function(){return $scope.model.getInputFor("code").getList()};var uniqueId=$scope.model.getSanitizedUniqueId();$scope._codedTextName=EhrLayoutHelper.getFormId($scope)+"_coded_text_"+uniqueId,$scope._otherFieldName=EhrLayoutHelper.getFormId($scope)+"_coded_text_other_"+uniqueId,$scope.codedTextName=function(){return $scope._codedTextName},$scope.otherFieldName=function(){return $scope._otherFieldName},$scope.computeLineClass=function(){$scope._ctLineClass||($scope._ctLineClass=EhrLayoutHelper.computeEhrLineClass($scope.model),$scope.model.getRmType()===thinkehr.f4.RmType.DV_CODED_TEXT?$scope._ctLineClass.push("ehr-coded-text"):$scope.model.getRmType()===thinkehr.f4.RmType.DV_ORDINAL&&$scope._ctLineClass.push("ehr-ordinal"));var indexOfReadOnly=$scope._ctLineClass.indexOf("ehr-read-only"),readOnly=$scope.model.getViewConfig().isReadOnly();return readOnly&&0>indexOfReadOnly?$scope._ctLineClass.push("ehr-read-only"):!readOnly&&indexOfReadOnly>-1&&$scope._ctLineClass.splice(indexOfReadOnly,1),$scope._ctLineClass},$scope.codeField=function(){return $scope.model.getViewConfig().getField("code")}};module.directive("ehrCodedText",["EhrLayoutHelper","EhrApiServiceFactory","$timeout",function(EhrLayoutHelper,EhrApiServiceFactory,$timeout){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-coded-text.html",scope:!0,controller:function($scope){_ehrCodedTextController($scope,$scope.EhrContext,EhrLayoutHelper),$scope.multiCodedTextName=function(){return EhrLayoutHelper.getFormId($scope)+"_multi_coded_text_"+$scope.model.getSanitizedUniqueId()}},link:function(scope,element){$timeout(function(){scope.disableCustomFunction||EhrApiServiceFactory.setupCustomFunction(scope,scope.model,element)},0)}}}]),module.directive("ehrOrdinal",["EhrLayoutHelper","EhrLocalizationHelper","EhrApiServiceFactory","$timeout",function(EhrLayoutHelper,EhrLocalizationHelper,EhrApiServiceFactory,$timeout){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-coded-text.html",scope:!0,controller:function($scope){_ehrCodedTextController($scope,$scope.EhrContext,EhrLayoutHelper),EhrLocalizationHelper.generateKendoName("ordinal",$scope),$scope.codedTextName=function(){return EhrLayoutHelper.getFormId($scope)+"_ordinal_"+$scope.model.getSanitizedUniqueId()},$scope.ordinalName=function(){return $scope.codedTextName()},$scope.multiCodedTextName=function(){return EhrLayoutHelper.getFormId($scope)+"_multi_ordinal_"+$scope.model.getSanitizedUniqueId()},$scope.displayOrdinalValue=function(){return"true"===$scope.model.annotationValue("displayOrdinalValue")},$scope.labelText=function(item,hideLabel){if(hideLabel)return"";var language=$scope.EhrContext?$scope.EhrContext.language:null;return $scope.displayOrdinalValue()?item.ordinal+" "+item.getLabel(language):item.getLabel(language)},$scope.codeField=function(){return $scope.model.getViewConfig().getField()}},link:function(scope,element){$timeout(function(){scope.disableCustomFunction||EhrApiServiceFactory.setupCustomFunction(scope,scope.model,element)},0)}}}]),module.directive("ehrCodedTextComponent",["EhrValidationHelper","EhrLocalizationHelper","EhrDepsHelper","EhrApiServiceFactory","EhrLayoutHelper","$timeout",function(EhrValidationHelper,EhrLocalizationHelper,EhrDepsHelper,EhrApiServiceFactory,EhrLayoutHelper,$timeout){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-coded-text-component.html",scope:!0,require:["ehrCodedTextComponent"],controller:function($scope){function removeSelectedItemsFromList(itemsList){getSelectedItemsIndexInArray(itemsList).reverse().forEach(function(index){itemsList.splice(index,1)})}var ctrl=this;EhrLocalizationHelper.generateKendoName("coded_text",$scope),$scope.suppressLabel=$scope.model.getViewConfig().isLabelHidden(),$scope._otherSelected=null!=$scope.otherValue(),$scope.listDSArray=[],$scope._lastFilterString=null,$scope._lastSelectedString=null,$scope.hasFocus=!1,$scope.hasErrorMessage=!1,$scope.inputLabelValue="",$scope.multiValuesArr=[],$scope.isTerminologyLoading=!1,$scope.inputItemStatus={loading:thinkehr.f4.InputItem.STATUS_LOADING,notFound:thinkehr.f4.InputItem.STATUS_NOT_FOUND};var ehrLanguage=$scope.EhrContext?$scope.EhrContext.language:"",isDropdownList=$scope.model.hasTag("dropdownlist")||$scope.model.hasTag("dropdownList"),isComboBox=$scope.model.hasTag("combobox")||$scope.model.hasTag("comboBox"),isAutocomplete=$scope.model.hasTag("autocomplete")||$scope.model.hasTag("autoComplete");isDropdownList?($scope.filterEnabled=!1,$scope.displayOnFocus=!0,$scope.displayListArrow=!0):isComboBox?($scope.filterEnabled=!0,$scope.displayOnFocus=!1,$scope.displayListArrow=!0):isAutocomplete?($scope.filterEnabled=!0,$scope.displayOnFocus=!1,$scope.displayListArrow=!1):($scope.filterEnabled=$scope.model.hasTag("filterEnabled")||$scope.model.getInputFor("code")&&$scope.model.getInputFor("code").getTerminology(),$scope.displayOnFocus=$scope.model.hasTag("displayOnFocus")||!$scope.filterEnabled,$scope.displayListArrow=$scope.model.hasTag("displayListArrow")||$scope.displayOnFocus),$scope.displayOnFocus&&$scope.$watch("hasFocus",function(newVal,oldVal){newVal!==oldVal&&1==newVal&&$scope.displayFullItemsList()}),$scope.addMultiItemEnabled=function(){if($scope.isMulti()){var itemsLen=$scope.multiValuesArr?$scope.multiValuesArr.length:0;return-1==$scope.model.getMax()||itemsLen<$scope.model.getMax()}return!0},$scope.minMultiNrDelta=function(createArray){var retDelta=0;if($scope.isMulti()){var selectedNr=$scope.multiValuesArr?$scope.multiValuesArr.length:0,delta=$scope.model.getMin()-selectedNr;retDelta=0>delta?0:delta}return createArray?new Array(retDelta):retDelta},$scope.$watch(function(){return $scope.showErrorMessage()},function(msgsObject){msgsObject?$scope.hasErrorMessage=Object.keys(msgsObject).length>0:$scope.hasErrorMessage=!1},!0),$scope.model.addTerminologyItemUpdateListener(function(ev){var language=$scope.EhrContext?$scope.EhrContext.language:null;try{setTimeout(function(){updateLabelFromModel($scope.model.labelValue(language,!0)),$scope.$digest()},0)}catch(e){updateLabelFromModel($scope.model.labelValue(language,!0))}}),$scope.getOtherLabel=function(){if($scope.EhrDictionary){var language=$scope.EhrContext?$scope.EhrContext.language:null;return $scope.EhrDictionary.text("other",language)}console.warn("$scope.EhrDictionary not defined",this)},$scope.getInputPlaceholder=function(){var placeholderStr=$scope.model.annotationValue("placeholder");if(null==placeholderStr)if($scope.EhrDictionary){var language=$scope.EhrContext?$scope.EhrContext.language:null;placeholderStr=$scope.getTerminology()?$scope.EhrDictionary.text("placeholder.terminology",language):""}else console.warn("$scope.EhrDictionary not defined",this);return placeholderStr||""},$scope.getKendoAutocompleteOptions=function(){var headerTemplString=$scope.model.annotationValue("headerTemplate"),language=$scope.EhrContext?$scope.EhrContext.language:null,headerTemplate=headerTemplString?kendo.template(headerTemplString)({currentFieldLabel:$scope.model.getLocalizedName(language)}):null;return{headerTemplate:headerTemplate,template:$scope.model.annotationValue("itemTemplate"),ignoreCase:!1}},this.setInputLabelValue=function(kendoAutocomplete,labelValue){kendoAutocomplete.value(labelValue),$scope.inputLabelValue=labelValue};var updateLabelFromModel=function(labelValueObj){if(!$scope.hasFocus||!$scope.isMulti()){var kendoAutocomplete=$scope[$scope.kendoName()];if(kendoAutocomplete)if($scope.isMulti())ctrl.setInputLabelValue(kendoAutocomplete,"");else if($scope.otherSelected())ctrl.setInputLabelValue(kendoAutocomplete,$scope.getOtherLabel()+" >>");else{var modelLabel=$scope.model.labelValue(ehrLanguage);ctrl.setInputLabelValue(kendoAutocomplete,modelLabel||"")}else $scope.isMulti()||$scope.$watch($scope.kendoName(),function(kendoAutocomplete,oldVal){if(kendoAutocomplete!==oldVal)if($scope.otherSelected())ctrl.setInputLabelValue(kendoAutocomplete,$scope.getOtherLabel()+" >>");else{var modelLabel=$scope.model.labelValue(ehrLanguage);ctrl.setInputLabelValue(kendoAutocomplete,modelLabel||"")}})}$scope.isMulti()&&(labelValueObj||(labelValueObj=$scope.model.labelValue(ehrLanguage,!0)),$scope.multiValuesArr=labelValueObj)};$scope.toLabelValuesArr=function(){var labelsArr=[];if($scope.isMulti())labelsArr=$scope.multiValuesArr.map(function(lblObj){return lblObj.label});else{var labelValue=$scope.model.labelValue(ehrLanguage,!1);labelsArr=labelValue?[labelValue]:[]}return labelsArr},$scope.$watch(function(){return $scope._otherSelected},function(newVal,oldVal){newVal!==oldVal&&updateLabelFromModel()}),$scope.$watch(function(){return $scope.otherValue()},function(newValue){$scope.otherSelected(void 0!==newValue&&$scope.codeValue()==thinkehr.f4.InputItem.OTHER_VALUE)});var language=$scope.EhrContext?$scope.EhrContext.language:"";$scope.isMulti()?$scope.$watch(function(){return $scope.model.labelValue(language,!0)},function(newVal,oldVal){newVal!==oldVal&&updateLabelFromModel(newVal)},!0):$scope.$watch(function(){return $scope.model.labelValue(language)},function(newVal,oldVal){updateLabelFromModel()}),$scope.model.onModelRefreshed(function(){updateLabelFromModel()}),$timeout(function(){updateLabelFromModel()},100),$scope.$watch("EhrContext.language",function(newValue,oldValue){newValue!==oldValue&&($scope.listDSArray=itemsToDSArray($scope.codeInput().getList(),$scope._lastFilterString))}),$scope.list=function(){return $scope.listDSArray},$scope.clearListKeepSelected=function(){if($scope.isMulti())$scope.codeInput().setList([],!0);else{var selectedItem=$scope.codeInput().findInputItemByValue($scope.codeValue()),newList=[];selectedItem&&newList.push(selectedItem),$scope.codeInput().setList(newList,!0)}},$scope.otherSelected=function(selected){return void 0!==selected&&($scope._otherSelected=selected),$scope._otherSelected},$scope.minValueRequired=function(){return $scope.isMulti()&&$scope.model.isRequired()},$scope.codeValueRequired=function(){return $scope.isMulti()?$scope.model.isRequired()?!($scope.otherValue()||$scope.codeValue().length):!1:!$scope.model.codeValue()&&$scope.model.isRequired()&&!$scope.otherSelected()},$scope.otherRequired=function(){return $scope.isMulti()?$scope.codeValueRequired():$scope.model.isRequired()&&$scope.otherSelected()},$scope.codeValue=function(value){if(value===thinkehr.f4.InputItem.OTHER_VALUE)return $scope.otherSelected(!0),$scope.otherValue(""),thinkehr.f4.InputItem.OTHER_VALUE;if(0===arguments.length&&$scope.otherSelected()&&!$scope.isMulti())return thinkehr.f4.InputItem.OTHER_VALUE;(arguments.length>0||void 0===value)&&$scope.otherSelected(!1),$scope.isMulti()&&0!==arguments.length&&value&&$scope.model.codeValue(value);var language=$scope.EhrContext?$scope.EhrContext.language:null,ret=0===arguments.length||$scope.isMulti()?$scope.model.codeValue():$scope.model.codeValue(value,language);if(arguments.length){var kendoAutocomplete=$scope[$scope.kendoName()];if(kendoAutocomplete&&$scope.hasFocus){kendoAutocomplete.select(null);var kendoVal=$scope.isMulti()?"":$scope.model.labelValue(language);ctrl.setInputLabelValue(kendoAutocomplete,kendoVal)}}return ret},$scope.removeCodeValue=function(codeValue){var formInputs=$scope.ehrFormInputs?$scope.ehrFormInputs():[];codeValue==thinkehr.f4.InputItem.OTHER_VALUE?$scope.model.removeOtherValue():($scope.model.removeValue(codeValue),$scope.listDSArray=itemsToDSArray($scope.codeInput().getList(),$scope._lastFilterString),formInputs.length||formInputs.push($scope.ehrFormInput())),formInputs.forEach(function(input){input.$setTouched(),input.$setDirty()})},$scope.$watch(function(){return $scope.codeInput().getList()},function(newValue){$scope.listDSArray=itemsToDSArray(newValue,$scope._lastFilterString),$timeout(function(){resetAutocompleteFilter()})});var getSelectedItemsIndexInArray=function(itemsList){var selectedIndexes=[];if($scope.isMulti())for(var selectedArr=$scope.codeValue(),i=0;i<itemsList.length;i++){var itm=itemsList[i];selectedArr.indexOf(itm.value)>-1&&selectedIndexes.push(i)}return selectedIndexes},itemsToDSArray=function(modelList,filterStr){var updatedList=null;modelList&&(updatedList=[],modelList.forEach(function(listItem){updatedList.push({value:listItem.getValue(),label:$scope.labelText(listItem)})})),updatedList||(updatedList=[]),$scope.listOpen()&&!$scope.isMulti()&&updatedList.unshift({value:thinkehr.f4.InputItem.OTHER_VALUE,label:$scope.getOtherLabel()+" >>"}),updatedList.unshift({value:"",label:""}),null==filterStr&&(filterStr=""),removeSelectedItemsFromList(updatedList);var ds=new kendo.data.DataSource({data:updatedList,serverFiltering:!0,serverPaging:!0,serverGrouping:!0,serverSorting:!0,serverAggregates:!0});return ds.filter(filterStr),ds};$scope.onChanged=function(e){var kendoAutocomplete=e.sender,codeVal=null,selectedItems=kendoAutocomplete.listView.selectedDataItems();if(selectedItems&&1==selectedItems.length)codeVal=selectedItems&&selectedItems.length?selectedItems[0].value:null;else{if(!(selectedItems.length>1))return;console.warn("Kendo autocomplete has "+selectedItems.length+" selected items!")}var updateScope=function(){if(codeVal){var language=$scope.EhrContext?$scope.EhrContext.language:null;$scope.codeValue(codeVal,language)}else $scope.codeValue(null);$scope.listDSArray=itemsToDSArray($scope.codeInput().getList(),$scope._lastFilterString)};updateScope(),$scope.$digest()},$scope.onBlur=function(e){$scope.getTerminology()&&($scope.clearListKeepSelected(),$timeout(function(){updateLabelFromModel(),$scope._lastFilterString=null}))},$scope.onClose=function(e){if(e){var selectedItems=e.sender.listView.selectedDataItems();selectedItems&&selectedItems.length&&$scope.onChanged(e)}$scope.$apply(function(){updateLabelFromModel(),$scope._lastFilterString=""})};var resetAutocompleteFilter=function(){if($scope.getTerminology()){var kendoAutocomplete=$scope[$scope.kendoName()];kendoAutocomplete&&$scope.hasFocus&&kendoAutocomplete.search($scope._lastFilterString)}}},link:function($scope,element,attr,controllers){var ctrl=controllers[0],_defaultFilterString="";$scope.setDefaultFilterString=function(filterStr){_defaultFilterString=filterStr?filterStr:""},$scope.displayFullItemsList=function(){$scope.model.getViewConfig().isReadOnly()||($scope.hasFocus||$(".ehr-autocomplete.ehr-text-input",element).focus(),$scope.codeInput().getTerminologyItemsWithLabel({query:_defaultFilterString,force:!0},function(){$timeout(function(){var kendoAutoCompleteComp=$scope[$scope.kendoName()];kendoAutoCompleteComp.search(_defaultFilterString)})}))},$scope.onFilter=function(e){var filterString=e.filter.value.trim();filterString||(filterString=_defaultFilterString);var language=$scope.EhrContext?$scope.EhrContext.language:null;if($scope.getTerminology()){if(!$scope.isMulti()&&$scope.model.labelValue(language)&&filterString&&$scope.model.labelValue(language).trim()!=filterString.trim()?($scope.model.clearValue(),$timeout(function(){var kendoAutocomplete=$scope[$scope.kendoName()];ctrl.setInputLabelValue(kendoAutocomplete,filterString)})):$scope.isMulti()||filterString||$scope.model.clearValue(),null!=filterString){var selectedLabel=$scope.model.labelValue(language),filterStringAlreadySelected=selectedLabel?selectedLabel==filterString:!1;filterString===$scope._lastFilterString||filterStringAlreadySelected||($scope.isTerminologyLoading=!0,$scope._lastFilterString=filterString,$scope.codeInput().getTerminologyItemsWithLabel({query:filterString,force:!0},function(resArr,resForFilterString){$scope.isTerminologyLoading=!1;try{setTimeout(function(){$scope.$digest()},0)}catch(e){}}))}}else if(!$scope.isMulti()){var modelLabelVal=$scope.model.labelValue(language),doLabelsMatch=modelLabelVal&&filterString!=modelLabelVal;filterString&&!doLabelsMatch||$scope.model.clearValue(),filterString!=modelLabelVal&&$timeout(function(){var kendoAutocomplete=$scope[$scope.kendoName()];ctrl.setInputLabelValue(kendoAutocomplete,filterString)},0)}},EhrDepsHelper.processModelDeps($scope,function(){var codeValues=$scope.codeValue();return thinkehr.f4.util.isArray(codeValues)&&(codeValues=codeValues.join(",")),codeValues+=$scope.otherValue(),EhrDepsHelper.depsValueFactory(codeValues)},!1,!0),$scope.hasValidation=function(){return!0},$scope.hasValidation()&&($scope.listOpen()?EhrValidationHelper.registerCompoundFormInputsModifyChains($scope,[$scope.codedTextName(),$scope.otherFieldName()]):EhrValidationHelper.registerFormInputOnScope($scope,EhrValidationHelper.replaceLastElement($scope.model.getElementNameChain(),$scope.codedTextName())))}}}]),module.directive("ehrCodedTextRadio",["EhrLayoutHelper","EhrValidationHelper","EhrDepsHelper","EhrApiServiceFactory",function(EhrLayoutHelper,EhrValidationHelper,EhrDepsHelper,EhrApiServiceFactory){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-coded-text-radio.html",scope:!0,controller:function($scope){$scope.suppressLabel=$scope.model.getViewConfig().isLabelHidden(),$scope.codeValue=function(value){var language=$scope.EhrContext?$scope.EhrContext.language:null;return 0===arguments.length?$scope.model.codeValue():$scope.model.codeValue(value,language)},$scope.columns=function(){var model=$scope.model,cols=1,codeFieldSettings=$scope.codeField();codeFieldSettings&&codeFieldSettings.getPresentation()===thinkehr.f4.FieldPresentation.RADIOS&&(cols=codeFieldSettings.getColumns()),1>cols&&(cols=1);var elements=model.getInputFor("code").getList().length;return EhrLayoutHelper.distributeColumns(cols,elements)}(),$scope.columnWidthPercentage=function(){return EhrLayoutHelper.columnWidthPercentage($scope.model.getViewConfig(),$scope.columns.length)},$scope.elementStyle=function(){var colWidthPer=$scope.columnWidthPercentage();if("auto"!=colWidthPer){var widthRelativeNr=parseInt(colWidthPer);if(!isNaN(widthRelativeNr)){var marginRightNr=10;return colWidthPer=widthRelativeNr-marginRightNr+"%",{width:colWidthPer,"margin-right":marginRightNr+"%"}}return{width:colWidthPer}}return{}},$scope.anySelectedInColumn=function(columnItems){return columnItems.some(function(itemIndex){return $scope.list()[itemIndex].getValue()==$scope.codeValue()})}},link:function($scope,element){EhrDepsHelper.processModelDeps($scope,function(){var codeValues=$scope.codeValue();return thinkehr.f4.util.isArray(codeValues)&&(codeValues=codeValues.join(",")),codeValues+=$scope.otherValue(),EhrDepsHelper.depsValueFactory(codeValues)},!1,!0),$scope.hasValidation=function(){return $scope.model.isRequired()},$scope.hasValidation()&&($scope.listOpen()?(EhrValidationHelper.registerCompoundFormInputsModifyChains($scope,["ehr_rb_group_"+$scope.codedTextName(),$scope.otherFieldName()]),$scope.radioRequired=function(){if($scope.model.isRequired()){var ov=$scope.otherValue();return!ov||0==ov.length}return!1},$scope.otherRequired=function(){if($scope.model.isRequired()){var cv=$scope.codeValue();return!cv||0==cv.length}return!1}):(EhrValidationHelper.registerFormInputOnScope($scope,EhrValidationHelper.replaceLastElement($scope.model.getElementNameChain(),"ehr_rb_group_"+$scope.codedTextName())),$scope.radioRequired=function(){return $scope.model.isRequired()},$scope.otherRequired=function(){return!1}),$scope._onRbFormInput=function(f){var ehrFormInput=$scope.ehrFormInput?$scope.ehrFormInput():$scope.ehrFormInputs?$scope.ehrFormInputs()[0]:null;ehrFormInput&&f.call(null,ehrFormInput)},$scope._onOtherFormInput=function(f){if($scope.listOpen()){var ehrOtherInput=$scope.ehrFormInputs()[1];ehrOtherInput&&f.call(null,ehrOtherInput)}},$scope.rbClicked=function(){if(angular.isUndefined($scope._dirty)){var rbs=$(element).find("input[type='radio'].ehr-radio");$(rbs).removeClass("ng-pristine"),$(rbs).addClass("ng-dirty"),$scope._dirty=!0,$scope._onRbFormInput(function(formInput){formInput.$setDirty()}),$scope._onOtherFormInput(function(otherInput){otherInput.$dirty||otherInput.$setDirty()})}},$scope.rbBlurred=function(){if(angular.isUndefined($scope._touched)){var rbs=$(element).find("input[type='radio'].ehr-radio");$(rbs).removeClass("ng-untouched"),$(rbs).addClass("ng-touched"),$scope._touched=!0,$scope._onRbFormInput(function(formInput){formInput.$setTouched()}),$scope._onOtherFormInput(function(otherInput){otherInput.$touched||otherInput.$setTouched()})}},$scope.listOpen()&&$scope.$watchGroup([function(scope){var ehrOtherInput=scope.ehrFormInputs()[1];return ehrOtherInput?ehrOtherInput.$dirty:null},function(scope){var ehrOtherInput=scope.ehrFormInputs()[1];return ehrOtherInput?ehrOtherInput.$touched:null}],function(newValue){newValue[0]&&$scope._onOtherFormInput(function(){$scope.rbClicked()}),newValue[1]&&$scope._onOtherFormInput(function(){$scope.rbBlurred()})}))}}}]),module.directive("ehrCodedTextCheckboxes",["EhrLayoutHelper","EhrValidationHelper","EhrApiServiceFactory",function(EhrLayoutHelper,EhrValidationHelper,EhrApiServiceFactory){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-coded-text-checkboxes.html",scope:!0,controller:function($scope){$scope.suppressLabel=$scope.model.getViewConfig().isLabelHidden(),$scope.codeValue=function(value){var language=$scope.EhrContext?$scope.EhrContext.language:null;return 0===arguments.length?$scope.model.codeValue():$scope.model.codeValue(value,language)},$scope.multiCodedTextNameFor=function(itemIndex){return $scope.multiCodedTextName()+"_"+$scope.list()[itemIndex].getValue()},$scope.multiCodedTextIdFor=function(itemIndex){return $scope.multiCodedTextNameFor(itemIndex)+"_id"},$scope.codedTextFormGroupName=function(){return $scope._codedTextFormGroupName||($scope._codedTextFormGroupName="ehr_coded_text_form_group_"+thinkehr.f4.util.guid("_")),$scope._codedTextFormGroupName},$scope.columns=function(){var model=$scope.model,cols=1,codeFieldSettings=$scope.codeField();codeFieldSettings&&codeFieldSettings.getPresentation()===thinkehr.f4.FieldPresentation.RADIOS&&(cols=codeFieldSettings.getColumns()),model.hasAnnotation("columns")&&(cols=parseInt(model.annotationValue("columns"))),1>cols&&(cols=1),(!angular.isNumber(cols)||1>cols)&&(cols=1);var elements=model.getInputFor("code").getList().length;return EhrLayoutHelper.distributeColumns(cols,elements)}(),$scope.columnWidthPercentage=function(){return EhrLayoutHelper.columnWidthPercentage($scope.model.getViewConfig(),$scope.columns.length)},$scope.elementStyle=function(){var colWidthPer=$scope.columnWidthPercentage();if("auto"!=colWidthPer){var widthRelativeNr=parseInt(colWidthPer);if(!isNaN(widthRelativeNr)){var marginRightNr=10;return colWidthPer=widthRelativeNr-marginRightNr+"%",{width:colWidthPer,"margin-right":marginRightNr+"%"}}return{width:colWidthPer}}return{}},$scope.multiValues={},this.generateMultiValueArray=function(){for(var prop in $scope.multiValues)$scope.multiValues.hasOwnProperty(prop)&&delete $scope.multiValues[prop];for(var codeValuesSelected=$scope.model.codeValue(),i=0;i<$scope.list().length;i++){var item=$scope.list()[i];$scope.multiValues[item.getValue()]={checked:codeValuesSelected.indexOf(item.getValue())>-1,index:i}}},this.generateMultiValueArray(),$scope.valueToggled=function(code){var valObject=$scope.model.findValueObjectByCode(code);if(valObject)$scope.model.removeValue(code);else{var language=$scope.EhrContext?$scope.EhrContext.language:null;$scope.model.addValue(code,language)}};var ctrl=this;$scope.model.onModelRefreshed(function(){ctrl.generateMultiValueArray()}),$scope.$watchCollection(function(){return $scope.codeValue()},function(newVal,oldVal){newVal!==oldVal&&ctrl.generateMultiValueArray(!0)}),$scope.hasSelectionsNrValidation=function(){var max=$scope.model.getMax(),ret=null!=max&&max>0;if(ret===!1){var min=$scope.model.getMin();ret=null!=min&&min>0}return ret},$scope.anySelectedInColumn=function(column){return column.some(function(itemIndex){return $scope.multiValues[$scope.list()[itemIndex].getValue()].checked})}},link:function($scope){if($scope.checkBoxGroupRequired=function(){return $scope.model.isRequired()},$scope.hasValidation=function(){return $scope.checkBoxGroupRequired()||$scope.hasSelectionsNrValidation()},$scope._cbAction=function(){if($scope.hasValidation()){var fgInput=$scope.ehrCbFormGroupInput();fgInput&&!fgInput.$dirty&&fgInput.$setDirty()}},$scope.cbClicked=function(){$scope._cbAction()},$scope.cbBlurred=function(){$scope._cbAction()},$scope.hasValidation()){if($scope.ehrCbFormGroupInput=function(){return EhrValidationHelper.ehrFormInput($scope,EhrValidationHelper.replaceLastElement($scope.model.getElementNameChain(),$scope.codedTextFormGroupName()),"_formCbGroupInput"),$scope._formCbGroupInput},$scope.showErrorMessage=function(){return EhrValidationHelper.showErrorMessage($scope,$scope.ehrCbFormGroupInput())},$scope.checkBoxGroupValid=function(){return $scope.ehrCbFormGroupInput().$valid},$scope.listOpen()){var chain=$scope.model.getElementNameChain();chain.pop(),chain.push($scope.codedTextFormGroupName()),chain.push($scope.otherFieldName()),EhrValidationHelper.ehrFormInput($scope,chain,"_formCbGroupOtherInput"),$scope.ehrCbFormGroupOtherInput=function(){return $scope._formCbGroupOtherInput||EhrValidationHelper.ehrFormInput($scope,chain,"_formCbGroupOtherInput")},$scope.$watchGroup([function(scope){var i=scope.ehrCbFormGroupOtherInput();return i?i.$touched:null},function(scope){var i=scope.ehrCbFormGroupOtherInput();return i?i.$dirty:null}],function(newValue){(newValue[0]||newValue[1])&&$scope.ehrCbFormGroupInput().$setDirty()})}if($scope.checkBoxGroupRequired()){$scope._haveSelection=function(){var val=$scope.model.getValue(),valLen=angular.isArray(val)?val.length:0;return valLen>0};var validityValue=$scope._haveSelection();$scope.ehrCbFormGroupInput().$setValidity("required",validityValue),$scope.$watch($scope._haveSelection,function(newValue){$scope.ehrCbFormGroupInput().$setValidity("required",newValue)}),$scope.listOpen()&&($scope.otherRequired=function(){return!$scope._haveSelection()})}if($scope.hasSelectionsNrValidation()&&$scope.ehrCbFormGroupInput()){var isSelectionsNrValid=function(){var selectedLen=$scope.codeValue().length;$scope.listOpen()&&$scope.otherValue()&&selectedLen++,$scope.numberOfSelectionsMin=$scope.model.getMin()||0,$scope.numberOfSelectionsMax=$scope.model.getMax();var ret=$scope.numberOfSelectionsMax<1||selectedLen<=$scope.numberOfSelectionsMax;return ret===!0&&(ret=$scope.numberOfSelectionsMin<=selectedLen),ret};$scope.ehrCbFormGroupInput().$setValidity("numberOfSelectionsInvalid",isSelectionsNrValid()),$scope.$watch(function(){return isSelectionsNrValid()},function(newValue){$scope.ehrCbFormGroupInput().$setValidity("numberOfSelectionsInvalid",newValue)})}}}}}]),module.directive("ehrNgMin",["EhrNgUtil",function(EhrNgUtil){return{restrict:"A",require:"ngModel",link:function(scope,elem,attr,ngModelController){var ehrNgMin=scope.$eval(attr.ehrNgMin),min=angular.isDefined(ehrNgMin)?ehrNgMin:null,minOp=scope.$eval(attr.ehrNgMinOp)||">=",listen=angular.isDefined(attr.ehrNgMinListen)?scope.$eval(attr.ehrNgMinListen):!0;if(scope.$watch(attr.ehrNgMin,function(){ngModelController.$setViewValue(ngModelController.$viewValue)}),listen&&(scope.$watch("minValue",function(newValue,oldValue){newValue!==oldValue&&(min=newValue,null!==min&&minValidator(ngModelController.$modelValue))}),scope.$watch("minValueOp",function(newValue,oldValue){newValue!==oldValue&&(minOp=newValue,null!==min&&minValidator(ngModelController.$modelValue))})),null!==min){var minValidator=function(value){if(EhrNgUtil.isEmpty(value))return ngModelController.$setValidity("min",!0),value;var cmpResult;return">="===minOp?cmpResult=value>=min:">"===minOp?cmpResult=value>min:"<="===minOp?cmpResult=min>=value:"<"===minOp?cmpResult=min>value:"="===minOp||"=="===minOp?cmpResult=value==min:(console.warn("Unknown min operator",minOp),cmpResult=!1),ngModelController.$setValidity("min",cmpResult),cmpResult||ngModelController.$options.allowInvalid?value:void 0};ngModelController.$parsers.push(minValidator),ngModelController.$formatters.push(minValidator)}}}}]),module.directive("ehrNgMax",["EhrNgUtil",function(EhrNgUtil){return{restrict:"A",require:"ngModel",link:function(scope,elem,attr,ngModelController){var ehrNgMax=scope.$eval(attr.ehrNgMax),max=angular.isDefined(ehrNgMax)?ehrNgMax:null,maxOp=scope.$eval(attr.ehrNgMaxOp)||"<=",listen=angular.isDefined(attr.ehrNgMaxListen)?scope.$eval(attr.ehrNgMaxListen):!0;if(scope.$watch(attr.ehrNgMax,function(){ngModelController.$setViewValue(ngModelController.$viewValue)}),listen&&(scope.$watch("maxValue",function(newValue,oldValue){newValue!==oldValue&&(max=newValue,null!==max&&maxValidator(ngModelController.$modelValue));
}),scope.$watch("maxValueOp",function(newValue,oldValue){newValue!==oldValue&&(maxOp=newValue,null!==max&&maxValidator(ngModelController.$modelValue))})),null!==max){var maxValidator=function(value){if(EhrNgUtil.isEmpty(value))return ngModelController.$setValidity("max",!0),value;var cmpResult;return"<="===maxOp?cmpResult=max>=value:"<"===maxOp?cmpResult=max>value:">="===maxOp?cmpResult=value>=max:">"===maxOp?cmpResult=value>max:"="===maxOp||"=="===maxOp?cmpResult=value==max:(console.warn("Unknown max operator",maxOp),cmpResult=!1),ngModelController.$setValidity("max",cmpResult),cmpResult||ngModelController.$options.allowInvalid?value:void 0};ngModelController.$parsers.push(maxValidator),ngModelController.$formatters.push(maxValidator)}}}}]),module.directive("ehrTerminologyCodeExistsValidator",["EhrNgUtil","$http","$q","$timeout",function(EhrNgUtil,$http,$q,$timeout){return{restrict:"A",require:["ehrTerminologyCodeExistsValidator","ngModel"],controller:function($scope){var checkedCodeResults={},codeLoadingDefers={},ctrl=this,loadFromTerminologyService=function(codeVal){$scope.validatedCodeValue=codeVal,1==codeLoadingDefers[codeVal].length&&$scope.EhrContext.getTerminologyItem($scope.codeInput().getTerminology(),codeVal,null,function(resItem){resItem&&resItem.code==codeVal?(checkedCodeResults[codeVal]=!0,codeLoadingDefers[codeVal].forEach(function(defr){defr.resolve()})):(checkedCodeResults[codeVal]=!1,codeLoadingDefers[codeVal].forEach(function(defr){ctrl.toDirty(),defr.reject()}))}.bind(this))};this.checkIfExists=function(code,deferred){null!=checkedCodeResults[code]?checkedCodeResults[code]?deferred.resolve():(ctrl.toDirty(),deferred.reject()):(codeLoadingDefers[code]||(codeLoadingDefers[code]=[]),codeLoadingDefers[code].push(deferred),loadFromTerminologyService(code))}},link:function(scope,elem,attr,ctrlArr){var thisCtrl=ctrlArr[0],ngModel=ctrlArr[1];thisCtrl.toDirty=function(){$timeout(function(){ngModel.$setDirty()})},scope.getTerminology()?scope.isMulti()?(scope.$watch(function(){return scope.multiValuesArr},function(newVal,oldVal){newVal!==oldVal&&ngModel.$validate()}),ngModel.$asyncValidators.terminologyCodeExistsValidator=function(){var deferred=$q.defer();return scope.validatedCodeValue="",scope.multiValuesArr.forEach(function(labelVal){labelVal.status&&(scope.validatedCodeValue&&(scope.validatedCodeValue+=", "),scope.validatedCodeValue+=labelVal.value)}),scope.validatedCodeValue?deferred.reject():deferred.resolve(),deferred.promise}):(scope.$watch(function(){return scope.model.codeValue()},function(newVal,oldVal){newVal!==oldVal&&ngModel.$validate()}),ngModel.$asyncValidators.terminologyCodeExistsValidator=function(){var deferred=$q.defer();if(scope.otherSelected())deferred.resolve();else{var codeVal=scope.codeValue();scope.EhrContext.getTerminologyItem&&codeVal&&scope.codeInput().getTerminology()?thisCtrl.checkIfExists(codeVal,deferred):codeVal?scope.EhrContext.getTerminologyItem&&scope.codeInput().getTerminology()?deferred.resolve():(thisCtrl.toDirty(),deferred.reject()):deferred.resolve()}return deferred.promise}):scope.isMulti()?(scope.$watch(function(){return scope.multiValuesArr},function(newVal,oldVal){newVal!==oldVal&&ngModel.$validate()}),ngModel.$asyncValidators.terminologyCodeExistsValidator=function(){var deferred=$q.defer();return scope.validatedCodeValue="",scope.multiValuesArr.forEach(function(labelVal){labelVal.status==thinkehr.f4.InputItem.STATUS_NOT_FOUND&&(scope.validatedCodeValue&&(scope.validatedCodeValue+=", "),scope.validatedCodeValue+=labelVal.value)}),scope.validatedCodeValue?(thisCtrl.toDirty(),deferred.reject()):deferred.resolve(),deferred.promise}):(scope.$watch(function(){return scope.model.codeValue()},function(newVal,oldVal){null!=newVal&&ngModel.$validate()},!0),ngModel.$asyncValidators.terminologyCodeExistsValidator=function(){var deferred=$q.defer();return scope.validatedCodeValue="",scope.model.findInputItemByCode(scope.model.codeValue(),null)||(scope.validatedCodeValue=scope.model.codeValue()),scope.validatedCodeValue?($timeout(function(){thisCtrl.toDirty()}),deferred.reject()):deferred.resolve(),deferred.promise})}}}]),module.directive("ehrDatePatternValidator",["EhrNgUtil",function(EhrNgUtil){return{restrict:"A",require:["ngModel","^^ehrDateField"],controller:function($scope){},link:function(scope,elem,attr,ctrlArr){var ngModel=ctrlArr[0];scope.$watch(function(){return scope.multiItemCtrl.ehrSingleFieldMultiItemValue()},function(newVal,oldVal){newVal!==oldVal&&ngModel.$validate()}),ngModel.$validators.ehrDatePatternValidator=function(modelVal,viewVal){var datePattern=scope._validationObj?scope._validationObj.pattern:null;if(datePattern){var currDateValue=scope.multiItemCtrl.ehrSingleFieldMultiItemValue();if(currDateValue){var useMarkerInd=scope.dateValidationPattern.getMinimumDatePatternIndex(datePattern);return currDateValue.split("-").length>=useMarkerInd}}return!0}}}}]),module.directive("ehrCodedTextMultiMinItemsValidator",["$parse",function($parse){return{restrict:"A",require:["ngModel"],controller:function($scope){},link:function(scope,elem,attr,ctrlArr){var ngModel=ctrlArr[0],evalFn=$parse(attr.ehrCodedTextMultiMinItemsValidator);1==evalFn(scope)&&(scope.$watch(function(){return scope.minMultiNrDelta()},function(newVal,oldVal){newVal!==oldVal&&ngModel.$validate()}),ngModel.$validators.ehrCodedTextMultiMinItemsValidator=function(modelVal,viewVal){return 0==scope.minMultiNrDelta()})}}}]),module.directive("ehrNumberFormatter",["EhrLocalizationHelper",function(EhrLocalizationHelper){return{restrict:"A",scope:!1,require:"ngModel",link:function($scope,element,attrs,ngModelCtrl){var locale=$scope.EhrContext.locale;ngModelCtrl.$formatters.splice(0,1,function(modelValue){return angular.isString(modelValue)?parseFloat(modelValue):modelValue}),ngModelCtrl.$parsers.splice(0,0,function(viewValue){if(angular.isString(viewValue)){var vv=EhrLocalizationHelper.isDecimalSeparatorComma(locale)?viewValue.replace(/,/g,"."):viewValue;return"integer"!==attrs.ehrNumberFormatter?parseFloat(vv):parseInt(vv)}return viewValue})}}}]),module.directive("ehrDateFormatter",["$window","dateFilter","EhrLocalizationHelper",function($window,dateFilter,EhrLocalizationHelper){return{restrict:"A",scope:!1,require:"ngModel",link:function($scope,element,attrs,ngModelCtrl){ngModelCtrl.$parsers.splice(0,0,function(viewValue){if(angular.isString(viewValue)){var date,df=EhrLocalizationHelper.dateFormat($scope.EhrContext.locale);if($window.kendo)date=$window.kendo.parseDate(viewValue,df),!date&&df&&(date=$window.kendo.parseDate(viewValue));else try{date=EhrLocalizationHelper.toDate(viewValue)}catch(e){console.warn("Error while parsing date, returning viewValue",e),date=null}return date?dateFilter(date,"yyyy-MM-dd"):viewValue}return viewValue})}}}]),module.directive("ehrTimeFormatter",["$window","dateFilter","EhrLocalizationHelper",function($window,dateFilter,EhrLocalizationHelper){return{restrict:"A",scope:!1,require:"ngModel",link:function($scope,element,attrs,ngModelCtrl){ngModelCtrl.$parsers.splice(0,0,function(viewValue){if(angular.isString(viewValue)){var tf=[EhrLocalizationHelper.timeFormat($scope.EhrContext.locale)];tf=tf.concat(EhrLocalizationHelper.supportedTimeFormats);var date;if($window.kendo)date=$window.kendo.parseDate(viewValue,tf);else try{date=EhrLocalizationHelper.toTime(viewValue)}catch(e){console.warn("Error while parsing time, returning viewValue",e),date=null}return date?dateFilter(date,"HH:mm:ss.sss"):viewValue}return viewValue})}}}]),module.directive("ehrDateTimeFormatter",["$window","dateFilter","EhrLocalizationHelper",function($window,dateFilter,EhrLocalizationHelper){return{restrict:"A",scope:!1,require:"ngModel",link:function($scope,element,attrs,ngModelCtrl){ngModelCtrl.$parsers.splice(0,0,function(viewValue){if(angular.isString(viewValue)){var date;if($window.kendo)date=$window.kendo.parseDate(viewValue,EhrLocalizationHelper.supportedDateTimeFormats($scope.EhrContext.locale)),date||(date=$window.kendo.parseDate(viewValue));else try{date=EhrLocalizationHelper.toDate(viewValue)}catch(e){console.warn("Error while parsing date, returning viewValue",e),date=null}return date?dateFilter(date,"yyyy-MM-ddTHH:mm:ss.sss"):viewValue}return viewValue})}}}]);var _ehrTextController=function($scope,EhrContext,EhrLayoutHelper){_ehrListValuesController($scope,EhrContext,EhrLayoutHelper),$scope.textValue=function(value,multiIndex){return $scope.model.textValue.apply($scope.model,arguments)},$scope.presentation=function(){if($scope.textValuesField()&&thinkehr.f4.util.isObject($scope.textValuesField())){var presentation=$scope.textValuesField().getPresentation();return presentation?presentation:thinkehr.f4.FieldPresentation.COMBOBOX}return thinkehr.f4.FieldPresentation.TEXTFIELD},$scope.list=function(){return $scope.model.getInputFor("textValues").getList()};var uniqueId=$scope.model.getSanitizedUniqueId();$scope._textValuesName=EhrLayoutHelper.getFormId($scope)+"_text_values_"+uniqueId,$scope._otherFieldName=EhrLayoutHelper.getFormId($scope)+"_text_values_other_"+uniqueId,$scope.textValuesName=function(){return $scope._textValuesName},$scope.otherFieldName=function(){return $scope._otherFieldName},$scope.computeLineClass=function(){return $scope._ctLineClass||($scope._ctLineClass=EhrLayoutHelper.computeEhrLineClass($scope.model),$scope.model.getRmType()===thinkehr.f4.RmType.DV_TEXT&&$scope._ctLineClass.push("ehr-text-values")),$scope._ctLineClass},$scope.textValuesField=function(){return $scope.model.viewConfig.getField()}};return module.directive("ehrText",["EhrApiServiceFactory","EhrLayoutHelper",function(EhrApiServiceFactory,EhrLayoutHelper){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-text.html",scope:!0,controller:function($scope){_ehrTextController($scope,$scope.EhrContext,EhrLayoutHelper),$scope.suppressLabel=$scope.model.getViewConfig().isLabelHidden(),$scope._listValuesCache={},$scope.field=function(){return $scope.model.getViewConfig().getField()},$scope.isTextField=function(){return!$scope.field()||!thinkehr.f4.util.isObject($scope.field())||$scope.field().getPresentation()!==thinkehr.f4.FieldPresentation.TEXTAREA},$scope.isTextArea=function(){return $scope.field()&&thinkehr.f4.util.isObject($scope.field())&&$scope.field().getPresentation()===thinkehr.f4.FieldPresentation.TEXTAREA},$scope.showTextField=function(){return $scope.isTextField()&&!$scope.isCombo()&&!$scope.isRadios()},$scope.showTextArea=function(){return $scope.isTextArea()&&!$scope.isCombo()&&!$scope.isRadios()},$scope.$watch(function(){return $scope.list()},function(newVal){setListValuesCache(newVal)},!0);var setListValuesCache=function(listArr){$scope._listValuesCache={},listArr&&listArr.forEach(function(listItem){$scope._listValuesCache[listItem.value]=!0})}},link:function($scope,element){$scope.disableCustomFunction||EhrApiServiceFactory.setupCustomFunction($scope,$scope.model,element)}}}]),module.directive("ehrTextField",["EhrValidationHelper","EhrDepsHelper","EhrApiServiceFactory","EhrLayoutHelper",function(EhrValidationHelper,EhrDepsHelper,EhrApiServiceFactory,EhrLayoutHelper){return{restrict:"EA",require:"ehrSingleFieldMultiItem",templateUrl:"thinkehr/f4/templates/ehr-text-field.html",scope:!0,link:function($scope,element,attrs,controllers){var _sanitizedUniqueId=$scope.model.getSanitizedUniqueId(),currMultiIndex=controllers.getMultiIndex();$scope.getFieldName=function(){return EhrLayoutHelper.getFormId($scope)+"_ehr_textfield"+_sanitizedUniqueId+"_"+currMultiIndex},$scope.textFieldValue=function(value){return $scope.textValue(value,currMultiIndex)},EhrDepsHelper.processModelDeps($scope,function(){return EhrDepsHelper.depsValueFactory($scope.textFieldValue())},!1,!0),$scope.hasValidation=function(){return $scope.model.isRequired()},$scope.hasValidation()&&EhrValidationHelper.registerFormInputOnScope($scope,EhrValidationHelper.replaceLastElement($scope.model.getElementNameChain(),$scope.getFieldName()))}}}]),module.directive("ehrTextArea",["EhrValidationHelper","EhrDepsHelper","EhrLayoutHelper","EhrApiServiceFactory",function(EhrValidationHelper,EhrDepsHelper,EhrLayoutHelper,EhrApiServiceFactory){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-text-area.html",scope:!0,require:"ehrSingleFieldMultiItem",link:function($scope,element,attrsj,controllers){var _sanitizedUniqueId=$scope.model.getSanitizedUniqueId(),currMultiIndex=controllers.getMultiIndex();$scope.getFieldName=function(){return EhrLayoutHelper.getFormId($scope)+"_ehr_textarea"+_sanitizedUniqueId+"_"+currMultiIndex},$scope.textFieldValue=function(value){return $scope.textValue(value,currMultiIndex)},$scope.rowsDefault=4,$scope.rows=function(){return EhrLayoutHelper.getTextareaRows($scope)},EhrDepsHelper.processModelDeps($scope,function(){return EhrDepsHelper.depsValueFactory($scope.textFieldValue())},!1,!0),$scope.hasValidation=function(){return $scope.model.isRequired()},$scope.hasValidation()&&EhrValidationHelper.registerFormInputOnScope($scope,EhrValidationHelper.replaceLastElement($scope.model.getElementNameChain(),$scope.getFieldName()))}}}]),module.directive("ehrTextValuesCombo",["EhrValidationHelper","EhrLocalizationHelper","EhrDepsHelper","EhrApiServiceFactory","EhrLayoutHelper",function(EhrValidationHelper,EhrLocalizationHelper,EhrDepsHelper,EhrApiServiceFactory,EhrLayoutHelper){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-text-values-combo.html",scope:!0,require:["ehrTextValuesCombo","ehrSingleFieldMultiItem"],controller:function($scope){EhrLocalizationHelper.generateKendoName("text_values",$scope),$scope.otherSelected=function(){return $scope.listOpen()&&!$scope._listValuesCache[$scope.otherValue()]},$scope.otherRequired=function(){return $scope.model.isRequired()&&$scope.otherSelected()}},link:function($scope,element,attr,controllers){$scope.multiController=controllers[1],EhrDepsHelper.processModelDeps($scope,function(){return EhrDepsHelper.depsValueFactory($scope.textFieldValue()+$scope.otherValue())},!1,!0),$scope.otherValue=function(value){return $scope.textValue(value,$scope.multiController.getMultiIndex())},$scope.textFieldValue=function(value){var ret=null;return value===thinkehr.f4.InputItem.OTHER_VALUE?($scope.otherValue(""),ret=thinkehr.f4.InputItem.OTHER_VALUE):0===arguments.length&&$scope.otherSelected()?ret=thinkehr.f4.InputItem.OTHER_VALUE:(null===value&&(value=""),ret=$scope.textValue(value,controllers[1].getMultiIndex())),setTimeout(function(){if(ret===thinkehr.f4.InputItem.OTHER_VALUE){var kendoComp=$scope[$scope.kendoName()];if(kendoComp)for(var dataArr=kendoComp.dataSource.data(),i=0;i<dataArr.length;i++)if(dataArr[i].value===thinkehr.f4.InputItem.OTHER_VALUE){kendoComp.select(i),kendoComp.value(dataArr[i].text);break}}},0),ret},$scope.textChanged=function(e){var comboBox=e.sender;comboBox&&comboBox.value()&&comboBox.selectedIndex<0?$scope.$apply(function(){$scope.textFieldValue("")}):comboBox&&!comboBox.value()&&comboBox.selectedIndex>-1&&$scope.$apply(function(){$scope.textFieldValue("")})},$scope.hasValidation=function(){return $scope.model.isRequired()},$scope.hasValidation()&&($scope.listOpen()?EhrValidationHelper.registerCompoundFormInputsModifyChains($scope,[$scope.textValuesName(),$scope.otherFieldName()]):EhrValidationHelper.registerFormInputOnScope($scope,EhrValidationHelper.replaceLastElement($scope.model.getElementNameChain(),$scope.textValuesName())))}}}]),module.directive("ehrTextValuesRadio",["EhrLayoutHelper","EhrValidationHelper","EhrDepsHelper","EhrApiServiceFactory",function(EhrLayoutHelper,EhrValidationHelper,EhrDepsHelper,EhrApiServiceFactory){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-text-values-radio.html",scope:!0,require:["ehrTextValuesRadio","ehrSingleFieldMultiItem"],controller:function($scope){$scope.columns=function(){var model=$scope.model,cols=1,textValuesFieldSettings=$scope.textValuesField();textValuesFieldSettings&&textValuesFieldSettings.getPresentation()===thinkehr.f4.FieldPresentation.RADIOS&&(cols=textValuesFieldSettings.getColumns()),1>cols&&(cols=1);var elements=model.getInputFor("textValues").getList().length;return EhrLayoutHelper.distributeColumns(cols,elements)}(),$scope.columnWidthPercentage=function(){return EhrLayoutHelper.columnWidthPercentage($scope.model.getViewConfig(),$scope.columns.length)},$scope.elementStyle=function(){var colWidthPer=$scope.columnWidthPercentage();if("auto"!=colWidthPer){var widthRelativeNr=parseInt(colWidthPer);if(!isNaN(widthRelativeNr)){var marginRightNr=10;return colWidthPer=widthRelativeNr-marginRightNr+"%",{width:colWidthPer,"margin-right":marginRightNr+"%"}}return{width:colWidthPer}}return{}},$scope.anySelectedInColumn=function(columnItems){return columnItems.some(function(itemIndex){return $scope.list()[itemIndex].getValue()==$scope.textFieldValue()})}},link:function($scope,element,attr,controllers){$scope.multiController=controllers[1],EhrDepsHelper.processModelDeps($scope,function(){return EhrDepsHelper.depsValueFactory($scope.textFieldValue()+$scope.otherValue())},!1,!0),$scope.otherValue=function(value){return $scope.textValue(value,$scope.multiController.getMultiIndex())},$scope.textFieldValue=function(value){return $scope.textValue(value,$scope.multiController.getMultiIndex())},$scope.hasValidation=function(){return $scope.model.isRequired()},$scope.hasValidation()&&($scope.listOpen()?(EhrValidationHelper.registerCompoundFormInputsModifyChains($scope,["ehr_rb_group_"+$scope.textValuesName(),$scope.otherFieldName()]),$scope.radioRequired=function(){if($scope.model.isRequired()){var ov=$scope.otherValue();return!ov||0==ov.length}return!1},$scope.otherRequired=function(){if($scope.model.isRequired()){var cv=$scope.textValue(void 0,$scope.multiController.getMultiIndex());return!cv||0==cv.length}return!1}):(EhrValidationHelper.registerFormInputOnScope($scope,EhrValidationHelper.replaceLastElement($scope.model.getElementNameChain(),"ehr_rb_group_"+$scope.textValuesName())),$scope.radioRequired=function(){return $scope.model.isRequired()},$scope.otherRequired=function(){return!1}),$scope._onRbFormInput=function(f){var ehrFormInput=$scope.ehrFormInput?$scope.ehrFormInput():$scope.ehrFormInputs?$scope.ehrFormInputs()[0]:null;ehrFormInput&&f.call(null,ehrFormInput)},$scope._onOtherFormInput=function(f){if($scope.listOpen()){var ehrOtherInput=$scope.ehrFormInputs()[1];ehrOtherInput&&f.call(null,ehrOtherInput)}},$scope.rbClicked=function(){if(angular.isUndefined($scope._dirty)){var rbs=$(element).find("input[type='radio'].ehr-radio");$(rbs).removeClass("ng-pristine"),$(rbs).addClass("ng-dirty"),$scope._dirty=!0,$scope._onRbFormInput(function(formInput){formInput.$setDirty()}),$scope._onOtherFormInput(function(otherInput){otherInput.$dirty||otherInput.$setDirty()})}},$scope.rbBlurred=function(){if(angular.isUndefined($scope._touched)){var rbs=$(element).find("input[type='radio'].ehr-radio");$(rbs).removeClass("ng-untouched"),$(rbs).addClass("ng-touched"),$scope._touched=!0,$scope._onRbFormInput(function(formInput){formInput.$setTouched()}),$scope._onOtherFormInput(function(otherInput){otherInput.$touched||otherInput.$setTouched()})}},$scope.listOpen()&&$scope.$watchGroup([function(scope){var ehrOtherInput=scope.ehrFormInputs()[1];return ehrOtherInput?ehrOtherInput.$dirty:null},function(scope){var ehrOtherInput=scope.ehrFormInputs()[1];return ehrOtherInput?ehrOtherInput.$touched:null}],function(newValue){newValue[0]&&$scope._onOtherFormInput(function(){$scope.rbClicked()}),newValue[1]&&$scope._onOtherFormInput(function(){$scope.rbBlurred()})}))}}}]),module.directive("ehrUri",["EhrApiServiceFactory","EhrLayoutHelper",function(EhrApiServiceFactory,EhrLayoutHelper){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-uri.html",scope:!0,controller:function($scope){$scope.suppressLabel=$scope.model.getViewConfig().isLabelHidden(),$scope.uriValue=function(value,multiIndex){return $scope.model.uriValue.apply($scope.model,arguments)},$scope.field=function(){return $scope.model.getViewConfig().getField()},$scope.isTextField=function(){return!$scope.field()||!thinkehr.f4.util.isObject($scope.field())||$scope.field().getPresentation()!==thinkehr.f4.FieldPresentation.TEXTAREA},$scope.isTextArea=function(){return $scope.field()&&thinkehr.f4.util.isObject($scope.field())&&$scope.field().getPresentation()===thinkehr.f4.FieldPresentation.TEXTAREA}},link:function(scope,element){scope.disableCustomFunction||EhrApiServiceFactory.setupCustomFunction(scope,scope.model,element)}}}]),module.directive("ehrUriTextField",["EhrValidationHelper","EhrDepsHelper","EhrApiServiceFactory","EhrLayoutHelper",function(EhrValidationHelper,EhrDepsHelper,EhrApiServiceFactory,EhrLayoutHelper){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-uri-text-field.html",scope:!0,require:"ehrSingleFieldMultiItem",link:function($scope,element,attr,controllers){var _sanitizedUniqueId=$scope.model.getSanitizedUniqueId(),currMultiIndex=controllers.getMultiIndex();$scope.getFieldName=function(){return EhrLayoutHelper.getFormId($scope)+"_ehr_uri_textfield"+_sanitizedUniqueId+"_"+currMultiIndex},EhrDepsHelper.processModelDeps($scope,function(){return EhrDepsHelper.depsValueFactory($scope.uriFieldValue())},!1,!0),$scope.uriFieldValue=function(value){return $scope.uriValue(value,currMultiIndex)},$scope.hasValidation=function(){return $scope.model.isRequired()},$scope.hasValidation()&&EhrValidationHelper.registerFormInputOnScope($scope,EhrValidationHelper.replaceLastElement($scope.model.getElementNameChain(),$scope.getFieldName()))}}}]),module.directive("ehrUriTextArea",["EhrValidationHelper","EhrDepsHelper","EhrLayoutHelper","EhrApiServiceFactory",function(EhrValidationHelper,EhrDepsHelper,EhrLayoutHelper,EhrApiServiceFactory){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-uri-text-area.html",scope:!0,require:["ehrUriTextArea","ehrSingleFieldMultiItem"],controller:function($scope){$scope.rowsDefault=4,$scope.rows=function(){return EhrLayoutHelper.getTextareaRows($scope)}},link:function($scope,element,attr,controllers){var _sanitizedUniqueId=$scope.model.getSanitizedUniqueId(),currMultiIndex=controllers[1].getMultiIndex();$scope.getFieldName=function(){return EhrLayoutHelper.getFormId($scope)+"_ehr_uri_textarea"+_sanitizedUniqueId+"_"+currMultiIndex},EhrDepsHelper.processModelDeps($scope,function(){return EhrDepsHelper.depsValueFactory($scope.uriFieldValue())},!1,!0),$scope.uriFieldValue=function(value){return $scope.uriValue(value,currMultiIndex)},$scope.hasValidation=function(){return $scope.model.isRequired()},$scope.hasValidation()&&EhrValidationHelper.registerFormInputOnScope($scope,EhrValidationHelper.replaceLastElement($scope.model.getElementNameChain(),$scope.getFieldName()))}}}]),module.directive("ehrEhrUri",["EhrApiServiceFactory","EhrLayoutHelper",function(EhrApiServiceFactory,EhrLayoutHelper){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-ehr-uri.html",scope:!0,controller:function($scope){$scope.suppressLabel=$scope.model.getViewConfig().isLabelHidden(),$scope.ehrUriValue=function(value,multiIndex){return $scope.model.ehrUriValue.apply($scope.model,arguments)},$scope.field=function(){return $scope.model.getViewConfig().getField()},$scope.isTextField=function(){return!$scope.field()||!thinkehr.f4.util.isObject($scope.field())||$scope.field().getPresentation()!==thinkehr.f4.FieldPresentation.TEXTAREA},$scope.isTextArea=function(){return $scope.field()&&thinkehr.f4.util.isObject($scope.field())&&$scope.field().getPresentation()===thinkehr.f4.FieldPresentation.TEXTAREA}},link:function(scope,element){scope.disableCustomFunction||EhrApiServiceFactory.setupCustomFunction(scope,scope.model,element)}}}]),module.directive("ehrEhrUriTextField",["EhrValidationHelper","EhrDepsHelper","EhrApiServiceFactory","EhrLayoutHelper",function(EhrValidationHelper,EhrDepsHelper,EhrApiServiceFactory,EhrLayoutHelper){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-ehr-uri-text-field.html",scope:!0,require:["ehrEhrUriTextField","ehrSingleFieldMultiItem"],controller:function($scope){$scope.patternValidExample=$scope.model.getPatternValidExample()},link:function($scope,element,attr,controllers){var _sanitizedUniqueId=$scope.model.getSanitizedUniqueId(),currMultiIndex=controllers[1].getMultiIndex();$scope.getFieldName=function(){return EhrLayoutHelper.getFormId($scope)+"_ehr_ehr_uri_textfield"+_sanitizedUniqueId+"_"+currMultiIndex},EhrDepsHelper.processModelDeps($scope,function(){return EhrDepsHelper.depsValueFactory($scope.ehrUriFieldValue())},!1,!0),$scope.ehrUriFieldValue=function(value){return $scope.ehrUriValue(value,currMultiIndex)},$scope.hasValidation=function(){return!0},$scope.hasValidation()&&EhrValidationHelper.registerFormInputOnScope($scope,EhrValidationHelper.replaceLastElement($scope.model.getElementNameChain(),$scope.getFieldName()))}}}]),module.directive("ehrEhrUriTextArea",["EhrValidationHelper","EhrDepsHelper","EhrLayoutHelper","EhrApiServiceFactory",function(EhrValidationHelper,EhrDepsHelper,EhrLayoutHelper,EhrApiServiceFactory){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-ehr-uri-text-area.html",scope:!0,require:["ehrEhrUriTextArea","ehrSingleFieldMultiItem"],controller:function($scope){$scope.rowsDefault=4,$scope.rows=function(){return EhrLayoutHelper.getTextareaRows($scope)},$scope.patternValidExample=$scope.model.getPatternValidExample()},link:function($scope,element,attr,controllers){var _sanitizedUniqueId=$scope.model.getSanitizedUniqueId(),currMultiIndex=controllers[1].getMultiIndex();$scope.getFieldName=function(){return EhrLayoutHelper.getFormId($scope)+"_ehr_ehr_uri_textarea"+_sanitizedUniqueId+"_"+currMultiIndex},EhrDepsHelper.processModelDeps($scope,function(){return EhrDepsHelper.depsValueFactory($scope.ehrUriFieldValue())},!1,!0),$scope.ehrUriFieldValue=function(value){return $scope.ehrUriValue(value,controllers[1].getMultiIndex())},$scope.hasValidation=function(){return!0},$scope.hasValidation()&&EhrValidationHelper.registerFormInputOnScope($scope,EhrValidationHelper.replaceLastElement($scope.model.getElementNameChain(),$scope.getFieldName()))}}}]),module.directive("ehrProportion",["EhrLayoutHelper","EhrValidationHelper","EhrLocalizationHelper","EhrDepsHelper","EhrApiServiceFactory",function(EhrLayoutHelper,EhrValidationHelper,EhrLocalizationHelper,EhrDepsHelper,EhrApiServiceFactory){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-proportion.html",scope:!0,controller:function($scope){$scope.suppressLabel=$scope.model.getViewConfig().isLabelHidden(),$scope.proportionValue=function(){return 2==arguments.length&&""==arguments[0]&&arguments[1]>=0?$scope.model.numeratorValue("",arguments[1],!0):2==arguments.length&&null===arguments[0]&&arguments[1]>=0?$scope.model.removeValue(arguments[1]):$scope.model.getValue()},$scope._precision=function(input){if(input.getType()===thinkehr.f4.InputType.DECIMAL){if(input.getValidation()){var p=input.getValidation().precision;return p?p.max:3}return 3}return 0},$scope.numeratorPrecision=$scope._precision($scope.model.getInputFor("numerator")),$scope.numeratorFormat="n"+$scope.numeratorPrecision,$scope.numeratorStep=1/Math.pow(10,$scope.numeratorPrecision),$scope.denominatorPrecision=$scope._precision($scope.model.getInputFor("denominator")),$scope.denominatorFormat="n"+$scope.denominatorPrecision,$scope.denominatorStep=1/Math.pow(10,$scope.denominatorPrecision),$scope.numeratorOptions={culture:$scope.EhrContext.locale,decimals:$scope.numeratorPrecision,format:$scope.numeratorFormat,step:$scope.numeratorStep},$scope.denominatorOptions={culture:$scope.EhrContext.locale,decimals:$scope.denominatorPrecision,format:$scope.denominatorFormat,step:$scope.denominatorStep},$scope.percentage=function(){var denominatorInput=$scope.model.getInputFor("denominator");if(denominatorInput.getValidation()){var v=denominatorInput.getValidation();return v.range&&100==v.range.min&&100==v.range.max}return!1},$scope.fixedDenominator=function(){var denominatorInput=$scope.model.getInputFor("denominator");if(denominatorInput.getValidation()){var v=denominatorInput.getValidation();return v.range&&void 0!==v.range.min&&v.range.min==v.range.max}return!1},$scope.numeratorMinValue=$scope.model.getMinValueForNumerator(),$scope.numeratorMinValueOp=$scope.model.getMinOperatorForNumerator()||">=",$scope.numeratorMaxValue=$scope.model.getMaxValueForNumerator(),$scope.numeratorMaxValueOp=$scope.model.getMaxOperatorForNumerator()||"<=",$scope.denominatorMinValue=$scope.model.getMinValueForDenominator(),$scope.denominatorMinValueOp=$scope.model.getMinOperatorForDenominator()||">=",$scope.denominatorMaxValue=$scope.model.getMaxValueForDenominator(),$scope.denominatorMaxValueOp=$scope.model.getMaxOperatorForDenominator()||"<=",$scope.computeFieldClass=function(){if(!$scope.fieldClass){var cl=EhrLayoutHelper.computeFieldClass($scope.model);$scope.percentage()?(cl.push("ehr-percentage"),cl.push("ehr-fixed-denominator")):$scope.fixedDenominator()&&cl.push("ehr-fixed-denominator"),$scope.fieldClass=cl}return $scope.fieldClass},$scope.numeratorField=function(){return $scope.model.getViewConfig().getField("numerator")},$scope.denominatorField=function(){return $scope.model.getViewConfig().getField("denominator")},$scope.denominatorRequired=function(){return $scope.model.isRequired()&&!$scope.fixedDenominator()}},link:function($scope,element){$scope.hasValidation=function(){var hv=$scope.model.isRequired()||angular.isNumber($scope.numeratorMinValue)||angular.isNumber($scope.numeratorMaxValue);return hv||(hv=$scope.fixedDenominator()&&(angular.isNumber($scope.denominatorMinValue)||angular.isNumber($scope.denominatorMaxValue))),hv},$scope.disableCustomFunction||EhrApiServiceFactory.setupCustomFunction($scope,$scope.model,element)}}}]),module.directive("ehrProportionField",["EhrLayoutHelper","EhrValidationHelper","EhrLocalizationHelper","EhrDepsHelper","EhrApiServiceFactory",function(EhrLayoutHelper,EhrValidationHelper,EhrLocalizationHelper,EhrDepsHelper,EhrApiServiceFactory){return{restrict:"A",template:"",require:["ehrSingleFieldMultiItem","^^ehrProportion"],scope:!0,controller:function($scope){$scope.suppressLabel=$scope.model.getViewConfig().isLabelHidden(),EhrLocalizationHelper.generateKendoName("numerator_proportion",$scope,!0,"_kendoNumName","kendoNumName"),EhrLocalizationHelper.generateKendoName("denominator_proportion",$scope,!0,"_kendoDenName","kendoDenName")},link:function($scope,element,attrs,controllers){function _rangePropertyWatcher(scope,inputIndex,property){var numInput=scope.ehrFormInputs()[inputIndex];return numInput&&numInput.$error&&angular.isDefined(numInput.$error[property])?numInput.$error[property]:null}var multiItemCtrl=controllers[0],currMultiIndex=multiItemCtrl.getMultiIndex();$scope.numeratorValue=function(value){return $scope.model.numeratorValue.apply($scope.model,[value,currMultiIndex])},$scope.denominatorValue=function(value){return $scope.model.denominatorValue.apply($scope.model,[value,currMultiIndex])},$scope.numeratorName=function(){return EhrLayoutHelper.getFormId($scope)+"_numerator_proportion_"+$scope.model.getSanitizedUniqueId()+"_"+currMultiIndex},$scope.denominatorName=function(){return EhrLayoutHelper.getFormId($scope)+"_denominator_proportion_"+$scope.model.getSanitizedUniqueId()+"_"+currMultiIndex},$scope.model.onModelRefreshed(function(){$scope.numerator=$scope.numeratorValue(),$scope.denominator=$scope.denominatorValue()}),EhrDepsHelper.processModelDeps($scope,function(){var numeratorValue=$scope.numeratorValue();null==numeratorValue&&(numeratorValue="");var denominatorValue=$scope.denominatorValue();return null==denominatorValue&&(denominatorValue=""),EhrDepsHelper.depsValueFactory(numeratorValue.toString()+denominatorValue.toString())},!1,!0),EhrValidationHelper.registerCompoundFormInputsModifyChains($scope,[$scope.numeratorName(),$scope.denominatorName()]),$scope.ehrFormInputs().length>0&&EhrValidationHelper.syncNgClasses($scope,element,[0,1],["input.ehr-number.ehr-proportion.ehr-numerator","input.ehr-number.ehr-proportion.ehr-denominator"]),
$scope.hasValidation()&&$scope.$watchGroup([function(scope){return _rangePropertyWatcher(scope,0,"min")},function(scope){return _rangePropertyWatcher(scope,1,"min")},function(scope){return _rangePropertyWatcher(scope,0,"max")},function(scope){return _rangePropertyWatcher(scope,1,"max")}],function(newValue,oldValue,scope){newValue[0]?(scope.minValue=scope.numeratorMinValue,scope.minValueOp=scope.numeratorMinValueOp):newValue[1]?(scope.minValue=scope.denominatorMinValue,scope.minValueOp=scope.denominatorMinValueOp):(scope.minValue=null,scope.minValueOp=null),newValue[2]?(scope.maxValue=scope.numeratorMaxValue,scope.maxValueOp=scope.numeratorMaxValueOp):newValue[3]?(scope.maxValue=scope.denominatorMaxValue,scope.maxValueOp=scope.denominatorMaxValueOp):(scope.maxValue=null,scope.maxValueOp=null)})}}}]),module.directive("ehrMultimedia",["EhrLayoutHelper","EhrValidationHelper","EhrLocalizationHelper","EhrDepsHelper","EhrApiServiceFactory",function(EhrLayoutHelper,EhrValidationHelper,EhrLocalizationHelper,EhrDepsHelper,EhrApiServiceFactory){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-multimedia.html",scope:!0,controller:function($scope){$scope.suppressLabel=$scope.model.getViewConfig().isLabelHidden(),$scope.uriValue=function(){return 2==arguments.length&&""==arguments[0]&&arguments[1]>=0?$scope.model.uriValue("",arguments[1],!0):2==arguments.length&&null===arguments[0]&&arguments[1]>=0?$scope.model.removeValue(arguments[1]):$scope.model.getValue()},$scope.getMimeTypeInTags=function(mimeTypesArr){return mimeTypesArr.filter(function(mtyp){return $scope.model.getViewConfig().hasTag(mtyp)?mtyp:!1})[0]}},link:function($scope,element){$scope.hasValidation=function(){return $scope.model.isRequired()},$scope.disableCustomFunction||EhrApiServiceFactory.setupCustomFunction($scope,$scope.model,element)}}}]),module.directive("ehrMultimediaField",["EhrLayoutHelper","EhrValidationHelper","EhrLocalizationHelper","EhrDepsHelper","EhrApiServiceFactory","$sce",function(EhrLayoutHelper,EhrValidationHelper,EhrLocalizationHelper,EhrDepsHelper,EhrApiServiceFactory,$sce){return{restrict:"E",templateUrl:"thinkehr/f4/templates/ehr-multimedia-field.html",require:["ehrSingleFieldMultiItem","^^ehrMultimedia"],scope:!0,controller:function($scope){$scope.MEDIA_TYPE_IMAGE="MEDIA_TYPE_IMAGE",$scope.MEDIA_TYPE_AUDIO="MEDIA_TYPE_AUDIO",$scope.MEDIA_TYPE_VIDEO="MEDIA_TYPE_VIDEO",$scope.suppressLabel=$scope.model.getViewConfig().isLabelHidden(),EhrLocalizationHelper.generateKendoName("multimedia_uri",$scope,!0,"_kendoNumName","kendoNumName")},link:function($scope,element,attrs,controllers){var multiItemCtrl=controllers[0],currMultiIndex=multiItemCtrl.getMultiIndex();$scope.uriValue=function(value){null!=value&&$scope.getFileSuffix(value)&&$scope.mimeTypeValue(getMimeTypeFromFilePath(value));var retVal=$scope.model.uriValue.apply($scope.model,[value,currMultiIndex]);return retVal},$scope.mimeTypeValue=function(value){return $scope.model.mimeTypeValue.apply($scope.model,[value,currMultiIndex])},$scope.uriName=function(){return EhrLayoutHelper.getFormId($scope)+"_multimedia_uri"+$scope.model.getSanitizedUniqueId()+"_"+currMultiIndex},$scope.mimeTypeName=function(){return EhrLayoutHelper.getFormId($scope)+"_multimedia_mime_type"+$scope.model.getSanitizedUniqueId()+"_"+currMultiIndex},$scope.imageFileSuffixes={jpg:"image/jpeg",jpeg:"image/jpeg",gif:"image/gif",png:"image/png"},$scope.videoFileSuffixes={mp4:"video/mp4"},$scope.audioFileSuffixes={mp3:"audio/mpeg"},$scope.getFileSuffix=function(uriValuePath){if(uriValuePath&&uriValuePath.lastIndexOf){var suffixStart=uriValuePath.lastIndexOf(".");if(suffixStart>0){var retSuff=uriValuePath.substring(suffixStart+1).trim().toLowerCase();if(retSuff.length>2&&retSuff.length<5)return retSuff}}return null},$scope.getMediaType=function(){var uri=$scope.uriValue();return $scope.isImageType(uri)?$scope.MEDIA_TYPE_IMAGE:$scope.isAudioType(uri)?$scope.MEDIA_TYPE_AUDIO:$scope.isVideoType(uri)?$scope.MEDIA_TYPE_VIDEO:null};var collectMimeTypesToArr=function(){for(var typesArr=[],i=0;i<arguments.length;i++){var fileSuffixObj=arguments[i];for(var suffix in fileSuffixObj)typesArr.push(fileSuffixObj[suffix])}return typesArr},getMimeTypeFromFilePath=function(filePath){var suff=$scope.getFileSuffix(filePath);if(suff)for(var typesArr=[$scope.imageFileSuffixes,$scope.videoFileSuffixes,$scope.audioFileSuffixes],i=0;i<typesArr.length;i++){var typeSuffObj=typesArr[i];for(var fileTypeSuff in typeSuffObj)if(fileTypeSuff==suff)return typeSuffObj[fileTypeSuff]}return null};$scope.getMimeType=function(filePath){if(filePath){var ret=getMimeTypeFromFilePath(filePath);return ret||(ret=$scope.mimeTypeValue()),ret||$scope.getMimeTypeInTags(collectMimeTypesToArr($scope.imageFileSuffixes,$scope.audioFileSuffixes,$scope.videoFileSuffixes)),ret}return null};var isMimeTypeInFileSuffixes=function(mimeType,fileSuffObj){if(mimeType)for(var suff in fileSuffObj)if(fileSuffObj[suff]==mimeType)return!0;return!1};$scope.isImageType=function(filePath){var mime=$scope.getMimeType(filePath);return isMimeTypeInFileSuffixes(mime,$scope.imageFileSuffixes)},$scope.isAudioType=function(filePath){var mime=$scope.getMimeType(filePath);return isMimeTypeInFileSuffixes(mime,$scope.audioFileSuffixes)},$scope.isVideoType=function(filePath){var mime=$scope.getMimeType(filePath);return isMimeTypeInFileSuffixes(mime,$scope.videoFileSuffixes)},$scope.model.onModelRefreshed(function(){$scope.uriVal=$scope.uriValue(),$scope.mimeTypeVal=$scope.mimeTypeValue()}),EhrDepsHelper.processModelDeps($scope,function(){return EhrDepsHelper.depsValueFactory($scope.uriValue())},!1,!0),$scope.hasValidation()&&EhrValidationHelper.registerCompoundFormInputsModifyChains($scope,[$scope.uriName()])}}}]),module.directive("ehrBoolean",["EhrLayoutHelper","EhrDepsHelper","EhrApiServiceFactory",function(EhrLayoutHelper,EhrDepsHelper,EhrApiServiceFactory){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-boolean.html",scope:!0,controller:function($scope){$scope.hideReadOnlyInputs=$scope.model.hasTag("hideDisabled"),$scope.suppressLabel=$scope.model.getViewConfig().isLabelHidden(),$scope.booleanName=function(){return EhrLayoutHelper.getFormId($scope)+"_boolean_"+$scope.model.getSanitizedUniqueId()},$scope.booleanValue=function(value){return $scope.model.booleanValue.apply($scope.model,arguments)},$scope.computeFieldClass=function(){if(!$scope.fieldClass){var cl=EhrLayoutHelper.computeFieldClass($scope.model);$scope.model.isThreeState()?cl.push("ehr-boolean-three-state"):cl.push("ehr-checkbox-two-state"),$scope.fieldClass=cl}return $scope.fieldClass},$scope.twoStateReadOnly=function(){return $scope.model.getViewConfig().isReadOnly()||$scope.model.allowedValues().length<2||$scope.isViewMode&&$scope.isViewMode()},$scope.trueAllowed=function(){return $scope.model.allowedValues().indexOf(!0)>=0},$scope.falseAllowed=function(){return $scope.model.allowedValues().indexOf(!1)>=0},$scope.nullAllowed=function(){return $scope.model.allowedValues().indexOf(null)>=0},$scope.trueReadOnly=function(){return $scope.model.getViewConfig().isReadOnly()||!$scope.trueAllowed()||$scope.isViewMode&&$scope.isViewMode()},$scope.falseReadOnly=function(){return $scope.model.getViewConfig().isReadOnly()||!$scope.falseAllowed()||$scope.isViewMode&&$scope.isViewMode()},$scope.nullReadOnly=function(){return $scope.model.getViewConfig().isReadOnly()||!$scope.nullAllowed()||$scope.isViewMode&&$scope.isViewMode()},$scope.columnWidthPercentage=function(){return EhrLayoutHelper.columnWidthPercentage($scope.model.getViewConfig(),3)},$scope.columnStyle=function(){if(!$scope._colStyle){var colWidthPer=$scope.columnWidthPercentage();"auto"!=colWidthPer?$scope._colStyle={width:colWidthPer}:$scope._colStyle={}}return $scope._colStyle}},link:function($scope,element){EhrDepsHelper.processModelDeps($scope,function(){return EhrDepsHelper.depsValueFactory($scope.booleanValue())},!1,!0),$scope.disableCustomFunction||EhrApiServiceFactory.setupCustomFunction($scope,$scope.model,element)}}}]),module.directive("ehrDate",["$timeout","dateFilter","EhrValidationHelper","EhrLocalizationHelper","EhrDepsHelper","EhrApiServiceFactory","EhrLayoutHelper",function($timeout,dateFilter,EhrValidationHelper,EhrLocalizationHelper,EhrDepsHelper,EhrApiServiceFactory,EhrLayoutHelper){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-date.html",scope:!0,controller:function($scope){$scope.suppressLabel=$scope.model.getViewConfig().isLabelHidden(),$scope.dateValue=function(value,multiIndex){return $scope.model.dateValue.apply($scope.model,arguments)}},link:function($scope,element){$scope._validationObj=$scope.model.getInputByType(thinkehr.f4.InputType.DATE).getValidation()||{},$scope.datePattern=$scope._validationObj.pattern,$scope.hasValidation=function(){return $scope.model.isRequired()||$scope._validationObj.pattern},$scope.disableCustomFunction||EhrApiServiceFactory.setupCustomFunction($scope,$scope.model,element)}}}]),module.directive("ehrDateField",["$timeout","dateFilter","EhrValidationHelper","EhrLocalizationHelper","EhrDepsHelper","EhrApiServiceFactory","EhrLayoutHelper",function($timeout,dateFilter,EhrValidationHelper,EhrLocalizationHelper,EhrDepsHelper,EhrApiServiceFactory,EhrLayoutHelper){return{restrict:"A",templateUrl:"",scope:!0,require:["ehrDateField","ehrSingleFieldMultiItem","^^ehrDate"],controller:function($scope){this.multiItemCtrl=null,this.onModelRefreshed=function(){$scope.updateDateObject(this.multiItemCtrl.ehrSingleFieldMultiItemValue())}},link:function($scope,element,attrs,controllers){function updateDateValueFormats(dateValue){if(dateValue)for(dateValue=dateValidationPattern.trimToMaxDateValueFormat(dateValue),$scope.selectedDateValueFormat=dateValue.split("-").map(function(val,i){return dateValidationPattern.timeframeFormatOrder[i+1]}).join("-"),$scope.selectedDateUIFormat=dateValidationPattern.getDateUIPatternFormatFromDateValueFormat($scope.selectedDateValueFormat);(dateValue.match(/-/g)||[]).length<2;)dateValue+="-01";return dateValue}var selfCtrl=controllers[0],multiItemCtrl=controllers[1];selfCtrl.multiItemCtrl=multiItemCtrl,$scope.multiItemCtrl=multiItemCtrl,$scope.model.onModelRefreshed(function(){selfCtrl.onModelRefreshed()});var dateValidationPattern={FORBIDDEN_MARKER:"xx",OPTIONAL_MARKER:"??",timeFrameOrder:["DECADE","YEAR","MONTH","DAY"],timeframeFormatOrder:["decade","yyyy","MM","dd"],getIndexInTimeFrameOrder:function(timeFrame){return timeFrame?this.timeFrameOrder.indexOf(timeFrame.toUpperCase()):null},compareTimeFrame:function(timeFrame1,timeFrame2){return timeFrame1&&timeFrame2?timeFrame1==timeFrame2?0:this.getIndexInTimeFrameOrder(timeFrame2)-this.getIndexInTimeFrameOrder(timeFrame1):null},indexOfTimeFrameMarker:function(pattern,markerString){if(pattern){var pattLC=pattern.toLowerCase();if(pattLC.indexOf(markerString)){var pattSplit=pattLC.split("-").indexOf(markerString);if(pattSplit>-1)return pattSplit}}return null},getMinimumDatePatternIndex:function(validationPattern){var useMarkerInd,forbiddenMarkerInd=this.indexOfTimeFrameMarker(validationPattern,this.FORBIDDEN_MARKER),optionalMarkerIndex=this.indexOfTimeFrameMarker(validationPattern,this.OPTIONAL_MARKER);return useMarkerInd=forbiddenMarkerInd&&optionalMarkerIndex>forbiddenMarkerInd||!optionalMarkerIndex?forbiddenMarkerInd:optionalMarkerIndex},getDateStart:function(validationPattern){var retVal;if(validationPattern){var useMarkerInd=this.getMinimumDatePatternIndex(validationPattern);retVal=null!=useMarkerInd&&useMarkerInd>-1?this.timeFrameOrder[useMarkerInd-1].toLowerCase():null}return retVal?retVal:"month"},getDateDepth:function(validationPattern){var retVal;if(validationPattern){var forbiddenTimeFrameIndex=this.indexOfTimeFrameMarker(validationPattern,this.FORBIDDEN_MARKER)-1;retVal=null!=forbiddenTimeFrameIndex&&null!=this.timeFrameOrder[forbiddenTimeFrameIndex]?this.timeFrameOrder[forbiddenTimeFrameIndex].toLowerCase():null}return retVal?retVal:"month"},getDateValuePatternFormat:function(validationObjPattern,marker){var retVal;if(validationObjPattern){var forbiddenTimeFrameIndex=this.indexOfTimeFrameMarker(validationObjPattern,marker);if(null!=forbiddenTimeFrameIndex){var formatArr=this.timeframeFormatOrder.slice(1,forbiddenTimeFrameIndex+1);formatArr.length>0&&(retVal=formatArr.length>1?formatArr.join("-"):formatArr[0])}}return retVal},getDateValueFormatForDepth:function(timeFrame){var toInd=this.getIndexInTimeFrameOrder(timeFrame);return 1>toInd&&(toInd=1),this.timeframeFormatOrder.slice(1,toInd+1).join("-")},trimToMaxDateValueFormat:function(dateValue){var maxFormat=this.getDateValuePatternFormat($scope._validationObj.pattern,this.FORBIDDEN_MARKER);if(maxFormat&&dateValue){var maxFSplitArr=maxFormat.split("-"),valSplitArr=dateValue.split("-");if(maxFSplitArr.length<valSplitArr.length)return valSplitArr.splice(0,maxFSplitArr.length).join("-")}return dateValue},getDateUIPatternFormatFromDateValueFormat:function(dateValueFormat){var currCulture=EhrLocalizationHelper.kendoCulture($scope.EhrContext.locale);if(currCulture){var cultureCalendarConf=currCulture.calendar?currCulture.calendar:currCulture.calendars.standard,datePattern=cultureCalendarConf.patterns.d,separator=cultureCalendarConf["/"],retVal=datePattern;if(dateValueFormat&&(dateValueFormat=this.trimToMaxDateValueFormat(dateValueFormat))){var valPattern_lc=dateValueFormat.toLowerCase();if(valPattern_lc&&datePattern&&separator){var pattArr=datePattern.split(separator);pattArr=pattArr.filter(function(pattItm){return valPattern_lc.indexOf(pattItm.toLowerCase())>-1}),retVal=pattArr.join(separator)}}return retVal}}};$scope.dateValidationPattern=dateValidationPattern,$scope.suppressLabel=$scope.model.getViewConfig().isLabelHidden(),$scope.selectedDateDepth=null,$scope.selectedDateDepthOptional=null,$scope.selectedDateValueFormat=null,$scope.selectedDateUIFormat=dateValidationPattern.getDateUIPatternFormatFromDateValueFormat($scope._validationObj.pattern),$scope._listenersSet=!1,$scope.selectedDateValue="",$scope.updateDateObject=function(dateValue){if($scope._dateObject=EhrLocalizationHelper.toDate(dateValue),dateValue){dateValue=updateDateValueFormats(dateValue);var kendoComp=$scope[$scope.kendoName()];$scope._dateObject=EhrLocalizationHelper.toDate(dateValue),kendoComp&&kendoComp.setOptions({format:$scope.selectedDateUIFormat})}$timeout(function(){$scope.dateObject=$scope._dateObject},50)},EhrLocalizationHelper.generateKendoName("date",$scope),$scope.dateName=function(){return EhrLayoutHelper.getFormId($scope)+"_date_"+$scope.model.getSanitizedUniqueId()+"_"+multiItemCtrl.getMultiIndex()},$scope.$watch(function(){return multiItemCtrl.ehrSingleFieldMultiItemValue()},function(newVal,oldVal){newVal!==oldVal&&$scope.updateDateObject(newVal)}),selfCtrl.onModelRefreshed(),$scope.toFormattedDate=function(dateObj){if(dateObj){var pattern=$scope.selectedDateValueFormat||dateValidationPattern.getDateValuePatternFormat($scope._validationObj.pattern,dateValidationPattern.FORBIDDEN_MARKER)||"yyyy-MM-dd";return dateFilter(dateObj,pattern)}return""},$scope.toUIFormattedDate=function(dateObj){if(dateObj){var pattern=$scope.selectedDateUIFormat||EhrLocalizationHelper.dateFormat($scope.EhrContext.locale)||"yyyy-MM-dd";return dateFilter(dateObj,pattern)}return""},$scope.$watch("dateObject",function(newVal,oldVal){if(newVal!==oldVal){var strDate;strDate=newVal?$scope.toFormattedDate(newVal):"",multiItemCtrl.ehrSingleFieldMultiItemValue()!=strDate&&multiItemCtrl.ehrSingleFieldMultiItemValue(strDate)}});var lastRequiredTFrame=dateValidationPattern.indexOfTimeFrameMarker($scope._validationObj.pattern,dateValidationPattern.OPTIONAL_MARKER),forbiddenMarker=dateValidationPattern.indexOfTimeFrameMarker($scope._validationObj.pattern,dateValidationPattern.FORBIDDEN_MARKER);(lastRequiredTFrame||forbiddenMarker)&&$scope.$watch($scope.kendoName(),function(kendoDatePicker){function updateFooterUI(isDepthOptional){var footerText="",kendoComponent=$scope[$scope.kendoName()];if(kendoComponent){var datePickerElement=kendoComponent.dateView.popup.element,$coloseIcon=$(datePickerElement).find(".ehr-optional-date-close"),$widget=$(datePickerElement).find(".k-widget.k-calendar"),$footerTextEl=$(datePickerElement).find(".k-footer .ehr-text-holder"),$footerBtn=$(datePickerElement).find(".k-footer .ehr-date-footer");$footerBtn.show();var language=$scope.EhrContext?$scope.EhrContext.language:null;isDepthOptional?(footerText=" "+$scope.EhrDictionary.text("validation.dateOptional.closeSelection",language)+" ",$coloseIcon.show(),$widget.removeClass("ng-invalid-background"),$footerBtn.click(function(ev){ev.stopPropagation(),kendoComponent.close()}).css("cursor","pointer")):(footerText=" "+$scope.EhrDictionary.text("validation.dateOptional.requiredSelection",language)+" ",$coloseIcon.hide(),$widget.addClass("ng-invalid-background"),$footerBtn.off("click").css("cursor","default")),$footerTextEl.text(footerText)}}if(kendoDatePicker&&kendoDatePicker.dateView&&kendoDatePicker.dateView.popup){var $kendoPopupEl=$(kendoDatePicker.dateView.popup.element);kendoDatePicker.bind("open",function(e){$kendoPopupEl.find(".k-footer a").length&&$kendoPopupEl.find(".k-footer .ehr-date-footer").unwrap();var updateSelectedDateDepth=function(ev){function getUIDepthFromTitle(selectedDateDepthHeaderString){var digitString=selectedDateDepthHeaderString.replace(/\D/g,"#"),digitStringArr=digitString.split("#"),toIntArr=digitStringArr.map(function(currStr){return parseInt(currStr)});if(1==digitStringArr.length&&!isNaN(toIntArr[0]))return dateValidationPattern.timeFrameOrder[1];if(2==digitStringArr.length){if(!isNaN(toIntArr[0])&&!isNaN(toIntArr[1]))return toIntArr[1]-toIntArr[0]<10?dateValidationPattern.timeFrameOrder[0]:"CENTURY"}else if(digitStringArr.length>2)return dateValidationPattern.timeFrameOrder[2];return null}function getSelectedData(selectedUIEl){var selectedYear,selectedMonth,selectedDay;if(selectedUIEl){selectedUIEl=$(selectedUIEl);var selectedData=selectedUIEl.data("value");selectedData||selectedUIEl.is("A")||(selectedData=selectedUIEl.find("a").data("value"));var selectedDataArr=selectedData?selectedData.replace(/\D/g,"#").split("#"):null;selectedYear=selectedDataArr&&null!=selectedDataArr[0]?selectedDataArr[0].toString():null,selectedMonth=selectedDataArr&&null!=selectedDataArr[1]?(parseInt(selectedDataArr[1])+1).toString():null,selectedDay=selectedDataArr&&null!=selectedDataArr[2]?parseInt(selectedDataArr[2]).toString():null}return[selectedYear,selectedMonth,selectedDay]}var finalDepth=dateValidationPattern.getDateDepth($scope._validationObj.pattern);$scope.$apply(function(){if(!ev||$(ev.target).closest("table").length||$(ev.target).closest(".k-header").length){var selectedDateDepthTitleString=kendoDatePicker.dateView.popup.element.find(".k-header .k-nav-fast").text(),selectedYearMonthDayArr=ev?getSelectedData(ev.target):[null,null,null],oldDateDepth=$scope.selectedDateDepth;$scope.selectedDateDepth=getUIDepthFromTitle(selectedDateDepthTitleString);var newDateValueString=selectedYearMonthDayArr.filter(function(val){return!!val}).map(function(val1){return val1.length<2?("0"+val1).slice(-2):val1}).join("-"),trimValueToFormat=function(valueFormat,value){var res=dateFilter(new Date(value),valueFormat);return res},newDateValue=null;if(newDateValueString&&dateValidationPattern.getIndexInTimeFrameOrder(oldDateDepth)>=0){var depthFromat=null,selectionAtFinalDepth=0==dateValidationPattern.compareTimeFrame(oldDateDepth,finalDepth);depthFromat=selectionAtFinalDepth?dateValidationPattern.getDateValueFormatForDepth(dateValidationPattern.timeFrameOrder[dateValidationPattern.getIndexInTimeFrameOrder(finalDepth)+1]):dateValidationPattern.getDateValueFormatForDepth($scope.selectedDateDepth),newDateValue=trimValueToFormat(depthFromat,newDateValueString)}$scope.selectedDateValue=newDateValue,selectionAtFinalDepth&&$scope.updateDateObject($scope.selectedDateValue)}})};$scope._listenersSet||($scope._listenersSet=!0,$kendoPopupEl.find(".k-header .k-nav-fast").click(updateSelectedDateDepth),$kendoPopupEl.find(".k-calendar").click(updateSelectedDateDepth),kendoDatePicker.bind("close",function(ev){$scope.$apply(function(){$scope.selectedDateValue&&$timeout(function(){$scope.updateDateObject($scope.selectedDateValue)})})})),updateSelectedDateDepth(),updateFooterUI($scope.selectedDateDepthOptional)})}$scope.$watch("selectedDateDepth",function(val){val=null==val?"":val;var kendoComponent=$scope[$scope.kendoName()];if(kendoComponent&&kendoComponent.dateView.popup){var selectedDepthIndex=dateValidationPattern.getIndexInTimeFrameOrder(val),indexOfTimeFrameMarker=dateValidationPattern.indexOfTimeFrameMarker($scope._validationObj.pattern,dateValidationPattern.OPTIONAL_MARKER);null!=indexOfTimeFrameMarker?$scope.selectedDateDepthOptional=selectedDepthIndex>=indexOfTimeFrameMarker:$scope.selectedDateDepthOptional=!1}else $scope.selectedDateDepthOptional=!1}),$scope.$watch("selectedDateDepthOptional",function(val){updateFooterUI(val)})}),$scope.dateOptions={culture:$scope.EhrContext.locale,start:dateValidationPattern.getDateStart($scope._validationObj.pattern),depth:dateValidationPattern.getDateDepth($scope._validationObj.pattern),format:$scope.selectedDateUIFormat,footer:kendo.template($("<div><p class='ehr-date-footer' style='display: none'><span class='ehr-text-holder'></span> <span class='ehr-optional-date-close'><i class='fa fa-2x fa-check red'></i></span></p></div>").html())},EhrDepsHelper.processModelDeps($scope,function(){return EhrDepsHelper.depsValueFactory(multiItemCtrl.ehrSingleFieldMultiItemValue())},!1,!0),$scope.hasValidation()&&EhrValidationHelper.registerFormInputOnScope($scope,EhrValidationHelper.replaceLastElement($scope.model.getElementNameChain(),$scope.dateName()))}}}]),module.directive("ehrTime",["$timeout","dateFilter","EhrValidationHelper","EhrLocalizationHelper","EhrDepsHelper","EhrApiServiceFactory","EhrLayoutHelper",function($timeout,dateFilter,EhrValidationHelper,EhrLocalizationHelper,EhrDepsHelper,EhrApiServiceFactory,EhrLayoutHelper){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-time.html",scope:!0,controller:function($scope){$scope.suppressLabel=$scope.model.getViewConfig().isLabelHidden(),$scope.interval=30,$scope.format=void 0,$scope.timeValue=function(value,multiIndex){return $scope.model.timeValue.apply($scope.model,arguments)},$scope.timeOptions={culture:$scope.EhrContext.locale,format:$scope.format,parseFormats:EhrLocalizationHelper.supportedTimeFormats,interval:$scope.interval},$scope.format||delete $scope.timeOptions.format},link:function($scope,element){$scope.hasValidation=function(){return $scope.model.isRequired()},$scope.disableCustomFunction||EhrApiServiceFactory.setupCustomFunction($scope,$scope.model,element)}}}]),module.directive("ehrTimeField",["$timeout","dateFilter","EhrValidationHelper","EhrLocalizationHelper","EhrDepsHelper","EhrApiServiceFactory","EhrLayoutHelper",function($timeout,dateFilter,EhrValidationHelper,EhrLocalizationHelper,EhrDepsHelper,EhrApiServiceFactory,EhrLayoutHelper){return{restrict:"A",templateUrl:"",scope:!0,require:["ehrTimeField","ehrSingleFieldMultiItem","^^ehrTime"],controller:function($scope){this.multiItemCtrl=null,this.onModelRefreshed=function(){$scope.updateTimeObject(this.multiItemCtrl.ehrSingleFieldMultiItemValue())}},link:function($scope,element,attrs,controllers){var selfCtrl=controllers[0],multiItemCtrl=controllers[1];selfCtrl.multiItemCtrl=multiItemCtrl,$scope.model.onModelRefreshed(function(){selfCtrl.onModelRefreshed()}),$scope.updateTimeObject=function(timeValue){$scope._timeObject=EhrLocalizationHelper.toTime(timeValue),$timeout(function(){$scope.timeObject=$scope._timeObject},50)},EhrLocalizationHelper.generateKendoName("time",$scope),$scope.timeName=function(){return EhrLayoutHelper.getFormId($scope)+"_time_"+$scope.model.getSanitizedUniqueId()+"_"+multiItemCtrl.getMultiIndex()},$scope.$watch(function(){return multiItemCtrl.ehrSingleFieldMultiItemValue()},function(newVal,oldVal){newVal!==oldVal&&$scope.updateTimeObject(newVal)}),selfCtrl.onModelRefreshed(),$scope.toFormattedTime=function(dateObj){return dateObj?dateFilter(dateObj,EhrLocalizationHelper.outputTimeFormat):""},$scope.toUIFormattedTime=function(dateObj){if(dateObj){var pattern=$scope.format||EhrLocalizationHelper.timeFormat($scope.EhrContext.locale)||"HH:mm";return dateFilter(dateObj,pattern)}return""},$scope.$watch("timeObject",function(newVal,oldVal){if(newVal!=oldVal){var strTime;strTime=newVal?$scope.toFormattedTime(newVal):"",multiItemCtrl.ehrSingleFieldMultiItemValue()!=strTime&&multiItemCtrl.ehrSingleFieldMultiItemValue(strTime)}}),EhrDepsHelper.processModelDeps($scope,function(){return EhrDepsHelper.depsValueFactory(multiItemCtrl.ehrSingleFieldMultiItemValue())},!1,!0),$scope.hasValidation()&&EhrValidationHelper.registerFormInputOnScope($scope,EhrValidationHelper.replaceLastElement($scope.model.getElementNameChain(),$scope.timeName()))}}}]),module.directive("ehrDateTime",["$timeout","dateFilter","EhrValidationHelper","EhrLocalizationHelper","EhrDepsHelper","EhrApiServiceFactory","EhrLayoutHelper",function($timeout,dateFilter,EhrValidationHelper,EhrLocalizationHelper,EhrDepsHelper,EhrApiServiceFactory,EhrLayoutHelper){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-date-time.html",scope:!0,controller:function($scope){$scope.suppressLabel=$scope.model.getViewConfig().isLabelHidden(),$scope.interval=30,$scope.timeFormat=void 0,$scope.dateTimeValue=function(value,multiIndex){return $scope.model.dateTimeValue.apply($scope.model,arguments)},$scope.dateTimeOptions={culture:$scope.EhrContext.locale,timeFormat:$scope.timeFormat,interval:$scope.interval,start:"month",depth:"month"},$scope.format||delete $scope.dateTimeOptions.timeFormat},link:function($scope,element){$scope.hasValidation=function(){return $scope.model.isRequired()},$scope.disableCustomFunction||EhrApiServiceFactory.setupCustomFunction($scope,$scope.model,element)}}}]),module.directive("ehrDateTimeField",["$timeout","dateFilter","EhrValidationHelper","EhrLocalizationHelper","EhrDepsHelper","EhrApiServiceFactory","EhrLayoutHelper",function($timeout,dateFilter,EhrValidationHelper,EhrLocalizationHelper,EhrDepsHelper,EhrApiServiceFactory,EhrLayoutHelper){return{restrict:"A",templateUrl:"",scope:!0,require:["ehrDateTimeField","ehrSingleFieldMultiItem","^^ehrDateTime"],controller:function($scope){this.multiItemCtrl=null,this.onModelRefreshed=function(){$scope.updateDateTimeObject(this.multiItemCtrl.ehrSingleFieldMultiItemValue())}},link:function($scope,element,attrs,controllers){var selfCtrl=controllers[0],multiItemCtrl=controllers[1];selfCtrl.multiItemCtrl=multiItemCtrl,$scope.model.onModelRefreshed(function(){selfCtrl.onModelRefreshed()}),$scope.updateDateTimeObject=function(dateTimeValue){$scope._dateTimeObject=EhrLocalizationHelper.toDate(dateTimeValue),$timeout(function(){$scope.dateTimeObject=$scope._dateTimeObject},50)},EhrLocalizationHelper.generateKendoName("date_time",$scope),$scope.dateTimeName=function(){return EhrLayoutHelper.getFormId($scope)+"_date_time_"+$scope.model.getSanitizedUniqueId()+"_"+multiItemCtrl.getMultiIndex()},$scope.$watch(function(){return multiItemCtrl.ehrSingleFieldMultiItemValue()},function(newVal,oldVal){newVal!==oldVal&&$scope.updateDateTimeObject(newVal)}),selfCtrl.onModelRefreshed(),$scope.toFormattedDateTime=function(dateObj){return dateObj?dateFilter(dateObj,"yyyy-MM-ddTHH:mm:ss.sssZ"):""},$scope.toUIFormattedDateTime=function(dateObj){if(dateObj){var pattern=$scope.dateTimeOptions.timeFormat||EhrLocalizationHelper.supportedDateTimeFormats($scope.EhrContext.locale)[0]||"yyyy-MM-dd HH:mm";return dateFilter(dateObj,pattern)}return""},$scope.$watch("dateTimeObject",function(newVal,oldVal){if(newVal!=oldVal){var strDateTime;strDateTime=newVal?$scope.toFormattedDateTime(newVal):"",multiItemCtrl.ehrSingleFieldMultiItemValue()!=strDateTime&&multiItemCtrl.ehrSingleFieldMultiItemValue(strDateTime)}}),EhrDepsHelper.processModelDeps($scope,function(){return EhrDepsHelper.depsValueFactory(multiItemCtrl.ehrSingleFieldMultiItemValue())},!1,!0),$scope.hasValidation()&&EhrValidationHelper.registerFormInputOnScope($scope,EhrValidationHelper.replaceLastElement($scope.model.getElementNameChain(),$scope.dateTimeName()))}}}]),module.directive("ehrCount",["$timeout","EhrValidationHelper","EhrLocalizationHelper","EhrDepsHelper","EhrApiServiceFactory","EhrLayoutHelper",function($timeout,EhrValidationHelper,EhrLocalizationHelper,EhrDepsHelper,EhrApiServiceFactory,EhrLayoutHelper){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-count.html",scope:!0,controller:function($scope){if($scope.suppressLabel=$scope.model.getViewConfig().isLabelHidden(),$scope.countValue=function(value,multiIndex){return $scope.model.countValue.apply($scope.model,arguments)},$scope.countOptions={culture:$scope.EhrContext.locale,decimals:0,format:"n0",step:1},$scope._validation=$scope.model.getInputByType(thinkehr.f4.InputType.INTEGER).getValidation(),$scope._validation&&$scope._validation.range){var range=$scope._validation.range;$scope._range=range,angular.isDefined(range.min)?($scope.minValue=angular.isString(range.min)?parseInt(range.min):range.min,$scope.minValueOp=">="):$scope.minValue=null,angular.isDefined(range.max)?($scope.maxValue=angular.isString(range.max)?parseInt(range.max):range.max,$scope.maxValueOp="<="):$scope.maxValue=null}},link:function($scope,element){$scope.hasValidation=function(){return $scope.model.isRequired()||angular.isNumber($scope.minValue)||angular.isNumber($scope.maxValue)},$scope.disableCustomFunction||EhrApiServiceFactory.setupCustomFunction($scope,$scope.model,element)}}}]),module.directive("ehrCountField",["$timeout","EhrValidationHelper","EhrLocalizationHelper","EhrDepsHelper","EhrApiServiceFactory","EhrLayoutHelper",function($timeout,EhrValidationHelper,EhrLocalizationHelper,EhrDepsHelper,EhrApiServiceFactory,EhrLayoutHelper){return{restrict:"A",template:"",scope:!0,require:["ehrSingleFieldMultiItem","^^ehrCount"],controller:function($scope){if($scope.suppressLabel=$scope.model.getViewConfig().isLabelHidden(),EhrLocalizationHelper.generateKendoName("count",$scope),$scope._validation=$scope.model.getInputByType(thinkehr.f4.InputType.INTEGER).getValidation(),$scope._validation&&$scope._validation.range){var range=$scope._validation.range;$scope._range=range,angular.isDefined(range.min)?($scope.minValue=angular.isString(range.min)?parseInt(range.min):range.min,$scope.minValueOp=">="):$scope.minValue=null,angular.isDefined(range.max)?($scope.maxValue=angular.isString(range.max)?parseInt(range.max):range.max,$scope.maxValueOp="<="):$scope.maxValue=null}},link:function($scope,element,attr,controllers){var multiItemCtrl=controllers[0];EhrDepsHelper.processModelDeps($scope,function(){return EhrDepsHelper.depsValueFactory($scope.countFieldValue())},!1,!0),$scope.countName=function(){return $scope._countName||($scope._countName=EhrLayoutHelper.getFormId($scope)+"_count_"+$scope.model.getSanitizedUniqueId()+"_"+multiItemCtrl.getMultiIndex()),$scope._countName},$scope.countFieldValue=function(value){0!==arguments.length&&(value&&isNaN(parseFloat(value))||null==value)&&(value=void 0===value?"-":"");var ehrSingleFieldMultiItemValue=multiItemCtrl.ehrSingleFieldMultiItemValue.apply(multiItemCtrl,arguments);return!ehrSingleFieldMultiItemValue&&isNaN(parseFloat(ehrSingleFieldMultiItemValue))?null:ehrSingleFieldMultiItemValue};var formInputRegistered=!1,regFormInput=function(){formInputRegistered||(formInputRegistered=!0,EhrValidationHelper.registerFormInputOnScope($scope,EhrValidationHelper.replaceLastElement($scope.model.getElementNameChain(),$scope.countName())),$scope.ehrFormInput()&&EhrValidationHelper.syncNgClasses($scope,element,[0],["input.ehr-count-input"]))},kendoComp=$scope[$scope.kendoName()];kendoComp?regFormInput():$scope.$watch(function(val){val&&regFormInput()})}}}]),module.directive("ehrQuantity",["$timeout","EhrValidationHelper","EhrLocalizationHelper","EhrDepsHelper","EhrApiServiceFactory","EhrLayoutHelper",function($timeout,EhrValidationHelper,EhrLocalizationHelper,EhrDepsHelper,EhrApiServiceFactory,EhrLayoutHelper){
return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-quantity.html",scope:!0,controller:function($scope){$scope.suppressLabel=$scope.model.getViewConfig().isLabelHidden(),$scope.quantityValue=function(){return 2==arguments.length&&""==arguments[0]&&arguments[1]>=0?$scope.model.magnitudeValue("",arguments[1],!0):2==arguments.length&&null===arguments[0]&&arguments[1]>=0?$scope.model.removeValue(arguments[1]):$scope.model.getValue()},$scope.hideUnit=function(){return"true"==$scope.model.annotationValue("hideUnit")},$scope.list=function(){return $scope.model.getInputFor("unit").getList()},$scope.presentation=function(){return $scope.unitField()&&$scope.unitField().getPresentation()?$scope.unitField().getPresentation():thinkehr.f4.FieldPresentation.COMBOBOX},$scope.isLabelUnit=function(){return 1===$scope.list().length},$scope.isComboUnit=function(){return!$scope.isLabelUnit()&&$scope.presentation()===thinkehr.f4.FieldPresentation.COMBOBOX},$scope.isRadiosUnit=function(){return!$scope.isLabelUnit()&&$scope.presentation()===thinkehr.f4.FieldPresentation.RADIOS},$scope.unitField=function(){return $scope.model.getViewConfig().getField("unit")},$scope.magnitudeField=function(){return $scope.model.getViewConfig().getField("magnitude")}},link:function($scope,element){$scope.hasValidation=function(){if($scope.model.isRequired())return!0;for(var unitInput=$scope.model.getInputFor("unit"),i=0;i<unitInput.getList().length;i++)if($scope.model.getRangeForUnit(i))return!0;return!1},$scope.disableCustomFunction||EhrApiServiceFactory.setupCustomFunction($scope,$scope.model,element)}}}]),module.directive("ehrQuantityField",["$timeout","EhrValidationHelper","EhrLocalizationHelper","EhrDepsHelper","EhrApiServiceFactory","EhrLayoutHelper",function($timeout,EhrValidationHelper,EhrLocalizationHelper,EhrDepsHelper,EhrApiServiceFactory,EhrLayoutHelper){return{restrict:"A",templateUrl:"",scope:!0,require:["ehrSingleFieldMultiItem","^^ehrQuantity","ehrQuantityField"],controller:function($scope){this.multiItemCtrl=null,EhrLocalizationHelper.generateKendoName("magnitude_quantity",$scope,!0,"_kendoMagName","kendoMagName"),EhrLocalizationHelper.generateKendoName("unit_quantity",$scope,!0,"_kendoUnitName","kendoUnitName"),$scope.precision=function(){var precision=$scope.model.getPrecisionForUnit(0);return null==precision?2:precision.max}(),$scope.format=function(){return"n"+$scope.precision}(),$scope.step=function(){return 1/Math.pow(10,$scope.precision)}(),this._minValue=function(unit){var minValue=$scope.model.getMinValueForUnit(unit);return minValue?($scope._minValueObj=minValue,minValue.min):null},this._maxValue=function(unit){var maxValue=$scope.model.getMaxValueForUnit(unit);return maxValue?($scope._maxValueObj=maxValue,maxValue.max):null};var minValue=this._minValue(0),maxValue=this._maxValue(0);$scope.magnitudeOptions={culture:$scope.EhrContext.locale,decimals:$scope.precision,format:$scope.format,step:$scope.step},angular.isNumber(minValue)&&($scope.minValue=minValue,$scope.minValueOp=$scope._minValueObj.minOp||">="),angular.isNumber(maxValue)&&($scope.maxValue=maxValue,$scope.maxValueOp=$scope._maxValueObj.maxOp||"<="),$scope.$watch("precision",function(newVal,oldVal){if(newVal!==oldVal){var input=$scope[$scope.kendoMagName()];input&&(input.options.decimals=$scope.precision,input.options.format=$scope.format,input.options.culture=$scope.EhrContext.locale,input.step($scope.step),$timeout(function(){var input=$scope[$scope.kendoMagName()];input&&input.focus();var select=$scope[$scope.kendoUnitName()];if(select)select.focus();else if(select=$("ehr-form form ehr-quantity select[name='"+$scope.unitName()+"'].ehr-combo"),select.length>0){var s=$(select).data("kendoComboBox");s.focus()}}))}}),$scope.isLabelUnit()&&$timeout(function(){$scope.unitFieldValue($scope.list()[0].getLabel())})},link:function($scope,element,attrs,controllers){var multiItemCtrl=controllers[0],currMultiIndex=multiItemCtrl.getMultiIndex(),ctrl=controllers[2];$scope.unitFieldValue=function(value){var val=$scope.model.unitValue.apply($scope.model,[value,currMultiIndex]);if(arguments.length>0){var u=null!=val&&void 0!==val?val:0,precision=$scope.model.getPrecisionForUnit(u);null==precision?$scope.precision=2:$scope.precision=precision.max,$scope.format="n"+$scope.precision,$scope.step=1/Math.pow(10,$scope.precision),$scope.magnitudeOptions.decimals=$scope.precision,$scope.magnitudeOptions.format=$scope.format,$scope.magnitudeOptions.step=$scope.step;var minValue=ctrl._minValue(u);angular.isNumber(minValue)&&($scope.minValue=minValue,$scope.minValueOp=$scope._minValueObj.minOp?$scope._minValueObj.minOp:">=");var maxValue=ctrl._maxValue(u);angular.isNumber(maxValue)&&($scope.maxValue=maxValue,$scope.maxValueOp=$scope._maxValueObj.maxOp?$scope._maxValueObj.maxOp:"<=")}return val},$scope.magnitudeFieldValue=function(value){var val=$scope.model.magnitudeValue.apply($scope.model,[value,currMultiIndex]);return val},$scope._uniqueId=$scope.model.getSanitizedUniqueId()+"_"+currMultiIndex,$scope.magnitudeName=function(){return $scope._magnitudeName||($scope._magnitudeName=EhrLayoutHelper.getFormId($scope)+"_magnitude_quantity_"+$scope._uniqueId),$scope._magnitudeName},$scope.unitName=function(){return $scope._unitName||($scope._unitName=EhrLayoutHelper.getFormId($scope)+"_unit_quantity_"+$scope._uniqueId),$scope._unitName},$scope.unitChanged=function(e){var comboBox=e.sender;comboBox&&comboBox.value()&&comboBox.selectedIndex<0&&($scope.unitFieldValue(null),$scope.$digest())},$scope.unitRbGroupName=function(){return $scope._unitRbGroupName||($scope._unitRbGroupName="ehr_rb_group_"+$scope.unitName()),$scope._unitRbGroupName},$scope.model.onModelRefreshed(function(){$scope.magnitude=$scope.magnitudeFieldValue()}),$scope.unitRequired=function(){var req=$scope.model.isRequired();return req},EhrDepsHelper.processModelDeps($scope,function(){var magnitudeFieldValue=$scope.magnitudeFieldValue();return null==magnitudeFieldValue&&(magnitudeFieldValue=""),EhrDepsHelper.depsValueFactory(magnitudeFieldValue.toString()+$scope.unitFieldValue())},!1,!0);var unitName=$scope.isComboUnit()?$scope.unitName():$scope.unitRbGroupName();EhrValidationHelper.registerCompoundFormInputsModifyChains($scope,[$scope.magnitudeName(),unitName]),$scope.ehrFormInputs().length>0&&EhrValidationHelper.syncNgClasses($scope,element,[0],["input.ehr-number"])}}}]),module.directive("ehrDuration",["$timeout","EhrValidationHelper","EhrLocalizationHelper","EhrDepsHelper","EhrLayoutHelper","EhrNgUtil","EhrApiServiceFactory",function($timeout,EhrValidationHelper,EhrLocalizationHelper,EhrDepsHelper,EhrLayoutHelper,EhrNgUtil,EhrApiServiceFactory){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-duration.html",scope:!0,controller:function($scope){$scope.suppressLabel=$scope.model.getViewConfig().isLabelHidden(),$scope.durationValue=function(value){return $scope.model.durationValue.apply($scope.model,arguments)},$scope.durationOptions={culture:$scope.EhrContext.locale,decimals:0,format:"n0",step:1},$scope.fieldLabel=function(suffix){var language=$scope.EhrContext?$scope.EhrContext.language:null;return thinkehr.f4.dict.tr("duration."+suffix,language)},$scope.fieldPlaceholder=function(suffix){var language=$scope.EhrContext?$scope.EhrContext.language:null;return thinkehr.f4.dict.tr("duration."+suffix+".ph",language)},$scope.durationInputClass=function(suffix){var c=EhrLayoutHelper.computeFieldClass($scope.model);return c.push("ehr-duration-"+suffix),c},$scope.isHiddenColumn=function(column){for(var i=0;i<column.length;i++){var input=column[i];if(!$scope.model.isFieldHidden(input.getSuffix()))return!1}return!0},$scope.minValueFor=function(suffix){return $scope.model.minValueFor(suffix)},$scope.minOperatorFor=function(suffix){return $scope.model.minOperatorFor(suffix)},$scope.maxValueFor=function(suffix){return $scope.model.maxValueFor(suffix)},$scope.maxOperatorFor=function(suffix){return $scope.model.maxOperatorFor(suffix)}},link:function($scope,element){$scope.$watch("model",function(newModel){newModel&&newModel.durationValue()}),$scope.hasValidation=function(){return $scope.model.hasValidation()},$scope.disableCustomFunction||EhrApiServiceFactory.setupCustomFunction($scope,$scope.model,element)}}}]),module.directive("ehrDurationField",["$timeout","EhrValidationHelper","EhrLocalizationHelper","EhrDepsHelper","EhrLayoutHelper","EhrNgUtil","EhrApiServiceFactory",function($timeout,EhrValidationHelper,EhrLocalizationHelper,EhrDepsHelper,EhrLayoutHelper,EhrNgUtil,EhrApiServiceFactory){return{restrict:"A",template:"",scope:!0,require:["ehrSingleFieldMultiItem","^^ehrDuration"],controller:function($scope){$scope.suppressLabel=$scope.model.getViewConfig().isLabelHidden(),EhrLocalizationHelper.generateKendoName("duration",$scope)},link:function($scope,element,attrs,controllers){function _inputFor(suffix){var input=$scope.model.getInputFor(suffix);input&&_inputs.push(input)}function findInputByName($name){for(var inputs=$scope.durationInputs(),i=0;i<inputs.length;i++){var input=inputs[i],dn=$scope.durationName(input.getSuffix());if(dn===$name)return input}return null}var multiItemCtrl=controllers[0],currMultiIndex=multiItemCtrl.getMultiIndex();$scope.currMultiIndex=currMultiIndex,$scope.durationFieldValue=function(value){return multiItemCtrl.ehrSingleFieldMultiItemValue.apply(multiItemCtrl,arguments)},$scope.durationFieldValue(),$scope.durationName=function(suffix){var dn=EhrLayoutHelper.getFormId($scope)+"_duration_"+$scope.model.getSanitizedUniqueId()+"_"+currMultiIndex;return angular.isDefined(suffix)&&(dn+="_"+suffix),dn},$scope.durationFieldInputValue={year:function(value){return $scope.model.yearsValue(value,currMultiIndex)},month:function(value){return $scope.model.monthsValue(value,currMultiIndex)},week:function(value){return $scope.model.weeksValue(value,currMultiIndex)},day:function(value){return $scope.model.daysValue(value,currMultiIndex)},hour:function(value){return $scope.model.hoursValue(value,currMultiIndex)},minute:function(value){return $scope.model.minutesValue(value,currMultiIndex)},second:function(value){return $scope.model.secondsValue(value,currMultiIndex)}};var _inputs=[];$scope.durationInputs=function(){return 0===_inputs.length&&angular.forEach($scope.model.getFieldNames(),function(fieldName){_inputFor(fieldName)}),_inputs},$scope.columns=function(){if(!$scope._columns){$scope._columns=[];var di=$scope.durationInputs(),cc=EhrLayoutHelper.distributeColumns($scope.model.columns(),di.length);angular.forEach(cc,function(c){var col=[];angular.forEach(c,function(ci){col.push(di[ci])}),$scope._columns.push(col)})}return $scope._columns};var inputs=$scope.durationInputs(),inputNames=[],inputSelectors=[];angular.forEach(inputs,function(input){inputNames.push($scope.durationName(input.getSuffix())),inputSelectors.push("input.ehr-duration-input.ehr-duration-"+input.getSuffix())}),EhrValidationHelper.registerCompoundFormInputsModifyChains($scope,inputNames);var iwDeReg=$scope.$watchCollection(function(){return $scope.ehrFormInputs()},function(formInputs){formInputs.indexOf(null)<0&&(formInputs.length>0&&EhrValidationHelper.syncNgClasses($scope,element,formInputs.length,inputSelectors),iwDeReg.call(null),$scope.hasValidation()&&$scope.$watch(function(){return $scope.durationValue()},function(newValue){angular.forEach($scope.ehrFormInputs(),function(fi){if(fi)if(newValue&&thinkehr.f4.util.isArray(newValue)&&(newValue=newValue[currMultiIndex]),EhrNgUtil.isEmpty(newValue))fi.$setValidity("min",!0);else if(EhrNgUtil.isEmpty(fi.$modelValue)){var validation=fi._ehrModelValidation;if(!validation){var input=findInputByName(fi.$name);validation=input?input.getValidation()||{}:{},fi._ehrModelValidation=validation}validation.range&&validation.range.min&&fi.$setValidity("min",!1)}})},!0))});$scope.showErrorMessageRequired=function(){var error=$scope.showErrorMessage();return error&&error.required?error:null},$scope.showErrorMessageField=function(suffix){for(var dn=$scope.durationName(suffix),inputs=$scope.ehrFormInputs(),i=0;i<inputs.length;i++){var input=inputs[i];if(input&&input.$name===dn){var touched=input.$dirty||input.$touched;if(!touched){var form=$scope.ehrForm();form&&form.$submitted&&(touched=!0)}return touched&&input.$error&&(input.$error.min||input.$error.max)?input.$error:null}}return null},EhrDepsHelper.processModelDeps($scope,function(){return EhrDepsHelper.depsValueFactory($scope.durationFieldValue())},!1,!0)}}}]),module.directive("ehrCustom",["$q","EhrApiServiceFactory","EhrLayoutHelper",function($q,EhrApiServiceFactory,EhrLayoutHelper){return{restrict:"EA",templateUrl:"thinkehr/f4/templates/ehr-custom.html",scope:!0,require:["ehrCustom","^^?ehrForm"],controller:function($scope){$scope.customName=function(){return EhrLayoutHelper.getFormId($scope)+"_ehr_custom_"+$scope.model.getSanitizedUniqueId()}},link:function($scope,$element,attrs,controllers){$scope.ehrFormCtrl=controllers[1];var contentEl=$element.find(".ehr-field-content.custom"),funcName=$scope.model.getCustomFunction();funcName||contentEl.append('<span class="ehr-custom-error no-init">No initialization function specified for this custom component.</span>');var delegateModel=$scope.model.getDelegateModel();$scope.suppressLabel=delegateModel.getViewConfig().isLabelHidden();var exeCFPromise=EhrApiServiceFactory.executeCustomFunction(delegateModel,$scope,null,funcName);exeCFPromise.then(function(newCustomElement){contentEl.append(newCustomElement)},function(errorObj){var $messageEl=$('<span class="ehr-custom-error"><span class="ehr-custom-error-icon"></span> <span class="ehr-custom-error-text">Error with initializing custom function.</span></span>'),$errorTextEl=$($(".ehr-custom-error-text",$messageEl));if(contentEl.append($messageEl),errorObj.message)switch(errorObj.errorId){case 2:$errorTextEl.text("No initialization function specified for this custom component");break;default:$errorTextEl.text(errorObj.message)}if(null!=errorObj.errorId)switch(errorObj.errorId){case 0:$messageEl.addClass("eval");break;case 1:$messageEl.addClass("reject");break;case 2:$messageEl.addClass("no-func-name");break;case 3:$messageEl.addClass("eval func-not-defined")}})}}}]),module.directive("ehrPlaceholder",[function(){return{restrict:"A",scope:!1,link:function(scope,element,attrs){var plValue="";attrs.ehrPlaceholder&&(plValue=attrs.ehrPlaceholder),element.placeholder=plValue,$(element).attr("placeholder",plValue)}}}]),module.directive("ehrColumnGap",[function(){return{restrict:"E",template:"",scope:{last:"=",observe:"="},link:function($scope,element){function setClassName(last){last===!0?element[0].className+=" last":element[0].className="ng-isolate-scope"}$scope.last===!0&&setClassName(!0),$scope.observe===!0&&$scope.$watch("last",function(newValue,oldValue){oldValue!==newValue&&setClassName(newValue)})}}}]),module.directive("ehrRowGap",[function(){return{restrict:"E",template:"",scope:{last:"=",observe:"="},link:function($scope,element){function setClassName(last){last===!0?element[0].className+=" last":element[0].className="ng-isolate-scope"}$scope.last===!0&&setClassName(!0),$scope.observe===!0&&$scope.$watch("last",function(newValue,oldValue){oldValue!==newValue&&setClassName(newValue)})}}}]),module.directive("ehrLabelGap",[function(){return{restrict:"E",template:"",scope:{}}}]),module.directive("ehrSingleFieldMultiHolder",[function(){return{restrict:"A",template:"",controller:function($scope){this.getMultiArrayValueFn=null,this.removeMultiFieldEnabled=function(){return $scope.singleFieldMultiValuesList.length>$scope.model.getMin()},this.addMultiFieldEnabled=function(){return $scope.singleFieldMultiValuesList.length<$scope.model.getMax()||-1==$scope.model.getMax()}},compile:function(){return{pre:function(scope){},post:function($scope,element,attr,controller){if(controller.getMultiArrayValueFn=$scope[attr.ehrSingleFieldMultiHolder],attr.ehrSingleFieldMultiHolder?controller.getMultiArrayValueFn||console.error("Multi arr value with name="+attr.ehrSingleFieldMultiHolder+" not found on scope!"):console.error("attr.ehrSingleFieldMultiHolder not defined"),$scope.singleFieldMultiValuesList=[],null==$scope.isMulti&&($scope.isMulti=function(){return $scope.model.isMulti()}),$scope.isMulti())$scope.$watch(function(){return controller.getMultiArrayValueFn()},function(newVal,oldVal){var min=$scope.model.getMin()||1;newVal||(newVal=[]),$scope.singleFieldMultiValuesList=newVal;var delta=min-newVal.length;if(delta>0)for(var i=0;delta>i;i++)newVal.push("")},!0);else{var modelVal=controller.getMultiArrayValueFn();modelVal=modelVal&&!thinkehr.f4.util.isArray(modelVal)?[modelVal]:[{}],$scope.singleFieldMultiValuesList=modelVal}}}}}}]),module.directive("ehrSingleFieldMultiItem",[function(){return{restrict:"A",template:"",priority:1,require:["ehrSingleFieldMultiItem","^^ehrSingleFieldMultiHolder"],controller:function($scope,$filter){this.ehrSingleFieldMultiHolderController=null,this.addMultiField=function(){this.ehrSingleFieldMultiHolderController.getMultiArrayValueFn("",$scope.singleFieldMultiValuesList.length)},this.removeMultiField=function(){this.ehrSingleFieldMultiHolderController.getMultiArrayValueFn(null,this.getMultiIndex())},this.anyTextValueEmpty=function(){return $filter("filter")($scope.singleFieldMultiValuesList,function(value){return null==value||!thinkehr.f4.util.isString(value)&&!thinkehr.f4.util.isObject(value)&&isNaN(value)||value.toString().length<1}).length>0},this.getMultiIndex=function(){return void 0===$scope.$parent.$index&&console.warn("$scope.$parent is not ngFqor directive."),$scope.$parent.$index},this.ehrSingleFieldMultiItemValue=function(value,modelPropertyName){var multiInd=$scope.$index;return this.ehrSingleFieldMultiHolderController.getMultiArrayValueFn(value,multiInd,modelPropertyName)}},compile:function(){return{pre:function(scope,element,attr,controllers){controllers[0].ehrSingleFieldMultiHolderController=controllers[1];var singleFieldGetterSetterName=attr.ehrSingleFieldMultiItem;singleFieldGetterSetterName&&(scope[singleFieldGetterSetterName]=controllers[0].ehrSingleFieldMultiItemValue)}}}}}]),module.directive("ehrSingleFieldMultiControls",[function(){return{restrict:"E",require:["^^ehrSingleFieldMultiItem","^^ehrSingleFieldMultiHolder"],templateUrl:"thinkehr/f4/templates/ehr-single-field-multi-controls.html",link:function($scope,element,attr,ctrls){var ehrSingleFieldMultiItemCtrl=ctrls[0],ehrSingleFieldMultiHolder=ctrls[1];$scope.removeMultiField=function(){return $scope.removeMultiFieldEnabled()?ehrSingleFieldMultiItemCtrl.removeMultiField():void console.warn("Disabled removing multi field.")},$scope.anyTextValueEmpty=function(){return ehrSingleFieldMultiItemCtrl.anyTextValueEmpty()},$scope.addMultiField=function(){return $scope.addMultiFieldEnabled()?ehrSingleFieldMultiItemCtrl.addMultiField():void console.warn("Disabled adding multi field.")},$scope.removeMultiFieldEnabled=function(){return ehrSingleFieldMultiHolder.removeMultiFieldEnabled()},$scope.addMultiFieldEnabled=function(){return ehrSingleFieldMultiHolder.addMultiFieldEnabled()}}}}]),module.filter("trustUrl",function($sce){return function(url){return $sce.trustAsResourceUrl(url)}}),module.directive("frangTree",function($parse,$animate){return{restrict:"EA",controller:function($scope,$element){this.insertChildren=null,this.init=function(insertChildren){this.insertChildren=insertChildren}}}}),module.directive("frangTreeRepeat",function($parse,$animate){function hashKey(obj){var key,objType=typeof obj;return"object"==objType&&null!==obj?"function"==typeof(key=obj.$$hashKey)?key=obj.$$hashKey():void 0===key&&(key=obj.$$hashKey=nextUid()):key=obj,objType+":"+key}function isArrayLike(obj){if(null==obj||isWindow(obj))return!1;var length=obj.length;return 1===obj.nodeType&&length?!0:isString(obj)||isArray(obj)||0===length||"number"==typeof length&&length>0&&length-1 in obj}function isWindow(obj){return obj&&obj.document&&obj.location&&obj.alert&&obj.setInterval}function isString(value){return"string"==typeof value}function isArray(value){return"[object Array]"==toString.apply(value)}function nextUid(){for(var digit,index=uid.length;index;){if(index--,digit=uid[index].charCodeAt(0),57==digit)return uid[index]="A",uid.join("");if(90!=digit)return uid[index]=String.fromCharCode(digit+1),uid.join("");uid[index]="0"}return uid.unshift("0"),uid.join("")}function assertNotHasOwnProperty(name,context){if("hasOwnProperty"===name)throw ngMinErr("badname","hasOwnProperty is not a valid {0} name",context)}function minErr(module){return function(){var message,i,code=arguments[0],prefix="["+(module?module+":":"")+code+"] ",template=arguments[1],templateArgs=arguments,stringify=function(obj){return isFunction(obj)?obj.toString().replace(/ \{[\s\S]*$/,""):isUndefined(obj)?"undefined":isString(obj)?obj:JSON.stringify(obj)};for(message=prefix+template.replace(/\{\d+\}/g,function(match){var arg,index=+match.slice(1,-1);return index+2<templateArgs.length?(arg=templateArgs[index+2],isFunction(arg)?arg.toString().replace(/ ?\{[\s\S]*$/,""):isUndefined(arg)?"undefined":isString(arg)?arg:toJson(arg)):match}),message=message+"\nhttp://errors.angularjs.org/"+version.full+"/"+(module?module+"/":"")+code,i=2;i<arguments.length;i++)message=message+(2==i?"?":"&")+"p"+(i-2)+"="+encodeURIComponent(stringify(arguments[i]));return new Error(message)}}function getBlockElements(block){if(block.startNode===block.endNode)return jqLite(block.startNode);var element=block.startNode,elements=[element];do{if(element=element.nextSibling,!element)break;elements.push(element)}while(element!==block.endNode);return jqLite(elements)}function addRepeatWatch($scope,$element,_lastBlockMap,valueIdentifier,keyIdentifier,rhs,trackByIdExpFn,trackByIdArrayFn,trackByIdObjFn,linker,expression){var lastBlockMap=_lastBlockMap;$scope.$watchCollection(rhs,function(collection){var index,length,nextNode,arrayLength,childScope,key,value,trackById,trackByIdFn,collectionKeys,block,elementsToRemove,previousNode=$element[0],nextBlockMap={},nextBlockOrder=[];if(isArrayLike(collection))collectionKeys=collection,trackByIdFn=trackByIdExpFn||trackByIdArrayFn;else{trackByIdFn=trackByIdExpFn||trackByIdObjFn,collectionKeys=[];for(key in collection)collection.hasOwnProperty(key)&&"$"!=key.charAt(0)&&collectionKeys.push(key);collectionKeys.sort()}for(arrayLength=collectionKeys.length,length=nextBlockOrder.length=collectionKeys.length,index=0;length>index;index++)if(key=collection===collectionKeys?index:collectionKeys[index],value=collection[key],trackById=trackByIdFn(key,value,index),assertNotHasOwnProperty(trackById,"`track by` id"),lastBlockMap.hasOwnProperty(trackById))block=lastBlockMap[trackById],delete lastBlockMap[trackById],nextBlockMap[trackById]=block,nextBlockOrder[index]=block;else{if(nextBlockMap.hasOwnProperty(trackById))throw forEach(nextBlockOrder,function(block){block&&block.startNode&&(lastBlockMap[block.id]=block)}),ngRepeatMinErr("dupes","Duplicates in a repeater are not allowed. Use 'track by' expression to specify unique keys. Repeater: {0}, Duplicate key: {1}",expression,trackById);nextBlockOrder[index]={id:trackById},nextBlockMap[trackById]=!1}for(key in lastBlockMap)lastBlockMap.hasOwnProperty(key)&&(block=lastBlockMap[key],elementsToRemove=getBlockElements(block),$animate.leave(elementsToRemove),forEach(elementsToRemove,function(element){element[NG_REMOVED]=!0}),block.scope.$destroy());for(index=0,length=collectionKeys.length;length>index;index++){if(key=collection===collectionKeys?index:collectionKeys[index],value=collection[key],block=nextBlockOrder[index],nextBlockOrder[index-1]&&(previousNode=nextBlockOrder[index-1].endNode),block.startNode){childScope=block.scope,nextNode=previousNode;do nextNode=nextNode.nextSibling;while(nextNode&&nextNode[NG_REMOVED]);block.startNode==nextNode||$animate.move(getBlockElements(block),null,jqLite(previousNode)),previousNode=block.endNode}else childScope=$scope.$new();childScope[valueIdentifier]=value,keyIdentifier&&(childScope[keyIdentifier]=key),childScope.$index=index,childScope.$first=0===index,childScope.$last=index===arrayLength-1,childScope.$middle=!(childScope.$first||childScope.$last),childScope.$odd=!(childScope.$even=index%2==0),block.startNode||linker(childScope,function(clone){clone[clone.length++]=document.createComment(" end ngRepeat: "+expression+" "),$animate.enter(clone,null,jqLite(previousNode)),previousNode=clone,block.scope=childScope,block.startNode=previousNode&&previousNode.endNode?previousNode.endNode:clone[0],block.endNode=clone[clone.length-1],nextBlockMap[block.id]=block})}lastBlockMap=nextBlockMap})}var uid=["0","0","0"],jqLite=angular.element,forEach=angular.forEach,NG_REMOVED="$$NG_REMOVED",ngRepeatMinErr=minErr("ngRepeat"),ngMinErr=minErr("ng"),toString=Object.prototype.toString,isFunction=angular.isFunction,isUndefined=angular.isUndefined,toJson=angular.toJson;return{restrict:"A",transclude:"element",priority:1e3,terminal:!0,require:"^frangTree",compile:function(element,attr,linker){return function($scope,$element,$attr,ctrl){var trackByExp,trackByExpGetter,trackByIdExpFn,trackByIdArrayFn,trackByIdObjFn,lhs,rhs,valueIdentifier,keyIdentifier,expression=$attr.frangTreeRepeat,match=expression.match(/^\s*(.+)\s+in\s+(.*?)\s*(\s+track\s+by\s+(.+)\s*)?$/),hashFnLocals={$id:hashKey};if(!match)throw ngRepeatMinErr("iexp","Expected expression in form of '_item_ in _collection_[ track by _id_]' but got '{0}'.",expression);if(lhs=match[1],rhs=match[2],trackByExp=match[4],trackByExp?(trackByExpGetter=$parse(trackByExp),trackByIdExpFn=function(key,value,index){return keyIdentifier&&(hashFnLocals[keyIdentifier]=key),hashFnLocals[valueIdentifier]=value,hashFnLocals.$index=index,trackByExpGetter($scope,hashFnLocals)}):(trackByIdArrayFn=function(key,value){return hashKey(value)},trackByIdObjFn=function(key){return key}),match=lhs.match(/^(?:([\$\w]+)|\(([\$\w]+)\s*,\s*([\$\w]+)\))$/),!match)throw ngRepeatMinErr("iidexp","'_item_' in '_item_ in _collection_' should be an identifier or '(_key_, _value_)' expression, but got '{0}'.",lhs);valueIdentifier=match[3]||match[1],keyIdentifier=match[2];addRepeatWatch($scope,$element,{},valueIdentifier,keyIdentifier,rhs,trackByIdExpFn,trackByIdArrayFn,trackByIdObjFn,linker,expression),ctrl.init(function($scope,$element,collection){addRepeatWatch($scope,$element,{},valueIdentifier,keyIdentifier,collection,trackByIdExpFn,trackByIdArrayFn,trackByIdObjFn,linker,expression)})}}}}),module.directive("frangTreeInsertChildren",function(){return{restrict:"EA",require:"^frangTree",link:function(scope,element,attrs,ctrl){var comment=document.createComment("treeRepeat");element.append(comment),ctrl.insertChildren(scope,angular.element(comment),attrs.frangTreeInsertChildren)}}}),module}function bootstrapModule(module,el){return angular.element(document).ready(function(){angular.bootstrap(el,[module.name]),console.info("Bootstrapped angular form module",module.name,".")}),module}createFormModule("fixed-angular-form","0.0.0",null,null,"thinkehrForms4"),thinkehr.f4.ng.createFormModule=createFormModule,thinkehr.f4.ng.bootstrapModule=bootstrapModule,thinkehr.f4.ng.createContextLocale=_createContext,thinkehr.f4.ng.getElementByModelId=function(model,underElement){return model?(underElement||(underElement=document.body),$('[id="'+model.getUniqueId()+'"]',underElement)):null},thinkehr.f4.ng.getElementByPathIdString=function(modelPathId,underElement){return $('[data-ehr-path="'+modelPathId+'"]',underElement)},thinkehr.f4.ng.getElementByPathId=function(model,underElement){underElement||(underElement=document.body);var pathId=thinkehr.f4.util.isString(model)?model:model.getPath();return thinkehr.f4.ng.getElementByPathIdString(pathId,underElement)},thinkehr.f4.ng.componentPlacement={POSITION_LABEL_START:"labelStart",POSITION_LABEL_END:"labelEnd",POSITION_CONTENT_START:"contentStart",POSITION_CONTENT_END:"contentEnd"},thinkehr.f4.ng.getFormApiObject=function(deferred,model,scope,$rootScope,$compile,element,externalContext,watchConfig,$q){return{deferred:deferred,model:model,scope:scope,rootScope:$rootScope,compile:$compile,element:element,externalContext:externalContext,withinAngular:function(f){$rootScope.$apply(f)},watchExpression:function(funcExpression,callback,deep){watchConfig.initialized?scope.$watch(funcExpression,callback,deep):watchConfig.watchExpressions.push([funcExpression,callback,deep])},onValueUpdate:function(model,valueFnStr,callbackFn,callbackPropName,callbackContext){if(model){var modelPropWatch=function(){return model[valueFnStr]()},listenerFn=function(newVal,oldVal){if(newVal!=oldVal){var cbObj=null;callbackPropName?(cbObj={},cbObj[callbackPropName]=newVal):cbObj=newVal,callbackContext?callbackFn.apply(callbackContext,[cbObj]):callbackFn(cbObj)}};watchConfig.initialized?scope.$watch(modelPropWatch,listenerFn):watchConfig.watchExpressions.push([modelPropWatch,listenerFn])}},findModelWithTag:function(tagName,searchFromRootOnly,disableAnnTagNamesFromRoot){if(this.model.getViewConfig().hasAnnotation(tagName)&&(tagName=this.model.getViewConfig().annotationValue(tagName),disableAnnTagNamesFromRoot||(searchFromRootOnly=!0)),!searchFromRootOnly){var searchFromModel=this.model.findAncestorContainer(!0);if(searchFromModel){var modelWithTagWithinFieldset=searchFromModel.findSuccessorWithTag(tagName);if(modelWithTagWithinFieldset)return modelWithTagWithinFieldset}var ancestorModelWithTag=this.model.findAncestorWithTag(tagName,!0);if(ancestorModelWithTag)return ancestorModelWithTag}return this.scope.model.getRootModel().findSuccessorWithTag(tagName)},findModelsWithTag:function(tagName,searchFromRootOnly,disableAnnTagNamesFromRoot){if(this.model.getViewConfig().hasAnnotation(tagName)&&(tagName=this.model.getViewConfig().annotationValue(tagName),disableAnnTagNamesFromRoot||(searchFromRootOnly=!0)),!searchFromRootOnly){var searchFromModel=this.model.findAncestorContainer(!0);if(searchFromModel){var modelWithTagWithinFieldset=searchFromModel.findSuccessorsWithTag(tagName);if(modelWithTagWithinFieldset)return modelWithTagWithinFieldset}var ancestorModelWithTag=this.model.findAncestorWithTag(tagName,!0);if(ancestorModelWithTag)return ancestorModelWithTag}return this.scope.model.getRootModel().findSuccessorsWithTag(tagName)},getElementByModelId:thinkehr.f4.ng.getElementByModelId,getElementByPathId:thinkehr.f4.ng.getElementByPathIdString,getAfterInputsHolder:function(){return this._getElementsByClassName("content-end-position-holder")[0]},getBeforeInputsHolder:function(){return this._getElementsByClassName("content-start-position-holder")[0]},getFieldContentHolder:function(){return this._getElementsByClassName("ehr-field-content")[0]},_getElementsByClassName:function(className){return this.element?this.element[0].getElementsByClassName(className):null},addHtmlAfterInputs:function(ngTemplateString,optionalNewScope){var appendTo=this.getAfterInputsHolder();if(appendTo){optionalNewScope=optionalNewScope?optionalNewScope:this.scope;var newElement=this.compile(ngTemplateString)(optionalNewScope)[0];return appendTo.appendChild(newElement),newElement}return null},addHtmlBeforeInputs:function(ngTemplateString,optionalNewScope){var appendTo=this.getBeforeInputsHolder();if(appendTo){optionalNewScope=optionalNewScope?optionalNewScope:this.scope;var newElement=this.compile(ngTemplateString)(optionalNewScope)[0];return appendTo.appendChild(newElement),newElement}return null},getFieldInputsHolderCompiled:function(){return this._getElementAfterCompilation("field-content-holder")},getLabelHolderCompiled:function(){return this._getElementAfterCompilation("ehr-label-content")},getElementCompiled:function(){return this._getElementAfterCompilation()},_getElementAfterCompilation:function(className){var resDefer=$q.defer();return setTimeout(function(){var retElement=className?this._getElementsByClassName(className)[0]:this.element[0];resDefer.resolve(retElement)}.bind(this)),resDefer.promise},getFormElement:function(){return $("[name='"+this.scope.formName()+"']").get(0)},selectTabByModel:function(tabModel,dontSelectParentTabs){
tabModel=tabModel.findAncestorWithAnnotation("tab",null,!0);var tabGroupHolderModel=tabModel.getParentModel();this.scope.ehrFormCtrl.setSelectTabModelPathId(tabGroupHolderModel.getPath(),tabModel.annotationValue("tab"),tabModel.getPath());for(var formEl=this.getFormElement(),i=0;i<tabGroupHolderModel.getChildCount();i++){var childModel=tabGroupHolderModel.getChildModel(i);if(childModel.hasAnnotation("tab")){var tabEl=this.getElementByModelId(childModel,formEl);if(tabEl.length&&tabEl.scope){tabEl.scope().selectTab(tabEl.scope().getTabObj(tabModel));break}}}if(dontSelectParentTabs!==!0){var parentTab=tabGroupHolderModel.findAncestorWithAnnotation("tab",null,!0);parentTab&&this.selectTabByModel(parentTab,dontSelectParentTabs)}}}}}();