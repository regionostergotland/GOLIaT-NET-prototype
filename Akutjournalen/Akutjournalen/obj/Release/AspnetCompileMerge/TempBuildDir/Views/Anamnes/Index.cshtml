@section scripts{

<script src="~/Scripts/angular.js"></script>    
 
  <script type="text/javascript">

    //var baseUrl = 'https://rest.ehrscape.com/rest/v1';
    //var queryUrl = baseUrl + '/query';
    //var username = 'Carlos.Ortiz@regionostergotland.se'
    //var password = 'Cortiz13112015'
   
      $(document).on("click", ".open-AddBookDialog", function () {
          var myBookId = $(this).data('id');
          
          reFreshTable(myBookId)
          $(".modal-body #bookId").val(myBookId);
      });



    $(document).ready(function () {
              
        
    });
</script>
 

<script>

    var baseUrl = "https://rest.ehrscape.com/rest/v1"
    var ehrId = "28ac8bbc-eb14-4f01-a30d-bcff446e0bd4"
    var username = "guidemo"
    var password = "gui?!demo123"

    
    //var baseUrl = 'https://rest.ehrscape.com/rest/v1';
    var baseUrl = 'https://rest.ehrscape.com/thinkcds/rest/v1'
    //var queryUrl = baseUrl + '/query';
    username = 'Carlos.Ortiz@regionostergotland.se'
    password = 'Cortiz13112015'

    function getSessionId() {

        var response = $.ajax({
            type: "POST",
            url: baseUrl + "/session?username=" + encodeURIComponent(username) +
                    "&password=" + encodeURIComponent(password),
            async: false
        });

        return response.responseJSON.sessionId;
    }

    var app = angular.module("myApp", []);
    
    app.controller("myCtrl", function ($scope) {
       
        sessionId = getSessionId()
        //alert(baseUrl + "/guide")

        $.ajax({
            url: baseUrl + "/guide",
            //url: "https://rest.ehrscape.com/ThinkCDS/services/CDSResources/guide",
            type: 'GET',
            headers: {
                "Ehr-Session": sessionId
            },
            error: function (jqXHR, exception) {
                alert(sessionId)
            },
            success: function (res) {                
                //alert(sessionId)
                //console.log(res)
                $scope.$apply(function () {                    
                    $scope.posts = res;
                });

            }
        });


    });


   
    app.controller('myCtrl2', function ($scope, $http) {
        
        $scope.getData = function (ID) {            
            
            
            sessionId = getSessionId()
            //console.log(baseUrl + "/guide/" + ID + "")

            $.ajax({
                //url: baseUrl + "/guide",
                url: baseUrl + "/guide/" + ID + "",
                type: 'GET',
                headers: {
                    "Ehr-Session": sessionId
                },
                error: function (jqXHR, exception) {
                    //alert("ERROR")
                },
                success: function (res) {
                                       
                    $(".modal-body #bookId").val(res);
                    $scope.$apply(function () {
                        $scope.rule = res;
                    });

                }
            });


        }

        $scope.getData();

    });

    function reFreshTable(ID) {
        
        var scope = angular.element(document.getElementById("MainWrap")).scope();

        scope.$apply(function () {
            scope.getData(ID);
        });

    }


 
</script>

}

<div class="row" ng-app="myApp">
    <div class="col-md-12">

        <div>
            <div class="box box-default table-responsive">
                <div class="box-header with-border">
                    <h5 class="box-title"><b>HEADER</b></h5>
                </div>
                

                    <!--Trigger the modal from text-->
                    <!--Modal-->
                    <div class="modal fade" id="myModal" role="dialog">
                        <div class="modal-dialog">

                            <!--Modal content-->
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal">&times;</button>
                                    <h4 class="modal-title">{{ data.id }}</h4>
                                </div>
                                <div class="modal-body" id="MainWrap" ng-controller="myCtrl2">

                                    <textarea rows="6" style="width:100%" typeof="text" name="bookId" id="bookId" value="{{ rule }}"></textarea>
                                </div>
                                <div class="modal-footer">
                                    
                                    
                                    
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Stäng</button>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="box-body table-responsive no-padding">
                        <div id="MainWrap" ng-controller="myCtrl">
                            <div class="box-header with-border">
                                <div class="box box-default table-responsive no-padding">
                                    <table class="table table-hover table-striped">
                                        <thead>
                                            <tr>
                                                <th style="width:50px">ID</th>
                                                <th style="width:70px">Description</th>
                                                <th style="width:80px">Use</th>
                                            </tr>
                                        </thead>

                                        <tr ng-repeat="data in posts">
                                            <td style="width: 50px;"><a href="#" data-toggle="modal" class="open-AddBookDialog" data-id="{{ data.id }}" data-target="#myModal">{{ data.id }}</a></td>
                                            <td style="width: 90px;">{{ data.id }}</td>
                                            <td style="width: 100px;">{{ data.id }}</td>
                                        </tr>
                                    </table>
                                </div>                            
                        </div>
                    </div>
                </div>




            </div>
        </div>
    </div>
